var Prototype={Version:"1.7",Browser:(function(){var ua=navigator.userAgent;var isOpera=Object.prototype.toString.call(window.opera)=="[object Opera]";return{IE:!!window.attachEvent&&!isOpera,Opera:isOpera,WebKit:ua.indexOf("AppleWebKit/")>-1,Gecko:ua.indexOf("Gecko")>-1&&ua.indexOf("KHTML")===-1,MobileSafari:/Apple.*Mobile/.test(ua)}})(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:(function(){var constructor=window.Element||window.HTMLElement;return !!(constructor&&constructor.prototype)})(),SpecificElementExtensions:(function(){if(typeof window.HTMLDivElement!=="undefined"){return true}var div=document.createElement("div"),form=document.createElement("form"),isSupported=false;if(div.__proto__&&(div.__proto__!==form.__proto__)){isSupported=true}div=form=null;return isSupported})()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(x){return x}};if(Prototype.Browser.MobileSafari){Prototype.BrowserFeatures.SpecificElementExtensions=false}var Abstract={};var Try={these:function(){var returnValue;for(var i=0,length=arguments.length;i<length;i++){var lambda=arguments[i];try{returnValue=lambda();break}catch(e){}}return returnValue}};var Class=(function(){var IS_DONTENUM_BUGGY=(function(){for(var p in {toString:1}){if(p==="toString"){return false}}return true})();function subclass(){}function create(){var parent=null,properties=$A(arguments);if(Object.isFunction(properties[0])){parent=properties.shift()}function klass(){this.initialize.apply(this,arguments)}Object.extend(klass,Class.Methods);klass.superclass=parent;klass.subclasses=[];if(parent){subclass.prototype=parent.prototype;klass.prototype=new subclass;parent.subclasses.push(klass)}for(var i=0,length=properties.length;i<length;i++){klass.addMethods(properties[i])}if(!klass.prototype.initialize){klass.prototype.initialize=Prototype.emptyFunction}klass.prototype.constructor=klass;return klass}function addMethods(source){var ancestor=this.superclass&&this.superclass.prototype,properties=Object.keys(source);if(IS_DONTENUM_BUGGY){if(source.toString!=Object.prototype.toString){properties.push("toString")}if(source.valueOf!=Object.prototype.valueOf){properties.push("valueOf")}}for(var i=0,length=properties.length;i<length;i++){var property=properties[i],value=source[property];if(ancestor&&Object.isFunction(value)&&value.argumentNames()[0]=="$super"){var method=value;value=(function(m){return function(){return ancestor[m].apply(this,arguments)}})(property).wrap(method);value.valueOf=method.valueOf.bind(method);value.toString=method.toString.bind(method)}this.prototype[property]=value}return this}return{create:create,Methods:{addMethods:addMethods}}})();(function(){var _toString=Object.prototype.toString,NULL_TYPE="Null",UNDEFINED_TYPE="Undefined",BOOLEAN_TYPE="Boolean",NUMBER_TYPE="Number",STRING_TYPE="String",OBJECT_TYPE="Object",FUNCTION_CLASS="[object Function]",BOOLEAN_CLASS="[object Boolean]",NUMBER_CLASS="[object Number]",STRING_CLASS="[object String]",ARRAY_CLASS="[object Array]",DATE_CLASS="[object Date]",NATIVE_JSON_STRINGIFY_SUPPORT=window.JSON&&typeof JSON.stringify==="function"&&JSON.stringify(0)==="0"&&typeof JSON.stringify(Prototype.K)==="undefined";function Type(o){switch(o){case null:return NULL_TYPE;case (void 0):return UNDEFINED_TYPE}var type=typeof o;switch(type){case"boolean":return BOOLEAN_TYPE;case"number":return NUMBER_TYPE;case"string":return STRING_TYPE}return OBJECT_TYPE}function extend(destination,source){for(var property in source){destination[property]=source[property]}return destination}function inspect(object){try{if(isUndefined(object)){return"undefined"}if(object===null){return"null"}return object.inspect?object.inspect():String(object)}catch(e){if(e instanceof RangeError){return"..."}throw e}}function toJSON(value){return Str("",{"":value},[])}function Str(key,holder,stack){var value=holder[key],type=typeof value;if(Type(value)===OBJECT_TYPE&&typeof value.toJSON==="function"){value=value.toJSON(key)}var _class=_toString.call(value);switch(_class){case NUMBER_CLASS:case BOOLEAN_CLASS:case STRING_CLASS:value=value.valueOf()}switch(value){case null:return"null";case true:return"true";case false:return"false"}type=typeof value;switch(type){case"string":return value.inspect(true);case"number":return isFinite(value)?String(value):"null";case"object":for(var i=0,length=stack.length;i<length;i++){if(stack[i]===value){throw new TypeError()}}stack.push(value);var partial=[];if(_class===ARRAY_CLASS){for(var i=0,length=value.length;i<length;i++){var str=Str(i,value,stack);partial.push(typeof str==="undefined"?"null":str)}partial="["+partial.join(",")+"]"}else{var keys=Object.keys(value);for(var i=0,length=keys.length;i<length;i++){var key=keys[i],str=Str(key,value,stack);if(typeof str!=="undefined"){partial.push(key.inspect(true)+":"+str)}}partial="{"+partial.join(",")+"}"}stack.pop();return partial}}function stringify(object){return JSON.stringify(object)}function toQueryString(object){return $H(object).toQueryString()}function toHTML(object){return object&&object.toHTML?object.toHTML():String.interpret(object)}function keys(object){if(Type(object)!==OBJECT_TYPE){throw new TypeError()}var results=[];for(var property in object){if(object.hasOwnProperty(property)){results.push(property)}}return results}function values(object){var results=[];for(var property in object){results.push(object[property])}return results}function clone(object){return extend({},object)}function isElement(object){return !!(object&&object.nodeType==1)}function isArray(object){return _toString.call(object)===ARRAY_CLASS}var hasNativeIsArray=(typeof Array.isArray=="function")&&Array.isArray([])&&!Array.isArray({});if(hasNativeIsArray){isArray=Array.isArray}function isHash(object){return object instanceof Hash}function isFunction(object){return _toString.call(object)===FUNCTION_CLASS}function isString(object){return _toString.call(object)===STRING_CLASS}function isNumber(object){return _toString.call(object)===NUMBER_CLASS}function isDate(object){return _toString.call(object)===DATE_CLASS}function isUndefined(object){return typeof object==="undefined"}extend(Object,{extend:extend,inspect:inspect,toJSON:NATIVE_JSON_STRINGIFY_SUPPORT?stringify:toJSON,toQueryString:toQueryString,toHTML:toHTML,keys:Object.keys||keys,values:values,clone:clone,isElement:isElement,isArray:isArray,isHash:isHash,isFunction:isFunction,isString:isString,isNumber:isNumber,isDate:isDate,isUndefined:isUndefined})})();Object.extend(Function.prototype,(function(){var slice=Array.prototype.slice;function update(array,args){var arrayLength=array.length,length=args.length;while(length--){array[arrayLength+length]=args[length]}return array}function merge(array,args){array=slice.call(array,0);return update(array,args)}function argumentNames(){var names=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return names.length==1&&!names[0]?[]:names}function bind(context){if(arguments.length<2&&Object.isUndefined(arguments[0])){return this}var __method=this,args=slice.call(arguments,1);return function(){var a=merge(args,arguments);return __method.apply(context,a)}}function bindAsEventListener(context){var __method=this,args=slice.call(arguments,1);return function(event){var a=update([event||window.event],args);return __method.apply(context,a)}}function curry(){if(!arguments.length){return this}var __method=this,args=slice.call(arguments,0);return function(){var a=merge(args,arguments);return __method.apply(this,a)}}function delay(timeout){var __method=this,args=slice.call(arguments,1);timeout=timeout*1000;return window.setTimeout(function(){return __method.apply(__method,args)},timeout)}function defer(){var args=update([0.01],arguments);return this.delay.apply(this,args)}function wrap(wrapper){var __method=this;return function(){var a=update([__method.bind(this)],arguments);return wrapper.apply(this,a)}}function methodize(){if(this._methodized){return this._methodized}var __method=this;return this._methodized=function(){var a=update([this],arguments);return __method.apply(null,a)}}return{argumentNames:argumentNames,bind:bind,bindAsEventListener:bindAsEventListener,curry:curry,delay:delay,defer:defer,wrap:wrap,methodize:methodize}})());(function(proto){function toISOString(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"}function toJSON(){return this.toISOString()}if(!proto.toISOString){proto.toISOString=toISOString}if(!proto.toJSON){proto.toJSON=toJSON}})(Date.prototype);RegExp.prototype.match=RegExp.prototype.test;RegExp.escape=function(str){return String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var PeriodicalExecuter=Class.create({initialize:function(callback,frequency){this.callback=callback;this.frequency=frequency;this.currentlyExecuting=false;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1000)},execute:function(){this.callback(this)},stop:function(){if(!this.timer){return}clearInterval(this.timer);this.timer=null},onTimerEvent:function(){if(!this.currentlyExecuting){try{this.currentlyExecuting=true;this.execute();this.currentlyExecuting=false}catch(e){this.currentlyExecuting=false;throw e}}}});Object.extend(String,{interpret:function(value){return value==null?"":String(value)},specialChar:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}});Object.extend(String.prototype,(function(){var NATIVE_JSON_PARSE_SUPPORT=window.JSON&&typeof JSON.parse==="function"&&JSON.parse('{"test": true}').test;function prepareReplacement(replacement){if(Object.isFunction(replacement)){return replacement}var template=new Template(replacement);return function(match){return template.evaluate(match)}}function gsub(pattern,replacement){var result="",source=this,match;replacement=prepareReplacement(replacement);if(Object.isString(pattern)){pattern=RegExp.escape(pattern)}if(!(pattern.length||pattern.source)){replacement=replacement("");return replacement+source.split("").join(replacement)+replacement}while(source.length>0){if(match=source.match(pattern)){result+=source.slice(0,match.index);result+=String.interpret(replacement(match));source=source.slice(match.index+match[0].length)}else{result+=source,source=""}}return result}function sub(pattern,replacement,count){replacement=prepareReplacement(replacement);count=Object.isUndefined(count)?1:count;return this.gsub(pattern,function(match){if(--count<0){return match[0]}return replacement(match)})}function scan(pattern,iterator){this.gsub(pattern,iterator);return String(this)}function truncate(length,truncation){length=length||30;truncation=Object.isUndefined(truncation)?"...":truncation;return this.length>length?this.slice(0,length-truncation.length)+truncation:String(this)}function strip(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function stripTags(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")}function stripScripts(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")}function extractScripts(){var matchAll=new RegExp(Prototype.ScriptFragment,"img"),matchOne=new RegExp(Prototype.ScriptFragment,"im");return(this.match(matchAll)||[]).map(function(scriptTag){return(scriptTag.match(matchOne)||["",""])[1]})}function evalScripts(){return this.extractScripts().map(function(script){return eval(script)})}function escapeHTML(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function unescapeHTML(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}function toQueryParams(separator){var match=this.strip().match(/([^?#]*)(#.*)?$/);if(!match){return{}}return match[1].split(separator||"&").inject({},function(hash,pair){if((pair=pair.split("="))[0]){var key=decodeURIComponent(pair.shift()),value=pair.length>1?pair.join("="):pair[0];if(value!=undefined){value=decodeURIComponent(value)}if(key in hash){if(!Object.isArray(hash[key])){hash[key]=[hash[key]]}hash[key].push(value)}else{hash[key]=value}}return hash})}function toArray(){return this.split("")}function succ(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)}function times(count){return count<1?"":new Array(count+1).join(this)}function camelize(){return this.replace(/-+(.)?/g,function(match,chr){return chr?chr.toUpperCase():""})}function capitalize(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()}function underscore(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()}function dasherize(){return this.replace(/_/g,"-")}function inspect(useDoubleQuotes){var escapedString=this.replace(/[\x00-\x1f\\]/g,function(character){if(character in String.specialChar){return String.specialChar[character]}return"\\u00"+character.charCodeAt().toPaddedString(2,16)});if(useDoubleQuotes){return'"'+escapedString.replace(/"/g,'\\"')+'"'}return"'"+escapedString.replace(/'/g,"\\'")+"'"}function unfilterJSON(filter){return this.replace(filter||Prototype.JSONFilter,"$1")}function isJSON(){var str=this;if(str.blank()){return false}str=str.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@");str=str.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");str=str.replace(/(?:^|:|,)(?:\s*\[)+/g,"");return(/^[\],:{}\s]*$/).test(str)}function evalJSON(sanitize){var json=this.unfilterJSON(),cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;if(cx.test(json)){json=json.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}try{if(!sanitize||json.isJSON()){return eval("("+json+")")}}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())}function parseJSON(){var json=this.unfilterJSON();return JSON.parse(json)}function include(pattern){return this.indexOf(pattern)>-1}function startsWith(pattern){return this.lastIndexOf(pattern,0)===0}function endsWith(pattern){var d=this.length-pattern.length;return d>=0&&this.indexOf(pattern,d)===d}function empty(){return this==""}function blank(){return/^\s*$/.test(this)}function interpolate(object,pattern){return new Template(this,pattern).evaluate(object)}return{gsub:gsub,sub:sub,scan:scan,truncate:truncate,strip:String.prototype.trim||strip,stripTags:stripTags,stripScripts:stripScripts,extractScripts:extractScripts,evalScripts:evalScripts,escapeHTML:escapeHTML,unescapeHTML:unescapeHTML,toQueryParams:toQueryParams,parseQuery:toQueryParams,toArray:toArray,succ:succ,times:times,camelize:camelize,capitalize:capitalize,underscore:underscore,dasherize:dasherize,inspect:inspect,unfilterJSON:unfilterJSON,isJSON:isJSON,evalJSON:NATIVE_JSON_PARSE_SUPPORT?parseJSON:evalJSON,include:include,startsWith:startsWith,endsWith:endsWith,empty:empty,blank:blank,interpolate:interpolate}})());var Template=Class.create({initialize:function(template,pattern){this.template=template.toString();this.pattern=pattern||Template.Pattern},evaluate:function(object){if(object&&Object.isFunction(object.toTemplateReplacements)){object=object.toTemplateReplacements()}return this.template.gsub(this.pattern,function(match){if(object==null){return(match[1]+"")}var before=match[1]||"";if(before=="\\"){return match[2]}var ctx=object,expr=match[3],pattern=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;match=pattern.exec(expr);if(match==null){return before}while(match!=null){var comp=match[1].startsWith("[")?match[2].replace(/\\\\]/g,"]"):match[1];ctx=ctx[comp];if(null==ctx||""==match[3]){break}expr=expr.substring("["==match[3]?match[1].length:match[0].length);match=pattern.exec(expr)}return before+String.interpret(ctx)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={};var Enumerable=(function(){function each(iterator,context){var index=0;try{this._each(function(value){iterator.call(context,value,index++)})}catch(e){if(e!=$break){throw e}}return this}function eachSlice(number,iterator,context){var index=-number,slices=[],array=this.toArray();if(number<1){return array}while((index+=number)<array.length){slices.push(array.slice(index,index+number))}return slices.collect(iterator,context)}function all(iterator,context){iterator=iterator||Prototype.K;var result=true;this.each(function(value,index){result=result&&!!iterator.call(context,value,index);if(!result){throw $break}});return result}function any(iterator,context){iterator=iterator||Prototype.K;var result=false;this.each(function(value,index){if(result=!!iterator.call(context,value,index)){throw $break}});return result}function collect(iterator,context){iterator=iterator||Prototype.K;var results=[];this.each(function(value,index){results.push(iterator.call(context,value,index))});return results}function detect(iterator,context){var result;this.each(function(value,index){if(iterator.call(context,value,index)){result=value;throw $break}});return result}function findAll(iterator,context){var results=[];this.each(function(value,index){if(iterator.call(context,value,index)){results.push(value)}});return results}function grep(filter,iterator,context){iterator=iterator||Prototype.K;var results=[];if(Object.isString(filter)){filter=new RegExp(RegExp.escape(filter))}this.each(function(value,index){if(filter.match(value)){results.push(iterator.call(context,value,index))}});return results}function include(object){if(Object.isFunction(this.indexOf)){if(this.indexOf(object)!=-1){return true}}var found=false;this.each(function(value){if(value==object){found=true;throw $break}});return found}function inGroupsOf(number,fillWith){fillWith=Object.isUndefined(fillWith)?null:fillWith;return this.eachSlice(number,function(slice){while(slice.length<number){slice.push(fillWith)}return slice})}function inject(memo,iterator,context){this.each(function(value,index){memo=iterator.call(context,memo,value,index)});return memo}function invoke(method){var args=$A(arguments).slice(1);return this.map(function(value){return value[method].apply(value,args)})}function max(iterator,context){iterator=iterator||Prototype.K;var result;this.each(function(value,index){value=iterator.call(context,value,index);if(result==null||value>=result){result=value}});return result}function min(iterator,context){iterator=iterator||Prototype.K;var result;this.each(function(value,index){value=iterator.call(context,value,index);if(result==null||value<result){result=value}});return result}function partition(iterator,context){iterator=iterator||Prototype.K;var trues=[],falses=[];this.each(function(value,index){(iterator.call(context,value,index)?trues:falses).push(value)});return[trues,falses]}function pluck(property){var results=[];this.each(function(value){results.push(value[property])});return results}function reject(iterator,context){var results=[];this.each(function(value,index){if(!iterator.call(context,value,index)){results.push(value)}});return results}function sortBy(iterator,context){return this.map(function(value,index){return{value:value,criteria:iterator.call(context,value,index)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0}).pluck("value")}function toArray(){return this.map()}function zip(){var iterator=Prototype.K,args=$A(arguments);if(Object.isFunction(args.last())){iterator=args.pop()}var collections=[this].concat(args).map($A);return this.map(function(value,index){return iterator(collections.pluck(index))})}function size(){return this.toArray().length}function inspect(){return"#<Enumerable:"+this.toArray().inspect()+">"}return{each:each,eachSlice:eachSlice,all:all,every:all,any:any,some:any,collect:collect,map:collect,detect:detect,findAll:findAll,select:findAll,filter:findAll,grep:grep,include:include,member:include,inGroupsOf:inGroupsOf,inject:inject,invoke:invoke,max:max,min:min,partition:partition,pluck:pluck,reject:reject,sortBy:sortBy,toArray:toArray,entries:toArray,zip:zip,size:size,inspect:inspect,find:detect}})();function $A(iterable){if(!iterable){return[]}if("toArray" in Object(iterable)){return iterable.toArray()}var length=iterable.length||0,results=new Array(length);while(length--){results[length]=iterable[length]}return results}function $w(string){if(!Object.isString(string)){return[]}string=string.strip();return string?string.split(/\s+/):[]}Array.from=$A;(function(){var arrayProto=Array.prototype,slice=arrayProto.slice,_each=arrayProto.forEach;function each(iterator,context){for(var i=0,length=this.length>>>0;i<length;i++){if(i in this){iterator.call(context,this[i],i,this)}}}if(!_each){_each=each}function clear(){this.length=0;return this}function first(){return this[0]}function last(){return this[this.length-1]}function compact(){return this.select(function(value){return value!=null})}function flatten(){return this.inject([],function(array,value){if(Object.isArray(value)){return array.concat(value.flatten())}array.push(value);return array})}function without(){var values=slice.call(arguments,0);return this.select(function(value){return !values.include(value)})}function reverse(inline){return(inline===false?this.toArray():this)._reverse()}function uniq(sorted){return this.inject([],function(array,value,index){if(0==index||(sorted?array.last()!=value:!array.include(value))){array.push(value)}return array})}function intersect(array){return this.uniq().findAll(function(item){return array.detect(function(value){return item===value})})}function clone(){return slice.call(this,0)}function size(){return this.length}function inspect(){return"["+this.map(Object.inspect).join(", ")+"]"}function indexOf(item,i){i||(i=0);var length=this.length;if(i<0){i=length+i}for(;i<length;i++){if(this[i]===item){return i}}return -1}function lastIndexOf(item,i){i=isNaN(i)?this.length:(i<0?this.length+i:i)+1;var n=this.slice(0,i).reverse().indexOf(item);return(n<0)?n:i-n-1}function concat(){var array=slice.call(this,0),item;for(var i=0,length=arguments.length;i<length;i++){item=arguments[i];if(Object.isArray(item)&&!("callee" in item)){for(var j=0,arrayLength=item.length;j<arrayLength;j++){array.push(item[j])}}else{array.push(item)}}return array}Object.extend(arrayProto,Enumerable);if(!arrayProto._reverse){arrayProto._reverse=arrayProto.reverse}Object.extend(arrayProto,{_each:_each,clear:clear,first:first,last:last,compact:compact,flatten:flatten,without:without,reverse:reverse,uniq:uniq,intersect:intersect,clone:clone,toArray:clone,size:size,inspect:inspect});var CONCAT_ARGUMENTS_BUGGY=(function(){return[].concat(arguments)[0][0]!==1})(1,2);if(CONCAT_ARGUMENTS_BUGGY){arrayProto.concat=concat}if(!arrayProto.indexOf){arrayProto.indexOf=indexOf}if(!arrayProto.lastIndexOf){arrayProto.lastIndexOf=lastIndexOf}})();function $H(object){return new Hash(object)}var Hash=Class.create(Enumerable,(function(){function initialize(object){this._object=Object.isHash(object)?object.toObject():Object.clone(object)}function _each(iterator){for(var key in this._object){var value=this._object[key],pair=[key,value];pair.key=key;pair.value=value;iterator(pair)}}function set(key,value){return this._object[key]=value}function get(key){if(this._object[key]!==Object.prototype[key]){return this._object[key]}}function unset(key){var value=this._object[key];delete this._object[key];return value}function toObject(){return Object.clone(this._object)}function keys(){return this.pluck("key")}function values(){return this.pluck("value")}function index(value){var match=this.detect(function(pair){return pair.value===value});return match&&match.key}function merge(object){return this.clone().update(object)}function update(object){return new Hash(object).inject(this,function(result,pair){result.set(pair.key,pair.value);return result})}function toQueryPair(key,value){if(Object.isUndefined(value)){return key}return key+"="+encodeURIComponent(String.interpret(value))}function toQueryString(){return this.inject([],function(results,pair){var key=encodeURIComponent(pair.key),values=pair.value;if(values&&typeof values=="object"){if(Object.isArray(values)){var queryValues=[];for(var i=0,len=values.length,value;i<len;i++){value=values[i];queryValues.push(toQueryPair(key,value))}return results.concat(queryValues)}}else{results.push(toQueryPair(key,values))}return results}).join("&")}function inspect(){return"#<Hash:{"+this.map(function(pair){return pair.map(Object.inspect).join(": ")}).join(", ")+"}>"}function clone(){return new Hash(this)}return{initialize:initialize,_each:_each,set:set,get:get,unset:unset,toObject:toObject,toTemplateReplacements:toObject,keys:keys,values:values,index:index,merge:merge,update:update,toQueryString:toQueryString,inspect:inspect,toJSON:toObject,clone:clone}})());Hash.from=$H;Object.extend(Number.prototype,(function(){function toColorPart(){return this.toPaddedString(2,16)}function succ(){return this+1}function times(iterator,context){$R(0,this,true).each(iterator,context);return this}function toPaddedString(length,radix){var string=this.toString(radix||10);return"0".times(length-string.length)+string}function abs(){return Math.abs(this)}function round(){return Math.round(this)}function ceil(){return Math.ceil(this)}function floor(){return Math.floor(this)}return{toColorPart:toColorPart,succ:succ,times:times,toPaddedString:toPaddedString,abs:abs,round:round,ceil:ceil,floor:floor}})());function $R(start,end,exclusive){return new ObjectRange(start,end,exclusive)}var ObjectRange=Class.create(Enumerable,(function(){function initialize(start,end,exclusive){this.start=start;this.end=end;this.exclusive=exclusive}function _each(iterator){var value=this.start;while(this.include(value)){iterator(value);value=value.succ()}}function include(value){if(value<this.start){return false}if(this.exclusive){return value<this.end}return value<=this.end}return{initialize:initialize,_each:_each,include:include}})());var Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(iterator){this.responders._each(iterator)},register:function(responder){if(!this.include(responder)){this.responders.push(responder)}},unregister:function(responder){this.responders=this.responders.without(responder)},dispatch:function(callback,request,transport,json){this.each(function(responder){if(Object.isFunction(responder[callback])){try{responder[callback].apply(responder,[request,transport,json])}catch(e){}}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});Ajax.Base=Class.create({initialize:function(options){this.options={method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:true,evalJS:true};Object.extend(this.options,options||{});this.options.method=this.options.method.toLowerCase();if(Object.isHash(this.options.parameters)){this.options.parameters=this.options.parameters.toObject()}}});Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,url,options){$super(options);this.transport=Ajax.getTransport();this.request(url)},request:function(url){this.url=url;this.method=this.options.method;var params=Object.isString(this.options.parameters)?this.options.parameters:Object.toQueryString(this.options.parameters);if(!["get","post"].include(this.method)){params+=(params?"&":"")+"_method="+this.method;this.method="post"}if(params&&this.method==="get"){this.url+=(this.url.include("?")?"&":"?")+params}this.parameters=params.toQueryParams();try{var response=new Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(response)}Ajax.Responders.dispatch("onCreate",this,response);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){this.respondToReadyState.bind(this).defer(1)}this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||params):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(e){this.dispatchException(e)}},onStateChange:function(){var readyState=this.transport.readyState;if(readyState>1&&!((readyState==4)&&this._complete)){this.respondToReadyState(this.transport.readyState)}},setRequestHeaders:function(){var headers={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"){headers["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){headers.Connection="close"}}if(typeof this.options.requestHeaders=="object"){var extras=this.options.requestHeaders;if(Object.isFunction(extras.push)){for(var i=0,length=extras.length;i<length;i+=2){headers[extras[i]]=extras[i+1]}}else{$H(extras).each(function(pair){headers[pair.key]=pair.value})}}for(var name in headers){this.transport.setRequestHeader(name,headers[name])}},success:function(){var status=this.getStatus();return !status||(status>=200&&status<300)||status==304},getStatus:function(){try{if(this.transport.status===1223){return 204}return this.transport.status||0}catch(e){return 0}},respondToReadyState:function(readyState){var state=Ajax.Request.Events[readyState],response=new Ajax.Response(this);if(state=="Complete"){try{this._complete=true;(this.options["on"+response.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(response,response.headerJSON)}catch(e){this.dispatchException(e)}var contentType=response.getHeader("Content-type");if(this.options.evalJS=="force"||(this.options.evalJS&&this.isSameOrigin()&&contentType&&contentType.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))){this.evalResponse()}}try{(this.options["on"+state]||Prototype.emptyFunction)(response,response.headerJSON);Ajax.Responders.dispatch("on"+state,this,response,response.headerJSON)}catch(e){this.dispatchException(e)}if(state=="Complete"){this.transport.onreadystatechange=Prototype.emptyFunction}},isSameOrigin:function(){var m=this.url.match(/^\s*https?:\/\/[^\/]*/);return !m||(m[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""}))},getHeader:function(name){try{return this.transport.getResponseHeader(name)||null}catch(e){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(exception){(this.options.onException||Prototype.emptyFunction)(this,exception);Ajax.Responders.dispatch("onException",this,exception)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];Ajax.Response=Class.create({initialize:function(request){this.request=request;var transport=this.transport=request.transport,readyState=this.readyState=transport.readyState;if((readyState>2&&!Prototype.Browser.IE)||readyState==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(transport.responseText);this.headerJSON=this._getHeaderJSON()}if(readyState==4){var xml=transport.responseXML;this.responseXML=Object.isUndefined(xml)?null:xml;this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(e){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(e){return null}},getResponseHeader:function(name){return this.transport.getResponseHeader(name)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var json=this.getHeader("X-JSON");if(!json){return null}json=decodeURIComponent(escape(json));try{return json.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(e){this.request.dispatchException(e)}},_getResponseJSON:function(){var options=this.request.options;if(!options.evalJSON||(options.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json"))||this.responseText.blank()){return null}try{return this.responseText.evalJSON(options.sanitizeJSON||!this.request.isSameOrigin())}catch(e){this.request.dispatchException(e)}}});Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,container,url,options){this.container={success:(container.success||container),failure:(container.failure||(container.success?null:container))};options=Object.clone(options);var onComplete=options.onComplete;options.onComplete=(function(response,json){this.updateContent(response.responseText);if(Object.isFunction(onComplete)){onComplete(response,json)}}).bind(this);$super(url,options)},updateContent:function(responseText){var receiver=this.container[this.success()?"success":"failure"],options=this.options;if(!options.evalScripts){responseText=responseText.stripScripts()}if(receiver=$(receiver)){if(options.insertion){if(Object.isString(options.insertion)){var insertion={};insertion[options.insertion]=responseText;receiver.insert(insertion)}else{options.insertion(receiver,responseText)}}else{receiver.update(responseText)}}}});Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,container,url,options){$super(options);this.onComplete=this.options.onComplete;this.frequency=(this.options.frequency||2);this.decay=(this.options.decay||1);this.updater={};this.container=container;this.url=url;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(response){if(this.options.decay){this.decay=(response.responseText==this.lastText?this.decay*this.options.decay:1);this.lastText=response.responseText}this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});function $(element){if(arguments.length>1){for(var i=0,elements=[],length=arguments.length;i<length;i++){elements.push($(arguments[i]))}return elements}if(Object.isString(element)){element=document.getElementById(element)}return Element.extend(element)}if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(expression,parentElement){var results=[];var query=document.evaluate(expression,$(parentElement)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var i=0,length=query.snapshotLength;i<length;i++){results.push(Element.extend(query.snapshotItem(i)))}return results}}if(!Node){var Node={}}if(!Node.ELEMENT_NODE){Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12})}(function(global){function shouldUseCache(tagName,attributes){if(tagName==="select"){return false}if("type" in attributes){return false}return true}var HAS_EXTENDED_CREATE_ELEMENT_SYNTAX=(function(){try{var el=document.createElement('<input name="x">');return el.tagName.toLowerCase()==="input"&&el.name==="x"}catch(err){return false}})();var element=global.Element;global.Element=function(tagName,attributes){attributes=attributes||{};tagName=tagName.toLowerCase();var cache=Element.cache;if(HAS_EXTENDED_CREATE_ELEMENT_SYNTAX&&attributes.name){tagName="<"+tagName+' name="'+attributes.name+'">';delete attributes.name;return Element.writeAttribute(document.createElement(tagName),attributes)}if(!cache[tagName]){cache[tagName]=Element.extend(document.createElement(tagName))}var node=shouldUseCache(tagName,attributes)?cache[tagName].cloneNode(false):document.createElement(tagName);return Element.writeAttribute(node,attributes)};Object.extend(global.Element,element||{});if(element){global.Element.prototype=element.prototype}})(this);Element.idCounter=1;Element.cache={};Element._purgeElement=function(element){var uid=element._prototypeUID;if(uid){Element.stopObserving(element);element._prototypeUID=void 0;delete Element.Storage[uid]}};Element.Methods={visible:function(element){return $(element).style.display!="none"},toggle:function(element){element=$(element);Element[Element.visible(element)?"hide":"show"](element);return element},hide:function(element){element=$(element);element.style.display="none";return element},show:function(element){element=$(element);element.style.display="";return element},remove:function(element){element=$(element);element.parentNode.removeChild(element);return element},update:(function(){var SELECT_ELEMENT_INNERHTML_BUGGY=(function(){var el=document.createElement("select"),isBuggy=true;el.innerHTML='<option value="test">test</option>';if(el.options&&el.options[0]){isBuggy=el.options[0].nodeName.toUpperCase()!=="OPTION"}el=null;return isBuggy})();var TABLE_ELEMENT_INNERHTML_BUGGY=(function(){try{var el=document.createElement("table");if(el&&el.tBodies){el.innerHTML="<tbody><tr><td>test</td></tr></tbody>";var isBuggy=typeof el.tBodies[0]=="undefined";el=null;return isBuggy}}catch(e){return true}})();var LINK_ELEMENT_INNERHTML_BUGGY=(function(){try{var el=document.createElement("div");el.innerHTML="<link>";var isBuggy=(el.childNodes.length===0);el=null;return isBuggy}catch(e){return true}})();var ANY_INNERHTML_BUGGY=SELECT_ELEMENT_INNERHTML_BUGGY||TABLE_ELEMENT_INNERHTML_BUGGY||LINK_ELEMENT_INNERHTML_BUGGY;var SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING=(function(){var s=document.createElement("script"),isBuggy=false;try{s.appendChild(document.createTextNode(""));isBuggy=!s.firstChild||s.firstChild&&s.firstChild.nodeType!==3}catch(e){isBuggy=true}s=null;return isBuggy})();function update(element,content){element=$(element);var purgeElement=Element._purgeElement;var descendants=element.getElementsByTagName("*"),i=descendants.length;while(i--){purgeElement(descendants[i])}if(content&&content.toElement){content=content.toElement()}if(Object.isElement(content)){return element.update().insert(content)}content=Object.toHTML(content);var tagName=element.tagName.toUpperCase();if(tagName==="SCRIPT"&&SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING){element.text=content;return element}if(ANY_INNERHTML_BUGGY){if(tagName in Element._insertionTranslations.tags){while(element.firstChild){element.removeChild(element.firstChild)}Element._getContentFromAnonymousElement(tagName,content.stripScripts()).each(function(node){element.appendChild(node)})}else{if(LINK_ELEMENT_INNERHTML_BUGGY&&Object.isString(content)&&content.indexOf("<link")>-1){while(element.firstChild){element.removeChild(element.firstChild)}var nodes=Element._getContentFromAnonymousElement(tagName,content.stripScripts(),true);nodes.each(function(node){element.appendChild(node)})}else{element.innerHTML=content.stripScripts()}}}else{element.innerHTML=content.stripScripts()}content.evalScripts.bind(content).defer();return element}return update})(),replace:function(element,content){element=$(element);if(content&&content.toElement){content=content.toElement()}else{if(!Object.isElement(content)){content=Object.toHTML(content);var range=element.ownerDocument.createRange();range.selectNode(element);content.evalScripts.bind(content).defer();content=range.createContextualFragment(content.stripScripts())}}element.parentNode.replaceChild(content,element);return element},insert:function(element,insertions){element=$(element);if(Object.isString(insertions)||Object.isNumber(insertions)||Object.isElement(insertions)||(insertions&&(insertions.toElement||insertions.toHTML))){insertions={bottom:insertions}}var content,insert,tagName,childNodes;for(var position in insertions){content=insertions[position];position=position.toLowerCase();insert=Element._insertionTranslations[position];if(content&&content.toElement){content=content.toElement()}if(Object.isElement(content)){insert(element,content);continue}content=Object.toHTML(content);tagName=((position=="before"||position=="after")?element.parentNode:element).tagName.toUpperCase();childNodes=Element._getContentFromAnonymousElement(tagName,content.stripScripts());if(position=="top"||position=="after"){childNodes.reverse()}childNodes.each(insert.curry(element));content.evalScripts.bind(content).defer()}return element},wrap:function(element,wrapper,attributes){element=$(element);if(Object.isElement(wrapper)){$(wrapper).writeAttribute(attributes||{})}else{if(Object.isString(wrapper)){wrapper=new Element(wrapper,attributes)}else{wrapper=new Element("div",wrapper)}}if(element.parentNode){element.parentNode.replaceChild(wrapper,element)}wrapper.appendChild(element);return wrapper},inspect:function(element){element=$(element);var result="<"+element.tagName.toLowerCase();$H({id:"id",className:"class"}).each(function(pair){var property=pair.first(),attribute=pair.last(),value=(element[property]||"").toString();if(value){result+=" "+attribute+"="+value.inspect(true)}});return result+">"},recursivelyCollect:function(element,property,maximumLength){element=$(element);maximumLength=maximumLength||-1;var elements=[];while(element=element[property]){if(element.nodeType==1){elements.push(Element.extend(element))}if(elements.length==maximumLength){break}}return elements},ancestors:function(element){return Element.recursivelyCollect(element,"parentNode")},descendants:function(element){return Element.select(element,"*")},firstDescendant:function(element){element=$(element).firstChild;while(element&&element.nodeType!=1){element=element.nextSibling}return $(element)},immediateDescendants:function(element){var results=[],child=$(element).firstChild;while(child){if(child.nodeType===1){results.push(Element.extend(child))}child=child.nextSibling}return results},previousSiblings:function(element,maximumLength){return Element.recursivelyCollect(element,"previousSibling")},nextSiblings:function(element){return Element.recursivelyCollect(element,"nextSibling")},siblings:function(element){element=$(element);return Element.previousSiblings(element).reverse().concat(Element.nextSiblings(element))},match:function(element,selector){element=$(element);if(Object.isString(selector)){return Prototype.Selector.match(element,selector)}return selector.match(element)},up:function(element,expression,index){element=$(element);if(arguments.length==1){return $(element.parentNode)}var ancestors=Element.ancestors(element);return Object.isNumber(expression)?ancestors[expression]:Prototype.Selector.find(ancestors,expression,index)},down:function(element,expression,index){element=$(element);if(arguments.length==1){return Element.firstDescendant(element)}return Object.isNumber(expression)?Element.descendants(element)[expression]:Element.select(element,expression)[index||0]},previous:function(element,expression,index){element=$(element);if(Object.isNumber(expression)){index=expression,expression=false}if(!Object.isNumber(index)){index=0}if(expression){return Prototype.Selector.find(element.previousSiblings(),expression,index)}else{return element.recursivelyCollect("previousSibling",index+1)[index]}},next:function(element,expression,index){element=$(element);if(Object.isNumber(expression)){index=expression,expression=false}if(!Object.isNumber(index)){index=0}if(expression){return Prototype.Selector.find(element.nextSiblings(),expression,index)}else{var maximumLength=Object.isNumber(index)?index+1:1;return element.recursivelyCollect("nextSibling",index+1)[index]}},select:function(element){element=$(element);var expressions=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(expressions,element)},adjacent:function(element){element=$(element);var expressions=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(expressions,element.parentNode).without(element)},identify:function(element){element=$(element);var id=Element.readAttribute(element,"id");if(id){return id}do{id="anonymous_element_"+Element.idCounter++}while($(id));Element.writeAttribute(element,"id",id);return id},readAttribute:function(element,name){element=$(element);if(Prototype.Browser.IE){var t=Element._attributeTranslations.read;if(t.values[name]){return t.values[name](element,name)}if(t.names[name]){name=t.names[name]}if(name.include(":")){return(!element.attributes||!element.attributes[name])?null:element.attributes[name].value}}return element.getAttribute(name)},writeAttribute:function(element,name,value){element=$(element);var attributes={},t=Element._attributeTranslations.write;if(typeof name=="object"){attributes=name}else{attributes[name]=Object.isUndefined(value)?true:value}for(var attr in attributes){name=t.names[attr]||attr;value=attributes[attr];if(t.values[attr]){name=t.values[attr](element,value)}if(value===false||value===null){element.removeAttribute(name)}else{if(value===true){element.setAttribute(name,name)}else{element.setAttribute(name,value)}}}return element},getHeight:function(element){return Element.getDimensions(element).height},getWidth:function(element){return Element.getDimensions(element).width},classNames:function(element){return new Element.ClassNames(element)},hasClassName:function(element,className){if(!(element=$(element))){return}var elementClassName=element.className;return(elementClassName.length>0&&(elementClassName==className||new RegExp("(^|\\s)"+className+"(\\s|$)").test(elementClassName)))},addClassName:function(element,className){if(!(element=$(element))){return}if(!Element.hasClassName(element,className)){element.className+=(element.className?" ":"")+className}return element},removeClassName:function(element,className){if(!(element=$(element))){return}element.className=element.className.replace(new RegExp("(^|\\s+)"+className+"(\\s+|$)")," ").strip();return element},toggleClassName:function(element,className){if(!(element=$(element))){return}return Element[Element.hasClassName(element,className)?"removeClassName":"addClassName"](element,className)},cleanWhitespace:function(element){element=$(element);var node=element.firstChild;while(node){var nextNode=node.nextSibling;if(node.nodeType==3&&!/\S/.test(node.nodeValue)){element.removeChild(node)}node=nextNode}return element},empty:function(element){return $(element).innerHTML.blank()},descendantOf:function(element,ancestor){element=$(element),ancestor=$(ancestor);if(element.compareDocumentPosition){return(element.compareDocumentPosition(ancestor)&8)===8}if(ancestor.contains){return ancestor.contains(element)&&ancestor!==element}while(element=element.parentNode){if(element==ancestor){return true}}return false},scrollTo:function(element){element=$(element);var pos=Element.cumulativeOffset(element);window.scrollTo(pos[0],pos[1]);return element},getStyle:function(element,style){element=$(element);style=style=="float"?"cssFloat":style.camelize();var value=element.style[style];if(!value||value=="auto"){var css=document.defaultView.getComputedStyle(element,null);value=css?css[style]:null}if(style=="opacity"){return value?parseFloat(value):1}return value=="auto"?null:value},getOpacity:function(element){return $(element).getStyle("opacity")},setStyle:function(element,styles){element=$(element);var elementStyle=element.style,match;if(Object.isString(styles)){element.style.cssText+=";"+styles;return styles.include("opacity")?element.setOpacity(styles.match(/opacity:\s*(\d?\.?\d*)/)[1]):element}for(var property in styles){if(property=="opacity"){element.setOpacity(styles[property])}else{elementStyle[(property=="float"||property=="cssFloat")?(Object.isUndefined(elementStyle.styleFloat)?"cssFloat":"styleFloat"):property]=styles[property]}}return element},setOpacity:function(element,value){element=$(element);element.style.opacity=(value==1||value==="")?"":(value<0.00001)?0:value;return element},makePositioned:function(element){element=$(element);var pos=Element.getStyle(element,"position");if(pos=="static"||!pos){element._madePositioned=true;element.style.position="relative";if(Prototype.Browser.Opera){element.style.top=0;element.style.left=0}}return element},undoPositioned:function(element){element=$(element);if(element._madePositioned){element._madePositioned=undefined;element.style.position=element.style.top=element.style.left=element.style.bottom=element.style.right=""}return element},makeClipping:function(element){element=$(element);if(element._overflow){return element}element._overflow=Element.getStyle(element,"overflow")||"auto";if(element._overflow!=="hidden"){element.style.overflow="hidden"}return element},undoClipping:function(element){element=$(element);if(!element._overflow){return element}element.style.overflow=element._overflow=="auto"?"":element._overflow;element._overflow=null;return element},clonePosition:function(element,source){var options=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});source=$(source);var p=Element.viewportOffset(source),delta=[0,0],parent=null;element=$(element);if(Element.getStyle(element,"position")=="absolute"){parent=Element.getOffsetParent(element);delta=Element.viewportOffset(parent)}if(parent==document.body){delta[0]-=document.body.offsetLeft;delta[1]-=document.body.offsetTop}if(options.setLeft){element.style.left=(p[0]-delta[0]+options.offsetLeft)+"px"}if(options.setTop){element.style.top=(p[1]-delta[1]+options.offsetTop)+"px"}if(options.setWidth){element.style.width=source.offsetWidth+"px"}if(options.setHeight){element.style.height=source.offsetHeight+"px"}return element}};Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(proceed,element,style){switch(style){case"height":case"width":if(!Element.visible(element)){return null}var dim=parseInt(proceed(element,style),10);if(dim!==element["offset"+style.capitalize()]){return dim+"px"}var properties;if(style==="height"){properties=["border-top-width","padding-top","padding-bottom","border-bottom-width"]}else{properties=["border-left-width","padding-left","padding-right","border-right-width"]}return properties.inject(dim,function(memo,property){var val=proceed(element,property);return val===null?memo:memo-parseInt(val,10)})+"px";default:return proceed(element,style)}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(proceed,element,attribute){if(attribute==="title"){return element.title}return proceed(element,attribute)})}else{if(Prototype.Browser.IE){Element.Methods.getStyle=function(element,style){element=$(element);style=(style=="float"||style=="cssFloat")?"styleFloat":style.camelize();var value=element.style[style];if(!value&&element.currentStyle){value=element.currentStyle[style]}if(style=="opacity"){if(value=(element.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/)){if(value[1]){return parseFloat(value[1])/100}}return 1}if(value=="auto"){if((style=="width"||style=="height")&&(element.getStyle("display")!="none")){return element["offset"+style.capitalize()]+"px"}return null}return value};Element.Methods.setOpacity=function(element,value){function stripAlpha(filter){return filter.replace(/alpha\([^\)]*\)/gi,"")}element=$(element);var currentStyle=element.currentStyle;if((currentStyle&&!currentStyle.hasLayout)||(!currentStyle&&element.style.zoom=="normal")){element.style.zoom=1}var filter=element.getStyle("filter"),style=element.style;if(value==1||value===""){(filter=stripAlpha(filter))?style.filter=filter:style.removeAttribute("filter");return element}else{if(value<0.00001){value=0}}style.filter=stripAlpha(filter)+"alpha(opacity="+(value*100)+")";return element};Element._attributeTranslations=(function(){var classProp="className",forProp="for",el=document.createElement("div");el.setAttribute(classProp,"x");if(el.className!=="x"){el.setAttribute("class","x");if(el.className==="x"){classProp="class"}}el=null;el=document.createElement("label");el.setAttribute(forProp,"x");if(el.htmlFor!=="x"){el.setAttribute("htmlFor","x");if(el.htmlFor==="x"){forProp="htmlFor"}}el=null;return{read:{names:{"class":classProp,className:classProp,"for":forProp,htmlFor:forProp},values:{_getAttr:function(element,attribute){return element.getAttribute(attribute)},_getAttr2:function(element,attribute){return element.getAttribute(attribute,2)},_getAttrNode:function(element,attribute){var node=element.getAttributeNode(attribute);return node?node.value:""},_getEv:(function(){var el=document.createElement("div"),f;el.onclick=Prototype.emptyFunction;var value=el.getAttribute("onclick");if(String(value).indexOf("{")>-1){f=function(element,attribute){attribute=element.getAttribute(attribute);if(!attribute){return null}attribute=attribute.toString();attribute=attribute.split("{")[1];attribute=attribute.split("}")[0];return attribute.strip()}}else{if(value===""){f=function(element,attribute){attribute=element.getAttribute(attribute);if(!attribute){return null}return attribute.strip()}}}el=null;return f})(),_flag:function(element,attribute){return $(element).hasAttribute(attribute)?attribute:null},style:function(element){return element.style.cssText.toLowerCase()},title:function(element){return element.title}}}}})();Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(element,value){element.checked=!!value},style:function(element,value){element.style.cssText=value?value:""}}};Element._attributeTranslations.has={};$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder").each(function(attr){Element._attributeTranslations.write.names[attr.toLowerCase()]=attr;Element._attributeTranslations.has[attr.toLowerCase()]=attr});(function(v){Object.extend(v,{href:v._getAttr2,src:v._getAttr2,type:v._getAttr,action:v._getAttrNode,disabled:v._flag,checked:v._flag,readonly:v._flag,multiple:v._flag,onload:v._getEv,onunload:v._getEv,onclick:v._getEv,ondblclick:v._getEv,onmousedown:v._getEv,onmouseup:v._getEv,onmouseover:v._getEv,onmousemove:v._getEv,onmouseout:v._getEv,onfocus:v._getEv,onblur:v._getEv,onkeypress:v._getEv,onkeydown:v._getEv,onkeyup:v._getEv,onsubmit:v._getEv,onreset:v._getEv,onselect:v._getEv,onchange:v._getEv})})(Element._attributeTranslations.read.values);if(Prototype.BrowserFeatures.ElementExtensions){(function(){function _descendants(element){var nodes=element.getElementsByTagName("*"),results=[];for(var i=0,node;node=nodes[i];i++){if(node.tagName!=="!"){results.push(node)}}return results}Element.Methods.down=function(element,expression,index){element=$(element);if(arguments.length==1){return element.firstDescendant()}return Object.isNumber(expression)?_descendants(element)[expression]:Element.select(element,expression)[index||0]}})()}}else{if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent)){Element.Methods.setOpacity=function(element,value){element=$(element);element.style.opacity=(value==1)?0.999999:(value==="")?"":(value<0.00001)?0:value;return element}}else{if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(element,value){element=$(element);element.style.opacity=(value==1||value==="")?"":(value<0.00001)?0:value;if(value==1){if(element.tagName.toUpperCase()=="IMG"&&element.width){element.width++;element.width--}else{try{var n=document.createTextNode(" ");element.appendChild(n);element.removeChild(n)}catch(e){}}}return element}}}}}if("outerHTML" in document.documentElement){Element.Methods.replace=function(element,content){element=$(element);if(content&&content.toElement){content=content.toElement()}if(Object.isElement(content)){element.parentNode.replaceChild(content,element);return element}content=Object.toHTML(content);var parent=element.parentNode,tagName=parent.tagName.toUpperCase();if(Element._insertionTranslations.tags[tagName]){var nextSibling=element.next(),fragments=Element._getContentFromAnonymousElement(tagName,content.stripScripts());parent.removeChild(element);if(nextSibling){fragments.each(function(node){parent.insertBefore(node,nextSibling)})}else{fragments.each(function(node){parent.appendChild(node)})}}else{element.outerHTML=content.stripScripts()}content.evalScripts.bind(content).defer();return element}}Element._returnOffset=function(l,t){var result=[l,t];result.left=l;result.top=t;return result};Element._getContentFromAnonymousElement=function(tagName,html,force){var div=new Element("div"),t=Element._insertionTranslations.tags[tagName];var workaround=false;if(t){workaround=true}else{if(force){workaround=true;t=["","",0]}}if(workaround){div.innerHTML="&nbsp;"+t[0]+html+t[1];div.removeChild(div.firstChild);for(var i=t[2];i--;){div=div.firstChild}}else{div.innerHTML=html}return $A(div.childNodes)};Element._insertionTranslations={before:function(element,node){element.parentNode.insertBefore(node,element)},top:function(element,node){element.insertBefore(node,element.firstChild)},bottom:function(element,node){element.appendChild(node)},after:function(element,node){element.parentNode.insertBefore(node,element.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};(function(){var tags=Element._insertionTranslations.tags;Object.extend(tags,{THEAD:tags.TBODY,TFOOT:tags.TBODY,TH:tags.TD})})();Element.Methods.Simulated={hasAttribute:function(element,attribute){attribute=Element._attributeTranslations.has[attribute]||attribute;var node=$(element).getAttributeNode(attribute);return !!(node&&node.specified)}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);(function(div){if(!Prototype.BrowserFeatures.ElementExtensions&&div.__proto__){window.HTMLElement={};window.HTMLElement.prototype=div.__proto__;Prototype.BrowserFeatures.ElementExtensions=true}div=null})(document.createElement("div"));Element.extend=(function(){function checkDeficiency(tagName){if(typeof window.Element!="undefined"){var proto=window.Element.prototype;if(proto){var id="_"+(Math.random()+"").slice(2),el=document.createElement(tagName);proto[id]="x";var isBuggy=(el[id]!=="x");delete proto[id];el=null;return isBuggy}}return false}function extendElementWith(element,methods){for(var property in methods){var value=methods[property];if(Object.isFunction(value)&&!(property in element)){element[property]=value.methodize()}}}var HTMLOBJECTELEMENT_PROTOTYPE_BUGGY=checkDeficiency("object");if(Prototype.BrowserFeatures.SpecificElementExtensions){if(HTMLOBJECTELEMENT_PROTOTYPE_BUGGY){return function(element){if(element&&typeof element._extendedByPrototype=="undefined"){var t=element.tagName;if(t&&(/^(?:object|applet|embed)$/i.test(t))){extendElementWith(element,Element.Methods);extendElementWith(element,Element.Methods.Simulated);extendElementWith(element,Element.Methods.ByTag[t.toUpperCase()])}}return element}}return Prototype.K}var Methods={},ByTag=Element.Methods.ByTag;var extend=Object.extend(function(element){if(!element||typeof element._extendedByPrototype!="undefined"||element.nodeType!=1||element==window){return element}var methods=Object.clone(Methods),tagName=element.tagName.toUpperCase();if(ByTag[tagName]){Object.extend(methods,ByTag[tagName])}extendElementWith(element,methods);element._extendedByPrototype=Prototype.emptyFunction;return element},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(Methods,Element.Methods);Object.extend(Methods,Element.Methods.Simulated)}}});extend.refresh();return extend})();if(document.documentElement.hasAttribute){Element.hasAttribute=function(element,attribute){return element.hasAttribute(attribute)}}else{Element.hasAttribute=Element.Methods.Simulated.hasAttribute}Element.addMethods=function(methods){var F=Prototype.BrowserFeatures,T=Element.Methods.ByTag;if(!methods){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods),BUTTON:Object.clone(Form.Element.Methods)})}if(arguments.length==2){var tagName=methods;methods=arguments[1]}if(!tagName){Object.extend(Element.Methods,methods||{})}else{if(Object.isArray(tagName)){tagName.each(extend)}else{extend(tagName)}}function extend(tagName){tagName=tagName.toUpperCase();if(!Element.Methods.ByTag[tagName]){Element.Methods.ByTag[tagName]={}}Object.extend(Element.Methods.ByTag[tagName],methods)}function copy(methods,destination,onlyIfAbsent){onlyIfAbsent=onlyIfAbsent||false;for(var property in methods){var value=methods[property];if(!Object.isFunction(value)){continue}if(!onlyIfAbsent||!(property in destination)){destination[property]=value.methodize()}}}function findDOMClass(tagName){var klass;var trans={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(trans[tagName]){klass="HTML"+trans[tagName]+"Element"}if(window[klass]){return window[klass]}klass="HTML"+tagName+"Element";if(window[klass]){return window[klass]}klass="HTML"+tagName.capitalize()+"Element";if(window[klass]){return window[klass]}var element=document.createElement(tagName),proto=element.__proto__||element.constructor.prototype;element=null;return proto}var elementPrototype=window.HTMLElement?HTMLElement.prototype:Element.prototype;if(F.ElementExtensions){copy(Element.Methods,elementPrototype);copy(Element.Methods.Simulated,elementPrototype,true)}if(F.SpecificElementExtensions){for(var tag in Element.Methods.ByTag){var klass=findDOMClass(tag);if(Object.isUndefined(klass)){continue}copy(T[tag],klass.prototype)}}Object.extend(Element,Element.Methods);delete Element.ByTag;if(Element.extend.refresh){Element.extend.refresh()}Element.cache={}};document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};(function(viewport){var B=Prototype.Browser,doc=document,element,property={};function getRootElement(){if(B.WebKit&&!doc.evaluate){return document}if(B.Opera&&window.parseFloat(window.opera.version())<9.5){return document.body}return document.documentElement}function define(D){if(!element){element=getRootElement()}property[D]="client"+D;viewport["get"+D]=function(){return element[property[D]]};return viewport["get"+D]()}viewport.getWidth=define.curry("Width");viewport.getHeight=define.curry("Height")})(document.viewport);Element.Storage={UID:1};Element.addMethods({getStorage:function(element){if(!(element=$(element))){return}var uid;if(element===window){uid=0}else{if(typeof element._prototypeUID==="undefined"){element._prototypeUID=Element.Storage.UID++}uid=element._prototypeUID}if(!Element.Storage[uid]){Element.Storage[uid]=$H()}return Element.Storage[uid]},store:function(element,key,value){if(!(element=$(element))){return}if(arguments.length===2){Element.getStorage(element).update(key)}else{Element.getStorage(element).set(key,value)}return element},retrieve:function(element,key,defaultValue){if(!(element=$(element))){return}var hash=Element.getStorage(element),value=hash.get(key);if(Object.isUndefined(value)){hash.set(key,defaultValue);value=defaultValue}return value},clone:function(element,deep){if(!(element=$(element))){return}var clone=element.cloneNode(deep);clone._prototypeUID=void 0;if(deep){var descendants=Element.select(clone,"*"),i=descendants.length;while(i--){descendants[i]._prototypeUID=void 0}}return Element.extend(clone)},purge:function(element){if(!(element=$(element))){return}var purgeElement=Element._purgeElement;purgeElement(element);var descendants=element.getElementsByTagName("*"),i=descendants.length;while(i--){purgeElement(descendants[i])}return null}});(function(){function toDecimal(pctString){var match=pctString.match(/^(\d+)%?$/i);if(!match){return null}return(Number(match[1])/100)}function getPixelValue(value,property,context){var element=null;if(Object.isElement(value)){element=value;value=element.getStyle(property)}if(value===null){return null}if((/^(?:-)?\d+(\.\d+)?(px)?$/i).test(value)){return window.parseFloat(value)}var isPercentage=value.include("%"),isViewport=(context===document.viewport);if(/\d/.test(value)&&element&&element.runtimeStyle&&!(isPercentage&&isViewport)){var style=element.style.left,rStyle=element.runtimeStyle.left;element.runtimeStyle.left=element.currentStyle.left;element.style.left=value||0;value=element.style.pixelLeft;element.style.left=style;element.runtimeStyle.left=rStyle;return value}if(element&&isPercentage){context=context||element.parentNode;var decimal=toDecimal(value);var whole=null;var position=element.getStyle("position");var isHorizontal=property.include("left")||property.include("right")||property.include("width");var isVertical=property.include("top")||property.include("bottom")||property.include("height");if(context===document.viewport){if(isHorizontal){whole=document.viewport.getWidth()}else{if(isVertical){whole=document.viewport.getHeight()}}}else{if(isHorizontal){whole=$(context).measure("width")}else{if(isVertical){whole=$(context).measure("height")}}}return(whole===null)?0:whole*decimal}return 0}function toCSSPixels(number){if(Object.isString(number)&&number.endsWith("px")){return number}return number+"px"}function isDisplayed(element){var originalElement=element;while(element&&element.parentNode){var display=element.getStyle("display");if(display==="none"){return false}element=$(element.parentNode)}return true}var hasLayout=Prototype.K;if("currentStyle" in document.documentElement){hasLayout=function(element){if(!element.currentStyle.hasLayout){element.style.zoom=1}return element}}function cssNameFor(key){if(key.include("border")){key=key+"-width"}return key.camelize()}Element.Layout=Class.create(Hash,{initialize:function($super,element,preCompute){$super();this.element=$(element);Element.Layout.PROPERTIES.each(function(property){this._set(property,null)},this);if(preCompute){this._preComputing=true;this._begin();Element.Layout.PROPERTIES.each(this._compute,this);this._end();this._preComputing=false}},_set:function(property,value){return Hash.prototype.set.call(this,property,value)},set:function(property,value){throw"Properties of Element.Layout are read-only."},get:function($super,property){var value=$super(property);return value===null?this._compute(property):value},_begin:function(){if(this._prepared){return}var element=this.element;if(isDisplayed(element)){this._prepared=true;return}var originalStyles={position:element.style.position||"",width:element.style.width||"",visibility:element.style.visibility||"",display:element.style.display||""};element.store("prototype_original_styles",originalStyles);var position=element.getStyle("position"),width=element.getStyle("width");if(width==="0px"||width===null){element.style.display="block";width=element.getStyle("width")}var context=(position==="fixed")?document.viewport:element.parentNode;element.setStyle({position:"absolute",visibility:"hidden",display:"block"});var positionedWidth=element.getStyle("width");var newWidth;if(width&&(positionedWidth===width)){newWidth=getPixelValue(element,"width",context)}else{if(position==="absolute"||position==="fixed"){newWidth=getPixelValue(element,"width",context)}else{var parent=element.parentNode,pLayout=$(parent).getLayout();newWidth=pLayout.get("width")-this.get("margin-left")-this.get("border-left")-this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right")}}element.setStyle({width:newWidth+"px"});this._prepared=true},_end:function(){var element=this.element;var originalStyles=element.retrieve("prototype_original_styles");element.store("prototype_original_styles",null);element.setStyle(originalStyles);this._prepared=false},_compute:function(property){var COMPUTATIONS=Element.Layout.COMPUTATIONS;if(!(property in COMPUTATIONS)){throw"Property not found."}return this._set(property,COMPUTATIONS[property].call(this,this.element))},toObject:function(){var args=$A(arguments);var keys=(args.length===0)?Element.Layout.PROPERTIES:args.join(" ").split(" ");var obj={};keys.each(function(key){if(!Element.Layout.PROPERTIES.include(key)){return}var value=this.get(key);if(value!=null){obj[key]=value}},this);return obj},toHash:function(){var obj=this.toObject.apply(this,arguments);return new Hash(obj)},toCSS:function(){var args=$A(arguments);var keys=(args.length===0)?Element.Layout.PROPERTIES:args.join(" ").split(" ");var css={};keys.each(function(key){if(!Element.Layout.PROPERTIES.include(key)){return}if(Element.Layout.COMPOSITE_PROPERTIES.include(key)){return}var value=this.get(key);if(value!=null){css[cssNameFor(key)]=value+"px"}},this);return css},inspect:function(){return"#<Element.Layout>"}});Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),COMPUTATIONS:{height:function(element){if(!this._preComputing){this._begin()}var bHeight=this.get("border-box-height");if(bHeight<=0){if(!this._preComputing){this._end()}return 0}var bTop=this.get("border-top"),bBottom=this.get("border-bottom");var pTop=this.get("padding-top"),pBottom=this.get("padding-bottom");if(!this._preComputing){this._end()}return bHeight-bTop-bBottom-pTop-pBottom},width:function(element){if(!this._preComputing){this._begin()}var bWidth=this.get("border-box-width");if(bWidth<=0){if(!this._preComputing){this._end()}return 0}var bLeft=this.get("border-left"),bRight=this.get("border-right");var pLeft=this.get("padding-left"),pRight=this.get("padding-right");if(!this._preComputing){this._end()}return bWidth-bLeft-bRight-pLeft-pRight},"padding-box-height":function(element){var height=this.get("height"),pTop=this.get("padding-top"),pBottom=this.get("padding-bottom");return height+pTop+pBottom},"padding-box-width":function(element){var width=this.get("width"),pLeft=this.get("padding-left"),pRight=this.get("padding-right");return width+pLeft+pRight},"border-box-height":function(element){if(!this._preComputing){this._begin()}var height=element.offsetHeight;if(!this._preComputing){this._end()}return height},"border-box-width":function(element){if(!this._preComputing){this._begin()}var width=element.offsetWidth;if(!this._preComputing){this._end()}return width},"margin-box-height":function(element){var bHeight=this.get("border-box-height"),mTop=this.get("margin-top"),mBottom=this.get("margin-bottom");if(bHeight<=0){return 0}return bHeight+mTop+mBottom},"margin-box-width":function(element){var bWidth=this.get("border-box-width"),mLeft=this.get("margin-left"),mRight=this.get("margin-right");if(bWidth<=0){return 0}return bWidth+mLeft+mRight},top:function(element){var offset=element.positionedOffset();return offset.top},bottom:function(element){var offset=element.positionedOffset(),parent=element.getOffsetParent(),pHeight=parent.measure("height");var mHeight=this.get("border-box-height");return pHeight-mHeight-offset.top},left:function(element){var offset=element.positionedOffset();return offset.left},right:function(element){var offset=element.positionedOffset(),parent=element.getOffsetParent(),pWidth=parent.measure("width");var mWidth=this.get("border-box-width");return pWidth-mWidth-offset.left},"padding-top":function(element){return getPixelValue(element,"paddingTop")},"padding-bottom":function(element){return getPixelValue(element,"paddingBottom")},"padding-left":function(element){return getPixelValue(element,"paddingLeft")},"padding-right":function(element){return getPixelValue(element,"paddingRight")},"border-top":function(element){return getPixelValue(element,"borderTopWidth")},"border-bottom":function(element){return getPixelValue(element,"borderBottomWidth")},"border-left":function(element){return getPixelValue(element,"borderLeftWidth")},"border-right":function(element){return getPixelValue(element,"borderRightWidth")},"margin-top":function(element){return getPixelValue(element,"marginTop")},"margin-bottom":function(element){return getPixelValue(element,"marginBottom")},"margin-left":function(element){return getPixelValue(element,"marginLeft")},"margin-right":function(element){return getPixelValue(element,"marginRight")}}});if("getBoundingClientRect" in document.documentElement){Object.extend(Element.Layout.COMPUTATIONS,{right:function(element){var parent=hasLayout(element.getOffsetParent());var rect=element.getBoundingClientRect(),pRect=parent.getBoundingClientRect();return(pRect.right-rect.right).round()},bottom:function(element){var parent=hasLayout(element.getOffsetParent());var rect=element.getBoundingClientRect(),pRect=parent.getBoundingClientRect();return(pRect.bottom-rect.bottom).round()}})}Element.Offset=Class.create({initialize:function(left,top){this.left=left.round();this.top=top.round();this[0]=this.left;this[1]=this.top},relativeTo:function(offset){return new Element.Offset(this.left-offset.left,this.top-offset.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},toArray:function(){return[this.left,this.top]}});function getLayout(element,preCompute){return new Element.Layout(element,preCompute)}function measure(element,property){return $(element).getLayout().get(property)}function getDimensions(element){element=$(element);var display=Element.getStyle(element,"display");if(display&&display!=="none"){return{width:element.offsetWidth,height:element.offsetHeight}}var style=element.style;var originalStyles={visibility:style.visibility,position:style.position,display:style.display};var newStyles={visibility:"hidden",display:"block"};if(originalStyles.position!=="fixed"){newStyles.position="absolute"}Element.setStyle(element,newStyles);var dimensions={width:element.offsetWidth,height:element.offsetHeight};Element.setStyle(element,originalStyles);return dimensions}function getOffsetParent(element){element=$(element);if(isDocument(element)||isDetached(element)||isBody(element)||isHtml(element)){return $(document.body)}var isInline=(Element.getStyle(element,"display")==="inline");if(!isInline&&element.offsetParent){return $(element.offsetParent)}while((element=element.parentNode)&&element!==document.body){if(Element.getStyle(element,"position")!=="static"){return isHtml(element)?$(document.body):$(element)}}return $(document.body)}function cumulativeOffset(element){element=$(element);var valueT=0,valueL=0;if(element.parentNode){do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;element=element.offsetParent}while(element)}return new Element.Offset(valueL,valueT)}function positionedOffset(element){element=$(element);var layout=element.getLayout();var valueT=0,valueL=0;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;element=element.offsetParent;if(element){if(isBody(element)){break}var p=Element.getStyle(element,"position");if(p!=="static"){break}}}while(element);valueL-=layout.get("margin-top");valueT-=layout.get("margin-left");return new Element.Offset(valueL,valueT)}function cumulativeScrollOffset(element){var valueT=0,valueL=0;do{valueT+=element.scrollTop||0;valueL+=element.scrollLeft||0;element=element.parentNode}while(element);return new Element.Offset(valueL,valueT)}function viewportOffset(forElement){element=$(element);var valueT=0,valueL=0,docBody=document.body;var element=forElement;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;if(element.offsetParent==docBody&&Element.getStyle(element,"position")=="absolute"){break}}while(element=element.offsetParent);element=forElement;do{if(element!=docBody){valueT-=element.scrollTop||0;valueL-=element.scrollLeft||0}}while(element=element.parentNode);return new Element.Offset(valueL,valueT)}function absolutize(element){element=$(element);if(Element.getStyle(element,"position")==="absolute"){return element}var offsetParent=getOffsetParent(element);var eOffset=element.viewportOffset(),pOffset=offsetParent.viewportOffset();var offset=eOffset.relativeTo(pOffset);var layout=element.getLayout();element.store("prototype_absolutize_original_styles",{left:element.getStyle("left"),top:element.getStyle("top"),width:element.getStyle("width"),height:element.getStyle("height")});element.setStyle({position:"absolute",top:offset.top+"px",left:offset.left+"px",width:layout.get("width")+"px",height:layout.get("height")+"px"});return element}function relativize(element){element=$(element);if(Element.getStyle(element,"position")==="relative"){return element}var originalStyles=element.retrieve("prototype_absolutize_original_styles");if(originalStyles){element.setStyle(originalStyles)}return element}if(Prototype.Browser.IE){getOffsetParent=getOffsetParent.wrap(function(proceed,element){element=$(element);if(isDocument(element)||isDetached(element)||isBody(element)||isHtml(element)){return $(document.body)}var position=element.getStyle("position");if(position!=="static"){return proceed(element)}element.setStyle({position:"relative"});var value=proceed(element);element.setStyle({position:position});return value});positionedOffset=positionedOffset.wrap(function(proceed,element){element=$(element);if(!element.parentNode){return new Element.Offset(0,0)}var position=element.getStyle("position");if(position!=="static"){return proceed(element)}var offsetParent=element.getOffsetParent();if(offsetParent&&offsetParent.getStyle("position")==="fixed"){hasLayout(offsetParent)}element.setStyle({position:"relative"});var value=proceed(element);element.setStyle({position:position});return value})}else{if(Prototype.Browser.Webkit){cumulativeOffset=function(element){element=$(element);var valueT=0,valueL=0;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;if(element.offsetParent==document.body){if(Element.getStyle(element,"position")=="absolute"){break}}element=element.offsetParent}while(element);return new Element.Offset(valueL,valueT)}}}Element.addMethods({getLayout:getLayout,measure:measure,getDimensions:getDimensions,getOffsetParent:getOffsetParent,cumulativeOffset:cumulativeOffset,positionedOffset:positionedOffset,cumulativeScrollOffset:cumulativeScrollOffset,viewportOffset:viewportOffset,absolutize:absolutize,relativize:relativize});function isBody(element){return element.nodeName.toUpperCase()==="BODY"}function isHtml(element){return element.nodeName.toUpperCase()==="HTML"}function isDocument(element){return element.nodeType===Node.DOCUMENT_NODE}function isDetached(element){return element!==document.body&&!Element.descendantOf(element,document.body)}if("getBoundingClientRect" in document.documentElement){Element.addMethods({viewportOffset:function(element){element=$(element);if(isDetached(element)){return new Element.Offset(0,0)}var rect=element.getBoundingClientRect(),docEl=document.documentElement;return new Element.Offset(rect.left-docEl.clientLeft,rect.top-docEl.clientTop)}})}})();window.$$=function(){var expression=$A(arguments).join(", ");return Prototype.Selector.select(expression,document)};Prototype.Selector=(function(){function select(){throw new Error('Method "Prototype.Selector.select" must be defined.')}function match(){throw new Error('Method "Prototype.Selector.match" must be defined.')}function find(elements,expression,index){index=index||0;var match=Prototype.Selector.match,length=elements.length,matchIndex=0,i;for(i=0;i<length;i++){if(match(elements[i],expression)&&index==matchIndex++){return Element.extend(elements[i])}}}function extendElements(elements){for(var i=0,length=elements.length;i<length;i++){Element.extend(elements[i])}return elements}var K=Prototype.K;return{select:select,match:match,find:find,extendElements:(Element.extend===K)?K:extendElements,extendElement:Element.extend}})();Prototype._original_property=window.Sizzle;
/*
 * Sizzle CSS Selector Engine - v1.0
 *  Copyright 2009, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
(function(){var chunker=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,done=0,toString=Object.prototype.toString,hasDuplicate=false,baseHasDuplicate=true;[0,0].sort(function(){baseHasDuplicate=false;return 0});var Sizzle=function(selector,context,results,seed){results=results||[];var origContext=context=context||document;if(context.nodeType!==1&&context.nodeType!==9){return[]}if(!selector||typeof selector!=="string"){return results}var parts=[],m,set,checkSet,check,mode,extra,prune=true,contextXML=isXML(context),soFar=selector;while((chunker.exec(""),m=chunker.exec(soFar))!==null){soFar=m[3];parts.push(m[1]);if(m[2]){extra=m[3];break}}if(parts.length>1&&origPOS.exec(selector)){if(parts.length===2&&Expr.relative[parts[0]]){set=posProcess(parts[0]+parts[1],context)}else{set=Expr.relative[parts[0]]?[context]:Sizzle(parts.shift(),context);while(parts.length){selector=parts.shift();if(Expr.relative[selector]){selector+=parts.shift()}set=posProcess(selector,set)}}}else{if(!seed&&parts.length>1&&context.nodeType===9&&!contextXML&&Expr.match.ID.test(parts[0])&&!Expr.match.ID.test(parts[parts.length-1])){var ret=Sizzle.find(parts.shift(),context,contextXML);context=ret.expr?Sizzle.filter(ret.expr,ret.set)[0]:ret.set[0]}if(context){var ret=seed?{expr:parts.pop(),set:makeArray(seed)}:Sizzle.find(parts.pop(),parts.length===1&&(parts[0]==="~"||parts[0]==="+")&&context.parentNode?context.parentNode:context,contextXML);set=ret.expr?Sizzle.filter(ret.expr,ret.set):ret.set;if(parts.length>0){checkSet=makeArray(set)}else{prune=false}while(parts.length){var cur=parts.pop(),pop=cur;if(!Expr.relative[cur]){cur=""}else{pop=parts.pop()}if(pop==null){pop=context}Expr.relative[cur](checkSet,pop,contextXML)}}else{checkSet=parts=[]}}if(!checkSet){checkSet=set}if(!checkSet){throw"Syntax error, unrecognized expression: "+(cur||selector)}if(toString.call(checkSet)==="[object Array]"){if(!prune){results.push.apply(results,checkSet)}else{if(context&&context.nodeType===1){for(var i=0;checkSet[i]!=null;i++){if(checkSet[i]&&(checkSet[i]===true||checkSet[i].nodeType===1&&contains(context,checkSet[i]))){results.push(set[i])}}}else{for(var i=0;checkSet[i]!=null;i++){if(checkSet[i]&&checkSet[i].nodeType===1){results.push(set[i])}}}}}else{makeArray(checkSet,results)}if(extra){Sizzle(extra,origContext,results,seed);Sizzle.uniqueSort(results)}return results};Sizzle.uniqueSort=function(results){if(sortOrder){hasDuplicate=baseHasDuplicate;results.sort(sortOrder);if(hasDuplicate){for(var i=1;i<results.length;i++){if(results[i]===results[i-1]){results.splice(i--,1)}}}}return results};Sizzle.matches=function(expr,set){return Sizzle(expr,null,null,set)};Sizzle.find=function(expr,context,isXML){var set,match;if(!expr){return[]}for(var i=0,l=Expr.order.length;i<l;i++){var type=Expr.order[i],match;if((match=Expr.leftMatch[type].exec(expr))){var left=match[1];match.splice(1,1);if(left.substr(left.length-1)!=="\\"){match[1]=(match[1]||"").replace(/\\/g,"");set=Expr.find[type](match,context,isXML);if(set!=null){expr=expr.replace(Expr.match[type],"");break}}}}if(!set){set=context.getElementsByTagName("*")}return{set:set,expr:expr}};Sizzle.filter=function(expr,set,inplace,not){var old=expr,result=[],curLoop=set,match,anyFound,isXMLFilter=set&&set[0]&&isXML(set[0]);while(expr&&set.length){for(var type in Expr.filter){if((match=Expr.match[type].exec(expr))!=null){var filter=Expr.filter[type],found,item;anyFound=false;if(curLoop==result){result=[]}if(Expr.preFilter[type]){match=Expr.preFilter[type](match,curLoop,inplace,result,not,isXMLFilter);if(!match){anyFound=found=true}else{if(match===true){continue}}}if(match){for(var i=0;(item=curLoop[i])!=null;i++){if(item){found=filter(item,match,i,curLoop);var pass=not^!!found;if(inplace&&found!=null){if(pass){anyFound=true}else{curLoop[i]=false}}else{if(pass){result.push(item);anyFound=true}}}}}if(found!==undefined){if(!inplace){curLoop=result}expr=expr.replace(Expr.match[type],"");if(!anyFound){return[]}break}}}if(expr==old){if(anyFound==null){throw"Syntax error, unrecognized expression: "+expr}else{break}}old=expr}return curLoop};var Expr=Sizzle.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(elem){return elem.getAttribute("href")}},relative:{"+":function(checkSet,part,isXML){var isPartStr=typeof part==="string",isTag=isPartStr&&!/\W/.test(part),isPartStrNotTag=isPartStr&&!isTag;if(isTag&&!isXML){part=part.toUpperCase()}for(var i=0,l=checkSet.length,elem;i<l;i++){if((elem=checkSet[i])){while((elem=elem.previousSibling)&&elem.nodeType!==1){}checkSet[i]=isPartStrNotTag||elem&&elem.nodeName===part?elem||false:elem===part}}if(isPartStrNotTag){Sizzle.filter(part,checkSet,true)}},">":function(checkSet,part,isXML){var isPartStr=typeof part==="string";if(isPartStr&&!/\W/.test(part)){part=isXML?part:part.toUpperCase();for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){var parent=elem.parentNode;checkSet[i]=parent.nodeName===part?parent:false}}}else{for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){checkSet[i]=isPartStr?elem.parentNode:elem.parentNode===part}}if(isPartStr){Sizzle.filter(part,checkSet,true)}}},"":function(checkSet,part,isXML){var doneName=done++,checkFn=dirCheck;if(!/\W/.test(part)){var nodeCheck=part=isXML?part:part.toUpperCase();checkFn=dirNodeCheck}checkFn("parentNode",part,doneName,checkSet,nodeCheck,isXML)},"~":function(checkSet,part,isXML){var doneName=done++,checkFn=dirCheck;if(typeof part==="string"&&!/\W/.test(part)){var nodeCheck=part=isXML?part:part.toUpperCase();checkFn=dirNodeCheck}checkFn("previousSibling",part,doneName,checkSet,nodeCheck,isXML)}},find:{ID:function(match,context,isXML){if(typeof context.getElementById!=="undefined"&&!isXML){var m=context.getElementById(match[1]);return m?[m]:[]}},NAME:function(match,context,isXML){if(typeof context.getElementsByName!=="undefined"){var ret=[],results=context.getElementsByName(match[1]);for(var i=0,l=results.length;i<l;i++){if(results[i].getAttribute("name")===match[1]){ret.push(results[i])}}return ret.length===0?null:ret}},TAG:function(match,context){return context.getElementsByTagName(match[1])}},preFilter:{CLASS:function(match,curLoop,inplace,result,not,isXML){match=" "+match[1].replace(/\\/g,"")+" ";if(isXML){return match}for(var i=0,elem;(elem=curLoop[i])!=null;i++){if(elem){if(not^(elem.className&&(" "+elem.className+" ").indexOf(match)>=0)){if(!inplace){result.push(elem)}}else{if(inplace){curLoop[i]=false}}}}return false},ID:function(match){return match[1].replace(/\\/g,"")},TAG:function(match,curLoop){for(var i=0;curLoop[i]===false;i++){}return curLoop[i]&&isXML(curLoop[i])?match[1]:match[1].toUpperCase()},CHILD:function(match){if(match[1]=="nth"){var test=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(match[2]=="even"&&"2n"||match[2]=="odd"&&"2n+1"||!/\D/.test(match[2])&&"0n+"+match[2]||match[2]);match[2]=(test[1]+(test[2]||1))-0;match[3]=test[3]-0}match[0]=done++;return match},ATTR:function(match,curLoop,inplace,result,not,isXML){var name=match[1].replace(/\\/g,"");if(!isXML&&Expr.attrMap[name]){match[1]=Expr.attrMap[name]}if(match[2]==="~="){match[4]=" "+match[4]+" "}return match},PSEUDO:function(match,curLoop,inplace,result,not){if(match[1]==="not"){if((chunker.exec(match[3])||"").length>1||/^\w/.test(match[3])){match[3]=Sizzle(match[3],null,null,curLoop)}else{var ret=Sizzle.filter(match[3],curLoop,inplace,true^not);if(!inplace){result.push.apply(result,ret)}return false}}else{if(Expr.match.POS.test(match[0])||Expr.match.CHILD.test(match[0])){return true}}return match},POS:function(match){match.unshift(true);return match}},filters:{enabled:function(elem){return elem.disabled===false&&elem.type!=="hidden"},disabled:function(elem){return elem.disabled===true},checked:function(elem){return elem.checked===true},selected:function(elem){elem.parentNode.selectedIndex;return elem.selected===true},parent:function(elem){return !!elem.firstChild},empty:function(elem){return !elem.firstChild},has:function(elem,i,match){return !!Sizzle(match[3],elem).length},header:function(elem){return/h\d/i.test(elem.nodeName)},text:function(elem){return"text"===elem.type},radio:function(elem){return"radio"===elem.type},checkbox:function(elem){return"checkbox"===elem.type},file:function(elem){return"file"===elem.type},password:function(elem){return"password"===elem.type},submit:function(elem){return"submit"===elem.type},image:function(elem){return"image"===elem.type},reset:function(elem){return"reset"===elem.type},button:function(elem){return"button"===elem.type||elem.nodeName.toUpperCase()==="BUTTON"},input:function(elem){return/input|select|textarea|button/i.test(elem.nodeName)}},setFilters:{first:function(elem,i){return i===0},last:function(elem,i,match,array){return i===array.length-1},even:function(elem,i){return i%2===0},odd:function(elem,i){return i%2===1},lt:function(elem,i,match){return i<match[3]-0},gt:function(elem,i,match){return i>match[3]-0},nth:function(elem,i,match){return match[3]-0==i},eq:function(elem,i,match){return match[3]-0==i}},filter:{PSEUDO:function(elem,match,i,array){var name=match[1],filter=Expr.filters[name];if(filter){return filter(elem,i,match,array)}else{if(name==="contains"){return(elem.textContent||elem.innerText||"").indexOf(match[3])>=0}else{if(name==="not"){var not=match[3];for(var i=0,l=not.length;i<l;i++){if(not[i]===elem){return false}}return true}}}},CHILD:function(elem,match){var type=match[1],node=elem;switch(type){case"only":case"first":while((node=node.previousSibling)){if(node.nodeType===1){return false}}if(type=="first"){return true}node=elem;case"last":while((node=node.nextSibling)){if(node.nodeType===1){return false}}return true;case"nth":var first=match[2],last=match[3];if(first==1&&last==0){return true}var doneName=match[0],parent=elem.parentNode;if(parent&&(parent.sizcache!==doneName||!elem.nodeIndex)){var count=0;for(node=parent.firstChild;node;node=node.nextSibling){if(node.nodeType===1){node.nodeIndex=++count}}parent.sizcache=doneName}var diff=elem.nodeIndex-last;if(first==0){return diff==0}else{return(diff%first==0&&diff/first>=0)}}},ID:function(elem,match){return elem.nodeType===1&&elem.getAttribute("id")===match},TAG:function(elem,match){return(match==="*"&&elem.nodeType===1)||elem.nodeName===match},CLASS:function(elem,match){return(" "+(elem.className||elem.getAttribute("class"))+" ").indexOf(match)>-1},ATTR:function(elem,match){var name=match[1],result=Expr.attrHandle[name]?Expr.attrHandle[name](elem):elem[name]!=null?elem[name]:elem.getAttribute(name),value=result+"",type=match[2],check=match[4];return result==null?type==="!=":type==="="?value===check:type==="*="?value.indexOf(check)>=0:type==="~="?(" "+value+" ").indexOf(check)>=0:!check?value&&result!==false:type==="!="?value!=check:type==="^="?value.indexOf(check)===0:type==="$="?value.substr(value.length-check.length)===check:type==="|="?value===check||value.substr(0,check.length+1)===check+"-":false},POS:function(elem,match,i,array){var name=match[2],filter=Expr.setFilters[name];if(filter){return filter(elem,i,match,array)}}}};var origPOS=Expr.match.POS;for(var type in Expr.match){Expr.match[type]=new RegExp(Expr.match[type].source+/(?![^\[]*\])(?![^\(]*\))/.source);Expr.leftMatch[type]=new RegExp(/(^(?:.|\r|\n)*?)/.source+Expr.match[type].source)}var makeArray=function(array,results){array=Array.prototype.slice.call(array,0);if(results){results.push.apply(results,array);return results}return array};try{Array.prototype.slice.call(document.documentElement.childNodes,0)}catch(e){makeArray=function(array,results){var ret=results||[];if(toString.call(array)==="[object Array]"){Array.prototype.push.apply(ret,array)}else{if(typeof array.length==="number"){for(var i=0,l=array.length;i<l;i++){ret.push(array[i])}}else{for(var i=0;array[i];i++){ret.push(array[i])}}}return ret}}var sortOrder;if(document.documentElement.compareDocumentPosition){sortOrder=function(a,b){if(!a.compareDocumentPosition||!b.compareDocumentPosition){if(a==b){hasDuplicate=true}return 0}var ret=a.compareDocumentPosition(b)&4?-1:a===b?0:1;if(ret===0){hasDuplicate=true}return ret}}else{if("sourceIndex" in document.documentElement){sortOrder=function(a,b){if(!a.sourceIndex||!b.sourceIndex){if(a==b){hasDuplicate=true}return 0}var ret=a.sourceIndex-b.sourceIndex;if(ret===0){hasDuplicate=true}return ret}}else{if(document.createRange){sortOrder=function(a,b){if(!a.ownerDocument||!b.ownerDocument){if(a==b){hasDuplicate=true}return 0}var aRange=a.ownerDocument.createRange(),bRange=b.ownerDocument.createRange();aRange.setStart(a,0);aRange.setEnd(a,0);bRange.setStart(b,0);bRange.setEnd(b,0);var ret=aRange.compareBoundaryPoints(Range.START_TO_END,bRange);if(ret===0){hasDuplicate=true}return ret}}}}(function(){var form=document.createElement("div"),id="script"+(new Date).getTime();form.innerHTML="<a name='"+id+"'/>";var root=document.documentElement;root.insertBefore(form,root.firstChild);if(!!document.getElementById(id)){Expr.find.ID=function(match,context,isXML){if(typeof context.getElementById!=="undefined"&&!isXML){var m=context.getElementById(match[1]);return m?m.id===match[1]||typeof m.getAttributeNode!=="undefined"&&m.getAttributeNode("id").nodeValue===match[1]?[m]:undefined:[]}};Expr.filter.ID=function(elem,match){var node=typeof elem.getAttributeNode!=="undefined"&&elem.getAttributeNode("id");return elem.nodeType===1&&node&&node.nodeValue===match}}root.removeChild(form);root=form=null})();(function(){var div=document.createElement("div");div.appendChild(document.createComment(""));if(div.getElementsByTagName("*").length>0){Expr.find.TAG=function(match,context){var results=context.getElementsByTagName(match[1]);if(match[1]==="*"){var tmp=[];for(var i=0;results[i];i++){if(results[i].nodeType===1){tmp.push(results[i])}}results=tmp}return results}}div.innerHTML="<a href='#'></a>";if(div.firstChild&&typeof div.firstChild.getAttribute!=="undefined"&&div.firstChild.getAttribute("href")!=="#"){Expr.attrHandle.href=function(elem){return elem.getAttribute("href",2)}}div=null})();if(document.querySelectorAll){(function(){var oldSizzle=Sizzle,div=document.createElement("div");div.innerHTML="<p class='TEST'></p>";if(div.querySelectorAll&&div.querySelectorAll(".TEST").length===0){return}Sizzle=function(query,context,extra,seed){context=context||document;if(!seed&&context.nodeType===9&&!isXML(context)){try{return makeArray(context.querySelectorAll(query),extra)}catch(e){}}return oldSizzle(query,context,extra,seed)};for(var prop in oldSizzle){Sizzle[prop]=oldSizzle[prop]}div=null})()}if(document.getElementsByClassName&&document.documentElement.getElementsByClassName){(function(){var div=document.createElement("div");div.innerHTML="<div class='test e'></div><div class='test'></div>";if(div.getElementsByClassName("e").length===0){return}div.lastChild.className="e";if(div.getElementsByClassName("e").length===1){return}Expr.order.splice(1,0,"CLASS");Expr.find.CLASS=function(match,context,isXML){if(typeof context.getElementsByClassName!=="undefined"&&!isXML){return context.getElementsByClassName(match[1])}};div=null})()}function dirNodeCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){var sibDir=dir=="previousSibling"&&!isXML;for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){if(sibDir&&elem.nodeType===1){elem.sizcache=doneName;elem.sizset=i}elem=elem[dir];var match=false;while(elem){if(elem.sizcache===doneName){match=checkSet[elem.sizset];break}if(elem.nodeType===1&&!isXML){elem.sizcache=doneName;elem.sizset=i}if(elem.nodeName===cur){match=elem;break}elem=elem[dir]}checkSet[i]=match}}}function dirCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){var sibDir=dir=="previousSibling"&&!isXML;for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){if(sibDir&&elem.nodeType===1){elem.sizcache=doneName;elem.sizset=i}elem=elem[dir];var match=false;while(elem){if(elem.sizcache===doneName){match=checkSet[elem.sizset];break}if(elem.nodeType===1){if(!isXML){elem.sizcache=doneName;elem.sizset=i}if(typeof cur!=="string"){if(elem===cur){match=true;break}}else{if(Sizzle.filter(cur,[elem]).length>0){match=elem;break}}}elem=elem[dir]}checkSet[i]=match}}}var contains=document.compareDocumentPosition?function(a,b){return a.compareDocumentPosition(b)&16}:function(a,b){return a!==b&&(a.contains?a.contains(b):true)};var isXML=function(elem){return elem.nodeType===9&&elem.documentElement.nodeName!=="HTML"||!!elem.ownerDocument&&elem.ownerDocument.documentElement.nodeName!=="HTML"};var posProcess=function(selector,context){var tmpSet=[],later="",match,root=context.nodeType?[context]:context;while((match=Expr.match.PSEUDO.exec(selector))){later+=match[0];selector=selector.replace(Expr.match.PSEUDO,"")}selector=Expr.relative[selector]?selector+"*":selector;for(var i=0,l=root.length;i<l;i++){Sizzle(selector,root[i],tmpSet)}return Sizzle.filter(later,tmpSet)};window.Sizzle=Sizzle})();(function(engine){var extendElements=Prototype.Selector.extendElements;function select(selector,scope){return extendElements(engine(selector,scope||document))}function match(element,selector){return engine.matches(selector,[element]).length==1}Prototype.Selector.engine=engine;Prototype.Selector.select=select;Prototype.Selector.match=match})(Sizzle);window.Sizzle=Prototype._original_property;delete Prototype._original_property;var Form={reset:function(form){form=$(form);form.reset();return form},serializeElements:function(elements,options){if(typeof options!="object"){options={hash:!!options}}else{if(Object.isUndefined(options.hash)){options.hash=true}}var key,value,submitted=false,submit=options.submit,accumulator,initial;if(options.hash){initial={};accumulator=function(result,key,value){if(key in result){if(!Object.isArray(result[key])){result[key]=[result[key]]}result[key].push(value)}else{result[key]=value}return result}}else{initial="";accumulator=function(result,key,value){return result+(result?"&":"")+encodeURIComponent(key)+"="+encodeURIComponent(value)}}return elements.inject(initial,function(result,element){if(!element.disabled&&element.name){key=element.name;value=$(element).getValue();if(value!=null&&element.type!="file"&&(element.type!="submit"||(!submitted&&submit!==false&&(!submit||key==submit)&&(submitted=true)))){result=accumulator(result,key,value)}}return result})}};Form.Methods={serialize:function(form,options){return Form.serializeElements(Form.getElements(form),options)},getElements:function(form){var elements=$(form).getElementsByTagName("*"),element,arr=[],serializers=Form.Element.Serializers;for(var i=0;element=elements[i];i++){arr.push(element)}return arr.inject([],function(elements,child){if(serializers[child.tagName.toLowerCase()]){elements.push(Element.extend(child))}return elements})},getInputs:function(form,typeName,name){form=$(form);var inputs=form.getElementsByTagName("input");if(!typeName&&!name){return $A(inputs).map(Element.extend)}for(var i=0,matchingInputs=[],length=inputs.length;i<length;i++){var input=inputs[i];if((typeName&&input.type!=typeName)||(name&&input.name!=name)){continue}matchingInputs.push(Element.extend(input))}return matchingInputs},disable:function(form){form=$(form);Form.getElements(form).invoke("disable");return form},enable:function(form){form=$(form);Form.getElements(form).invoke("enable");return form},findFirstElement:function(form){var elements=$(form).getElements().findAll(function(element){return"hidden"!=element.type&&!element.disabled});var firstByIndex=elements.findAll(function(element){return element.hasAttribute("tabIndex")&&element.tabIndex>=0}).sortBy(function(element){return element.tabIndex}).first();return firstByIndex?firstByIndex:elements.find(function(element){return/^(?:input|select|textarea)$/i.test(element.tagName)})},focusFirstElement:function(form){form=$(form);var element=form.findFirstElement();if(element){element.activate()}return form},request:function(form,options){form=$(form),options=Object.clone(options||{});var params=options.parameters,action=form.readAttribute("action")||"";if(action.blank()){action=window.location.href}options.parameters=form.serialize(true);if(params){if(Object.isString(params)){params=params.toQueryParams()}Object.extend(options.parameters,params)}if(form.hasAttribute("method")&&!options.method){options.method=form.method}return new Ajax.Request(action,options)}};Form.Element={focus:function(element){$(element).focus();return element},select:function(element){$(element).select();return element}};Form.Element.Methods={serialize:function(element){element=$(element);if(!element.disabled&&element.name){var value=element.getValue();if(value!=undefined){var pair={};pair[element.name]=value;return Object.toQueryString(pair)}}return""},getValue:function(element){element=$(element);var method=element.tagName.toLowerCase();return Form.Element.Serializers[method](element)},setValue:function(element,value){element=$(element);var method=element.tagName.toLowerCase();Form.Element.Serializers[method](element,value);return element},clear:function(element){$(element).value="";return element},present:function(element){return $(element).value!=""},activate:function(element){element=$(element);try{element.focus();if(element.select&&(element.tagName.toLowerCase()!="input"||!(/^(?:button|reset|submit)$/i.test(element.type)))){element.select()}}catch(e){}return element},disable:function(element){element=$(element);element.disabled=true;return element},enable:function(element){element=$(element);element.disabled=false;return element}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers=(function(){function input(element,value){switch(element.type.toLowerCase()){case"checkbox":case"radio":return inputSelector(element,value);default:return valueSelector(element,value)}}function inputSelector(element,value){if(Object.isUndefined(value)){return element.checked?element.value:null}else{element.checked=!!value}}function valueSelector(element,value){if(Object.isUndefined(value)){return element.value}else{element.value=value}}function select(element,value){if(Object.isUndefined(value)){return(element.type==="select-one"?selectOne:selectMany)(element)}var opt,currentValue,single=!Object.isArray(value);for(var i=0,length=element.length;i<length;i++){opt=element.options[i];currentValue=this.optionValue(opt);if(single){if(currentValue==value){opt.selected=true;return}}else{opt.selected=value.include(currentValue)}}}function selectOne(element){var index=element.selectedIndex;return index>=0?optionValue(element.options[index]):null}function selectMany(element){var values,length=element.length;if(!length){return null}for(var i=0,values=[];i<length;i++){var opt=element.options[i];if(opt.selected){values.push(optionValue(opt))}}return values}function optionValue(opt){return Element.hasAttribute(opt,"value")?opt.value:opt.text}return{input:input,inputSelector:inputSelector,textarea:valueSelector,select:select,selectOne:selectOne,selectMany:selectMany,optionValue:optionValue,button:valueSelector}})();Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,element,frequency,callback){$super(callback,frequency);this.element=$(element);this.lastValue=this.getValue()},execute:function(){var value=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(value)?this.lastValue!=value:String(this.lastValue)!=String(value)){this.callback(this.element,value);this.lastValue=value}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});Abstract.EventObserver=Class.create({initialize:function(element,callback){this.element=$(element);this.callback=callback;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=="form"){this.registerFormCallbacks()}else{this.registerCallback(this.element)}},onElementEvent:function(){var value=this.getValue();if(this.lastValue!=value){this.callback(this.element,value);this.lastValue=value}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(element){if(element.type){switch(element.type.toLowerCase()){case"checkbox":case"radio":Event.observe(element,"click",this.onElementEvent.bind(this));break;default:Event.observe(element,"change",this.onElementEvent.bind(this));break}}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});(function(){var Event={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}};var docEl=document.documentElement;var MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED="onmouseenter" in docEl&&"onmouseleave" in docEl;var isIELegacyEvent=function(event){return false};if(window.attachEvent){if(window.addEventListener){isIELegacyEvent=function(event){return !(event instanceof window.Event)}}else{isIELegacyEvent=function(event){return true}}}var _isButton;function _isButtonForDOMEvents(event,code){return event.which?(event.which===code+1):(event.button===code)}var legacyButtonMap={0:1,1:4,2:2};function _isButtonForLegacyEvents(event,code){return event.button===legacyButtonMap[code]}function _isButtonForWebKit(event,code){switch(code){case 0:return event.which==1&&!event.metaKey;case 1:return event.which==2||(event.which==1&&event.metaKey);case 2:return event.which==3;default:return false}}if(window.attachEvent){if(!window.addEventListener){_isButton=_isButtonForLegacyEvents}else{_isButton=function(event,code){return isIELegacyEvent(event)?_isButtonForLegacyEvents(event,code):_isButtonForDOMEvents(event,code)}}}else{if(Prototype.Browser.WebKit){_isButton=_isButtonForWebKit}else{_isButton=_isButtonForDOMEvents}}function isLeftClick(event){return _isButton(event,0)}function isMiddleClick(event){return _isButton(event,1)}function isRightClick(event){return _isButton(event,2)}function element(event){event=Event.extend(event);var node=event.target,type=event.type,currentTarget=event.currentTarget;if(currentTarget&&currentTarget.tagName){if(type==="load"||type==="error"||(type==="click"&&currentTarget.tagName.toLowerCase()==="input"&&currentTarget.type==="radio")){node=currentTarget}}if(node.nodeType==Node.TEXT_NODE){node=node.parentNode}return Element.extend(node)}function findElement(event,expression){var element=Event.element(event);if(!expression){return element}while(element){if(Object.isElement(element)&&Prototype.Selector.match(element,expression)){return Element.extend(element)}element=element.parentNode}}function pointer(event){return{x:pointerX(event),y:pointerY(event)}}function pointerX(event){var docElement=document.documentElement,body=document.body||{scrollLeft:0};return event.pageX||(event.clientX+(docElement.scrollLeft||body.scrollLeft)-(docElement.clientLeft||0))}function pointerY(event){var docElement=document.documentElement,body=document.body||{scrollTop:0};return event.pageY||(event.clientY+(docElement.scrollTop||body.scrollTop)-(docElement.clientTop||0))}function stop(event){Event.extend(event);event.preventDefault();event.stopPropagation();event.stopped=true}Event.Methods={isLeftClick:isLeftClick,isMiddleClick:isMiddleClick,isRightClick:isRightClick,element:element,findElement:findElement,pointer:pointer,pointerX:pointerX,pointerY:pointerY,stop:stop};var methods=Object.keys(Event.Methods).inject({},function(m,name){m[name]=Event.Methods[name].methodize();return m});if(window.attachEvent){function _relatedTarget(event){var element;switch(event.type){case"mouseover":case"mouseenter":element=event.fromElement;break;case"mouseout":case"mouseleave":element=event.toElement;break;default:return null}return Element.extend(element)}var additionalMethods={stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},inspect:function(){return"[object Event]"}};Event.extend=function(event,element){if(!event){return false}if(!isIELegacyEvent(event)){return event}if(event._extendedByPrototype){return event}event._extendedByPrototype=Prototype.emptyFunction;var pointer=Event.pointer(event);Object.extend(event,{target:event.srcElement||element,relatedTarget:_relatedTarget(event),pageX:pointer.x,pageY:pointer.y});Object.extend(event,methods);Object.extend(event,additionalMethods);return event}}else{Event.extend=Prototype.K}if(window.addEventListener){Event.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__;Object.extend(Event.prototype,methods)}function _createResponder(element,eventName,handler){var registry=Element.retrieve(element,"prototype_event_registry");if(Object.isUndefined(registry)){CACHE.push(element);registry=Element.retrieve(element,"prototype_event_registry",$H())}var respondersForEvent=registry.get(eventName);if(Object.isUndefined(respondersForEvent)){respondersForEvent=[];registry.set(eventName,respondersForEvent)}if(respondersForEvent.pluck("handler").include(handler)){return false}var responder;if(eventName.include(":")){responder=function(event){if(Object.isUndefined(event.eventName)){return false}if(event.eventName!==eventName){return false}Event.extend(event,element);handler.call(element,event)}}else{if(!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED&&(eventName==="mouseenter"||eventName==="mouseleave")){if(eventName==="mouseenter"||eventName==="mouseleave"){responder=function(event){Event.extend(event,element);var parent=event.relatedTarget;while(parent&&parent!==element){try{parent=parent.parentNode}catch(e){parent=element}}if(parent===element){return}handler.call(element,event)}}}else{responder=function(event){Event.extend(event,element);handler.call(element,event)}}}responder.handler=handler;respondersForEvent.push(responder);return responder}function _destroyCache(){for(var i=0,length=CACHE.length;i<length;i++){Event.stopObserving(CACHE[i]);CACHE[i]=null}}var CACHE=[];if(Prototype.Browser.IE){window.attachEvent("onunload",_destroyCache)}if(Prototype.Browser.WebKit){window.addEventListener("unload",Prototype.emptyFunction,false)}var _getDOMEventName=Prototype.K,translations={mouseenter:"mouseover",mouseleave:"mouseout"};if(!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED){_getDOMEventName=function(eventName){return(translations[eventName]||eventName)}}function observe(element,eventName,handler){element=$(element);var responder=_createResponder(element,eventName,handler);if(!responder){return element}if(eventName.include(":")){if(element.addEventListener){element.addEventListener("dataavailable",responder,false)}else{element.attachEvent("ondataavailable",responder);element.attachEvent("onlosecapture",responder)}}else{var actualEventName=_getDOMEventName(eventName);if(element.addEventListener){element.addEventListener(actualEventName,responder,false)}else{element.attachEvent("on"+actualEventName,responder)}}return element}function stopObserving(element,eventName,handler){element=$(element);var registry=Element.retrieve(element,"prototype_event_registry");if(!registry){return element}if(!eventName){registry.each(function(pair){var eventName=pair.key;stopObserving(element,eventName)});return element}var responders=registry.get(eventName);if(!responders){return element}if(!handler){responders.each(function(r){stopObserving(element,eventName,r.handler)});return element}var i=responders.length,responder;while(i--){if(responders[i].handler===handler){responder=responders[i];break}}if(!responder){return element}if(eventName.include(":")){if(element.removeEventListener){element.removeEventListener("dataavailable",responder,false)}else{element.detachEvent("ondataavailable",responder);element.detachEvent("onlosecapture",responder)}}else{var actualEventName=_getDOMEventName(eventName);if(element.removeEventListener){element.removeEventListener(actualEventName,responder,false)}else{element.detachEvent("on"+actualEventName,responder)}}registry.set(eventName,responders.without(responder));return element}function fire(element,eventName,memo,bubble){element=$(element);if(Object.isUndefined(bubble)){bubble=true}if(element==document&&document.createEvent&&!element.dispatchEvent){element=document.documentElement}var event;if(document.createEvent){event=document.createEvent("HTMLEvents");event.initEvent("dataavailable",bubble,true)}else{event=document.createEventObject();event.eventType=bubble?"ondataavailable":"onlosecapture"}event.eventName=eventName;event.memo=memo||{};if(document.createEvent){element.dispatchEvent(event)}else{element.fireEvent(event.eventType,event)}return Event.extend(event)}Event.Handler=Class.create({initialize:function(element,eventName,selector,callback){this.element=$(element);this.eventName=eventName;this.selector=selector;this.callback=callback;this.handler=this.handleEvent.bind(this)},start:function(){Event.observe(this.element,this.eventName,this.handler);return this},stop:function(){Event.stopObserving(this.element,this.eventName,this.handler);return this},handleEvent:function(event){var element=Event.findElement(event,this.selector);if(element){this.callback.call(this.element,event,element)}}});function on(element,eventName,selector,callback){element=$(element);if(Object.isFunction(selector)&&Object.isUndefined(callback)){callback=selector,selector=null}return new Event.Handler(element,eventName,selector,callback).start()}Object.extend(Event,Event.Methods);Object.extend(Event,{fire:fire,observe:observe,stopObserving:stopObserving,on:on});Element.addMethods({fire:fire,observe:observe,stopObserving:stopObserving,on:on});Object.extend(document,{fire:fire.methodize(),observe:observe.methodize(),stopObserving:stopObserving.methodize(),on:on.methodize(),loaded:false});if(window.Event){Object.extend(window.Event,Event)}else{window.Event=Event}})();(function(){var timer;function fireContentLoadedEvent(){if(document.loaded){return}if(timer){window.clearTimeout(timer)}document.loaded=true;document.fire("dom:loaded")}function checkReadyState(){if(document.readyState==="complete"){document.stopObserving("readystatechange",checkReadyState);fireContentLoadedEvent()}}function pollDoScroll(){try{document.documentElement.doScroll("left")}catch(e){timer=pollDoScroll.defer();return}fireContentLoadedEvent()}if(document.addEventListener){document.addEventListener("DOMContentLoaded",fireContentLoadedEvent,false)}else{document.observe("readystatechange",checkReadyState);if(window==top){timer=pollDoScroll.defer()}}Event.observe(window,"load",fireContentLoadedEvent)})();Element.addMethods();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(element,content){return Element.insert(element,{before:content})},Top:function(element,content){return Element.insert(element,{top:content})},Bottom:function(element,content){return Element.insert(element,{bottom:content})},After:function(element,content){return Element.insert(element,{after:content})}};var $continue=new Error('"throw $continue" is deprecated, use "return" instead');var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},within:function(element,x,y){if(this.includeScrollOffsets){return this.withinIncludingScrolloffsets(element,x,y)}this.xcomp=x;this.ycomp=y;this.offset=Element.cumulativeOffset(element);return(y>=this.offset[1]&&y<this.offset[1]+element.offsetHeight&&x>=this.offset[0]&&x<this.offset[0]+element.offsetWidth)},withinIncludingScrolloffsets:function(element,x,y){var offsetcache=Element.cumulativeScrollOffset(element);this.xcomp=x+offsetcache[0]-this.deltaX;this.ycomp=y+offsetcache[1]-this.deltaY;this.offset=Element.cumulativeOffset(element);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+element.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+element.offsetWidth)},overlap:function(mode,element){if(!mode){return 0}if(mode=="vertical"){return((this.offset[1]+element.offsetHeight)-this.ycomp)/element.offsetHeight}if(mode=="horizontal"){return((this.offset[0]+element.offsetWidth)-this.xcomp)/element.offsetWidth}},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(element){Position.prepare();return Element.absolutize(element)},relativize:function(element){Position.prepare();return Element.relativize(element)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(source,target,options){options=options||{};return Element.clonePosition(target,source,options)}};if(!document.getElementsByClassName){document.getElementsByClassName=function(instanceMethods){function iter(name){return name.blank()?null:"[contains(concat(' ', @class, ' '), ' "+name+" ')]"}instanceMethods.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(element,className){className=className.toString().strip();var cond=/\s/.test(className)?$w(className).map(iter).join(""):iter(className);return cond?document._getElementsByXPath(".//*"+cond,element):[]}:function(element,className){className=className.toString().strip();var elements=[],classNames=(/\s/.test(className)?$w(className):null);if(!classNames&&!className){return elements}var nodes=$(element).getElementsByTagName("*");className=" "+className+" ";for(var i=0,child,cn;child=nodes[i];i++){if(child.className&&(cn=" "+child.className+" ")&&(cn.include(className)||(classNames&&classNames.all(function(name){return !name.toString().blank()&&cn.include(" "+name+" ")})))){elements.push(Element.extend(child))}}return elements};return function(className,parentElement){return $(parentElement||document.body).getElementsByClassName(className)}}(Element.Methods)}Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(element){this.element=$(element)},_each:function(iterator){this.element.className.split(/\s+/).select(function(name){return name.length>0})._each(iterator)},set:function(className){this.element.className=className},add:function(classNameToAdd){if(this.include(classNameToAdd)){return}this.set($A(this).concat(classNameToAdd).join(" "))},remove:function(classNameToRemove){if(!this.include(classNameToRemove)){return}this.set($A(this).without(classNameToRemove).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);(function(){window.Selector=Class.create({initialize:function(expression){this.expression=expression.strip()},findElements:function(rootElement){return Prototype.Selector.select(this.expression,rootElement)},match:function(element){return Prototype.Selector.match(element,this.expression)},toString:function(){return this.expression},inspect:function(){return"#<Selector: "+this.expression+">"}});Object.extend(Selector,{matchElements:function(elements,expression){var match=Prototype.Selector.match,results=[];for(var i=0,length=elements.length;i<length;i++){var element=elements[i];if(match(element,expression)){results.push(Element.extend(element))}}return results},findElement:function(elements,expression,index){index=index||0;var matchIndex=0,element;for(var i=0,length=elements.length;i<length;i++){element=elements[i];if(Prototype.Selector.match(element,expression)&&index===matchIndex++){return Element.extend(element)}}},findChildElements:function(element,expressions){var selector=expressions.toArray().join(", ");return Prototype.Selector.select(selector,element||document)}})})();var Scriptaculous={Version:"1.9.0"};var Builder={NODEMAP:{AREA:"map",CAPTION:"table",COL:"table",COLGROUP:"table",LEGEND:"fieldset",OPTGROUP:"select",OPTION:"select",PARAM:"object",TBODY:"table",TD:"table",TFOOT:"table",TH:"table",THEAD:"table",TR:"table"},node:function(elementName){elementName=elementName.toUpperCase();var parentTag=this.NODEMAP[elementName]||"div";var parentElement=document.createElement(parentTag);try{parentElement.innerHTML="<"+elementName+"></"+elementName+">"}catch(e){}var element=parentElement.firstChild||null;if(element&&(element.tagName.toUpperCase()!=elementName)){element=element.getElementsByTagName(elementName)[0]}if(!element){element=document.createElement(elementName)}if(!element){return}if(arguments[1]){if(this._isStringOrNumber(arguments[1])||(arguments[1] instanceof Array)||arguments[1].tagName){this._children(element,arguments[1])}else{var attrs=this._attributes(arguments[1]);if(attrs.length){try{parentElement.innerHTML="<"+elementName+" "+attrs+"></"+elementName+">"}catch(e){}element=parentElement.firstChild||null;if(!element){element=document.createElement(elementName);for(attr in arguments[1]){element[attr=="class"?"className":attr]=arguments[1][attr]}}if(element.tagName.toUpperCase()!=elementName){element=parentElement.getElementsByTagName(elementName)[0]}}}}if(arguments[2]){this._children(element,arguments[2])}return $(element)},_text:function(text){return document.createTextNode(text)},ATTR_MAP:{className:"class",htmlFor:"for"},_attributes:function(attributes){var attrs=[];for(attribute in attributes){attrs.push((attribute in this.ATTR_MAP?this.ATTR_MAP[attribute]:attribute)+'="'+attributes[attribute].toString().escapeHTML().gsub(/"/,"&quot;")+'"')}return attrs.join(" ")},_children:function(element,children){if(children.tagName){element.appendChild(children);return}if(typeof children=="object"){children.flatten().each(function(e){if(typeof e=="object"){element.appendChild(e)}else{if(Builder._isStringOrNumber(e)){element.appendChild(Builder._text(e))}}})}else{if(Builder._isStringOrNumber(children)){element.appendChild(Builder._text(children))}}},_isStringOrNumber:function(param){return(typeof param=="string"||typeof param=="number")},build:function(html){var element=this.node("div");$(element).update(html.strip());return element.down()},dump:function(scope){if(typeof scope!="object"&&typeof scope!="function"){scope=window}var tags=("A ABBR ACRONYM ADDRESS APPLET AREA B BASE BASEFONT BDO BIG BLOCKQUOTE BODY BR BUTTON CAPTION CENTER CITE CODE COL COLGROUP DD DEL DFN DIR DIV DL DT EM FIELDSET FONT FORM FRAME FRAMESET H1 H2 H3 H4 H5 H6 HEAD HR HTML I IFRAME IMG INPUT INS ISINDEX KBD LABEL LEGEND LI LINK MAP MENU META NOFRAMES NOSCRIPT OBJECT OL OPTGROUP OPTION P PARAM PRE Q S SAMP SCRIPT SELECT SMALL SPAN STRIKE STRONG STYLE SUB SUP TABLE TBODY TD TEXTAREA TFOOT TH THEAD TITLE TR TT U UL VAR").split(/\s+/);tags.each(function(tag){scope[tag]=function(){return Builder.node.apply(Builder,[tag].concat($A(arguments)))}})}};var FlipKey=FlipKey||{};function _e(str){if(FlipKey.debug&&typeof console!="undefined"){console.log(str)}}FlipKey.Class=Class.create();FlipKey.Class.prototype={className:"FlipKey.Class",initialize:function(){},require:function(properties){for(var i=0;i<properties.length;i++){var property_name=properties[i];var property=eval("this."+properties[i]);if(!property){throw (this.className+" requires "+property_name+", but property is set to "+typeof property)}}},onAjax:function(resp){FlipKey._last_ajax_response=resp;if(resp.responseJSON.length!=3||resp.status!=200){return false}else{return this.onSuccess(resp)}},onSucess:function(resp){}};LIGHTBOX_LOADER='<div class="loading"><b>Loading...</b><img src="/img/house-throbber-40x40.gif" /></div>';LIGHTBOX_ARCHES_NEW_LOADER='<div class="loading"><img src="/img/house-throbber-40x40.gif" /></div>';Object.extend(FlipKey,{small_button_loader:new Element("div").addClassName("small_button_loader"),clearErrorAndFeeState:function(){if(FlipKey.Payments&&FlipKey.Payments.Request){FlipKey.Payments.Request.clear()}},updatePaymentRequestFormEstimatedRates:function(){if(FlipKey.Payments&&FlipKey.Payments.Request){FlipKey.Payments.Request.updateEstimatedRates()}},showLightboxText:function(textContent,close_button,loading_indicator,callback,width,config){if(typeof config!="undefined"){this.config=config}else{this.config={}}var style;if(width){if(width=="auto"){style="width: auto"}else{style="width: "+width+"px"}}else{style=""}if(config&&config.archesnew){var div_text='<div class="lightbox-a" style="'+style+'">'}else{var div_text='<div id="lightbox_default" style="'+style+'">'}this._lightBox(div_text+textContent+"</div><br/>",close_button,loading_indicator,callback)},showLightboxFromDiv:function(source_div,close_button,loading_indicator,callback,config){if(typeof source_div=="string"){source_div=$(source_div)}if(typeof config!="undefined"){config.dont_remove=true;this.config=config;this.config.div=source_div;FlipKey._lightBox(null,close_button,loading_indicator,callback);return true}else{this.config={};this.config.dont_remove=true}source_div.setStyle({position:"absolute",display:"block",top:(Position.page(document.body)[1]*-1+100)+"px"});this.centerElement(source_div,document.body);this._box=source_div;if($("lb_close")){$("lb_close").remove()}if(close_button){this._box.innerHTML+='<div id="lb_close"><a class="small_button small_stroke_button small_brown_stroke" style="float:right; margin-bottom: 6px" onclick="FlipKey.closeLightbox()" ><span>Close</span></a><br/></div>'}document.body.appendChild(this._box);this.addOpaque();this._box.show();if(typeof callback=="function"){callback()}return true},showLightboxAjax:function(url,close_button,loading_indicator,callback,_params,config){if(typeof config=="undefined"){config={}}this.config=config;this.showLightboxText(LIGHTBOX_LOADER,false,true,null,null,config);FlipKey.Ajax.request(url,{parameters:_params,onSuccess:function(data){FlipKey._lightBox(data.responseText,close_button,loading_indicator,callback)}})},closeLightbox:function(){if(typeof FlipKey.config.onClose=="function"){var resp=FlipKey.config.onClose();if(resp=="stop_close"){return false}if(FlipKey.config.neverClose){return true}}FlipKey._box.hide();Element.hide($("loading_opaque"));if(this.config&&this.config.close_callback){this.config.close_callback()}return true},addOpaque:function(returnElement){if(!$("loading_opaque")){var opaque=new Element("div",{id:"loading_opaque"});var styles={background:"#333333",width:"100%",display:"block",height:"100%"};$$("body")[0].appendChild(opaque);$("loading_opaque").setStyle(styles);var watchOpaqueClick=(this.config.bind_close_on_opaque==true||this.config.bind_close_on_opaque==undefined);if(watchOpaqueClick){opaque.observe("click",(FlipKey.closeLightbox).bind(this))}}else{$("loading_opaque").setStyle({display:"block"})}},getInternetExplorerVersion:function(){var rv=-1;if(navigator.appName=="Microsoft Internet Explorer"){var ua=navigator.userAgent;var re=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(re.exec(ua)!=null){rv=parseFloat(RegExp.$1)}}return rv},_lightBox:function(textContent,close_button,loading_indicator,callback){if($("lightbox_container")){Element.remove($("lightbox_container"))}if(typeof hideTooltips=="function"){hideTooltips()}var styles={background:"#333333",display:"block",width:"100%",height:document.documentElement.scrollHeight+"px"};FlipKey._lightboxKeyHandlerBinding=FlipKey._lightboxKeyEventHandler.bind(this);$(document).observe("keydown",FlipKey._lightboxKeyHandlerBinding);if(this.config.arches==true){var box=Builder.node("div",{id:"lightbox_container",style:"font-size: 1em;"},[Builder.node("div",{id:"lightbox_body"},[Builder.node("p",{id:"close_box",className:"close_box"+(this.config.closeClass?" close_box_"+this.config.closeClass:"")},[Builder.node("span","close "),Builder.node("span",{className:"close_box_x"},"")]),Builder.node("span",{className:"cleaner"}),Builder.node("div",{id:"lightbox_inner_content"},[Builder.node("div",{id:"lightbox_inner"})])]),]);$("content").appendChild(box);div_fnc=function(){if(FlipKey.inquiry.popup_inq){$("limit_display_div").hide();$("captcha_display_div").hide();$$("#lightbox_inner .error_msg").invoke("remove");$$("#lightbox_inner .fields input.error").invoke("removeClassName","error");$$("#lightbox_inner .fields select.error").invoke("removeClassName","error")}ele=$$("#lightbox_inner > div")[0].remove();ele.hide();$("content").appendChild(ele);FlipKey.inquiry.popup_inq=false};if(this.config.close_callback){var close_callback=this.config.close_callback;this.config.close_callback=(function(){close_callback();div_fnc()}).bind(this)}else{this.config.close_callback=div_fnc}if(this.config.div!=undefined){innerdiv=this.config.div.remove();innerdiv=Element.extend(innerdiv).setStyle({display:"block"});$("lightbox_inner").appendChild(innerdiv)}else{$("lightbox_inner").update(textContent)}if(loading_indicator){$("lightbox_inner").update(LIGHTBOX_LOADER);$("lightbox_inner").setStyle({textAlign:"center"})}if(close_button||box){$("close_box").setStyle({display:"block"});$("close_box").observe("click",function(event){FlipKey.closeLightbox()})}this.addOpaque(true);styles={top:(Position.page($$("body")[0])[1]*-1+100)+"px",display:"inline-block"};$("lightbox_container").setStyle(styles);this.centerElement($("lightbox_container"),document.body);this._box=$("lightbox_container");if(typeof callback=="function"){callback()}return true}else{if(this.config.miniarches==true){var box=Builder.node("div",{id:"lightbox_container",style:"font-size: 1em;"},[Builder.node("div",{id:"lightbox_body"},[Builder.node("p",{id:"close_box",className:"close_box"},[Builder.node("span",{className:"close_box_x"},"")]),Builder.node("span",{className:"cleaner"}),Builder.node("div",{id:"lightbox_inner_content"},[Builder.node("div",{id:"lightbox_inner",style:"padding: 5px;"})])]),]);$("content").appendChild(box);div_fnc=function(){if(FlipKey.inquiry.popup_inq){$("limit_display_div").hide();$("captcha_display_div").hide();$$("#lightbox_inner .error_msg").invoke("remove");$$("#lightbox_inner .fields input.error").invoke("removeClassName","error");$$("#lightbox_inner .fields select.error").invoke("removeClassName","error")}if($$("#lightbox_inner > div")[0]!==undefined){ele=$$("#lightbox_inner > div")[0].remove();ele.hide();$("content").appendChild(ele)}FlipKey.inquiry.popup_inq=false};if(this.config.close_callback){var close_callback=this.config.close_callback;this.config.close_callback=(function(){close_callback();div_fnc()}).bind(this)}else{this.config.close_callback=div_fnc}if(this.config.div!=undefined){innerdiv=this.config.div.remove();innerdiv=Element.extend(innerdiv).setStyle({display:"block"});$("lightbox_inner").appendChild(innerdiv)}else{$("lightbox_inner").update(textContent)}if(loading_indicator){$("lightbox_inner").update(LIGHTBOX_LOADER);$("lightbox_inner").setStyle({textAlign:"center"})}if(close_button){$("close_box").setStyle({display:"block"});$("close_box").observe("click",function(event){FlipKey.closeLightbox()})}this.addOpaque(true);if(this.config.top){var top=this.config.top}else{var top=(Position.page($$("body")[0])[1]*-1+100)}styles={top:top+"px",left:this.config.left+"%",display:"inline-block"};$("lightbox_container").setStyle(styles);this._box=$("lightbox_container");if(typeof callback=="function"){callback()}return true}else{if(this.config.archesnew==true){if(!$("lightbox_new")){var box=Builder.node("div",{id:"lightbox_new"},[Builder.node("div",{id:"lightbox_container",style:"font-size: 1em;"},[Builder.node("div",{id:"lightbox_body"},[Builder.node("p",{id:"close_box",className:"close_box"},[Builder.node("span",{className:"close_box_x"},"")]),Builder.node("span",{className:"cleaner"}),Builder.node("div",{id:"lightbox_inner_content"},[Builder.node("div",{id:"lightbox_inner"})])]),]),]);$("content").appendChild(box);new_lb=$("lightbox_new");var div_fnc=function(){if(FlipKey.inquiry.popup_inq){$("limit_display_div").hide();$("captcha_display_div").hide();$$("#lightbox_inner .error_msg").invoke("remove");$$("#lightbox_inner .fields input.error").invoke("removeClassName","error");$$("#lightbox_inner .fields select.error").invoke("removeClassName","error")}if(!this.dont_remove){var lb=$("lightbox_new");if(lb&&lb.remove){lb.remove()}}FlipKey.inquiry.popup_inq=false};if(this.config.close_callback){var close_callback=this.config.close_callback;this.config.close_callback=(function(){var close_call_return=close_callback();if(close_call_return!="stop_close"){div_fnc()}}).bind(this)}else{this.config.close_callback=div_fnc}if(this.config.div!=undefined){innerdiv=this.config.div.remove();innerdiv=Element.extend(innerdiv).setStyle({display:"block"});$("lightbox_inner").appendChild(innerdiv)}else{$("lightbox_inner").update(textContent)}if(loading_indicator){$("lightbox_inner").update(LIGHTBOX_ARCHES_NEW_LOADER);$("lightbox_inner").setStyle({textAlign:"center"})}if(close_button){$("close_box").setStyle({display:"block"});$("close_box").observe("click",function(event){FlipKey.closeLightbox()})}this.addOpaque(true);if(this.config.top){var top=this.config.top}else{var top=(Position.page($$("body")[0])[1]*-1+100)}var content_offset=$("content").cumulativeOffset();var top1=(document.viewport.getDimensions().height/2)-(new_lb.getHeight()/2)+document.viewport.getScrollOffsets().top;var left1=(document.viewport.getDimensions().width/2)-(new_lb.getWidth()/2)+document.viewport.getScrollOffsets().left;if(top1<0){top1=0}new_lb.setStyle({top:top1+"px",left:left1+"px"});this._box=$("lightbox_container");if(typeof callback=="function"){callback()}}else{$("lightbox_new").remove();var box=Builder.node("div",{id:"lightbox_new"},[Builder.node("div",{id:"lightbox_container",style:"font-size: 1em;"},[Builder.node("div",{id:"lightbox_body"},[Builder.node("p",{id:"close_box",className:"close_box"},[Builder.node("span",{className:"close_box_x"},"")]),Builder.node("span",{className:"cleaner"}),Builder.node("div",{id:"lightbox_inner_content"},[Builder.node("div",{id:"lightbox_inner"})])]),]),]);$("content").appendChild(box);new_lb=$("lightbox_new");if(this.config.div!=undefined){innerdiv=this.config.div.remove();innerdiv=Element.extend(innerdiv).setStyle({display:"block"});$("lightbox_inner").appendChild(innerdiv)}else{var content=Builder.build("<div>"+textContent+"</div>");$("lightbox_inner").appendChild(content)}if(close_button){$("close_box").setStyle({display:"block"});$("close_box").observe("click",function(event){FlipKey.closeLightbox()})}if(this.config.top){var top=this.config.top}else{var top=(Position.page($$("body")[0])[1]*-1+100)}var content_offset=$("content").cumulativeOffset();var top1=(document.viewport.getDimensions().height/2)-(new_lb.getHeight()/2)+document.viewport.getScrollOffsets().top;var left1=(document.viewport.getDimensions().width/2)-(new_lb.getWidth()/2)+document.viewport.getScrollOffsets().left;if(top1<0){top1=0}new_lb.setStyle({top:top1+"px",left:left1+"px"});this._box=$("lightbox_container");if(typeof callback=="function"){callback()}}return true}else{if(this.config.metalabs==true){var box=Builder.node("span",{id:"lightbox_container",style:"background: url(/img/1.0/lightbox-a-middle.png) repeat-y transparent; max-width: 750px; font-size: 1em;"},[Builder.node("div",{id:"lightbox_body"},[Builder.node("div",{id:"lightbox_root"},[Builder.node("div",{id:"lightbox_inner"})])]),Builder.node("div",{id:"lightbox_close"})]);document.body.appendChild(box);if(this.config.div!=undefined){innerdiv=this.config.div.cloneNode(true);innerdiv=Element.extend(innerdiv).setStyle({display:"block"});$("lightbox_inner").appendChild(innerdiv)}else{$("lightbox_inner").update(textContent)}if(loading_indicator){$("lightbox_inner").update(LIGHTBOX_LOADER);$("lightbox_inner").setStyle({textAlign:"center"})}if(close_button){$("lightbox_close").setStyle({display:"block"});$("lightbox_close").observe("click",function(event){FlipKey.closeLightbox()})}}else{var box=document.createElement("span");box.id="lightbox_container";box.innerHTML=textContent;document.body.appendChild(box);var control_wrap=document.createElement("span");control_wrap.id="lightbox_control_wrap";if(close_button){control_wrap.innerHTML+='<a class="small_button small_stroke_button small_brown_stroke" style="float:right; margin-bottom: 6px" onclick="FlipKey.closeLightbox()" ><span>Close</span></a><br/>'}$("lightbox_container").descendants()[0].appendChild(control_wrap)}}}}this.addOpaque();styles={top:(Position.page($$("body")[0])[1]*-1+100)+"px",display:"block"};$("lightbox_container").setStyle(styles);this.centerElement($("lightbox_container"),document.body);this._box=$("lightbox_container");if(typeof callback=="function"){callback()}},_lightboxKeyEventHandler:function(event){var key=event.which||event.keyCode;switch(key){case Event.KEY_ESC:FlipKey.closeLightbox();$(document).stopObserving("keydown",FlipKey._lightboxKeyHandlerBinding);break}},lightboxSubmit:function(form,url,update_el,callback){if(!update_el){update_el=$("lightbox_inner")}FlipKey.Ajax.request(url,{parameters:form.serialize(true),method:"POST",onSuccess:function(response){if(update_el){update_el.update(response.responseText)}if(typeof callback=="function"){callback()}}})},lightboxMessage:function(message_div,response){message_div.innerHTML=response.text;message_div.className=response.status;message_div.show();Effect.Fade(message_div,{delay:2,duration:2})},lightboxLoading:function(){this._box.update(LIGHTBOX_LOADER)},centerElement:function(element,parent){var w,h,pw,ph;var d=Element.getDimensions(element);w=d.width;h=d.height;Position.prepare();if(!parent){var ws=Position.GetWindowSize();pw=ws[0];ph=ws[1]}else{pw=parent.offsetWidth;ph=parent.offsetHeight}element.style.left=(pw/2)-(w/2)-Position.deltaX+"px"},include_once:function(src){var scripts=document.getElementsByTagName("script");if(scripts){for(var k=0;k<scripts.length;k++){if(scripts[k].src==src){return}}}var script=document.createElement("script");script.src=src;script.type="text/javascript";(document.getElementsByTagName("HEAD")[0]||document.body).appendChild(script)},pdpshare:{email_regex:/^[a-zA-Z0-9\._\-+]+@([a-zA-Z0-9\._\-+])+([a-z]+\.)*\.([a-z][a-z]+)$/,delimiter:"",key:"6LdQnLsSAAAAAAmNvofTt82p5L4f5QbyqqAbm2A_",load:function(){FlipKey.setupDefaultText()},validateSingleEmail:function(email){return FlipKey.pdpshare.email_regex.test(email)},validateDelimitedEmails:function(emails){emails=emails.toLowerCase();emails=emails.replace(/[^a-zA-Z0-9\._\-@]+/g,";").split(";").filter(function(e){return e!=""});if(emails.length>5){return false}else{var valid=true;emails.each(function(email){valid=valid&&FlipKey.pdpshare.validateSingleEmail(email)});return valid}},beforeSubmitValidation:function(property_id,share_lightbox){if(!FlipKey.pdpshare.alert_bar){FlipKey.pdpshare.alert_bar=new AlertBar()}var count=0;var error={error:{},status:"error"};yourname=$("share-name");youremail=$("share-email");sendto=$("share-sendto");var email=youremail.getValue();var sendtoval=sendto.getValue();var valid_youremail=FlipKey.pdpshare.validateSingleEmail(email);var valid_sendto=FlipKey.pdpshare.validateDelimitedEmails(sendtoval);if(yourname.getValue()==""||yourname.getValue()=="Your full name"){error.error.name="Please enter your name.";count++}if(youremail.getValue()==""){error.error.email="Please enter your email.";count++}else{if(!valid_youremail){error.error.email="Please enter a valid email address.";count++}}if(sendtoval==""||sendtoval=="Type up to 5 email addresses, separated by commas."){error.error.sendto="Please enter up to 5 email addresses";count++}else{if(!valid_sendto){error.error.sendto="Please enter up to 5 valid email addresses";count++}}if(count>0){FlipKey.pdpshare.afterValidation(Object.toJSON(error),null,property_id);return false}return true},afterValidation:function(resp,json,property_id){var response;if(resp.responseText){response=eval("("+resp.responseText+")")}else{response=eval("("+resp+")")}if(response.status!="success"){try{if(response.error.limit_reached==1){$("limit_display_div").show();$("tabs-loading-div").hide();return false}if(response.error.notificationBarMessage!=null){FlipKey.pdpshare.alert_bar.show(response.error.notificationBarMessage,{alertType:"error",closeable:true});response.error.notificationBarMessage=null}if(response.error.code_popup){$$("#share_captcha_display_div .recaptcha-ajax-div").invoke("update","");$("share_captcha_display_div").show();if(FlipKey.inquiry.key!=null){setTimeout(function(){Recaptcha.create(FlipKey.pdpshare.key,$$("#share_captcha_display_div .recaptcha-ajax-div")[0],{theme:"red",callback:function(){$("recaptcha_response_field").observe("keypress",function(e){var el=e.element();if(el.up(".captcha-lightbox").style.display=="block"){if(e.keyCode==13){$$("#lightbox_container .captcha-lightbox .blue-button-large")[0].onclick();e.stop()}}})}})},100)}}if(response.error.code){newp=new Element("p",{"class":"error_message"}).update(response.error.code);$$("#lightbox_container .share-form-code")[0].appendChild(newp)}}catch(e){}}else{FlipKey.pdpshare.alert_bar.show("Thanks! We've sent this listing by email.",{alertType:"success",closeable:true});FlipKey.closeLightbox()}var errorFieldCount=0;for(errField in response.error){errorFieldCount++}if(errorFieldCount>0){newp=new Element("p",{"class":"main_error_message"}).update('<span style="width:17px;height:17px;margin:0;display:inline-block;" class="general-error"></span> We need a little more information before we can continue.</span>');$("share-form-unexpected").appendChild(newp)}response.error=$H(response.error);response.error.each(function(pair){if(pair.key!="notificationBarMessage"&&pair.key!="code_popup"&&pair.key!="code"){newp=new Element("p",{"class":"error_message"}).update(pair.value);$("share-form-"+pair.key).appendChild(newp);$$("#share-form-"+pair.key+" input").invoke("addClassName","error")}})},submit:function(property_id,share_lightbox){FlipKey.pdpshare.delimiter=null;$$("#share-form .error_message").invoke("remove");$$("#share-form .main_error_message").invoke("remove");$$("#share-form .error").invoke("removeClassName","error");params=$("share-form").serialize(true);if(FlipKey.pdpshare.beforeSubmitValidation(property_id,share_lightbox)){params["data[Sharing][delimiter]"]=FlipKey.pdpshare.delimiter;FlipKey.Ajax.request("/messages/share_pdp_with_friends/"+property_id+"/",{parameters:params,type:"post",onComplete:(function(resp,json){FlipKey.pdpshare.afterValidation(resp,json,property_id)})})}return true}},inquiry:{rando:"",key:null,load:function(){inquiry_datepicker=new DatePicker({noAvailability:true,id:"datepicker_inquiry",startInput:"inquiry-from",endInput:"inquiry-to",startButton:"inquiry-from-picker",endButton:"inquiry-to-picker"});FlipKey.setupDefaultText()},beforeSubmitValidation:function(property_id,rando){var count=0;var error={error:{},status:"error"};if(!FlipKey.inquiry.alert_bar){FlipKey.inquiry.alert_bar=new AlertBar()}if(rando){fname=$("inquiry-name-"+rando);email=$("inquiry-email-"+rando);phone=$("inquiry-phone-"+rando);ifrom=$("inquiry-from-"+rando);ito=$("inquiry-to-"+rando)}else{fname=$("inquiry-name");email=$("inquiry-email");phone=$("inquiry-phone");ifrom=$("inquiry-from");ito=$("inquiry-to")}if($F(fname)==""){error.error.name="Please enter your first and last name.";count++;if(typeof _gaq!=="undefined"&&typeof _gaq.push==="function"){_gaq.push(["_trackEvent","Inquiry error","standard","missingName"])}}var email=email.getValue();if(email==""){error.error.email="Please enter an email where the manager can reach you";count++;if(typeof _gaq!=="undefined"&&typeof _gaq.push==="function"){_gaq.push(["_trackEvent","Inquiry error","standard","missingEmail"])}}else{if(!/^[a-zA-Z0-9._\-+]+@([a-zA-Z0-9._\-+])+([a-z]+\.)*\.([a-z][a-z]+)$/.test(email)){error.error.email="Please enter a valid email address.";count++;if(typeof _gaq!=="undefined"&&typeof _gaq.push==="function"){_gaq.push(["_trackEvent","Inquiry error","standard","invalidEmail"])}}}if($("PropertyMaxSleeps").value<parseInt($$("#f-guests option").find(function(ele){return !!ele.selected}).value)){error.error.number_of_guest="Your guest count exceeds the maximum occupancy of this rental.";count++;if(typeof _gaq!=="undefined"&&typeof _gaq.push==="function"){_gaq.push(["_trackEvent","Inquiry error","standard","tooManyGuests"])}}if(typeof(FlipKey.inquiry.inquiry_requirements)!="undefined"){for(requirement in FlipKey.inquiry.inquiry_requirements){switch(requirement){case"require_phone":if(phone.getValue()===""){error.error.phone="Please enter a phone number where the manager can reach you.";count++;if(typeof _gaq!=="undefined"&&typeof _gaq.push==="function"){_gaq.push(["_trackEvent","Inquiry error","frontdesk requirement","missingPhone"])}}break;case"require_guests":if($$("#f-guests option").find(function(ele){return !!ele.selected}).value==="0"){error.error.number_of_guest="Please enter the number of guests traveling with you.";count++;if(typeof _gaq!=="undefined"&&typeof _gaq.push==="function"){_gaq.push(["_trackEvent","Inquiry error","frontdesk requirement","missingGuests"])}}break;case"require_dates":if(ifrom.getValue()===""&&ito.getValue()===""){error.error.to="Please enter travel dates.";count++;if(typeof _gaq!=="undefined"&&typeof _gaq.push==="function"){_gaq.push(["_trackEvent","Inquiry error","frontdesk requirement","missingDates"])}}else{if(ifrom.getValue()===""){error.error.to="Please enter a check in date.";count++;if(typeof _gaq!=="undefined"&&typeof _gaq.push==="function"){_gaq.push(["_trackEvent","Inquiry error","frontdesk requirement","missingArrivalDate"])}}if(ito.getValue()===""){error.error.to="Please enter a check out date.";count++;if(typeof _gaq!=="undefined"&&typeof _gaq.push==="function"){_gaq.push(["_trackEvent","Inquiry error","frontdesk requirement","missingDepartureDate"])}}}break;case"require_vacancy":FlipKey.Pdp.checkAvailDates("-"+rando,"inquiry-");if(!FlipKey.Pdp.inquiry_vacant_dates){error.error.to="Please select vacant dates.";count++;if(typeof _gaq!=="undefined"&&typeof _gaq.push==="function"){_gaq.push(["_trackEvent","Inquiry error","frontdesk requirement","noVacancy"])}}}}}if(count>0){if(!rando){FlipKey.inquiry.afterValidation(Object.toJSON(error),null,property_id)}else{FlipKey.inquiry.afterValidation(Object.toJSON(error),null,property_id,rando)}return false}return true},afterValidation:function(resp,json,property_id,rando,params,redirect){if(rando==undefined){var rawrando="";rando=""}else{var rawrando=rando;rando="-"+rando}if(typeof redirect=="undefined"){redirect=true}var response;if(resp.responseText){response=eval("("+resp.responseText+")")}else{response=eval("("+resp+")")}if(response.status!="success"){try{if(response.error.limit_reached==1){if(FlipKey.getInternetExplorerVersion()==6){$$("#inquiry-form"+rando+" select").invoke("hide")}if(FlipKey.inquiry.popup_inq){$("limit_display_div").show()}else{FlipKey.showLightboxFromDiv($$(".limit-reached-lightbox")[0],true,null,null,{arches:true,close_callback:function(){if(FlipKey.getInternetExplorerVersion()==6){$$("#inquiry-form"+rando+" select").invoke("show")}}})}$("tabs-loading-div").hide();return false}if(response.error.notificationBarMessage!=null){response.error.notificationBarMessage=null}if(response.error.code_popup){$$("#captcha_display_div .recaptcha-ajax-div").invoke("update","");FlipKey.inquiry.rando=rawrando;if(typeof _gaq!=="undefined"&&typeof _gaq.push==="function"){_gaq.push(["_trackEvent","Inquiry error","captcha requirement","invalidCode"])}if(FlipKey.inquiry.popup_inq){$("captcha_display_div").show();if(FlipKey.inquiry.key!=null){setTimeout(function(){Recaptcha.create(FlipKey.inquiry.key,$$("#captcha_display_div .recaptcha-ajax-div")[0],{theme:"red",callback:function(){$("recaptcha_response_field").observe("keypress",function(e){var el=e.element();if(el.up(".captcha-lightbox").style.display=="block"){if(e.keyCode==13){$$("#lightbox_container .captcha-lightbox .blue-button-large")[0].onclick();e.stop()}}})}})},100)}}else{if(FlipKey.getInternetExplorerVersion()==6){$$("#inquiry-form"+rando+" select").invoke("hide")}FlipKey.showLightboxFromDiv($$(".captcha-lightbox")[0],null,null,function(){if(FlipKey.inquiry.key!=null){setTimeout(function(){Recaptcha.create(FlipKey.inquiry.key,$$("#lightbox_container .recaptcha-ajax-div")[0],{theme:"red",callback:function(){$("recaptcha_response_field").observe("keypress",function(e){var el=e.element();if(el.up(".captcha-lightbox").style.display=="block"){if(e.keyCode==13){$$("#lightbox_container .captcha-lightbox .blue-button-large")[0].onclick();e.stop()}}})}})},100)}},{arches:true,close_callback:function(){if(FlipKey.getInternetExplorerVersion()==6){$$("#inquiry-form"+rando+" select").invoke("show")}}})}if(response.error.code){newp=new Element("p",{"class":"error_msg"}).update(response.error.code);$$("#lightbox_container .inquiry-form-code")[0].appendChild(newp)}}}catch(e){}var errorFieldCount=0;for(errField in response.error){errorFieldCount++}if(errorFieldCount>=1){newp=new Element("p",{"class":"error_msg"}).update("Oops! Please correct the errors below.");var blah=$("inquiry-form-unexpected"+rando);var blah2="inquiry-form-unexpected"+rando;$("inquiry-form-unexpected"+rando).appendChild(newp)}response.error=$H(response.error);$$("input").each(function(s){if(s.hasClassName("error")){s.removeClassName("error")}});$$("error_msg").each(function(s){s.remove()});response.error.each(function(pair){if(pair.key!="notificationBarMessage"&&pair.key!="code_popup"&&pair.key!="code"){newp=new Element("p",{"class":"error_msg"}).update(pair.value);$("inquiry-form-"+pair.key+rando).appendChild(newp);$$("#inquiry-form-"+pair.key+rando+" input").invoke("addClassName","error");$$("#inquiry-form-"+pair.key+rando+" select").invoke("addClassName","error")}});if(!response.error.get("code_popup")||FlipKey.inquiry.popup_inq){$("inquiry-form-unexpected"+rando).show()}else{$$(".captcha-lightbox .inquiry-form-loading").invoke("hide");$$(".captcha-lightbox .inquiry-form-button").invoke("show")}$("tabs-loading-div").hide()}else{if(typeof optimizely!="undefined"){optimizely.trackEvent("InquirySubmit")}if(response.first_inquiry){if(rando){var rando_url=rawrando+"/"}FlipKey.Ajax.request("/messages/recommended_properties/"+property_id+"/"+response.originating_reservation_request+"/"+rando_url,{parameters:params,type:"post",onComplete:function(resp){if(resp.responseJSON!==null&&typeof resp.responseJSON.status!="undefined"&&resp.responseJSON.status==="no-properties"){FlipKey.inquiry.reservationSent(property_id)}else{if(resp.responseText){FlipKey.showLightboxText(resp.responseText,true,false,null,"auto",{archesnew:true,close_callback:FlipKey.inquiry.reservationSent.curry(property_id)})}else{if(this.redirect){FlipKey.inquiry.reservationSent(property_id)}else{this.post_inquiry_lightbox(property_id);$("inquiry").remove()}}}}})}else{FlipKey.inquiry.reservationSent(property_id)}}},reservationSent:function(property_id){window.location="/messages/reservation_sent/"+property_id+"/"},submit:function(prop_id,rando,captcha,loading_div,redirect){var params;if(!rando){rando=""}if(typeof redirect==="undefined"){this.redirect=true}else{this.redirect=redirect}if(FlipKey.inquiry.popup_inq){$("limit_display_div").hide();$("captcha_display_div").hide()}if(captcha){$$("textarea.hasDefault").each(function(el){el.update()});$$("input.hasDefault").each(function(el){el.writeAttribute("value","")});params=$H($("inquiry-form"+rando).serialize(true)).merge($$("#lightbox_container .captcha-lightbox form")[0].serialize(true)).toObject();$$(".captcha-lightbox .error_msg").invoke("remove");$$("#inquiry-form"+rando+" .error_msg").invoke("remove");$$(".captcha-lightbox .inquiry-form-loading").invoke("show");$$(".captcha-lightbox .inquiry-form-button").invoke("hide")}else{$$("#inquiry-form"+rando+" .error_msg").invoke("remove");$$("#inquiry-form"+rando+" .fields input.error").invoke("removeClassName","error");$$("#inquiry-form"+rando+" .fields select.error").invoke("removeClassName","error");if(loading_div){FlipKey.ui.isLoading(loading_div,{noAnimation:true})}else{FlipKey.ui.isLoading($$("#inquiry-form"+rando+" div.inner")[0],{noAnimation:true})}$$("textarea.hasDefault").each(function(el){el.update()});$$("input.hasDefault").each(function(el){el.writeAttribute("value","")});params=$("inquiry-form"+rando).serialize(true)}if(FlipKey.inquiry.beforeSubmitValidation(prop_id,rando)){FlipKey.Ajax.request("/messages/inquiry/"+prop_id+"/",{parameters:params,type:"post",onComplete:(function(resp,json){if(!rando){FlipKey.inquiry.afterValidation(resp,json,prop_id,"",params,this.redirect)}else{FlipKey.inquiry.afterValidation(resp,json,prop_id,rando,params,this.redirect)}FlipKey.ButtonMash.release()}).bind(this)})}else{FlipKey.ButtonMash.release()}return false},multiInquiry:function(originating_property_id,originating_reservation_request,rando){var multi_inquiry_submit,params,ids=[];multi_inquiry_submit=$("multi-inquiry-submit");multi_inquiry_submit.disable();multi_inquiry_submit.addClassName("button-disabled");$("multi-inquiry-throbber").show();params=$("inquiry-form"+rando).serialize(true);params["data[Inquiry][text]"]=$("inquiry-textarea").getValue();$$(".checkbox-container input").each(function(el){if(el.checked==true){ids.push(el.id.slice(el.id.lastIndexOf("-")+1))}});if(ids.length<1){if(!$("submit-error")){$$(".similar-prop-text")[0].insert({after:'<div id="submit-error">Please check at least one property before submitting inquiries.</div>'})}multi_inquiry_submit.enable();$("multi-inquiry-throbber").hide();multi_inquiry_submit.removeClassName("button-disabled")}else{params["data[Inquiry][property_ids]"]=ids.join();params["data[Inquiry][originating_reservation_request]"]=originating_reservation_request;FlipKey.Ajax.request("/messages/multi_inquiry/",{parameters:params,type:"post",onComplete:function(resp){FlipKey.inquiry.reservationSent(originating_property_id)}})}},post_inquiry_lightbox:function(property_id){FlipKey.Ajax.request("/messages/inquiry_success_lightbox/"+property_id,{onComplete:(function(resp){$("inquiry_form_lightbox").update(resp.responseText);$("tabs-loading-div").hide()})})},destroy_inquiry_lightbox:function(){FlipKey.closeLightbox();$("inquiry").remove()}},ui:{showcase:function(){var roots=$$("div.showcase-a-inner");roots.each(function(root){var slots=root.select("div.photo");var thumbs=root.select("ul.thumbs")[0];var thumb_list=root.select("ul.thumbs > li > a");slots.each(function(slot,index){if(index>1){slot.setStyle("position","static");slot.hide()}});thumb_list.each(function(e,index){e.observe("click",function(event){if(e.hasClassName("active")){return false}var row=Math.ceil((index+1)/2);var start=row*2-2;thumbs.select("li a.active").invoke("removeClassName","active");thumb_list.each(function(thumb,thumb_index){if(thumb_index>=start&&thumb_index<start+2){thumb.addClassName("active")}});slots.findAll(function(n){return n.hasClassName("active")}).invoke("removeClassName","active");slots.each(function(slot,slot_index){if(slot_index>=start&&slot_index<start+2){slot.addClassName("active");slot.setStyle("position","static")}});slots.findAll(function(n){return n.visible()}).invoke("fade",{duration:0.7});slots.each(function(slot,slot_index){if(slot_index>=start&&slot_index<start+2){slot.appear({duration:0.5})}});return false})});$("Property-Photo-Showcase-Outer").setStyle({height:$("Property-Photo-Showcase-Outer").getHeight()+"px"})})},tabs:function(){scope=this;var hash=document.location.hash.replace("#","");$$("div.tabs-a").each(function(e,index){var root=e;var tabs=e.select("ul.tabs li a");var content=e.select("div.tab");var contentBox=e.select("div.box-c-inner")[0];var outerBox=e.select("div.box-c-inner")[0];tabs.each(function(tab,tabi){if(tab.getAttribute("afterLoad")){tab.observe("tabs:afterLoad",eval(tab.getAttribute("afterLoad")))}tab.observe("click",function(event){if(tab.hasClassName("active")){return false}update_url=tab.id;if(update_url.indexOf("anonymous_element_")>-1){update_url=""}if(FlipKey.ui.loadedTabs==undefined){FlipKey.ui.loadedTabs={}}currHeight=outerBox.getHeight();outerBox.setStyle({height:currHeight+"px",overflow:"hidden"});if(FlipKey.ui.loadedTabs[tab.id]!=true&&update_url){FlipKey.ui.isLoading(outerBox,{afterFinish:function(){update_url=update_url.replace(/\./g,"/");FlipKey.Ajax.request("/"+update_url,{onSuccess:function(resp){arr=tabs.findAll(function(n){return n.hasClassName("active")});arr.invoke("removeClassName","active");tab.addClassName("active");activeTabs=content.findAll(function(n){return n.hasClassName("active")});content[tabi].update(resp.responseText);if(tab.getAttribute("afterLoad")){tab.fire("tabs:afterLoad")}activeTabs.invoke("removeClassName","active");content[tabi].addClassName("active");newHeight=content[tabi].getHeight();new Effect.Parallel([new Effect.Morph(outerBox,{sync:true,style:"height: "+newHeight+"px;"}),new Effect.Fade("tabs-loading-div",{sync:true})],{duration:0.3,afterFinish:function(){outerBox.setStyle({height:""})}})}})}});FlipKey.ui.loadedTabs[tab.id]=true}else{tabs.findAll(function(n){return n.hasClassName("active")}).invoke("removeClassName","active");tab.addClassName("active");activeTabs=content.findAll(function(n){return n.hasClassName("active")});activeTabs.invoke("removeClassName","active");content[tabi].addClassName("active");newHeight=content[tabi].getHeight();outerBox.setStyle({height:newHeight+"px",overflow:"hidden"})}return false})})})},isLoading:function(ele,loadingOptions){var type=typeof ele;if(type=="string"){ele=$(ele)}if($("tabs-loading-div")){$("tabs-loading-div").remove()}loading=new Element("div",{id:"tabs-loading-div"});loading.setStyle({position:"absolute",top:"0px",left:"0px",display:"none",zIndex:100,width:"100%",height:"100%",backgroundColor:"white"});loading_span=new Element("span");loading_img=new Element("img",{src:"/img/house-throbber-32x32.gif",height:32,width:32});loading_text=new Element("span",{claxssName:"loadingText"}).update("Loading");loading_span.appendChild(loading_img);loading_span.appendChild(loading_text);loading.appendChild(loading_span);ele.appendChild(loading);if($("tabs-loading-div")==undefined){loading=new Element("div",{id:"tabs-loading-div"});loading.setStyle({position:"absolute",display:"none",zIndex:100,backgroundColor:"white"});loading_span=new Element("span");loading_img=new Element("img",{src:"/img/house-throbber-32x32.gif",height:32,width:32});loading_text=new Element("span",{claxssName:"loadingText"}).update("Loading");loading_span.appendChild(loading_img);loading_span.appendChild(loading_text);loading.appendChild(loading_span);document.body.appendChild(loading)}$("tabs-loading-div").setStyle({visibility:"hidden",display:"block"});try{$("tabs-loading-div").clonePosition(ele)}catch(e){}FlipKey.utils.center($("tabs-loading-div").select("span")[0],$("tabs-loading-div"));$("tabs-loading-div").setStyle({visibility:"visible",display:"none"});defaultOptions=$H({duration:0.4,to:0.7,from:0});if(!loadingOptions){loadingOptions={}}loadingOptions=defaultOptions.merge(loadingOptions);if(loadingOptions.get("noAnimation")===true){$("tabs-loading-div").setOpacity(0.7);$("tabs-loading-div").show()}else{$("tabs-loading-div").appear(loadingOptions.toObject())}return true},fadeFromLoading:function(response,ele,newele,callback){var type=typeof ele;if(type=="string"){ele=$(ele)}else{ele=Element.extend(ele)}ele.update(response.responseText);return true}},rate:{convertConvertible:function(ele,defaultCurrency,foreignCurrency,rate){ele=Element.extend(ele);if(FlipKey.rate.currentCurrency==undefined){FlipKey.rate.currentCurrency=foreignCurrency.abbrev}if(ele.value==FlipKey.rate.currentCurrency){return false}$$("td.convertible span.rate_"+ele.value).invoke("show");$$("td.convertible span.rate_"+FlipKey.rate.currentCurrency).invoke("hide");FlipKey.rate.currentCurrency=ele.value;return false}},utils:{fireEvent:function(element,event){if(document.createEventObject){var evt=document.createEventObject();return element.fireEvent("on"+event,evt)}else{var evt=document.createEvent("HTMLEvents");evt.initEvent(event,true,true);return !element.dispatchEvent(evt)}},obfuscateLinks:function(){links=$$("a.obfuscate");links.each(function(ele){newspan=new Element("span").update(ele.innerHTML);attributes=new Array(ele.attributes);attributes.each(function(a){newspan.writeAttribute(a.nodeName,a.nodeValue)});Element.replace(ele,newspan)})},center:function(element,parent,options){defaults=$H({x:true,y:true});element=Element.extend(element);options=$H(options);options=defaults.merge(options);var w,h,pw,ph;var d=element.getDimensions();w=d.width;h=d.height;pd=Element.getDimensions(parent);pw=pd.width;ph=pd.height;element.setStyle({position:"relative"});if(options.get("y")==true){element.setStyle({top:(ph/2)-(h/2)+"px"})}if(options.get("x")==true){element.setStyle({left:(pw/2)-(w/2)+"px"})}},cut:function(str,cutStart,cutEnd){return str.substr(0,cutStart)+str.substr(cutEnd+1)},visualLength:function(elem){var attrs={id:"ruler"};var element=new Element("span",attrs);$("content").insert(element);str=elem.innerHTML;var ruler=$("ruler");ruler.setStyle({fontSize:elem.getStyle("fontSize"),fontWeight:elem.getStyle("fontWeight")});ruler.innerHTML=str;var offset=ruler.offsetWidth;$("ruler").remove();return offset},visualHeight:function(elem){var attrs={id:"ruler"};var element=new Element("span",attrs);$("content").insert(element);str=elem.innerHTML;var ruler=$("ruler");ruler.setStyle({fontSize:elem.getStyle("fontSize"),fontWeight:elem.getStyle("fontWeight")});ruler.innerHTML=str;var offset=ruler.offsetHeight;$("ruler").remove();return offset},trimTextForDiv:function(element,rows){if(FlipKey.getInternetExplorerVersion()==9){return}var visual_width=this.visualLength(element);var element_width=element.getWidth();var actual_len=element.innerHTML.length;var visual_height=this.visualHeight(element);var prod=(element_width*rows)/visual_width;var cut_len=actual_len*prod;if(visual_height*rows>=element.offsetHeight){return}var making_up_for_something=0;var row_multiplier=1;if(rows>1){making_up_for_something=9*rows;row_multiplier=2}if(visual_width+making_up_for_something>element_width*row_multiplier){element.innerHTML=this.cut(element.innerHTML,cut_len,actual_len)}else{return}var half_string=this.cut(element.innerHTML,element.innerHTML.length/2,element.innerHTML.length);if(half_string.split(" ").length<(element.innerHTML.split(" ").length/2)||element.innerHTML.split(" ").length<6){making_up_for_something+=10*rows}var count=0;while(this.visualLength(element)+(20*rows)+making_up_for_something>element_width*rows){element.innerHTML=this.cut(element.innerHTML,element.innerHTML.length-1,element.innerHTML.length);if(count>30){break}count++}var count=0;while((this.visualHeight(element)*rows)+(2*rows)<element.offsetHeight){element.innerHTML=this.cut(element.innerHTML,element.innerHTML.length-1,element.innerHTML.length);if(count>30){break}count++}var before_spaces=element.innerHTML;var count=0;while(count<11){if(element.innerHTML.charAt(element.innerHTML.length-1)==" "){element.innerHTML=this.cut(element.innerHTML,element.innerHTML.length-1,element.innerHTML.length);break}else{element.innerHTML=this.cut(element.innerHTML,element.innerHTML.length-1,element.innerHTML.length)}if(count==10){element.innerHTML=before_spaces;break}count++}element.innerHTML=element.innerHTML+"..."},trimTextToRows:function(element,rows,appendage){rows=Math.round(rows*1);if(rows<1){rows=1}if(typeof appendage=="undefined"){appendage=""}else{appendage=" "+appendage}var text=element.innerText&&!window.opera?element.innerText:element.innerHTML.stripScripts().unescapeHTML().replace(/[\n\r\s]+/g," ");var lineHeight=this.visualHeight(element);element.update("|");var targetHeight=Math.round((lineHeight+element.getHeight())/2);element.update(text+appendage);var boxHeight=element.getHeight();var words=text.split(" ");var heightFactor=Math.floor(boxHeight/targetHeight);while(heightFactor>rows){words.pop();element.update(words.join(" ")+"..."+appendage);heightFactor=Math.floor(element.getHeight()/targetHeight)}}},isCompatible:function(){}});FlipKey.LoadingEvents={contentReady:false,pageLoaded:false,contentReadyEvent:function(){if(FlipKey.LoadingEvents.contentReady==true){clearInterval(FlipKey.LoadingEvents.contentReadyInterval);document.fire("FlipKey:domloaded")}},pageLoadedEvent:function(){if(FlipKey.LoadingEvents.pageLoaded==true){clearInterval(FlipKey.LoadingEvents.pageLoadedInterval);document.fire("FlipKey:pageloaded")}},contentReadyInterval:setInterval("FlipKey.LoadingEvents.contentReadyEvent()",50),pageLoadedInterval:setInterval("FlipKey.LoadingEvents.pageLoadedEvent()",50)};Event.observe(document,"dom:loaded",function(event){FlipKey.LoadingEvents.contentReady=true});Event.observe(window,"load",function(event){FlipKey.LoadingEvents.pageLoaded=true});FlipKey.loadAvailability=function(property_id){FlipKey.Ajax.request("/properties/calendar_ajax/"+property_id+"/"+new Date().getFullYear(),FlipKey.processAjax)};FlipKey.processAjax=function(response){var year_hash=eval(response.responseText);FlipKey.booked_dates=year_hash.dates;FlipKey.calendar.render()};FlipKey.createDatePicker=function(){Event.observe(window,"load",function(){Calendar.setup({inputField:"arrival_date",button:"arrival_calendar",weekNumbers:false,range:[new Date().getFullYear(),new Date().getFullYear()+4],ifFormat:"%m-%d-%Y",align:"TR",onUpdate:selectArrival,dateStatusFunc:FlipKey.disableDate,onOpen:function(cal){calendar=cal}});Calendar.setup({inputField:"departure_date",button:"departure_calendar",weekNumbers:false,range:[new Date().getFullYear(),new Date().getFullYear()+4],ifFormat:"%m-%d-%Y",align:"TR",onUpdate:selectDeparture,dateStatusFunc:FlipKey.disableDate,onOpen:function(cal){calendar=cal}})})};FlipKey.restoredArrivalDate=null;FlipKey.disableDate=function(date,year,month,day){if(calendar.params.inputField.id=="arrival_date"){var mode="arrival"}else{var mode="departure"}if(mode=="departure"){if(FlipKey.arrival_date&&(date<=FlipKey.arrival_date)){return"disabled"}else{if($("arrival_date")&&$("arrival_date").value.length){if(!(FlipKey.restoredArrivalDate)){var a=$("arrival_date").value.toString().split("-");FlipKey.restoredArrivalDate=new Date(parseInt(a[2]),parseInt(a[0]-1),parseInt(a[1]))}if(date<=FlipKey.restoredArrivalDate){return"disabled"}}}}if(date<new Date()&&!(date.getDate()==new Date().getDate()&&date.getMonth()==new Date().getMonth()&&date.getFullYear()==new Date().getFullYear())){return"disabled"}if(!FlipKey.booked_dates){return""}if(FlipKey.booked_dates[year]=="none"||!FlipKey.booked_dates[year]){return""}if(FlipKey.booked_dates[year][month]){if(mode=="departure"){if(FlipKey.booked_dates[year][month][day]==2){return"disabled"}}else{if(mode=="arrival"){if(FlipKey.booked_dates[year][month][day]==1||FlipKey.booked_dates[year][month][day]==2){return"disabled"}}}}return""};Abstract.XMLHttpCatch=Class.create();Abstract.XMLHttpCatch.prototype={initialize:function(opts){},receive:function(response,scope){if(typeof scope.onAjax=="function"){scope.onAjax(response)}else{scope.formatAfterUpadateData(response)}}};FlipKey.loadGoogleMap=function(){Event.observe(window,"load",function(){if(document.getElementById("smallGoogleMap")){document.getElementById("smallGoogleMap").src=FlipKey.google_map_url}})};Position.GetWindowSize=function(w){var width,height;w=w?w:window;width=w.innerWidth||(w.document.documentElement.clientWidth||w.document.body.clientWidth);height=w.innerHeight||(w.document.documentElement.clientHeight||w.document.body.clientHeight);return{width:width,height:height}};Position.center=function(element,parent){var w,h,pw,ph;var d=Element.getDimensions(element);w=d.width;h=d.height;Position.prepare();if(!parent){var ws=Position.GetWindowSize();pw=ws[0];ph=ws[1]}else{pw=parent.offsetWidth;ph=parent.offsetHeight}element.style.left=(pw/2)-(w/2)-Position.deltaX+"px"};function showAjax(url){FlipKey.showLightboxAjax(url)}function closeLightbox(){FlipKey.closeLightbox()}FlipKey.tooltip_options={arrow:true,xOffset:10,metalabs:true,maxWidth:359};function loadScript(url,callback){var f=arguments.callee;if(!("queue" in f)){f.queue={}}var queue=f.queue;if(url in queue){if(callback){if(queue[url]){queue[url].push(callback)}else{callback()}}return}queue[url]=callback?[callback]:[];var script=document.createElement("script");script.type="text/javascript";script.onload=script.onreadystatechange=function(){if(script.readyState&&script.readyState!="loaded"&&script.readyState!="complete"){return}script.onreadystatechange=script.onload=null;while(queue[url].length){queue[url].shift()()}queue[url]=null};script.src=url;document.getElementsByTagName("head")[0].appendChild(script)}function defaultValueSwap(element,dclass,aclass,dvalue){element=$(element);element._default=dvalue;return element.observe("focus",function(){if(element._default!=element.value){return}element.removeClassName(dclass).addClassName(aclass).value=""}).observe("blur",function(){if(element.value.strip()!=""){return}element.removeClassName(aclass).addClassName(dclass).value=element._default}).addClassName(dclass)}function urlJoin(parts){return"/"+parts.join("/")}FlipKey.processDOM=function(){processEl=function(el){activehelp_config={backgroundColor:"#D0DAE0",borderColor:"#3892CB",textColor:"#333333",contentAttribute:"activehelp",mode:"focus",layout:Tooltip.ATTACH_RIGHT,xOffset:20,yOffset:0,arrow:true};if(Element.readAttribute(el,"activehelp")&&el.id.length>0){if(Element.readAttribute(el,"activehelp_xoffset")){xoffset=Math.round(Element.readAttribute(el,"activehelp_xoffset"))}new Tooltip(el,activehelp_config)}tooltip_config={backgroundColor:"#D0DAE0",borderColor:"#3892CB",textColor:"#333333",arrow:true,yOffset:-10,xOffset:30};if(Element.readAttribute(el,"title")){if(Element.readAttribute(el,"activehelp_xoffset")){xoffset=Math.round(Element.readAttribute(el,"activehelp_xoffset"))}new Tooltip(el,tooltip_config)}var lv=Element.readAttribute(el,"lv");if(lv){lv=eval(lv);var validation=new LiveValidation(el.id);for(var j=0;j<lv.length;j++){var type=eval(lv[j].type);if(typeof lv[j].params=="undefined"){validation.add(type)}else{validation.add(type,lv[j].params)}}}};$$("input").each(processEl);$$("textarea").each(processEl);$$("select").each(processEl);$$("a.activehelp").each(processEl)};UpdaterField=Class.create(FlipKey.Class);UpdaterField.prototype=Object.extend(new FlipKey.Class(),{className:"UpdaterField",default_config:{url:null,live_validation:null,submit_el:null,loading_text:"Loading...",edit_in_place:false},initialize:function(el,config){this.el=el;this.config=Object.extend(this.default_config,config);if(this.config.edit_in_place){this.require(["el","config.url"])}else{this.require(["el","config.url","config.submit_el"])}this.alert_bar=new AlertBar();this.scopeResolver=new Abstract.XMLHttpCatch();this.submitEvent=this.submit.bindAsEventListener(this);this.initial_value=this.el.value;if(this.config.submit_el){if(this.config.submit_el.descendants().length>0){this.submit_text_el=this.config.submit_el.descendants()[0]}else{this.submit_text_el=this.config.submit_el}this.config.submit_el.observe("click",this.submitEvent)}if(this.config.edit_in_place){this.editEvent=this.edit.bindAsEventListener(this);this.el.observe("click",this.editEvent);this.el.observe("blur",this.submitEvent)}},edit:function(evt){if(!this.config.edit_in_place){return true}this.editing=true;this.el.addClassName("editing");this.el.removeAttribute("readonly");return true},submit:function(evt){if(this.submitting){return false}if(this.config.edit_in_place&&(this.initial_value==this.el.value)){return false}var params={};params[this.el.name]=this.el.value;if(this.config.live_validation){if(!this.config.live_validation.validate()){return false}}this.submitting=true;if(this.submit_text_el){this.text=this.submit_text_el.textContent}ajax_catch=this.scopeResolver;scope=this;FlipKey.Ajax.request(this.config.url,{parameters:params,evalJSON:"force",onComplete:function(resp){ajax_catch.receive(resp,scope)},onFailure:function(resp){ajax_catch.receive(resp,scope)}});if(this.submit_text_el){this.submit_text_el.update(this.config.loading_text)}return false},onAjax:function(resp){resp.responseJSON=eval(resp.responseText);var status=resp.responseJSON[0];var message=resp.responseJSON[1];var context=resp.responseJSON[2];var config={closeable:true,autoHideAfter:3};if(status){config.alertType="info"}else{config.alertType="error"}this.alert_bar.show(message,config);if(this.submit_text_el){this.submit_text_el.update(this.text)}this.submitting=false;if(this.config.edit_in_place){this.editing=false;this.el.removeClassName("editing");this.setAttribute("readonly",true)}}});Alerts=Class.create({hide:function(id){FlipKey.Ajax.request("/dashboards/alerts/hide/"+id+"/",{type:"get",onComplete:function(response){$("alert_"+id).hide()}})},ignore:function(id){FlipKey.Ajax.request("/dashboards/alerts/ignore/"+id+"/",{type:"get",onComplete:function(response){$("alert_"+id).hide()}})}});FlipKey.Ajax=Class.create();FlipKey.Ajax.prototype={initialize:function(){},receive:function(response,scope,callback){if(callback){scope[callback](response)}else{scope.receive(response)}}};Object.extend(FlipKey.Ajax,{on401:function(response){json=eval("["+response.responseText+"]");if(json[0]&&json[0]["redirect_to"]){window.location=json[0]["redirect_to"]}else{window.location="/users/login/restricted/"}return false},onException:function(request,exception){setTimeout(function(){throw exception},50)},updater:function(container,url,options){if(options==null){options={}}if(typeof options.on401=="undefined"){options.on401=FlipKey.Ajax.on401}if(typeof options.onException=="undefined"){options.onException=FlipKey.Ajax.onException}new Ajax.Updater(container,url,options)},request:function(url,options){if(options==null){options={}}if(typeof options.on401=="undefined"){options.on401=FlipKey.Ajax.on401}if(typeof options.onException=="undefined"){options.onException=FlipKey.Ajax.onException}return new Ajax.Request(url,options)},alertFromJSON:function(response){if(response.responseJSON){response=response.responseJSON}else{response=eval(response.responseText)}params={closeable:true,autoHideAfter:3};if(response[0]){params.alertType="success"}else{params.alertType="error"}new AlertBar().show(response[1],params)},alertBarRequest:function(url,options){if(typeof options!="object"){options={}}if(options.onSuccess){success=options.onSuccess;options.onSuccess=function(resp){FlipKey.Ajax.alertFromJSON;success()}}else{options.onSuccess=FlipKey.Ajax.alertFromJSON}options.evalJSON="force";FlipKey.Ajax.request(url,options)}});UI={showOpaque:function(){if(!$$(".UI_opaque").length){UI._opaque=new Element("div").addClassName("UI_opaque");UI._opaque.observe("click",UI.hideOpaque);document.body.appendChild(UI._opaque)}UI._opaque.show()},hideOpaque:function(evt){UI._opaque.hide();if(evt&&evt.type=="click"){UI.LightBox.hide()}}};UI.Object=Class.create();UI.Object.prototype={ajax:new FlipKey.Ajax(),tryCallback:function(callback){args=[];for(i=0;i<arguments.length;i++){if(i!=0){args.push(arguments[i])}}if(typeof callback=="function"){return callback.apply(null,args)}else{try{callback=eval(callback);if(typeof callback=="function"){return callback.apply(null,args)}}catch(e){_e(e)}}return null}};UI.LightBox=Class.create(UI.Object,{defaultParams:{type:"text",showLoading:true,loadingContent:LIGHTBOX_LOADER},initialize:function(content,params){this.content=content;this.params=$H(this.defaultParams).merge(params)._object;if(this.params.type=="text"){this._createEl();this.el.update(content)}else{if(this.params.type=="div"){if(typeof this.content=="string"){this.content=$(this.content)}this._createEl(this.content)}else{this._createEl()}}},show:function(){scope=this;ajax=this.ajax;if(this.params.type=="ajax_json"||this.params.type=="ajax"){if(this.params.showLoading){this.el.update(this.params.loadingContent);this._show()}new FlipKey.Ajax.request(this.content,{evalJSON:"force",evalScripts:true,onComplete:function(resp){ajax.receive(resp,scope)}})}else{this.receive({})}},hide:function(preserve){if(preserve==undefined&&this.params.type!="div"){this.el.remove()}else{this.el.hide()}UI.hideOpaque()},receive:function(resp){if(this.params.type=="ajax_json"){if(!resp.responseJSON){resp.responseJSON=eval(resp.responseText)}if(resp.responseJSON&&resp.responseJSON[0]){this.el.update(resp.responseJSON[2])}else{FlipKey.Ajax.alertFromJSON(resp)}}else{if(this.params.type=="ajax"){this.el.update(resp.responseText)}}this._show();if(typeof this.params.afterShow=="function"){this.params.afterShow(this.el,resp)}},_show:function(){UI.showOpaque();this.el.setStyle({top:(Position.page(document.body)[1]*-1+100)+"px",left:(Math.round($$("html")[0].getWidth()/2)-Math.round(this.el.getWidth()/2))+"px"});this.el.show()},submit:function(form_id,params){this.submitParams=params;scope=this;ajax=this.ajax;if(params.url){action=params.url}else{action=$(form_id).readAttribute("action")}FlipKey.Ajax.request(action,{parameters:$(form_id).serialize(true),method:"POST",evalJSON:"force",onComplete:function(resp){ajax.receive(resp,scope,"onSubmit")}})},onSubmit:function(resp){FlipKey.Ajax.alertFromJSON(resp);this.tryCallback(this.submitParams.onComplete,resp)},_createEl:function(el){if(!el){this.el=new Element("div")}else{this.el=el}this.el.addClassName("UI_lightbox").hide();this.el._box=this;document.body.appendChild(this.el)}});Object.extend(UI.LightBox,{hide:function(){$$(".UI_lightbox").each(function(el){el._box.hide()})},cleanUp:function(){$$(".UI_lightbox").each(function(el){el.remove()})}});UI.Tabs=Class.create(UI.Object,{config:{version:1},selectors:{tabContainer:".UI_tab_buttons",tabs:".UI_tab_buttons > *",inverted:"_inverted",contents:".UI_tab_contents",label:".text"},classes:{active:"UI_tab_buttons_active",disabled:"UI_tab_buttons_disabled"},selectors_v2:{tabContainer:"ul.tabs",tabs:"ul.tabs li",inverted:"_inverted",contents:".body",label:"*"},classes_v2:{active:"active",disabled:"disabled"},initialize:function(el,tabs,config){if(typeof config=="object"){for(var i in config){this.config[i]=config[i]}}else{}if(this.config.version==2){this.selectors=this.selectors_v2;this.classes=this.classes_v2}this.el=(typeof el=="object")?el:$(el);this.tabs=this.el.select(this.selectors.tabs);if(this.tabs.length==0){var tab_container=this.el.select(this.selectors.tabContainer)[0];for(var i in tabs){if(typeof tabs[i]!="object"){continue}var label=tabs[i].label?tabs[i].label:i.capitalize();var new_tab=new Element("li").update(label);new_tab.id=i;tab_container.appendChild(new_tab)}this.tabs=this.el.select(this.selectors.tabs)}this.tab_contents=this.el.select(this.selectors.contents)[0];if(typeof tabs=="object"){this.tabs_meta=tabs}clickEvent=this.click.bindAsEventListener(this);var local=this;var local=this;var hasActive=false;this.tabs.each(function(tab){if(local.config.version==1){tab.update(new Element("span").addClassName("text").update(tab.innerHTML));tab.appendChild(new Element("div").addClassName("l"));tab.appendChild(new Element("div").addClassName("r"))}if(!tab.hasClassName(local.classes.disabled)){tab.observe("click",this.clickEvent);tab.observe("custom:click",this.clickEvent)}if(tab.hasClassName(local.classes.active)){hasActive=true}});UI.Tabs.instances.push(this);if(this.config.hash_listen){this.listening=true;if(UI.Tabs.listen(document.location.hash)){return}}if(this.config.initial_tab){this._activateByName(this.config.initial_tab)}else{if(!hasActive){this.activate(0)}}},activate:function(index){active_tab_el=this.tabs[index];active_tab=this.tabs_meta[active_tab_el.id];this.active_tab_el=active_tab_el;this.active_tab=active_tab;this.active_index=index;if(typeof this.active_tab!="undefined"){if(this.active_tab.type=="datatable"){this.active_tab.table.element_id=this.tab_contents.identify();this.active_tab.table.refresh(this.receive,this)}else{if(this.active_tab.type=="ajax"&&this.active_tab.url){this.tab_contents.appendChild(UI.Tabs.loader);scope=this;ajax=this.ajax;new FlipKey.Ajax.request(this.tabs_meta[this.tabs[index].id].url,{onComplete:function(resp){ajax.receive(resp,scope)},evalJSON:"force",evalScripts:true})}}}this.loading=true;UI.Tabs.active_tab_el=this.active_tab_el;UI.Tabs.active_tab=this.active_tab;UI.Tabs.active_instance=this;var local=this;this.tabs.each(function(tab){if(tab.hasClassName(local.classes.active)){tab.removeClassName(local.classes.active)}});this.tabs[index].addClassName(this.classes.active);if($(this.active_tab_el.id+this.selectors.inverted)){$(this.active_tab_el.id+this.selectors.inverted).addClassName(this.classes.active)}return true},activateByName:function(name,check,listening){if(typeof listening!="undefined"){this.listening=listening}if(check&&typeof this.tabs_meta[name]!="undefined"){var beforeChange=this.tryCallback(this.tabs_meta[name].beforeChange,this.active_tab_el.id,name);if(beforeChange==true){return false}}if(name.indexOf("/")==0){window.location=name}if(this.listening){document.location.hash="#/"+name;return true}return this._activateByName(name,check)},_activateByName:function(name){var i=0;if(name!=""){for(tab_name in this.tabs_meta){if(!isNaN(parseInt(tab_name))){if(typeof FlipKey.Listing.tabs!="undefined"){if(name==FlipKey.Listing.tabs.tabs[tab_name].id){return this.activate(i)}}else{return this.activate(0)}}else{if(name==tab_name){return this.activate(i)}}i++}}return false},reload:function(index){this.activate(this.active_index)},click:function(evt){if(this.loading){return false}if(evt.element().id.indexOf(this.selectors.inverted)>0){el=$(evt.element().id.replace(this.selectors.inverted,""))}else{el=evt.element()}if(el.hasClassName("text")){el=el.up()}if(this.tabs.indexOf(el)>=0){var tab_index=this.tabs.indexOf(el);clicked_tab_meta=this.tabs_meta[this.tabs[tab_index].id];this.activateByName(el.id,true)}return true},receive:function(resp){this.loading=false;if(resp!=undefined){resp.responseText.evalScripts();if(resp.status!=401){this.tab_contents.update(resp.responseText)}}this.tryCallback(this.active_tab.afterLoad,resp,this.tab_contents)},nextId:function(){if(this.active_index<this.tabs.length-1){var id=this.tabs[this.active_index+1].id;if(id.indexOf(this.selectors.inverted)>=0){return false}else{return id}}else{return false}},updateLabel:function(id,text){var label=this.el.select("#"+id);if(label.length>0){label=label.select(this.selectors.label)[0]}return label.update(text)}});Object.extend(UI.Tabs,{instances:[],active_tab:null,active_tab_el:null,active_instance:null,listening:false,called_handler:false,reload:function(){return UI.Tabs.instances[0].reload()},activate:function(index){return UI.Tabs.instances[0].activate(index)},activateByName:function(name,listening){return UI.Tabs.instances[0].activateByName(name,undefined,listening)},listen:function(specific){UI.Tabs.listening=true;hash=UI.Tabs.parseHash(document.location.hash.replace("#/",""));if(UI.Tabs.active_tab){if(hash.hash!=UI.Tabs.active_tab_el.id){match=UI.Tabs.instances[0]._activateByName(hash.hash)}}else{match=UI.Tabs.instances[0]._activateByName(hash.hash)}if(typeof FlipKey.tab_handler=="function"&&specific){FlipKey.tab_handler(hash.extra);UI.Tabs.called_handler=true}window.setTimeout("UI.Tabs.listen()",500);return match},parseHash:function(hash){if(hash.indexOf("?")>=0){hash_arr=hash.split("?");hash=hash_arr[0];extra=hash_arr[1];return{hash:hash,extra:extra}}return{hash:hash}}});UI.Tabs.loader=document.createElement("div");UI.Tabs.loader.id="tab_loader";FlipKey.ReviewNew=Class.create({alertbar:null,evt_els:$A(),initialize:function(){startup_func=function(e){this.evt_els.push($("submit_button"));$$(".optional_rating").each(function(ele){hi=ele.select("input")[0];if(hi&&hi.value>0){ele.select(".star_rating_medium span").each(function(child){child.setStyle({width:hi.value*20+"px"})})}});$$(".overall_rating").each(function(ele){hi=ele.select("input")[0];if(hi&&hi.value>0){ele.select(".star_rating_large span").each(function(child){child.setStyle({width:hi.value*30+"px"})})}});$$(".optional_rating").each((function(ele){ele.select(".star_rating_medium").each((function(st){Event.observe(st,"mousemove",(function(event){st.setAttribute("polling",true);rating=this.star_rollover(ele,st,20,event);this.changeStarText(rating,st,"optional")}).bindAsEventListener(this));Event.observe(st,"mouseout",(function(event){st.setAttribute("polling",false);hi=ele.select("input")[0];stars=hi.getAttribute("value");st.select("span").each((function(child){if(stars>0){child.setStyle({width:stars*20+"px"})}else{child.setStyle({width:"0px"})}this.changeStarText(stars,st,"optional")}).bind(this))}).bind(this));Event.observe(st,"click",function(event){ele.select("input").each(function(hiddeninput){hiddeninput.setAttribute("value",fullstars)})});this.evt_els.push(st)}).bind(this))}).bind(this));$$(".overall_rating").each((function(ele){ele.select(".star_rating_large").each((function(st){Event.observe(st,"mousemove",(function(event){st.setAttribute("polling",true);rating=this.star_rollover(ele,st,30,event);this.changeStarText(rating,st,"overall")}).bindAsEventListener(this));Event.observe(st,"mouseout",(function(event){st.setAttribute("polling",false);hi=ele.select("input")[0];stars=hi.getAttribute("value");st.select("span").each((function(child){if(stars>0){child.setStyle({width:stars*30+"px"})}else{child.setStyle({width:"0px"})}this.changeStarText(stars,st,"overall")}).bind(this))}).bind(this));Event.observe(st,"click",function(event){ele.select("input").each(function(hiddeninput){hiddeninput.setAttribute("value",fullstars)})});this.evt_els.push(st)}).bind(this))}).bind(this))};(startup_func.bind(this))()},showPopupPrevious:function(el,w,h){var src=el.src.replace("320x240_thumb","full");var alt=el.alt;var bheight=Math.min(h,480);bheight=bheight+50;if(alt){alt='<p class="alt-text">'+alt+"</p>"}FlipKey.showLightboxText('<div id="previous-photo-lb"><h4 class="lightbox-header" style="margin-bottom: 0px;">Guest Photo</h4><div class="pdp-large-review-image" style="height:'+bheight+'px;"><img class="pdp-review-image" src="'+src+'" />'+alt+"</div></div>",true,false,false,"auto",{archesnew:true})},changeStarText:function(rating,el,type){star2text={0:"Click to rate",1:"Terrible",2:"Poor",3:"Average",4:"Very Good",5:"Excellent"};if(type=="optional"){img_type="md"}else{img_type="lg"}if(!rating){el.removeClassName("review-"+img_type+"-review-stars-empty");el.addClassName("review-"+img_type+"-review-stars-blank");rating=0}else{el.removeClassName("review-"+img_type+"-review-stars-blank");el.addClassName("review-"+img_type+"-review-stars-empty")}el.next().update(star2text[rating]);if(rating!=0||type!="optional"){el.next().show()}else{el.next().hide()}},star_rollover:function(container,stars,size,event){pixoff=event.pointerX()-stars.cumulativeOffset()["left"];fullstars=Math.ceil(pixoff/size);stars.select("span").each(function(child){child.setStyle({width:fullstars*size+"px"})});return fullstars},toggleReservationName:function(el){Element.extend(el).up().up().up().next().toggle()},confimationPopup:function(prop_id){FlipKey.showLightboxFromDiv("review_confirmation_lightbox",true,false,null,{archesnew:true,onClose:function(){window.location="/p"+prop_id},neverClose:true})},addAnotherPhoto:function(prop_id,type,review_id,prev_count){var l=$$("div.review_photo").length+1;var max=10;if(prev_count){max=10-prev_count}if(l>max){return false}if(type=="modify"&&review_id){extra_src="/modify/"+review_id}else{extra_src=""}var num=(parseInt($$(".review_photo iframe").pluck("name").invoke("replace","photo_iframe","").max())+1);var disp_num=parseInt($$(".frame_no").pluck("innerHTML").max())+1;if(!num){num=0}if(!disp_num){disp_num=1}var h=Builder.node("div",{className:"review_photo",id:"review_photo_"+num}).update('<p class="photo_header">Photo <span class="frame_no">'+(disp_num)+'</span> <a href="javascript:void(0);" id="review_photo_delete_'+num+'" style="display:none;" onclick="window.rev.deletePhoto('+prop_id+","+num+", '"+type+"', "+review_id+", "+prev_count+');">delete</a></p>             <div id="review_photo_loading_'+num+'" class="loading_div" style="display:none;"><p>Loading...</p></div>             <iframe id="photo_iframe'+num+'" name="photo_iframe'+num+'" class="loader" height="100" width="420" border="0" frameborder="0" scrolling="no" src="/reviews/save_photo/'+prop_id+"/"+num+extra_src+'"></iframe>');$("photo_input_div").appendChild(h);$("photo_input_div").appendChild(new Element("hr"));if($$(".review_photo iframe").length==max){$("add_more_review_photos").hide()}},doAfterUploadJS:function(i){window.parent.document.getElementById("review_photo_delete_"+i).style.display="inline"},deletePhoto:function(prop_id,i,type,review_id,prev_count){if(type=="modify"&&review_id){extra_src="/modify/"+review_id}else{extra_src=""}FlipKey.Ajax.request("/reviews/deletePhoto/"+prop_id+"/"+i+extra_src,{onSuccess:(function(){$("review_photo_"+i).next("hr").remove();$("review_photo_"+i).remove();if($$(".review_photo iframe").length==0){this.addAnotherPhoto(prop_id,type,review_id,prev_count)}$$(".frame_no").each(function(e,i){e.update(i+1)})}).bind(this)})},submit:function(){if(this.alertbar){this.alertbar.hide();delete this.alertbar}var alertbar=new AlertBar();config={};config.alertType="warning";config.closeable=false;config.options=[];message="Processing...";alertbar.show(message,config);this.destroy();var data=$("review_form").serialize(true);for(i=0;i<window.frames.length;i++){try{if(window.frames[i].frameElement.hasClassName("loader")){data["data[Captions]["+window.frames[i].document.getElementById("HoldingReviewPhotoTmpid").value+"]"]=window.frames[i].document.getElementById("HoldingReviewPhotoCaption").value}}catch(e){continue}}FlipKey.Ajax.updater("content",window.location.href,{parameters:data,evalScripts:true,onSuccess:function(resp){alertbar.hide()},onComplete:(function(resp){FlipKey.ButtonMash.release($("submit_button"));this.initialize()}).bind(this)})},destroy:function(){this.evt_els.each(function(el){el.stopObserving()})}});FlipKey.Review=Class.create({reminderClosed:false,initialize:function(){startup_func=function(e){$("submit_button").observe("click",function(e){if(FlipKey.ButtonMash.lock(e,Event.element(e))){$("review_form").select("input.hasDefault").each(function(el){el.writeAttribute("value","")});setTimeout(function(){$("review_form").submit()},50)}});FlipKey.setupDefaultText();Event.observe("add_more_row","click",function(e){$("add_more_row").hide();$("more_options").show()});$$(".optional_rating").each(function(ele){hi=ele.select("input")[0];if(hi&&hi.value>0){ele.select(".rating-b span").each(function(child){child.setStyle({width:hi.value*15+"px"})})}});$$(".overall_rating").each(function(ele){hi=ele.select("input")[0];if(hi&&hi.value>0){ele.select(".rating-a span").each(function(child){child.setStyle({width:hi.value*20+"px"})})}});$$("div.box-a-review-inner .row").each(function(ele,index){if(index%2){ele.addClassName("even")}else{ele.addClassName("odd")}});$$(".optional_rating").each((function(ele){ele.select(".rating-b").each((function(st){Event.observe(st,"mousemove",(function(event){st.setAttribute("polling",true);this.star_rollover(ele,st,15,event)}).bindAsEventListener(this));Event.observe(st,"mouseout",function(event){st.setAttribute("polling",false);hi=ele.select("input")[0];stars=hi.getAttribute("value");st.select("span").each(function(child){if(stars>0){child.setStyle({width:stars*15+"px"})}else{child.setStyle({width:"0px"})}})});Event.observe(st,"click",function(event){ele.select("input").each(function(hiddeninput){hiddeninput.setAttribute("value",fullstars)})})}).bind(this))}).bind(this));$$(".overall_rating").each((function(ele){ele.select(".rating-a").each((function(st){Event.observe(st,"click",function(event){$("optional-ratings-row").show()});Event.observe(st,"mousemove",(function(event){st.setAttribute("polling",true);rating=this.star_rollover(ele,st,20,event);this.changeStarText(rating)}).bindAsEventListener(this));Event.observe(st,"mouseout",(function(event){st.setAttribute("polling",false);hi=ele.select("input")[0];stars=hi.getAttribute("value");st.select("span").each((function(child){if(stars>0){child.setStyle({width:stars*20+"px"})}else{child.setStyle({width:"0px"})}this.changeStarText(stars)}).bind(this))}).bind(this));Event.observe(st,"click",function(event){ele.select("input").each(function(hiddeninput){hiddeninput.setAttribute("value",fullstars)})})}).bind(this))}).bind(this));$("learn_more_link").observe("click",function(e){FlipKey.showLightboxFromDiv("learn_more_lightbox",true,false,null,{metalabs:true})});Event.observe("ReviewReviewText","focus",(function(e){if($F("ReviewReviewRating")==1||$F("ReviewReviewRating")==2){if(!this.reminderClosed){$("honestyAlert").setStyle({display:"block"});Position.clone("ReviewReviewText","honestyAlert")}}}).bind(this));Event.observe("tips_and_gl_link","click",function(e){$("tips_and_gl").toggle();if($("honestyAlert").visible()){Position.clone("ReviewReviewText","honestyAlert")}})};(startup_func.bind(this))()},changeStarText:function(rating){star2text={0:"Click to rate",1:"Terrible",2:"Poor",3:"Average",4:"Very Good",5:"Excellent"};if(!rating){rating=0}$("overall_rating_text").update(star2text[rating]);$("overall_rating_text").show()},star_rollover:function(container,stars,size,event){pixoff=event.pointerX()-stars.cumulativeOffset()["left"];fullstars=Math.ceil(pixoff/size);stars.select("span").each(function(child){child.setStyle({width:fullstars*size+"px"})});return fullstars}});FlipKey.UpgradePayment=Class.create({no_of_props:0,props:$A([]),prop_cache:$H({}),pending_request:null,processing_cost:false,initialize:function(options){if(options&&options.form){vals=$(options.form).select("input[type=checkbox]");checks=0;vals.each((function(ele){if($F(ele)){if(ele.name.startsWith("data[NewProperty]")){this.props.push(0)}else{re=/data\[Property\]\[(\d+)\]/;match=ele.name.match(re);if(match&&match[1]){this.props.push(match[1])}}this.highlightGreenParent(ele)}}).bind(this))}$$("div.reactivate input[type=checkbox]").each(function(e){Event.observe(e,"click",function(event){payment.toggleProperty(this)})});$$("div.reactivate").each(function(ele){Event.observe(ele,"mouseover",function(e){cblist=this.select("input[type=checkbox]");if(cblist&&cblist[0]){if($F(cblist[0])!=1){this.setStyle({backgroundColor:"#878787"})}}})});$$("div.reactivate").each(function(ele){Event.observe(ele,"mouseout",function(e){cblist=this.select("input[type=checkbox]");if(cblist&&cblist[0]){if($F(cblist[0])!=1){this.setStyle({backgroundColor:""})}}})})},highlightGreenParent:function(ele){foundparent=Element.extend(ele.parentNode);hasclass=foundparent.hasClassName("reactivate");while(!hasclass){foundparent=Element.extend(foundparent.parentNode);hasclass=foundparent.hasClassName("reactivate")}foundparent.setStyle({backgroundColor:"#7BFF63"})},updatePropertyUpgradeBox:function(props,flushcache){if(!props){this.no_of_props=this.props.size();props=this.no_of_props}this.prop_cache=$H({});if(props==0){$("upgrade-billing-box-wrapper").hide();return true}else{$("upgrade-billing-box-wrapper").show()}if(!this.prop_cache.get(props)){if(this.processing_cost){this.pending_request.transport.abort();this.pending_request=null;this.processing_cost=false}if(!this.processing_cost){this.processing_cost=true;this.pending_request=FlipKey.Ajax.request("/rbo_account/upgrade/"+props,{onLoading:(function(){this.showLoading()}).bind(this),onSuccess:(function(response){this.hideLoading();this.no_of_props=props;ele=$("upgrade-billing-box");ele.update(response.responseText);this.prop_cache.set(props,response.responseText);this.processing_cost=false;this.pending_request=null}).bind(this)})}}else{$("upgrade-billing-box").update(this.prop_cache.get(props))}return true},toggleProperty:function(ele){if(ele.name.startsWith("data[NewProperty]")){id=0}else{re=/data\[Property\]\[(\d+)\]/;match=ele.name.match(re);if(match&&match[1]){id=match[1]}else{return false}}if($F(ele.id)){this.props.push(id);this.props=this.props.uniq();this.updatePropertyUpgradeBox();this.highlightGreenParent(ele)}else{this.props.splice(this.props.indexOf(id),1);this.props=this.props.uniq();this.updatePropertyUpgradeBox()}},showLoading:function(){if($("upgrade-billing-box").select(".opaque").size()==0){op=new Element("div",{"class":"opaque",style:"display:none;"});div=new Element("div",{id:"loading-key-upgrade","class":"loading-results"}).update("Loading");op.appendChild(div);$("upgrade-billing-box").appendChild(op)}op=$("upgrade-billing-box").select(".opaque");op=op[0];op.show()},hideLoading:function(){op=$("upgrade-billing-box").select(".opaque");op=op[0];op.hide()},showLightbox:function(id){FlipKey.showLightboxFromDiv(id,true,false,null,{metalabs:true})},confirmSubmit:function(form_id){var answer=confirm("Please confirm your upgrade request");if(answer){$(form_id).submit();return true}else{return false}}});Object.extend(FlipKey,{Iovation:{started:false,base_url:null,start:function(){if(!FlipKey.Iovation.started){window.io_operation="ioBegin";window.io_bbout_element_id="ioBB";window.io_install_stm=false;window.io_install_flash=false;window.io_exclude_stm=12;(function(){var io=document.createElement("script");io.type="text/javascript";io.async=true;io.src=FlipKey.Iovation.base_url+"/snare.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(io)})();FlipKey.Iovation.started=true}}}});FlipKey.Cookie={create:function(name,value,days,domain){var expires="";if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires="; expires="+date.toGMTString()}if(typeof domain==="undefined"){domain=""}else{domain=" domain="+domain+";"}document.cookie=name+"="+encodeURIComponent(value)+expires+"; path=/;"+domain;return true},read:function(name){var nameEQ=name+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" "){c=c.substring(1,c.length)}if(c.indexOf(nameEQ)==0){return decodeURIComponent(c.substring(nameEQ.length,c.length))}}return null},destroy:function(name,domain){FlipKey.Cookie.create(name,"",-1,domain)}};FlipKey.Impression={click:function(pid,property_id,guid){var data=Object.toJSON({pid:pid,property_id:property_id,guid:guid});FlipKey.Cookie.create("impression_click",data,1)}};FlipKey.Coupon={submit_coupon:function(){var code=$("CouponCode").value;var user_id=$("user_id").value;var property_count=$("property_count_real").value;var subscription_type=$("subscription_type").value;if(code==""){return null}FlipKey.Ajax.request("/rbo_account/submit_coupon",{parameters:{"data[coupon_code]":code,"data[property_count]":property_count,"data[cycle]":subscription_type,"data[user_id]":user_id},method:"POST",onSuccess:function(response){var billing=eval("("+response.responseText+")");if(billing.response[0]==-1){$("coupon_error").innerHTML="Please enter a valid coupon";$("coupon_error").show()}else{$("coupon_row").hide();$("coupon_link").hide();$$(".value_text").each(function(text){text.style.color="#009900"});$("coupon_accepted").show();$("coupon_title").innerHTML=billing.coupon.title;$("coupon_description").innerHTML=billing.coupon.coupon_message;$("coupon_error").hide();if(billing.type=="reactivate"){$("old_charge").innerHTML=$("immediate_charge").innerHTML;$("old_charge").show();$("old_bill").innerHTML=$("recurring_price").innerHTML;$("old_bill").show();$("immediate_charge").innerHTML=billing.immediate_charge.toFixed(2);$("recurring_price").innerHTML=billing.recurring_charge.toFixed(2);var savings=parseFloat($("old_charge").innerHTML).toFixed(2)-parseFloat($("immediate_charge").innerHTML).toFixed(2);$("lboxCouponSavings").innerHTML="$"+savings.toFixed(2);$("lboxAnnualCouponSavings").innerHTML="$"+billing.recurring_charge.toFixed(2);$("lboxRenewalPrice").innerHTML="$"+billing.immediate_charge.toFixed(2)}else{var old_price=$("immediate_charge").innerHTML;$("old_bill").innerHTML=old_price;$("old_bill").show();$("immediate_charge").innerHTML=billing.immediate_charge.toFixed(2);old_price=old_price.replace(",","");var additional_savings=parseFloat(old_price)-parseFloat(billing.immediate_charge);var new_savings=parseFloat($("savings").innerHTML)+parseFloat(additional_savings);$("lboxCouponSavings").innerHTML="$"+additional_savings.toFixed(2);$("lboxSavingsText").innerHTML="$"+new_savings.toFixed(2);$("lboxAnnualCouponSavings").innerHTML="$"+additional_savings.toFixed(2);$("lboxAnnualPrice").innerHTML="$"+billing.immediate_charge.toFixed(2);$("old_savings").innerHTML=$("savings").innerHTML;$("old_savings").show();$("savings").innerHTML=new_savings.toFixed(2)}}}})},remove_yearly_coupon:function(){FlipKey.Ajax.request("/rbo_account/remove_coupon",{onSuccess:function(response){$("coupon_accepted").hide();$("savings").innerHTML=$("old_savings").innerHTML;$("old_savings").hide();$("immediate_charge").innerHTML=$("old_bill").innerHTML;$("old_bill").hide();$("coupon_link").show();$("lboxCouponSavings").innerHTML="$0.00";$("lboxSavingsText").innerHTML=$("old_savings").innerHTML;$("lboxAnnualCouponSavings").innerHTML="$0.00";$("lboxAnnualPrice").innerHTML=$("old_bill").innerHTML;$$(".value_text").each(function(text){text.style.color="#395666"})}})},remove_reactivate_coupon:function(){FlipKey.Ajax.request("/rbo_account/remove_coupon",{onSuccess:function(response){$("lboxCouponSavings").innerHTML="$0.00";$("lboxAnnualCouponSavings").innerHTML="$0.00";$("lboxRenewalPrice").innerHTML=$("old_charge").innerHTML;$("coupon_accepted").hide();$("immediate_charge").innerHTML=$("old_charge").innerHTML;$("old_charge").hide();$("recurring_price").innerHTML=$("old_bill").innerHTML;$("old_bill").hide();$("coupon_link").show();$$(".value_text").each(function(text){text.style.color="#395666"})}})}};FlipKey.ClickTale={insert_clicktale_tag:function(tid){if(typeof ClickTaleTag=="function"){ClickTaleTag(tid)}return true},clickEmulation:function(link){var cancelled=false;if(document.createEvent){var event=document.createEvent("MouseEvents");event.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);cancelled=!link.dispatchEvent(event)}else{if(link.fireEvent){cancelled=!link.fireEvent("onclick")}}},prepSearchPage:function(){return true;$$("input[type=checkbox]").each(function(e){id=e.identify();e.observe("change",function(){ClickTaleExec("FlipKey.ClickTale.clickEmulation($('"+id+"'));")})});$$("div.results-a div.sort a").each(function(e){id=e.identify();e.observe("click",function(){ClickTaleExec("FlipKey.ClickTale.clickEmulation($('"+id+"'));")})});$$("div.results-a div.count a").each(function(e){id=e.identify();e.observe("click",function(){ClickTaleExec("FlipKey.ClickTale.clickEmulation($('"+id+"'));")})});$("f-price-range").observe("change",function(){ClickTaleExec("FlipKey.ClickTale.clickEmulation($('f-price-range'));")});return true}};FlipKey.ThirdParty={load:function(conf){defaults={on_domload:false,on_load:true,fail_params:{},success_params:{},object_type:"object"};for(attrname in conf){defaults[attrname]=conf[attrname]}conf=defaults;tmpfnc=function(conf){var script_tag=document.createElement("script");script_tag.type="text/javascript";script_tag.src=conf.src;document.getElementsByTagName("head")[0].appendChild(script_tag);FlipKey.ThirdParty._load=function(i,conf){setTimeout(function(){typofval=(typeof window[conf.check_var]);if(typofval!=(conf.object_type)){if(i<50){FlipKey.ThirdParty._load(i+1,conf)}else{document.fire("3PFAIL:"+conf.event_name,conf.fail_params)}}else{document.fire("3PL:"+conf.event_name,conf.success_params)}},10)};FlipKey.ThirdParty._load(0,conf)};if(conf.on_load){Event.observe(document,"FlipKey:pageloaded",function(event){tmpfnc(conf)})}else{if(conf.on_domload&&!conf.on_load){Event.observe(document,"FlipKey:domloaded",function(event){tmpfnc(conf)})}else{tmpfnc(conf)}}}};FlipKey.setupDefaultText=function(){arr=$$("input.hasDefault").concat($$("textarea.hasDefault"));arr.each(function(ele){text=ele.getAttribute("defaulttext");if(text&&ele.nodeName.toUpperCase()=="TEXTAREA"){if(ele.innerHTML==""){ele.update(text)}else{ele.removeClassName("hasDefault")}}else{if(text&&!ele.getAttribute("value")){ele.writeAttribute("value",text)}else{ele.removeClassName("hasDefault")}}ele.writeAttribute("defaulttext",false);Event.observe(ele,"focus",function(event){if(ele.hasClassName("hasDefault")){ele.removeClassName("hasDefault");if(ele.nodeName.toUpperCase()=="TEXTAREA"){ele.update("")}else{ele.writeAttribute("value","")}}Event.stopObserving(ele,"focus",this)})})};FlipKey.DecoratorPane={opening:false,openId:null,clickEvent:null,open:function(tab){FlipKey.DecoratorPane.opening=true;window.setTimeout(function(){FlipKey.DecoratorPane.opening=false},100);if(!FlipKey.DecoratorPane.isOpen(tab)){tab=$(tab);FlipKey.DecoratorPane.closeAll();tab.up().up().addClassName("decorator-pane-open");FlipKey.DecoratorPane.openId=tab.identify();if(!FlipKey.DecoratorPane.clickEvent){FlipKey.DecoratorPane.clickEvent=Event.observe("arches","click",FlipKey.DecoratorPane.closeCurrent)}}},close:function(tab){tab=$(tab);if(FlipKey.DecoratorPane.isOpen(tab)){tab.up().up().removeClassName("decorator-pane-open")}if(tab.identify()==FlipKey.DecoratorPane.openId){FlipKey.DecoratorPane.openId=null}},closeAll:function(){$$(".decorator-pane-open").each(function(el){el.removeClassName("decorator-pane-open")});FlipKey.DecoratorPane.openId=null},closeCurrent:function(e){if(!FlipKey.DecoratorPane.opening&&FlipKey.DecoratorPane.openId&&!FlipKey.DecoratorPane.isDecoratorPane(e.element())){FlipKey.DecoratorPane.close(FlipKey.DecoratorPane.openId)}},isDecoratorPane:function(el){while(el.up){if(el.hasClassName&&el.hasClassName("decorator-pane")){return true}el=el.up()}return false},isOpen:function(tab){tab=$(tab);return tab.identify()==FlipKey.DecoratorPane.openId||tab.up().up().hasClassName("decorator-pane-open")},toggle:function(tab){tab=$(tab);if(FlipKey.DecoratorPane.isOpen(tab)){FlipKey.DecoratorPane.close(tab)}else{FlipKey.DecoratorPane.open(tab)}}};FlipKey.Currency={USD:{code:"USD",exchangeRate:1,symbol:"$",format:"[n-][$][M,3][m.2]",rounding:"0.005=0.01",abbreviation:"1=1"},currency:{},userCurrency:{},formattedSymbols:{CNY:"",EUR:"",GBP:"",JPY:"",RUB:"",THB:""},moneyChars:/[0-9\.\,]/,defaultFormatOptions:{zero:0,formatSymbol:false},gotoRatesAfterChange:false,parse:function(value,format){if(typeof format=="undefined"||!format.length){format=FlipKey.Currency.currency.format}var backwards=format.indexOf("m,")>0;var pattern=backwards?/[^0-9,]+/g:/[^0-9\.]+/g;value=value.replace(pattern,"");if(backwards){value=value.replace(",",".")}value=value.replace(/(\.\d+)\./,"$1");if(isNaN(value)){return 0}else{return value*1}},change:function(newCurrency){FlipKey.DecoratorPane.closeAll();FlipKey.Ajax.request("/currencies/change/"+newCurrency,{onSuccess:(function(response){if(response.responseJSON&&response.responseJSON.success==true){var data=response.responseJSON;if(FlipKey.Currency.gotoRatesAfterChange){var uri=window.location.href.split("#")[0].split("?")[0];window.location.href=uri+"?"+newCurrency+"#rate-tab-ratedetails"}else{window.location.reload()}}})})},set:function(code,exr,sym,frm){if(exr&&sym&&frm){FlipKey.Currency.setCurrency({code:code,exchangeRate:exr,symbol:sym,format:frm,rounders:"0.005=0.01",abbreviators:"1=1"})}},setCurrency:function(currency){FlipKey.Currency.currency=currency;if(FlipKey.Form&&FlipKey.Form.CurrencyInput){FlipKey.Form.CurrencyInput.onGlobalCurrencyChanged(currency)}},formatCurrencyInputs:function(params){$$("input.currency, input.monetary").each(function(el){if(FlipKey.Form&&FlipKey.Form.CurrencyInput){FlipKey.Form.CurrencyInput.addInput(el,params)}})},addInput:function(input,params){if(FlipKey.Form&&FlipKey.Form.CurrencyInput){FlipKey.Form.CurrencyInput.addInput(input,params)}},refreshInputs:function(){if(FlipKey.Form&&FlipKey.Form.CurrencyInput){FlipKey.Form.CurrencyInput.refreshInputs()}},refreshInput:function(input){if(FlipKey.Form&&FlipKey.Form.CurrencyInput){input=FlipKey.Form.CurrencyInput.getInput(input);if(input){input.refreshValues()}}},addStopCondition:function(input,testInput,stopValues){if(FlipKey.Form&&FlipKey.Form.CurrencyInput){input=FlipKey.Form.CurrencyInput.getInput(input);if(input){input.addStopCondition(testInput,stopValues)}}},checkStopCondition:function(input,testInput,stopValues){if(FlipKey.Form&&FlipKey.Form.CurrencyInput){input=FlipKey.Form.CurrencyInput.getInput(input);if(input&&input.checkStopCondition){input.checkStopCondition(testInput,stopValues)}}},stopFormatting:function(input){if(FlipKey.Form&&FlipKey.Form.CurrencyInput){input=FlipKey.Form.CurrencyInput.getInput(input);if(input){input.stopFormatting()}}},resumeFormatting:function(input){if(FlipKey.Form&&FlipKey.Form.CurrencyInput){input=FlipKey.Form.CurrencyInput.getInput(input);if(input){input.resumeFormatting()}}},getRoundedExchangeRate:function(){if(FlipKey.Currency.currency&&FlipKey.Currency.currency.exchangeRate){if(typeof FlipKey.Currency.currency.roundedExchangeRate=="undefined"){var rate=FlipKey.Currency.currency.exchangeRate;var tot=Math.round(rate*1000);var len=(""+tot).length;roundTo=tot>1000?Math.pow(10,len-2):Math.pow(10,len-1);tot=Math.round(tot/roundTo)*roundTo;FlipKey.Currency.currency.roundedExchangeRate=tot/1000}}return FlipKey.Currency.currency.roundedExchangeRate?FlipKey.Currency.currency.roundedExchangeRate:1},exchange:function(value){if(FlipKey.Currency.currency&&FlipKey.Currency.currency.exchangeRate){value=value*FlipKey.Currency.currency.exchangeRate}return value},format:function(value,options){options=$H(FlipKey.Currency.defaultFormatOptions).merge(options)._object;var currency=$H(FlipKey.Currency.currency).merge(options)._object;if(currency.abbreviation&&currency.abbreviation.length){currency.abbreviation=currency.abbreviation.split(",");currency.abbreviation.each(function(abbreviator,i){if(abbreviator&&abbreviator.length){this[i]=abbreviator.split("=")}if(this[i].length!=2){delete this[i]}},currency.abbreviation)}else{currency.abbreviation=[]}if(currency&&currency.format){var formatter=currency.format;if(!formatter){return"$"+value}var negative=value<0;value=Math.round(Math.abs(value)*1000)/1000;formatter=formatter.replace(/[\[\]]/g,"#$%").split("#$%");if(formatter.length>=1){for(var i=1;i<formatter.length;i+=2){var f=formatter[i];if(f){switch(f[0]){case"p":formatter[i]=f.length>1&&value>=0?f.substr(1):"";break;case"n":formatter[i]=f.length>1&&negative?f.substr(1):"";break;case"M":var major=(currency.abbreviation&&currency.abbreviation.length)?Math.round(value):Math.floor(value);if(major==0){if(value<0.005||currency.abbreviation&&currency.abbreviation.length||currency.format.indexOf("[m")==-1){formatter[i]=options.zero;options.isZero=true}else{formatter[i]=0}}else{if(f.length>1){var delim=f[1];var lengths=[3];if(f.length>2){lengths=f.substr(2,f.length).split("+")}var x=[];while(major>=1){var len=lengths[0]*1;if(len==0){x.unshift(""+major);major=0}else{x.unshift(""+(major%Math.pow(10,len)));major=Math.floor(major/Math.pow(10,len))}if(major){while(x[0].length<len){x[0]="0"+x[0]}}if(lengths.length>1){lengths.shift()}}formatter[i]="";for(var j=0;j<x.length;j++){formatter[i]+=x[j];if(j<x.length-1){formatter[i]+=delim}}}else{formatter[i]=major}}break;case"m":formatter[i]="";if(currency.abbreviation&&currency.abbreviation.length){continue}if(!value||(""+value).indexOf(".")==-1){if(options.honorNoDecimal||options.isZero){continue}else{value="0"}}f=f.substr(1);if(f.length!=2){continue}delim=f[0];len=f[1]*1;if(len==0){continue}var base=Math.pow(10,len);var minor=Math.round(value*base)%base;if(isNaN(minor)||minor==0){minor=""}while((""+minor).length<len){minor="0"+minor}formatter[i]=""+delim+minor;break;case"$":if(options.formatSymbol&&FlipKey.Currency.formattedSymbols[currency.code]){formatter[i]=FlipKey.Currency.formattedSymbols[currency.code]}else{formatter[i]=currency.symbol}break;default:formatter[i]="";break}}}value="";formatter.each(function(val){value+=(""+val)})}}return value}};FlipKey.ButtonMash={locklist:[],lock:function(event,el){var id,checkarr;id=Element.identify(el);checkarr="|"+this.locklist.join("|")+"|";if(checkarr.indexOf("|"+id+"|")!=-1){event.stop();return false}else{this.locklist.push(id)}return true},release:function(el){if(!el){this.locklist=[]}else{this.locklist=$A(this.locklist).without(el.id).toArray()}return true}};FlipKey.Currency.currency=FlipKey.Currency.USD;FlipKey.Reviews={paginate:function(new_page,current_page){$("review-page-"+new_page).show();$("review-page-"+current_page).hide()},paginate_to_review:function(review_id){review_box=$("review-reviews-box-"+review_id);review_page=review_box.up("div").id;$("review-page-1").hide();$(review_page).show();review_box.scrollTo();self.scrollTo(0,self.scrollY-50)},get_hash:function(){var hash=window.location.hash;if(hash.search("reviews&id")!=-1){var review_id=hash.replace("#reviews&id=","");if(review_id){this.paginate_to_review(review_id)}}},helpful_review:function(review_id){FlipKey.Ajax.request("/properties/markReviewHelpful/"+review_id+"/"+$("pid").value,{onSuccess:(function(response){$("review-reviews-helpful-text "+review_id).innerHTML="<em>Thank you for your feedback</em>"})})},show_bedroom_details:function(){$("property-details-bedroom-details").toggle();$("property-details-bedroom-details-link").setStyle("border-bottom:none");if($("property-details-bedroom-details-link").innerHTML.search("Hide")!=-1){$("property-details-bedroom-details-link").innerHTML="Show Details &#x25BA;"}else{$("property-details-bedroom-details-link").innerHTML="Hide Details &#x25BC;"}},show_bathroom_details:function(){$("property-details-bathroom-details").toggle();$("property-details-bathroom-details-link").setStyle("border-bottom:none");if($("property-details-bathroom-details-link").innerHTML.search("Hide")){$("property-details-bathroom-details-link").innerHTML="Show Details &#x25BA;"}else{$("property-details-bathroom-details-link").innerHTML="Hide Details &#x25BC;"}},show_more_details:function(review_id){$("review-reviews-expanded "+review_id).toggle();if($("more-link-"+review_id).innerHTML.search("Hide")!=-1){$("more-link-"+review_id).innerHTML="<strong>More Details &#x25BA;</strong>"}else{$("more-link-"+review_id).innerHTML="<strong>Hide Details &#x25BC;</strong>"}}};FlipKey.Payment=Class.create({initialize:function(lb_url,post_url,ach_enabled,other){this.lb_url=lb_url;this.post_url=post_url;this.ach_enabled=ach_enabled;if(other.onformsuccess&&typeof(other.onformsuccess)=="function"){this.formsuccess=other.onformsuccess.bind(this)}},openPaymentForm:function(){FlipKey.showLightboxAjax(this.lb_url,true,false,(function(){this.addEventListeners();$$(".tooltip").each(function(link){new Tooltip(link,{metalabs:true,maxWidth:359})})}).bind(this),null,{metalabs:true});return false},addEventListeners:function(){Event.observe("submitCreditCard","click",(this.submitCreditCard).bind(this));Event.observe("changeCCSelect","change",(this.changeCCSelect).bind(this));if(this.ach_enabled){Event.observe("payment_type_select_box","change",(this.paymentSelect).bind(this));Event.observe("submitACHForm","click",(this.submitACHForm).bind(this))}},submitCreditCard:function(){var errors=0;if($("phone").value==""){errors=1;$("e_phone").innerHTML="Phone number is required."}if($("address1").value==""){errors=1;$("e_address1").innerHTML="Address is required."}if($("city").value==""){errors=1;$("e_city").innerHTML="City is required."}if($("state").value==""){errors=1;$("e_state").innerHTML="State is required."}if($("zip").value==""){errors=1;$("e_zip").innerHTML="Zip Code is required."}if($("ccnumber").value==""){errors=1;$("e_ccnumber").innerHTML="Credit Card number is required."}if($("ccmonth").value==""){errors=1;$("e_ccmonth").innerHTML="Credit Card Expiration Month is required."}if($("ccyear").value==""){errors=1;$("e_ccyear").innerHTML="Credit Card Expiration Year is required."}if($("cvv").value==""){errors=1;$("e_cvv").innerHTML="Security Code is required."}if($("cctype".value=="")){errors=1;$("e_cctype").innerHTML="Credit Card Type is required."}$("edit_credit_card").submit()},changeCCSelect:function(){pic=$("ccPic");tt=$("ccSecurityHelp");if($F("changeCCSelect")=="AMEX"){if(pic.src!="/img/ccv2_amex.png"){pic.src="/img/ccv2_amex.png";pic.style.display="block"}}else{if(pic.src!="/img/ccv2_nonamex.png"){pic.src="/img/ccv2_nonamex.png";pic.style.display="block"}}},submitACHForm:function(){var errors=0;if($("checkname").value==""){errors=1;$("e_checkname").innerHTML="Name on Account is required."}if($("checkaccount").value==""){errors=1;$("e_checkaccount").innerHTML="Account Number is required."}if($("checkaccount2").value!=$("checkaccount").value==""){errors=1;$("e_checkaccount2").innerHTML="Account Numbers do not match, please re-enter."}if($("checkaba").value==""){errors=1;$("e_checkaba").innerHTML="Routing Number is required."}if($("checkaba2").value!=$("checkaba").value){errors=1;$("e_checkaba2").innerHTML="Routing numbers do not match, please re-enter."}},paymentSelect:function(){if($F("payment_type_select_box")=="ach"){$("ccform").hide();$("achform").show()}else{$("ccform").show();$("achform").hide()}}});FlipKey.MyPicks={changed:{viewed:true,my_pick:true,inquired:true},tids:{},btids:{},hoverHeaderId:null,hoverMegaDropDownId:null,firstTime:true,clickEvent:null,removePick:function(pid,header){new FlipKey.Ajax.request("/my_picks/remove/"+pid,{onSuccess:function(resp){var json_resp=resp.responseJSON;if(!json_resp.logged_in){FlipKey.showLightboxAjax("/Pages/login/?action=mypicks&data="+pid+"&redirect_url="+encodeURIComponent(window.location.href),true,false,null,null,{archesnew:true})}else{if($("in_my_picks"+pid)){$("in_my_picks"+pid).hide();$("add_to_my_picks"+pid).show()}if($("mypicklinkchecked"+pid)){$("mypicklinkchecked"+pid).up().hide();$("my_pick_activity_bar"+pid).hide();if(!header){$("mypicklinkunchecked"+pid).show()}}if(json_resp.count==0){$$(".my_pick_count").invoke("update",json_resp.count);$$(".my_pick_count_dropdown").each(function(e){e.parentNode.hide()})}else{$$(".my_pick_count").invoke("update",json_resp.count);$$(".my_pick_count_dropdown").each(function(e){e.up().show()})}}FlipKey.MyPicks.changed.my_pick=true;if($("nav-picks-divider").hasClassName("active")&&$("my_pick_nav_tab").hasClassName("active")){FlipKey.MyPicks.getProps("mypicks")}}})},removeViewed:function(pid,header){new FlipKey.Ajax.request("/my_picks/remove_view/"+pid,{onSuccess:function(resp){var json_resp=resp.responseJSON;FlipKey.MyPicks.changed.viewed=true;if(json_resp.count==0){$$(".view_count").invoke("update",json_resp.count);$$(".view_count_dropdown").each(function(e){e.parentNode.hide()})}else{$$(".view_count").invoke("update",json_resp.count);$$(".view_count_dropdown").each(function(e){e.up().show()})}if($("nav-picks-divider").hasClassName("active")&&$("viewed_nav_tab").hasClassName("active")){FlipKey.MyPicks.getProps("views")}}})},addPick:function(pid){new FlipKey.Ajax.request("/my_picks/add/"+pid,{onSuccess:function(resp){var json_resp=resp.responseJSON;if(!json_resp.logged_in){FlipKey.showLightboxAjax("/Pages/login/?action=mypicks&data="+pid+"&redirect_url="+encodeURIComponent(window.location.href),true,false,null,null,{archesnew:true})}else{if($("in_my_picks"+pid)){$("in_my_picks"+pid).show();$("add_to_my_picks"+pid).hide()}if($("mypicklinkchecked"+pid)){$("mypicklinkchecked"+pid).up().show();$("mypicklinkunchecked"+pid).hide()}if(json_resp.count==0){$$(".my_pick_count").invoke("update",json_resp.count);$$(".my_pick_count").each(function(e){e.parentNode.hide()})}else{$$(".my_pick_count").invoke("update",json_resp.count).invoke("show");$$(".my_pick_count_dropdown").each(function(e){e.parentNode.show()})}}FlipKey.MyPicks.changed.my_pick=true;if($("nav-picks-divider").hasClassName("active")&&$("my_pick_nav_tab").hasClassName("active")){FlipKey.MyPicks.getProps("mypicks")}}})},onClickHeaderDiv:function(){if($("nav-picks-divider").hasClassName("active")){$("nav-picks-divider").removeClassName("active");$("my-picks-details-outer").hide();return}$("nav-picks-divider").addClassName("active");$("my-picks-details-outer").style.top=$("nav-picks").cumulativeOffset().top+$("nav-picks").getHeight()-1+"px";$("my-picks-details-outer").show();if(FlipKey.MyPicks.firstTime){FlipKey.MyPicks.make_active("mypicks")}},mouseOverMegaDropDown:function(){clearTimeout(FlipKey.MyPicks.hoverMegaDropDownId);clearTimeout(FlipKey.MyPicks.hoverHeaderId)},mouseOutMegaDropDown:function(){FlipKey.MyPicks.hoverMegaDropDownId=setTimeout(function(e){$("nav-picks-divider").removeClassName("active");$("my-picks-details-outer").hide()},200)},make_active:function(tab){if(!FlipKey.MyPicks.clickEvent){FlipKey.MyPicks.clickEvent=Event.observe("arches","click",FlipKey.MyPicks.closeCurrent)}if(!$(tab+"_nav_tab").hasClassName("active")){$$(".nav_content_wrapper > div").invoke("hide");$$(".share_links").invoke("hide");$$(".my-picks-nav-menu td.nav-li").invoke("removeClassName","active");$(tab+"_nav_content").show();$(tab+"_nav_tab").addClassName("active");$(tab+"_links").show();FlipKey.MyPicks.getProps(tab)}},closeCurrent:function(e){if($(e.target).descendantOf("nav-picks")||$(e.target).descendantOf("my-picks-details")||!$("nav-picks-divider").hasClassName("active")){return false}$("nav-picks-divider").removeClassName("active");$("my-picks-details-outer").hide();return true},getProps:function(type){if(FlipKey.MyPicks.changed[type]==false){return}ele=$(type+"_nav_content");if($("dropdown-loading-div")){$("dropdown-loading-div").remove()}loading=new Element("div",{id:"dropdown-loading-div"});loading_span=new Element("span");loading_img=new Element("img",{src:"/img/house-throbber-32x32.gif",height:32,width:32});loading_text=new Element("span",{className:"loading-text"}).update("Loading");loading_span.appendChild(loading_img);loading_span.appendChild(loading_text);loading.appendChild(loading_span);ele.update(loading);FlipKey.Ajax.updater(type+"_nav_content","/my_picks/show_super_dropdown/"+type);FlipKey.MyPicks.changed[type]=false},hoverOverPickImage:function(id,type){clearTimeout(FlipKey.MyPicks.tids[id]);clearTimeout(FlipKey.MyPicks.btids[id]);par=$("my-picks-details").cumulativeOffset();image=$(type+"-primary-photo-"+id).cumulativeOffset();xoff=$(type+"_image_hoverbox"+id).getWidth()/2-$(type+"-primary-photo-"+id).getWidth()/2;$(type+"_image_hoverbox"+id).setStyle({top:image.top-par.top+$(type+"-primary-photo-"+id).getHeight()+"px",left:image.left-par.left-xoff+"px"});$$(".pick_image_hovebox").reject(function(e){e.id==type+"_image_hoverbox"+id}).invoke("hide");$(type+"_image_hoverbox"+id).show();offToTheLeft=$(type+"_image_hoverbox"+id).cumulativeOffset().left;if(offToTheLeft<0){$(type+"_image_hoverbox"+id).style.left=parseInt($(type+"_image_hoverbox"+id).style.left.replace("px",""))-offToTheLeft+"px";$(type+"_image_hoverbox"+id).select(".general-hover-arrow").each(function(e){e.setStyle({marginRight:-1*offToTheLeft*2+"px"})})}else{$(type+"_image_hoverbox"+id).select(".general-hover-arrow").each(function(e){e.setStyle({marginRight:"0px"})})}},hoverOutImage:function(id,type){FlipKey.MyPicks.tids[id]=setTimeout(function(e){$(type+"_image_hoverbox"+id).hide()},200)},hoverOverPickBox:function(id,type){clearTimeout(FlipKey.MyPicks.tids[id]);clearTimeout(FlipKey.MyPicks.btids[id])},hoverOutPickBox:function(id,type){FlipKey.MyPicks.btids[id]=setTimeout(function(){$(type+"_image_hoverbox"+id).hide()},200)}};AlertBar=Class.create();AlertBar.prototype={hideTimeoutId:null,defaultparams:$H({addOpaque:false,alertType:"warning",autoHideAfter:false,closeable:false,options:new Array(),placement:"top",alignment:"center"}),params:{},bar:null,initialized:false,initialize:function(){this.closeButton=new Element("a").addClassName("close").update("&times;");this.hideEvent=this.hide.bindAsEventListener(this)},show:function(text,params){AlertBar.last_message=text;AlertBar.last_params=params;if(this.hideAnimation){this.hideAnimation.cancel();this.hideAnimation=null}if(this.hideTimeoutId){clearTimeout(this.hideTimeoutId);this.hideTimeoutId=null}this.params=this.defaultparams.merge(params).toObject();var error_class;if(this.params.alertType){error_class="alert-"+this.params.alertType}else{error_class="alert-warning"}if(this.params.alignment=="left"){this.bar=new Element("div").addClassName(error_class).update('<div class="message-left">'+text+"</div>")}else{this.bar=new Element("div").addClassName(error_class).update('<div class="message-center">'+text+"</div>")}if(this.params.closeable){this.bar.insert({top:this.closeButton});this.closeButton.observe("click",this.hideEvent);this.closeButton.innerHTML="&times;";this.closeButton.show()}buttons=[];is_buttons=false;this.params.options.each(function(e,index){if(e&&e.text&&e.callback){is_buttons=true;ele=new Element("a",{className:"alert-button",href:"javascript:void(0);"}).insert(e.text);ele.observe("click",e.callback);buttons.push(ele)}});if(is_buttons){ele=new Element("div",{className:"alert-buttons"});var message=this.bar.select("div.message, div.message-center, div.message-left")[0];if(message){message.insert(ele)}else{this.bar.insert(ele)}buttons.each(function(e,index){ele.insert(e)})}if(this.params.addOpaque){if(!$("alert_bar_opaque")){opaque=new Element("div",{id:"alert_bar_opaque"});opaque.setOpacity(0.8);$$("body")[0].insert(opaque)}$("alert_bar_opaque").show()}else{if($("alert_bar_opaque")){$("alert_bar_opaque").hide()}}if(this.params.placement=="top"){if(this.initialized==false){$("alert-bar-top").insert({top:this.bar})}else{$("alert-bar-top").update(this.bar)}}else{if(this.params.placement=="inline"){if(this.initialized==false){$("alert-bar-inline").insert({top:this.bar})}else{$("alert-bar-inline").update(this.bar)}}}if(typeof this.params.autoHideAfter=="number"&&this.params.autoHideAfter>0){this.hideTimeoutId=this.hideEvent.delay(this.params.autoHideAfter)}this.initialized=true},hide:function(){if(typeof this.params.afterHide=="function"){this.params.afterHide()}if(!this.bar){return}this.bar.hide();if($("alert_bar_opaque")){$("alert_bar_opaque").hide()}}};Object.extend(AlertBar,{last_message:"",last_params:{}});AlertBars=[];Event.observe(window,"load",function(evt){AlertBars.each(function(el){new AlertBar().show(el.message,el.params)})});var DatePicker=Class.create();DatePicker.prototype={destroy:function(){Event.stopObserving($$("html")[0],"click",this.closeEvent);if($(this.params.startInput)){$(this.params.startInput).stopObserving("click",this.showEvent);$(this.params.startInput).stopObserving("focus",this.showEvent);$(this.params.startInput).stopObserving("blur",this.closeEvent)}if($(this.params.endInput)){$(this.params.endInput).stopObserving("click",this.showEvent);$(this.params.endInput).stopObserving("focus",this.showEvent);$(this.params.endInput).stopObserving("blur",this.closeEvent)}if($(this.closeLink.identify())){this.closeLink.stopObserving("click",this.closeEvent)}if($(this.params.startButton)){$(this.params.startButton).stopObserving("click",this.showEvent)}if($(this.params.endButton)){$(this.params.endButton).stopObserving("click",this.showEvent)}if($(this.params.startButton_container)){$(this.params.startButton_container).stopObserving("click",this.showEvent)}if($(this.params.endButton_container)){$(this.params.endButton_container).stopObserving("click",this.showEvent)}if($(this.el.identify())){this.el.remove()}},initialize:function(params){this.params=params;if(!this.params.defaultSelectedDays){this.params.defaultSelectedDays=7}if(!this.params.direction){this.params.direction="right"}this.mode="closed";this.showEvent=this.show.bindAsEventListener(this);$(this.params.startInput).addClassName("datepicker-input");if(!this.params.endInput){this.params.endInput=this.params.startInput;this.params.single=true}if(!this.params.single){$(this.params.endInput).addClassName("datepicker-input")}$(this.params.startInput).observe("click",this.showEvent);if(!this.params.single){$(this.params.endInput).observe("click",this.showEvent)}$(this.params.startInput).observe("focus",this.showEvent);if(!this.params.single){$(this.params.endInput).observe("focus",this.showEvent)}if(this.params.startButton){$(this.params.startButton).addClassName("datepicker-button");if(this.params.showOnButtonClick){$(this.params.startButton).observe("click",this.showEvent)}}if(this.params.endButton){$(this.params.endButton).addClassName("datepicker-button");if(this.params.showOnButtonClick){$(this.params.endButton).observe("click",this.showEvent)}}if(this.params.startButton_container){$(this.params.startButton_container).observe("click",this.showEvent)}if(this.params.endButton_container){$(this.params.endButton_container).observe("click",this.showEvent)}this.closeEvent=this.close.bindAsEventListener(this);Event.observe($$("html")[0],"click",this.closeEvent);$(this.params.startInput).observe("blur",this.closeEvent);if(!this.params.single){$(this.params.endInput).observe("blur",this.closeEvent)}if(this.params.arches&&this.params.arches==true){this.el=Builder.node("div",{className:"datepicker-a datepicker-"+this.params.direction,id:this.params.id,style:"display: none; width: 374px;"},[Builder.node("div",{className:"toparrowdiv"},[Builder.node("span").update("&#9650;")]),Builder.node("div",{className:"archestop"},[this.closeLink=Builder.node("p",{className:"close arches-calendar-close"},[Builder.node("a",{id:this.params.id+"_close"},"")]),Builder.node("div",{id:this.params.id+"_month_1",className:"inline-block"}),Builder.node("div",{id:this.params.id+"_month_2",className:"inline-block"}),Builder.node("br",{className:"cleaner"})]),Builder.node("div",{className:"bottomarrowdiv"},[Builder.node("span").update("&#9660;")])])}else{this.el=Builder.node("div",{className:"datepicker-a datepicker-"+this.params.direction,id:this.params.id,style:"display: none"},[Builder.node("div",{className:"top"},[this.prevLink=Builder.node("a",{className:"nav prev",id:this.params.id+"_prev"}),this.nextLink=Builder.node("a",{className:"nav next",id:this.params.id+"_next"}),Builder.node("div",{id:this.params.id+"_month_1",style:"float: left"}),Builder.node("div",{id:this.params.id+"_month_2",style:"float: right"}),Builder.node("br",{className:"cleaner"}),]),Builder.node("div",{className:"bottom"},[Builder.node("p",{className:"close"},[this.closeLink=Builder.node("a",{id:this.params.id+"_close"},"Close")])])])}Event.observe(this.closeLink,"click",this.closeEvent);if(this.params.lockTo){this.params.lockTo=$(this.params.lockTo);var dp=this;Event.observe(window,"load",function(){if(dp.params.lockTo&&UI.StickyBox.boxes){var lockBox=UI.StickyBox.boxes[dp.params.lockTo.id];if(lockBox){lockBox.setParam("onChangeState",dp.onLockChange.bind(dp));dp.onLockChange(dp)}}})}document.body.appendChild(this.el);if(this.params.noAvailability||this.params.showPastMonths){disableFunction=this.doNotDisableDates}else{disableFunction=this.disableDates}if(params.dateFormat){dformat=params.dateFormat}else{dformat="%m/%d/%Y"}this.cal1=Calendar.setup({dateField:params.startInput,parentElement:this.params.id+"_month_1",disabledHandler:disableFunction,selectHandler:this.selectDate,datePicker:this,type:"popup",dateFormat:dformat,arches:this.params.arches,left_cal:true});this.cal2=Calendar.setup({dateField:params.endInput,parentElement:this.params.id+"_month_2",disabledHandler:disableFunction,selectHandler:this.selectDate,datePicker:this,type:"popup",dateFormat:dformat,arches:this.params.arches,left_cal:false});this.prevEvent=this.prev.bindAsEventListener(this);this.prevLink.observe("click",this.prevEvent);this.nextEvent=this.next.bindAsEventListener(this);this.nextLink.observe("click",this.nextEvent);if(this.params.clearButton&&$(this.params.clearButton)){this.clearButton=$(this.params.clearButton);if(this.clearButton.getAttribute("href")){this.clearButton.removeAttribute("href")}this.clearEvent=this.clearDates.bindAsEventListener(this);this.clearButton.observe("click",this.clearEvent);this.showClearButtonEvent=this.showClearButton.bindAsEventListener(this);$(this.params.startInput).observe("change",this.showClearButtonEvent);if(this.params.endInput){$(this.params.endInput).observe("change",this.showClearButtonEvent)}}},onLockChange:function(state){var newPos="absolute";if(state){if(state=="top-locked"||state=="bottom-locked"){newPos="fixed"}}else{if(this.params.lockTo.getStyle("position")=="fixed"){newPos="fixed"}}if(newPos!=this.el.getStyle("position")){var input=$(this.params.startInput);var newTop=Position.cumulativeOffset(input)[1]-this.el.getHeight()-10;this.el.setStyle({position:newPos,top:""+newTop+"px"})}},defaultParams:{direction:"right",debug:true},debug:function(message){if(typeof console!="undefined"&&this.params.debug){console.log(message)}},parse:function(str){var parts=str.split("/");if(parts.length!=3){return false}if(parts[0]=="mm"||parts[1]=="dd"||parts[2]=="yyyy"){return false}var date=new Date();try{date.setDate(parts[1]);date.setMonth(parts[0]-1);date.setYear(parts[2])}catch(e){return false}if(!date||isNaN(date)){return false}else{return date}},clearDates:function(evt){$(this.params.startInput).value="";$(this.params.endInput).value="";return false},showClearButton:function(evt){if(!this.clearButton.visible()){this.clearButton.show();Effect.Fade(this.clearButton,{from:0,to:1})}},print:function(date){return(date.getMonth()+1)+"-"+date.getDate()+"-"+date.getFullYear()},getArrival:function(){return this.parse($(this.params.startInput).value)},getDeparture:function(){return this.parse($(this.params.endInput).value)},show:function(evt){var input=evt.element();hideSelects("hidden");if((this.mode=="arrival"&&(input.id==this.params.startButton||input.id==this.params.startButton_container))||(this.mode=="departure"&&(input.id==this.params.endButton||input.id==this.params.endButton_container))){this.debug("Closing for button");this.close(evt,true);this.mode="closed";return}else{if(input.id==this.params.startInput||input.id==this.params.startButton||input.id==this.params.startButton_container){this.mode="arrival";var pos=Position.cumulativeOffset($(this.params.startInput));var input=$(this.params.startInput)}else{if(input.id==this.params.endInput||input.id==this.params.endButton||input.id==this.params.endButton_container){this.mode="departure";var pos=Position.cumulativeOffset($(this.params.endInput));var input=$(this.params.endInput)}else{return false}}}if(this.mode=="arrival"){if(this.parse(input.value)){this.cal1.date=this.parse(input.value);this.cal1.update(this.parse(input.value));this.cal2.date=new Date(this.cal1.date).set("+1m");this.cal2.update(this.cal2.date,true)}else{if(this.parse($(this.params.endInput).value)){this.cal2.parseDate($(this.params.endInput).value);cal1_date=new Date(this.cal2.date).set("-1m");this.cal1.update(cal1_date,true)}else{this.cal1.update(new Date(),true);if(this.params.endInput){cal2_date=new Date().set("+1m")}this.cal2.update(cal2_date,true)}}}else{if(this.mode=="departure"){if(this.parse(input.value)){this.cal1.date=this.parse(input.value);this.cal1.update(this.parse(input.value));this.cal2.date=new Date(this.cal1.date).set("+1m");this.cal2.update(this.cal2.date,true)}else{if(this.parse($(this.params.startInput).value)){this.cal1.parseDate($(this.params.startInput).value);cal2_date=new Date(this.cal1.date).set("+1m");this.cal2.update(cal2_date,true)}else{this.cal1.update(new Date(),true);cal2_date=new Date().set("+1m");this.cal2.update(cal2_date,true)}}}}var left=this.params.direction=="right"?-50:(-1*this.el.getWidth())+76;var top_pos=pos[1]+input.getHeight();var left_pos=pos[0]+left;this.el.setStyle({display:"block",top:top_pos+"px",left:left_pos+"px"});if(this.el.hasClassName("datepicker-above")){this.el.removeClassName("datepicker-above")}if(document.viewport.getDimensions().height<this.el.viewportOffset().top+input.getHeight()+180){if(this.params.lockTo&&UI.StickyBox.boxes[this.params.lockTo.id]){this.el.setStyle({top:(top_pos-this.el.getHeight()-input.getHeight()-10)+"px"});this.el.addClassName("datepicker-above")}else{var vert_shift=(this.el.viewportOffset().top+input.getHeight()+180)-document.viewport.getDimensions().height;window.scrollBy(0,vert_shift)}}if(parseInt(this.el.viewportOffset().left)<0){this.el.setStyle({left:"0px"})}},doNotDisableDates:function(date,datepicker){if(typeof datepicker=="undefined"){return[true,""]}if(this.type=="static"){return[true,""]}if(datepicker.params.alwaysShowHighlighting){return datepicker.addRangeHighlighting(date,datepicker)}return[true,""]},disableDates:function(date,datepicker){if(typeof datepicker=="undefined"){return[true,""]}var year=date.getFullYear();var month=date.getMonth();var day=date.getDate();if(date<new Date()&&!(date.getDate()==new Date().getDate()&&date.getMonth()==new Date().getMonth()&&date.getFullYear()==new Date().getFullYear())){return[false,"disabled","Dates in past cannot be booked"]}find_between=function(arriv,now){if(arriv>now){return true}year=now.getFullYear();month=now.getMonth();day=now.getDate();if(FlipKey.booked_dates[year]){if(FlipKey.booked_dates[year]=="all"){return false}if(FlipKey.booked_dates[year][month]){if(FlipKey.booked_dates[year][month]=="all"){return false}var range,i;for(i=0;i<FlipKey.booked_dates[year][month].length;i++){range=FlipKey.booked_dates[year][month][i];if(day>=range[0]&&day<=range[1]){return false}}return arguments.callee(arriv,new Date(year,month,day-1))}else{return arguments.callee(arriv,new Date(year,month,0))}}else{return arguments.callee(arriv,new Date(year,0,0))}};is_day_booked=false;if(FlipKey.booked_dates){if(FlipKey.booked_dates[year]){if(FlipKey.booked_dates[year]=="all"){is_day_booked=true}if(FlipKey.booked_dates[year][month]){if(FlipKey.booked_dates[year][month]=="all"){is_day_booked=true}var range,i;for(i=0;i<FlipKey.booked_dates[year][month].length;i++){range=FlipKey.booked_dates[year][month][i];if(range&&day>=range[0]&&day<=range[1]){is_day_booked=true;break}}}}if(is_day_booked){if(!datepicker.params.staticmap){range_highlighting=datepicker.addRangeHighlighting(date,datepicker);if(range_highlighting[1]){highlight_class=range_highlighting[1]}else{highlight_class=""}}else{highlight_class=""}return[true,"na"+highlight_class,"Dates is not available"]}}if(this.type=="static"){return[true,""]}return datepicker.addRangeHighlighting(date,datepicker)},addRangeHighlighting:function(date,datepicker){var plain_date=DatePicker.justDate(date);var arrival=DatePicker.justDate(datepicker.getArrival());var departure=DatePicker.justDate(datepicker.getDeparture());if(arrival&&departure){if(plain_date>=arrival&&plain_date<=departure&&Math.abs(departure.getMonth()-arrival.getMonth())%11>=0&&Math.abs(departure.getMonth()-arrival.getMonth())%11<=2){if(plain_date.equalsTo(departure)&&datepicker.params.arches){if(datepicker.mode=="departure"){return[true,"last_selected"]}else{return[true,"last_selected other_selected"]}}if(plain_date.equalsTo(arrival)&&datepicker.params.arches){if(datepicker.mode=="arrival"){return[true,"first_selected"]}else{return[true,"first_selected other_selected"]}}return[true,"selected"]}else{return[true,""]}}else{return[true,""]}},close:function(evt,close_for_sure){this.debug("close"+this.params.id);this.debug("closelink?"+(evt.element().id==this.closeLink.id));this.debug(evt.element());this.debug(this.nextLink.id);this.debug("on descendant? "+evt.element().descendantOf(this.el));if(evt.element().hasClassName("nav")&&(evt.element().hasClassName("prev")||evt.element().hasClassName("next"))){return}if(evt.element().hasClassName("datepicker-input")){return}if((evt.element().identify()==this.closeLink.identify())||(!evt.element().descendantOf(this.el)&&evt.element().id!=this.params.startInput&&evt.element().id!=this.params.endInput&&evt.element().id!=this.params.startButton&&evt.element().id!=this.params.startButton_container&&evt.element().id!=this.params.endButton&&evt.element().id!=this.params.endButton_container)||close_for_sure){var dp=$(this.params.id);if(dp){dp.hide()}this.mode="closed";hideSelects("visible")}},selectDate:function(cal,date,datepicker){if(cal){if(datepicker.mode=="arrival"){$(datepicker.params.startInput).value=cal.date.print(cal.dateFormat);$(datepicker.params.startInput).removeClassName("default");if(!datepicker.params.single&&datepicker.params.endInput){if(!DatePicker.justDate(datepicker.parse($(datepicker.params.endInput).value))||cal.date>=DatePicker.justDate(datepicker.parse($(datepicker.params.endInput).value))){var end_date=new Date(cal.date);end_date.setDate(end_date.getDate()+datepicker.params.defaultSelectedDays);$(datepicker.params.endInput).value=end_date.print(cal.dateFormat);$(datepicker.params.endInput).removeClassName("default").removeClassName("hasDefault")}}}else{if(datepicker.mode=="departure"){if(datepicker.params.endInput){$(datepicker.params.endInput).value=cal.date.print(cal.dateFormat);$(datepicker.params.endInput).removeClassName("default")}if(!DatePicker.justDate(datepicker.parse($(datepicker.params.startInput).value))||cal.date<=DatePicker.justDate(datepicker.parse($(datepicker.params.startInput).value))){var start_date=new Date(cal.date);start_date.setDate(start_date.getDate()-2);$(datepicker.params.startInput).value=start_date.print(cal.dateFormat);$(datepicker.params.startInput).removeClassName("default").removeClassName("hasDefault")}}}if(datepicker.params.validate_dates){$A([$(datepicker.params.startInput),$(datepicker.params.endInput)]).each(function(e){rando=e.id.match(/(\d+)$/);if(rando){rando="-"+rando[0]}prefix=e.id.replace(rando,"").replace("-to","-").replace("-from","-");is_good=FlipKey.Pdp.checkAvailDates(rando,prefix);if(!FlipKey.Pdp.noavail){error_class_name="error_msg";error_text="The dates you have selected are not available"}else{error_class_name="error_msg";error_text="The dates you have selected may not be available for this property"}$($(datepicker.params.startInput).parentNode.parentNode).select("."+error_class_name).invoke("remove");if(!is_good){$($(datepicker.params.startInput).parentNode.parentNode).appendChild(Builder.node("p",{className:error_class_name}).update(error_text))}})}if(datepicker.params.show_nights){FlipKey.updatePaymentRequestFormEstimatedRates()}if(typeof datepicker.params.onChange=="function"){datepicker.params.onChange($(datepicker.params.startInput),$(datepicker.params.endInput))}}datepicker.el.hide();hideSelects("visible");if(datepicker.clearButton){datepicker.showClearButton()}if(typeof datepicker.params.afterSelect=="function"){datepicker.params.afterSelect(cal.date)}if(datepicker.mode=="arrival"){$(datepicker.params.endInput).focus()}},changeMonth:function(offset){cal1_date=this.cal1.date;cal1_date.setDate(1);cal1_date.setMonth(cal1_date.getMonth()+offset);this.debug(cal1_date);this.cal1.update(cal1_date,true);cal2_date=this.cal2.date;cal1_date.setDate(1);cal2_date.setMonth(cal2_date.getMonth()+offset);this.cal2.update(cal2_date,true)},prev:function(evt){var today=new Date();if(this.params.showPastMonths||this.cal1.date.getYear()*12+this.cal1.date.getMonth()>today.getYear()*12+today.getMonth()){this.changeMonth(-1)}},next:function(evt){this.debug("next");this.debug(evt);this.changeMonth(1)},checkDates:function(allowBlank){var start=$(this.params.startInput);var end=$(this.params.endInput);if(start.value=="mm/dd/yyyy"){start.value=""}if(end.value=="mm/dd/yyyy"){end.value=""}if(!start.value&&!end.value){if(allowBlank){return true}else{alert("Must supply arrival and departure dates")}}if(this.getArrival()&&this.getDeparture()){return true}else{if(start.value||end.value){if(!this.getArrival()){alert("Must supply a valid arrival date")}else{if(!this.getDeparture()){alert("Must supply a valid departure date")}}}}return false}};DatePicker.justDate=function(date){if(!date){return false}var temp_date=new Date(date);temp_date.setHours(0);temp_date.setMinutes(0);temp_date.setSeconds(0);temp_date.setMilliseconds(0);return temp_date},StaticDatePicker=Class.create(DatePicker,{initialize:function(params){this.params=params;this.cal1=Calendar.setup({parentElement:this.params.id+"_month_1",disabledHandler:this.disableDates,datePicker:this,type:"static"});this.cal2=Calendar.setup({parentElement:this.params.id+"_month_2",disabledHandler:this.disableDates,datePicker:this,type:"static"});this.cal1.update(new Date(),true);this.cal2.update(new Date().set("+1m"),true);this.prevEvent=this.prev.bindAsEventListener(this);this.nextEvent=this.next.bindAsEventListener(this);this.cal1.container.select("a.prev")[0].observe("click",this.prevEvent);this.cal1.container.select("a.next")[0].observe("click",this.nextEvent);this.cal2.container.select("a.prev")[0].observe("click",this.prevEvent);this.cal2.container.select("a.next")[0].observe("click",this.nextEvent)}});function hideSelects(action){if(action!="visible"){action="hidden"}if(FlipKey.getInternetExplorerVersion()!=6){return}if(navigator.appName.indexOf("MSIE")){for(var S=0;S<document.forms.length;S++){for(var R=0;R<document.forms[S].length;R++){if(document.forms[S].elements[R].options){document.forms[S].elements[R].style.visibility=action}}}}}var Calendar=Class.create();Calendar.VERSION="1.2";Calendar.DAY_NAMES=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday");Calendar.SHORT_DAY_NAMES=new Array("S","M","T","W","T","F","S","S");Calendar.MONTH_NAMES=new Array("January","February","March","April","May","June","July","August","September","October","November","December");Calendar.SHORT_MONTH_NAMES=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");Calendar.NAV_PREVIOUS_YEAR=-2;Calendar.NAV_PREVIOUS_MONTH=-1;Calendar.NAV_TODAY=0;Calendar.NAV_NEXT_MONTH=1;Calendar.NAV_NEXT_YEAR=2;function prevMonth(){}function nextMonth(){}Calendar._checkCalendar=function(event){if(!window._popupCalendar){return false}if(Element.descendantOf(Event.element(event),window._popupCalendar.container)){return}window._popupCalendar.callCloseHandler();return Event.stop(event)};Calendar.handleMouseDownEvent=function(event){Event.observe(document,"mouseup",Calendar.handleMouseUpEvent);Event.stop(event)};Calendar.handleMouseUpEvent=function(event){var el=Event.element(event);var calendar=el.calendar;var isNewDate=false;if(!calendar){return false}if(typeof el.navAction=="undefined"){if(el.disabled){return true}if(calendar.currentDateElement){Element.removeClassName(calendar.currentDateElement,"selected");Element.addClassName(el,"selected");calendar.shouldClose=(calendar.currentDateElement==el);if(!calendar.shouldClose){calendar.currentDateElement=el}}calendar.date.setDateOnly(el.date);isNewDate=true;calendar.shouldClose=!el.hasClassName("otherDay");var isOtherMonth=!calendar.shouldClose;if(isOtherMonth){calendar.update(calendar.date)}}else{var date=new Date(calendar.date);if(el.navAction==Calendar.NAV_TODAY){date.setDateOnly(new Date())}var year=date.getFullYear();var mon=date.getMonth();function setMonth(m){var day=date.getDate();var max=date.getMonthDays(m);if(day>max){date.setDate(max)}date.setMonth(m)}switch(el.navAction){case Calendar.NAV_PREVIOUS_YEAR:if(year>calendar.minYear){date.setFullYear(year-1)}break;case Calendar.NAV_PREVIOUS_MONTH:if(mon>0){setMonth(mon-1)}else{if(year-->calendar.minYear){date.setFullYear(year);setMonth(11)}}break;case Calendar.NAV_TODAY:break;case Calendar.NAV_NEXT_MONTH:if(mon<11){setMonth(mon+1)}else{if(year<calendar.maxYear){date.setFullYear(year+1);setMonth(0)}}break;case Calendar.NAV_NEXT_YEAR:if(year<calendar.maxYear){date.setFullYear(year+1)}break}if(!date.equalsTo(calendar.date)){calendar.setDate(date);isNewDate=true}else{if(el.navAction==0){isNewDate=(calendar.shouldClose=true)}}}if(isNewDate){event&&calendar.callSelectHandler()}if(calendar.shouldClose){event&&calendar.callCloseHandler()}Event.stopObserving(document,"mouseup",Calendar.handleMouseUpEvent);return Event.stop(event)};Calendar.defaultSelectHandler=function(calendar){if(!calendar.dateField){return false}if(calendar.dateField.tagName=="DIV"){Element.update(calendar.dateField,calendar.date.print(calendar.dateFormat))}else{if(calendar.dateField.tagName=="INPUT"){calendar.dateField.value=calendar.date.print(calendar.dateFormat)}}if(typeof calendar.dateField.onchange=="function"){calendar.dateField.onchange()}if(calendar.shouldClose){calendar.callCloseHandler()}};Calendar.defaultCloseHandler=function(calendar){calendar.hide()};Calendar.setup=function(params){function param_default(name,def){if(!params[name]){params[name]=def}}param_default("dateField",null);param_default("triggerElement",null);param_default("parentElement",null);param_default("selectHandler",null);param_default("closeHandler",null);if(params.parentElement){var calendar=new Calendar(params.parentElement,params.type,params);calendar.setSelectHandler(params.selectHandler||Calendar.defaultSelectHandler);calendar.disabledHandler=params.disabledHandler;if(params.dateFormat){calendar.setDateFormat(params.dateFormat)}if(params.dateField){calendar.setDateField(params.dateField);calendar.parseDate(calendar.dateField.innerHTML||calendar.dateField.value)}if(params.datePicker){calendar.datepicker=params.datePicker}calendar.show();return calendar}else{var triggerElement=$(params.triggerElement||params.dateField);triggerElement.onclick=function(){var calendar=new Calendar();calendar.setSelectHandler(params.selectHandler||Calendar.defaultSelectHandler);calendar.setCloseHandler(params.closeHandler||Calendar.defaultCloseHandler);if(params.dateFormat){calendar.setDateFormat(params.dateFormat)}if(params.dateField){calendar.setDateField(params.dateField);calendar.parseDate(calendar.dateField.innerHTML||calendar.dateField.value)}if(params.dateField){Date.parseDate(calendar.dateField.value||calendar.dateField.innerHTML,calendar.dateFormat)}calendar.showAtElement(triggerElement);return calendar}}};Calendar.prototype={container:null,selectHandler:null,closeHandler:null,minYear:1900,maxYear:2100,dateFormat:"%m-%d-%Y",date:new Date(),currentDateElement:null,shouldClose:false,isPopup:true,dateField:null,initialize:function(parent,type,params){if(params){this.passed_params=params}if(parent){this.create($(parent),type)}else{this.create(null,type)}},update:function(date,preserve_selected){var calendar=this;var today=new Date();var thisYear=today.getFullYear();var thisMonth=today.getMonth();var thisDay=today.getDate();var month=date.getMonth();var dayOfMonth=date.getDate();if(date.getFullYear()<this.minYear){date.setFullYear(this.minYear)}else{if(date.getFullYear()>this.maxYear){date.setFullYear(this.maxYear)}}this.date=new Date(date);date.setDate(1);date.setDate(-(date.getDay())+1);var first=true;Element.extend(this.container).select("tbody.dates tr").each(function(row,i){var rowHasDays=false;row.immediateDescendants().each(function(cell,j){var day=date.getDate();var dayOfWeek=date.getDay();var isCurrentMonth=(date.getMonth()==month);cell.date=new Date(date);if(isCurrentMonth){if(typeof calendar.disabledHandler=="function"){disabled_data=calendar.disabledHandler(cell.date,calendar.datepicker);if(!disabled_data[0]){cell.disabled=true;cell.className=disabled_data[1];if(typeof last_cell!="undefined"){if(!last_cell.disabled){last_cell.addClassName("stop")}}}else{cell.disabled=false;cell.className=disabled_data[1];if(typeof last_cell!="undefined"){if(last_cell.disabled){cell.addClassName("start")}}if(first){cell.addClassName("start")}else{if(day==Calendar.lastDayOfMonth(month+1)){cell.addClassName("stop")}}}}else{cell.disabled=false;cell.className="";if(first){cell.addClassName("start")}else{if(day==Calendar.lastDayOfMonth(month+1)){cell.addClassName("stop")}}}cell.update(day);first=false;rowHasDays=true}else{cell.update("");cell.disabled=true;cell.className="disabled";rowHasDays=true}if(isCurrentMonth&&day==dayOfMonth&&!preserve_selected){cell.addClassName("selected");calendar.currentDateElement=cell}if(date.getFullYear()==thisYear&&date.getMonth()==thisMonth&&day==thisDay){cell.addClassName("today")}if([0,6].indexOf(dayOfWeek)!=-1){cell.addClassName("weekend")}date.setDate(day+1);last_cell=cell})});$(this.container).select(this.title_selector)[0].update(Calendar.MONTH_NAMES[month]+" "+this.date.getFullYear())},create:function(parent,type){if(!parent){parent=document.getElementsByTagName("body")[0];this.isPopup=true}else{this.isPopup=false}this.type=type;var table=new Element("table");table.className="calendar-a";var thead=new Element("thead");if(this.type=="popup"){if(this.passed_params.arches){this.title_selector="td.title";if(this.passed_params.left_cal){table.setStyle({borderRight:"0px"});var title_table=Builder.node("td",{colSpan:7},[Builder.node("table",{className:"title_table"},[Builder.node("tbody",[Builder.node("tr",[this.passed_params.datePicker.prevLink=Builder.node("td",{className:"prev"},[Builder.node("span").update("&#9664;")]),Builder.node("td",{className:"title"}),Builder.node("td",{className:"next"})])])])])}else{table.className="calendar-a calendar-a-right";var title_table=Builder.node("td",{colSpan:7},[Builder.node("table",{className:"title_table"},[Builder.node("tbody",[Builder.node("tr",[Builder.node("td",{className:"prev"}),Builder.node("td",{className:"title"}),this.passed_params.datePicker.nextLink=Builder.node("td",{className:"next"},[Builder.node("span").update("&#9654;")])])])])])}}else{this.title_selector="td.title";title_table=Builder.node("td",{colSpan:7,className:"title"})}var row=new Element("tr");var cell=new Element("td",{colSpan:7});var title_block=Builder.node("tr",[title_table]);thead.appendChild(title_block)}else{if(this.type=="static"){this.title_selector="div span";var caption=new Element("div");var prev=new Element("a");prev.className="prev";var next=new Element("a");next.className="next";var title_span=new Element("span");caption.addClassName("staticCalendarMonthYearHeader");caption.appendChild(title_span);caption.appendChild(prev);caption.appendChild(next);var rowMonthYear=new Element("tr");var tdMonthYear=new Element("td",{colSpan:7});tdMonthYear.addClassName("staticCalendarMonthYearHeader");tdMonthYear.appendChild(caption);rowMonthYear.appendChild(tdMonthYear);thead.appendChild(rowMonthYear)}}table.appendChild(thead);row=new Element("tr");for(var i=0;i<7;++i){cell=new Element("th").update(Calendar.SHORT_DAY_NAMES[i]);if(i==0||i==6){cell.addClassName("weekend")}row.appendChild(cell)}thead.appendChild(row);var tbody=table.appendChild(new Element("tbody",{className:"dates"}));for(i=6;i>0;--i){row=tbody.appendChild(new Element("tr"));row.addClassName("days");for(var j=7;j>0;--j){cell=row.appendChild(new Element("td"));cell.calendar=this}}this.container=new Element("div");this.container.addClassName("calendar");if(this.isPopup){this.container.setStyle({position:"absolute",display:"none"});this.container.addClassName("popup")}this.container.appendChild(table);Event.observe(this.container,"mousedown",Calendar.handleMouseDownEvent);parent.appendChild(this.container);parent.appendChild(new Element("span",{className:"cleaner"}))},_drawButtonCell:function(parent,text,colSpan,navAction){var cell=new Element("td");if(colSpan>1){cell.colSpan=colSpan}cell.className="button";cell.calendar=this;cell.navAction=navAction;cell.innerHTML=text;cell.unselectable="on";parent.appendChild(cell);return cell},callSelectHandler:function(){if(this.selectHandler){this.selectHandler(this,this.date.print(this.dateFormat),this.datepicker)}},callCloseHandler:function(){if(this.closeHandler){this.closeHandler(this)}},show:function(){this.container.show();if(this.isPopup){window._popupCalendar=this;Event.observe(document,"mousedown",Calendar._checkCalendar)}},showAt:function(x,y){this.container.setStyle({left:x+"px",top:y+"px"});this.show()},showAtElement:function(element){var pos=Position.cumulativeOffset(element);this.showAt(pos[0],pos[1])},hide:function(){if(this.isPopup){Event.stopObserving(document,"mousedown",Calendar._checkCalendar)}this.container.hide()},parseDate:function(str,format){if(!format){format=this.dateFormat}this.setDate(Date.parseDate(str,format))},setSelectHandler:function(selectHandler){this.selectHandler=selectHandler},setCloseHandler:function(closeHandler){this.closeHandler=closeHandler},setDate:function(date){if(!date.equalsTo(this.date)){this.update(date)}},setDateFormat:function(format){this.dateFormat=format},setDateField:function(field){this.dateField=$(field)},setRange:function(minYear,maxYear){this.minYear=minYear;this.maxYear=maxYear}};window._popupCalendar=null;Date.DAYS_IN_MONTH=new Array(31,28,31,30,31,30,31,31,30,31,30,31);Date.SECOND=1000;Date.MINUTE=60*Date.SECOND;Date.HOUR=60*Date.MINUTE;Date.DAY=24*Date.HOUR;Date.WEEK=7*Date.DAY;Date.parseDate=function(str,fmt){var today=new Date();var y=0;var m=-1;var d=0;var a=str.split(/\W+/);var b=fmt.match(/%./g);var i=0,j=0;var hr=0;var min=0;for(i=0;i<a.length;++i){if(!a[i]){continue}switch(b[i]){case"%d":case"%e":d=parseInt(a[i],10);break;case"%m":m=parseInt(a[i],10)-1;break;case"%Y":case"%y":y=parseInt(a[i],10);(y<100)&&(y+=(y>29)?1900:2000);break;case"%b":case"%B":for(j=0;j<12;++j){if(Calendar.MONTH_NAMES[j].substr(0,a[i].length).toLowerCase()==a[i].toLowerCase()){m=j;break}}break;case"%H":case"%I":case"%k":case"%l":hr=parseInt(a[i],10);break;case"%P":case"%p":if(/pm/i.test(a[i])&&hr<12){hr+=12}else{if(/am/i.test(a[i])&&hr>=12){hr-=12}}break;case"%M":min=parseInt(a[i],10);break}}if(isNaN(y)){y=today.getFullYear()}if(isNaN(m)){m=today.getMonth()}if(isNaN(d)){d=today.getDate()}if(isNaN(hr)){hr=today.getHours()}if(isNaN(min)){min=today.getMinutes()}if(y!=0&&m!=-1&&d!=0){return new Date(y,m,d,hr,min,0)}y=0;m=-1;d=0;for(i=0;i<a.length;++i){if(a[i].search(/[a-zA-Z]+/)!=-1){var t=-1;for(j=0;j<12;++j){if(Calendar.MONTH_NAMES[j].substr(0,a[i].length).toLowerCase()==a[i].toLowerCase()){t=j;break}}if(t!=-1){if(m!=-1){d=m+1}m=t}}else{if(parseInt(a[i],10)<=12&&m==-1){m=a[i]-1}else{if(parseInt(a[i],10)>31&&y==0){y=parseInt(a[i],10);(y<100)&&(y+=(y>29)?1900:2000)}else{if(d==0){d=a[i]}}}}}if(y==0){y=today.getFullYear()}if(m!=-1&&d!=0){return new Date(y,m,d,hr,min,0)}return today};Date.prototype.getMonthDays=function(month){var year=this.getFullYear();if(typeof month=="undefined"){month=this.getMonth()}if(((0==(year%4))&&((0!=(year%100))||(0==(year%400))))&&month==1){return 29}else{return Date.DAYS_IN_MONTH[month]}};Date.prototype.getDayOfYear=function(){var now=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0);var then=new Date(this.getFullYear(),0,0,0,0,0);var time=now-then;return Math.floor(time/Date.DAY)};Date.prototype.getWeekNumber=function(){var d=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0);var DoW=d.getDay();d.setDate(d.getDate()-(DoW+6)%7+3);var ms=d.valueOf();d.setMonth(0);d.setDate(4);return Math.round((ms-d.valueOf())/(7*86400000))+1};Date.prototype.equalsTo=function(date){return((this.getFullYear()==date.getFullYear())&&(this.getMonth()==date.getMonth())&&(this.getDate()==date.getDate())&&(this.getHours()==date.getHours())&&(this.getMinutes()==date.getMinutes()))};Date.prototype.setDateOnly=function(date){var tmp=new Date(date);this.setDate(1);this.setFullYear(tmp.getFullYear());this.setMonth(tmp.getMonth());this.setDate(tmp.getDate())};Date.prototype.print=function(str){var m=this.getMonth();var d=this.getDate();var y=this.getFullYear();var wn=this.getWeekNumber();var w=this.getDay();var s={};var hr=this.getHours();var pm=(hr>=12);var ir=(pm)?(hr-12):hr;var dy=this.getDayOfYear();if(ir==0){ir=12}var min=this.getMinutes();var sec=this.getSeconds();s["%a"]=Calendar.SHORT_DAY_NAMES[w];s["%A"]=Calendar.DAY_NAMES[w];s["%b"]=Calendar.SHORT_MONTH_NAMES[m];s["%B"]=Calendar.MONTH_NAMES[m];s["%C"]=1+Math.floor(y/100);s["%d"]=(d<10)?("0"+d):d;s["%e"]=d;s["%H"]=(hr<10)?("0"+hr):hr;s["%I"]=(ir<10)?("0"+ir):ir;s["%j"]=(dy<100)?((dy<10)?("00"+dy):("0"+dy)):dy;s["%k"]=hr;s["%l"]=ir;s["%m"]=(m<9)?("0"+(1+m)):(1+m);s["%M"]=(min<10)?("0"+min):min;s["%n"]="\n";s["%p"]=pm?"PM":"AM";s["%P"]=pm?"pm":"am";s["%s"]=Math.floor(this.getTime()/1000);s["%S"]=(sec<10)?("0"+sec):sec;s["%t"]="\t";s["%U"]=s["%W"]=s["%V"]=(wn<10)?("0"+wn):wn;s["%u"]=w+1;s["%w"]=w;s["%y"]=(""+y).substr(2,2);s["%Y"]=y;s["%%"]="%";return str.gsub(/%./,function(match){return s[match]||match})};Date.prototype.__msh_oldSetFullYear=Date.prototype.setFullYear;Date.prototype.setFullYear=function(y){var d=new Date(this);d.__msh_oldSetFullYear(y);if(d.getMonth()!=this.getMonth()){this.setDate(28)}this.__msh_oldSetFullYear(y)};Date.prototype.set=function(str){this.setDate(1);switch(str){case"+1m":this.setMonth(this.getMonth()+1);break;case"+2m":this.setMonth(this.getMonth()+2);break;case"-1m":this.setMonth(this.getMonth()-1);break;case"-2m":this.setMonth(this.getMonth()-2);break}return this};Calendar.lastDayOfMonth=function(month){var last_days={1:31,2:31,3:31,4:30,5:31,6:30,7:31,8:31,9:30,10:31,11:30,12:31};return last_days[month]};Event.observe(window,"load",function(){if(FlipKey.Cookie.read("ignored_browser_alert")){return true}function isVersionSupported(version,control,delimiter){if(!delimiter){delimiter="."}var version=version.split(delimiter);var control=control.split(delimiter);var version_size=version.length;var control_size=control.length;if(version_size<control_size){var length=version_size}else{var length=control_size}for(var i=0;i<length;i++){if(version[i]>control[i]){return true}if(version[i]<control[i]){return false}}if(version_size>=control_size){return true}else{return false}}var userAgent=navigator.userAgent.toLowerCase();var version=(userAgent.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1];var chrome=/chrome/.test(userAgent);var webkit=/webkit/.test(userAgent)&&!/chrome/.test(userAgent);var opera=/opera/.test(userAgent);var msie=/msie/.test(userAgent)&&!/opera/.test(userAgent);var mozilla=/mozilla/.test(userAgent)&&!/(compatible|webkit)/.test(userAgent);var incompatbility_msg="To ensure a high quality experience with Flipkey,<br /> please upgrade your browser to the latest version from one of the options below.<br /></br />";var browsers=[{logo:"/img/browsers/firefox.png",link:"http://www.mozilla.org/firefox/"},{logo:"/img/browsers/chrome.png",link:"http://google.com/chrome"},{logo:"/img/browsers/safari.png",link:"http://www.apple.com/safari/"},{logo:"/img/browsers/ie.png",link:"http://windows.microsoft.com/en-US/internet-explorer/products/ie/home"}];browsers.each(function(browser){img='<a href="'+browser.link+'" target="_blank"><img src="'+browser.logo+'"/></a>';incompatbility_msg+=img});if((msie&&!isVersionSupported(version,"8.0"))||(mozilla&&!isVersionSupported(version,"1.9.2"))){new AlertBar().show(incompatbility_msg,{alertType:"success",closeable:true,placement:"inline"})}});var dateFormat=function(){var token=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,timezone=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,timezoneClip=/[^-+\dA-Z]/g,pad=function(val,len){val=String(val);len=len||2;while(val.length<len){val="0"+val}return val};return function(date,mask,utc){var dF=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(date)=="[object String]"&&!/\d/.test(date)){mask=date;date=undefined}date=date?new Date(date):new Date;if(isNaN(date)){throw SyntaxError("invalid date")}mask=String(dF.masks[mask]||mask||dF.masks["default"]);if(mask.slice(0,4)=="UTC:"){mask=mask.slice(4);utc=true}var _=utc?"getUTC":"get",d=date[_+"Date"](),D=date[_+"Day"](),m=date[_+"Month"](),y=date[_+"FullYear"](),H=date[_+"Hours"](),M=date[_+"Minutes"](),s=date[_+"Seconds"](),L=date[_+"Milliseconds"](),o=utc?0:date.getTimezoneOffset(),flags={d:d,dd:pad(d),ddd:dF.i18n.dayNames[D],dddd:dF.i18n.dayNames[D+7],m:m+1,mm:pad(m+1),mmm:dF.i18n.monthNames[m],mmmm:dF.i18n.monthNames[m+12],yy:String(y).slice(2),yyyy:y,h:H%12||12,hh:pad(H%12||12),H:H,HH:pad(H),M:M,MM:pad(M),s:s,ss:pad(s),l:pad(L,3),L:pad(L>99?Math.round(L/10):L),t:H<12?"a":"p",tt:H<12?"am":"pm",T:H<12?"A":"P",TT:H<12?"AM":"PM",Z:utc?"UTC":(String(date).match(timezone)||[""]).pop().replace(timezoneClip,""),o:(o>0?"-":"+")+pad(Math.floor(Math.abs(o)/60)*100+Math.abs(o)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10]};return mask.replace(token,function($0){return $0 in flags?flags[$0]:$0.slice(1,$0.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.format=function(mask,utc){return dateFormat(this,mask,utc)};Element.addMethods({mailcheck:function(opts,optsAlt){var defaultDomains=["yahoo.com","google.com","hotmail.com","gmail.com","me.com","aol.com","mac.com","live.com","comcast.net","googlemail.com","msn.com","hotmail.co.uk","yahoo.co.uk","facebook.com","verizon.net","sbcglobal.net","att.net","gmx.com","mail.com"];var defaultTopLevelDomains=["co.uk","com","net","org","info","edu","gov","mil"];if(typeof optsAlt==="object"){opts.domains=opts.domains||defaultDomains}else{var domains=opts;opts=optsAlt;opts.domains=domains||defaultDomains}opts.topLevelDomains=defaultTopLevelDomains;opts.distanceFunction=Kicksend.sift3Distance;var result=Kicksend.mailcheck.suggest(encodeURI(opts.value),opts.domains,opts.topLevelDomains,opts.distanceFunction);if(result){if(optsAlt.suggested){optsAlt.suggested(this,result)}}else{if(optsAlt.empty){optsAlt.empty(this)}}}});var Kicksend={mailcheck:{threshold:3,suggest:function(email,domains,topLevelDomains,distanceFunction){email=email.toLowerCase();var emailParts=this.splitEmail(email);var closestDomain=this.findClosestDomain(emailParts.domain,domains,distanceFunction);if(closestDomain){if(closestDomain!=emailParts.domain){return{address:emailParts.address,domain:closestDomain,full:emailParts.address+"@"+closestDomain}}}else{var closestTopLevelDomain=this.findClosestDomain(emailParts.topLevelDomain,topLevelDomains);if(emailParts.domain&&closestTopLevelDomain&&closestTopLevelDomain!=emailParts.topLevelDomain){var domain=emailParts.domain;closestDomain=domain.substring(0,domain.lastIndexOf(emailParts.topLevelDomain))+closestTopLevelDomain;return{address:emailParts.address,domain:closestDomain,full:emailParts.address+"@"+closestDomain}}}return false},findClosestDomain:function(domain,domains,distanceFunction){var dist;var minDist=99;var closestDomain=null;if(!domain||!domains){return false}if(!distanceFunction){distanceFunction=this.sift3Distance}for(var i=0;i<domains.length;i++){if(domain===domains[i]){return domain}dist=distanceFunction(domain,domains[i]);if(dist<minDist){minDist=dist;closestDomain=domains[i]}}if(minDist<=this.threshold&&closestDomain!==null){return closestDomain}else{return false}},sift3Distance:function(s1,s2){if(s1==null||s1.length===0){if(s2==null||s2.length===0){return 0}else{return s2.length}}if(s2==null||s2.length===0){return s1.length}var c=0;var offset1=0;var offset2=0;var lcs=0;var maxOffset=5;while((c+offset1<s1.length)&&(c+offset2<s2.length)){if(s1.charAt(c+offset1)==s2.charAt(c+offset2)){lcs++}else{offset1=0;offset2=0;for(var i=0;i<maxOffset;i++){if((c+i<s1.length)&&(s1.charAt(c+i)==s2.charAt(c))){offset1=i;break}if((c+i<s2.length)&&(s1.charAt(c)==s2.charAt(c+i))){offset2=i;break}}}c++}return(s1.length+s2.length)/2-lcs},splitEmail:function(email){var parts=email.split("@");if(parts.length<2){return false}for(var i=0;i<parts.length;i++){if(parts[i]===""){return false}}var domain=parts.pop();var domainParts=domain.split(".");var tld="";if(domainParts.length==0){return false}else{if(domainParts.length==1){tld=domainParts[0]}else{for(var i=1;i<domainParts.length;i++){tld+=domainParts[i]+"."}if(domainParts.length>=2){tld=tld.substring(0,tld.length-1)}}}return{topLevelDomain:tld,domain:domain,address:parts.join("@")}}}};var swfobject=function(){var D="undefined",r="object",S="Shockwave Flash",W="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=false,U=[h],o=[],N=[],I=[],l,Q,E,B,J=false,a=false,n,G,m=true,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,ah=t.userAgent.toLowerCase(),Y=t.platform.toLowerCase(),ae=Y?/win/.test(Y):/win/.test(ah),ac=Y?/mac/.test(Y):/mac/.test(ah),af=/webkit/.test(ah)?parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,X=!+"\v1",ag=[0,0,0],ab=null;if(typeof t.plugins!=D&&typeof t.plugins[S]==r){ab=t.plugins[S].description;if(ab&&!(typeof t.mimeTypes!=D&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin)){T=true;X=false;ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10);ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10);ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof O.ActiveXObject!=D){try{var ad=new ActiveXObject(W);if(ad){ab=ad.GetVariable("$version");if(ab){X=true;ab=ab.split(" ")[1].split(",");ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}}catch(Z){}}}return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac}}(),k=function(){if(!M.w3){return}if((typeof j.readyState!=D&&j.readyState=="complete")||(typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body))){f()}if(!J){if(typeof j.addEventListener!=D){j.addEventListener("DOMContentLoaded",f,false)}if(M.ie&&M.win){j.attachEvent(x,function(){if(j.readyState=="complete"){j.detachEvent(x,arguments.callee);f()}});if(O==top){(function(){if(J){return}try{j.documentElement.doScroll("left")}catch(X){setTimeout(arguments.callee,0);return}f()})()}}if(M.wk){(function(){if(J){return}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}f()})()}s(f)}}();function f(){if(J){return}try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));Z.parentNode.removeChild(Z)}catch(aa){return}J=true;var X=U.length;for(var Y=0;Y<X;Y++){U[Y]()}}function K(X){if(J){X()}else{U[U.length]=X}}function s(Y){if(typeof O.addEventListener!=D){O.addEventListener("load",Y,false)}else{if(typeof j.addEventListener!=D){j.addEventListener("load",Y,false)}else{if(typeof O.attachEvent!=D){i(O,"onload",Y)}else{if(typeof O.onload=="function"){var X=O.onload;O.onload=function(){X();Y()}}else{O.onload=Y}}}}}function h(){if(T){V()}else{H()}}function V(){var X=j.getElementsByTagName("body")[0];var aa=C(r);aa.setAttribute("type",q);var Z=X.appendChild(aa);if(Z){var Y=0;(function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");if(ab){ab=ab.split(" ")[1].split(",");M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}else{if(Y<10){Y++;setTimeout(arguments.callee,10);return}}X.removeChild(aa);Z=null;H()})()}else{H()}}function H(){var ag=o.length;if(ag>0){for(var af=0;af<ag;af++){var Y=o[af].id;var ab=o[af].callbackFn;var aa={success:false,id:Y};if(M.pv[0]>0){var ae=c(Y);if(ae){if(F(o[af].swfVersion)&&!(M.wk&&M.wk<312)){w(Y,true);if(ab){aa.success=true;aa.ref=z(Y);ab(aa)}}else{if(o[af].expressInstall&&A()){var ai={};ai.data=o[af].expressInstall;ai.width=ae.getAttribute("width")||"0";ai.height=ae.getAttribute("height")||"0";if(ae.getAttribute("class")){ai.styleclass=ae.getAttribute("class")}if(ae.getAttribute("align")){ai.align=ae.getAttribute("align")}var ah={};var X=ae.getElementsByTagName("param");var ac=X.length;for(var ad=0;ad<ac;ad++){if(X[ad].getAttribute("name").toLowerCase()!="movie"){ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value")}}P(ai,ah,Y,ab)}else{p(ae);if(ab){ab(aa)}}}}}else{w(Y,true);if(ab){var Z=z(Y);if(Z&&typeof Z.SetVariable!=D){aa.success=true;aa.ref=Z}ab(aa)}}}}}function z(aa){var X=null;var Y=c(aa);if(Y&&Y.nodeName=="OBJECT"){if(typeof Y.SetVariable!=D){X=Y}else{var Z=Y.getElementsByTagName(r)[0];if(Z){X=Z}}}return X}function A(){return !a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312)}function P(aa,ab,X,Z){a=true;E=Z||null;B={success:false,id:X};var ae=c(X);if(ae){if(ae.nodeName=="OBJECT"){l=g(ae);Q=null}else{l=ae;Q=X}aa.id=R;if(typeof aa.width==D||(!/%$/.test(aa.width)&&parseInt(aa.width,10)<310)){aa.width="310"}if(typeof aa.height==D||(!/%$/.test(aa.height)&&parseInt(aa.height,10)<137)){aa.height="137"}j.title=j.title.slice(0,47)+" - Flash Player Installation";var ad=M.ie&&M.win?"ActiveX":"PlugIn",ac="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ad+"&MMdoctitle="+j.title;if(typeof ab.flashvars!=D){ab.flashvars+="&"+ac}else{ab.flashvars=ac}if(M.ie&&M.win&&ae.readyState!=4){var Y=C("div");X+="SWFObjectNew";Y.setAttribute("id",X);ae.parentNode.insertBefore(Y,ae);ae.style.display="none";(function(){if(ae.readyState==4){ae.parentNode.removeChild(ae)}else{setTimeout(arguments.callee,10)}})()}u(aa,ab,X)}}function p(Y){if(M.ie&&M.win&&Y.readyState!=4){var X=C("div");Y.parentNode.insertBefore(X,Y);X.parentNode.replaceChild(g(Y),X);Y.style.display="none";(function(){if(Y.readyState==4){Y.parentNode.removeChild(Y)}else{setTimeout(arguments.callee,10)}})()}else{Y.parentNode.replaceChild(g(Y),Y)}}function g(ab){var aa=C("div");if(M.win&&M.ie){aa.innerHTML=ab.innerHTML}else{var Y=ab.getElementsByTagName(r)[0];if(Y){var ad=Y.childNodes;if(ad){var X=ad.length;for(var Z=0;Z<X;Z++){if(!(ad[Z].nodeType==1&&ad[Z].nodeName=="PARAM")&&!(ad[Z].nodeType==8)){aa.appendChild(ad[Z].cloneNode(true))}}}}}return aa}function u(ai,ag,Y){var X,aa=c(Y);if(M.wk&&M.wk<312){return X}if(aa){if(typeof ai.id==D){ai.id=Y}if(M.ie&&M.win){var ah="";for(var ae in ai){if(ai[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="data"){ag.movie=ai[ae]}else{if(ae.toLowerCase()=="styleclass"){ah+=' class="'+ai[ae]+'"'}else{if(ae.toLowerCase()!="classid"){ah+=" "+ae+'="'+ai[ae]+'"'}}}}}var af="";for(var ad in ag){if(ag[ad]!=Object.prototype[ad]){af+='<param name="'+ad+'" value="'+ag[ad]+'" />'}}aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>";N[N.length]=ai.id;X=c(ai.id)}else{var Z=C(r);Z.setAttribute("type",q);for(var ac in ai){if(ai[ac]!=Object.prototype[ac]){if(ac.toLowerCase()=="styleclass"){Z.setAttribute("class",ai[ac])}else{if(ac.toLowerCase()!="classid"){Z.setAttribute(ac,ai[ac])}}}}for(var ab in ag){if(ag[ab]!=Object.prototype[ab]&&ab.toLowerCase()!="movie"){e(Z,ab,ag[ab])}}aa.parentNode.replaceChild(Z,aa);X=Z}}return X}function e(Z,X,Y){var aa=C("param");aa.setAttribute("name",X);aa.setAttribute("value",Y);Z.appendChild(aa)}function y(Y){var X=c(Y);if(X&&X.nodeName=="OBJECT"){if(M.ie&&M.win){X.style.display="none";(function(){if(X.readyState==4){b(Y)}else{setTimeout(arguments.callee,10)}})()}else{X.parentNode.removeChild(X)}}}function b(Z){var Y=c(Z);if(Y){for(var X in Y){if(typeof Y[X]=="function"){Y[X]=null}}Y.parentNode.removeChild(Y)}}function c(Z){var X=null;try{X=j.getElementById(Z)}catch(Y){}return X}function C(X){return j.createElement(X)}function i(Z,X,Y){Z.attachEvent(X,Y);I[I.length]=[Z,X,Y]}function F(Z){var Y=M.pv,X=Z.split(".");X[0]=parseInt(X[0],10);X[1]=parseInt(X[1],10)||0;X[2]=parseInt(X[2],10)||0;return(Y[0]>X[0]||(Y[0]==X[0]&&Y[1]>X[1])||(Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]))?true:false}function v(ac,Y,ad,ab){if(M.ie&&M.mac){return}var aa=j.getElementsByTagName("head")[0];if(!aa){return}var X=(ad&&typeof ad=="string")?ad:"screen";if(ab){n=null;G=null}if(!n||G!=X){var Z=C("style");Z.setAttribute("type","text/css");Z.setAttribute("media",X);n=aa.appendChild(Z);if(M.ie&&M.win&&typeof j.styleSheets!=D&&j.styleSheets.length>0){n=j.styleSheets[j.styleSheets.length-1]}G=X}if(M.ie&&M.win){if(n&&typeof n.addRule==r){n.addRule(ac,Y)}}else{if(n&&typeof j.createTextNode!=D){n.appendChild(j.createTextNode(ac+" {"+Y+"}"))}}}function w(Z,X){if(!m){return}var Y=X?"visible":"hidden";if(J&&c(Z)){c(Z).style.visibility=Y}else{v("#"+Z,"visibility:"+Y)}}function L(Y){var Z=/[\\\"<>\.;]/;var X=Z.exec(Y)!=null;return X&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y}var d=function(){if(M.ie&&M.win){window.attachEvent("onunload",function(){var ac=I.length;for(var ab=0;ab<ac;ab++){I[ab][0].detachEvent(I[ab][1],I[ab][2])}var Z=N.length;for(var aa=0;aa<Z;aa++){y(N[aa])}for(var Y in M){M[Y]=null}M=null;for(var X in swfobject){swfobject[X]=null}swfobject=null})}}();return{registerObject:function(ab,X,aa,Z){if(M.w3&&ab&&X){var Y={};Y.id=ab;Y.swfVersion=X;Y.expressInstall=aa;Y.callbackFn=Z;o[o.length]=Y;w(ab,false)}else{if(Z){Z({success:false,id:ab})}}},getObjectById:function(X){if(M.w3){return z(X)}},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:false,id:ah};if(M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y){w(ah,false);K(function(){ae+="";ag+="";var aj={};if(af&&typeof af===r){for(var al in af){aj[al]=af[al]}}aj.data=ab;aj.width=ae;aj.height=ag;var am={};if(ad&&typeof ad===r){for(var ak in ad){am[ak]=ad[ak]}}if(Z&&typeof Z===r){for(var ai in Z){if(typeof am.flashvars!=D){am.flashvars+="&"+ai+"="+Z[ai]}else{am.flashvars=ai+"="+Z[ai]}}}if(F(Y)){var an=u(aj,am,ah);if(aj.id==ah){w(ah,true)}X.success=true;X.ref=an}else{if(aa&&A()){aj.data=aa;P(aj,am,ah,ac);return}else{w(ah,true)}}if(ac){ac(X)}})}else{if(ac){ac(X)}}},switchOffAutoHideShow:function(){m=false},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]}},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){if(M.w3){return u(Z,Y,X)}else{return undefined}},showExpressInstall:function(Z,aa,X,Y){if(M.w3&&A()){P(Z,aa,X,Y)}},removeSWF:function(X){if(M.w3){y(X)}},createCSS:function(aa,Z,Y,X){if(M.w3){v(aa,Z,Y,X)}},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;if(Z){if(/\?/.test(Z)){Z=Z.split("?")[1]}if(aa==null){return L(Z)}var Y=Z.split("&");for(var X=0;X<Y.length;X++){if(Y[X].substring(0,Y[X].indexOf("="))==aa){return L(Y[X].substring((Y[X].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(a){var X=c(R);if(X&&l){X.parentNode.replaceChild(l,X);if(Q){w(Q,true);if(M.ie&&M.win){l.style.display="block"}}if(E){E(B)}}a=false}}}}();var _ec_history=0,_ec_tests=10,_ec_baseurl="/biscotti/",_fk_domain=window.location.host.slice(window.location.host.indexOf("."));function _ec_replace(str,key,value){if(str.indexOf("&"+key+"=")>-1||str.indexOf(key+"=")===0){var idx=str.indexOf("&"+key+"="),end,newstr;if(idx===-1){idx=str.indexOf(key+"=")}end=str.indexOf("&",idx+1);if(end!==-1){newstr=str.substr(0,idx)+str.substr(end+(idx?0:1))+"&"+key+"="+value}else{newstr=str.substr(0,idx)+"&"+key+"="+value}return newstr}else{return str+"&"+key+"="+value}}var _global_lso;function _biscotti_flash_var(cookie){_global_lso=cookie;var swf=document.getElementById("myswf");if(swf&&swf.parentNode){swf.parentNode.removeChild(swf)}}var _global_isolated;function onSilverlightLoad(sender,args){var control=sender.getHost();_global_isolated=control.Content.App.getIsolatedStorage()}function onSilverlightError(sender,args){_global_isolated=""}var biscotti=(function(window){var document=window.document,Image=window.Image,localStorage=window.localStorage,globalStorage=window.globalStorage,swfobject=window.swfobject;try{var sessionStorage=window.sessionStorage}catch(e){}this._class=function(){var self=this,_baseKeyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",no_color=-1;this._ec={};this.get=function(name,cb,dont_reset){self._biscotti(name,cb,undefined,undefined,dont_reset)};this.set=function(name,value){self._biscotti(name,function(){},value)};this._biscotti=function(name,cb,value,i,dont_reset){if(self._biscotti===undefined){self=this}if(i===undefined){i=0}if(i===0){self.biscotti_database_storage(name,value);self.biscotti_png(name,value);self.biscotti_etag(name,value);self.biscotti_cache(name,value);self.biscotti_lso(name,value);self._ec.userData=self.biscotti_userdata(name,value);self._ec.cookieData=self.biscotti_cookie(name,value);self._ec.localData=self.biscotti_local_storage(name,value);self._ec.globalData=self.biscotti_global_storage(name,value);self._ec.sessionData=self.biscotti_session_storage(name,value);self._ec.windowData=self.biscotti_window(name,value);if(_ec_history){self._ec.historyData=self.biscotti_history(name,value)}}if(value!==undefined){if((typeof _global_lso==="undefined"||typeof _global_isolated==="undefined")&&i++<_ec_tests){setTimeout(function(){self._biscotti(name,cb,value,i,dont_reset)},300)}}else{if(((window.openDatabase&&typeof self._ec.dbData==="undefined")||(typeof _global_lso==="undefined")||(typeof self._ec.etagData==="undefined")||(typeof self._ec.cacheData==="undefined")||(document.createElement("canvas").getContext&&(typeof self._ec.pngData==="undefined"||self._ec.pngData===""))||(typeof _global_isolated==="undefined"))&&i++<_ec_tests){setTimeout(function(){self._biscotti(name,cb,value,i,dont_reset)},300)}else{self._ec.lsoData=self.getFromStr(name,_global_lso);_global_lso=undefined;self._ec.slData=self.getFromStr(name,_global_isolated);_global_isolated=undefined;var tmpec=self._ec,candidates=[],bestnum=0,candidate,item;self._ec={};for(item in tmpec){if(tmpec[item]&&tmpec[item]!=="null"&&tmpec[item]!=="undefined"){candidates[tmpec[item]]=candidates[tmpec[item]]===undefined?1:candidates[tmpec[item]]+1}}for(item in candidates){if(candidates[item]>bestnum){bestnum=candidates[item];candidate=item}}if(candidate!==undefined&&(dont_reset===undefined||dont_reset!==1)){self.set(name,candidate)}if(typeof cb==="function"){cb(candidate,tmpec)}}}};this.biscotti_window=function(name,value){try{if(value!==undefined){window.name=_ec_replace(window.name,name,value)}else{return this.getFromStr(name,window.name)}}catch(e){}};this.biscotti_userdata=function(name,value){try{var elm=this.createElem("div","userdata_el",1);elm.style.behavior="url(#default#userData)";if(value!==undefined){elm.setAttribute(name,value);elm.save(name)}else{elm.load(name);return elm.getAttribute(name)}}catch(e){}};function newImage(src){var img=new Image();img.style.visibility="hidden";img.style.position="absolute";img.src=src}this.ajax=function(settings){var headers,name,transports,transport,i,length;headers={"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*"};transports=[function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(i=0,length=transports.length;i<length;i++){transport=transports[i];try{transport=transport();break}catch(e){}}transport.onreadystatechange=function(){if(transport.readyState!==4){return}settings.success(transport.responseText)};transport.open("get",settings.url,true);for(name in headers){transport.setRequestHeader(name,headers[name])}transport.send()};this.biscotti_cache=function(name,value){if(value!==undefined){document.cookie="biscotti_cache="+value+"; domain="+_fk_domain;newImage(_ec_baseurl+"biscotti_cache.php?name="+name)}else{var origvalue=this.getFromStr("biscotti_cache",document.cookie);self._ec.cacheData=undefined;document.cookie="biscotti_cache=; expires=Mon, 20 Sep 2010 00:00:00 UTC; path=/; domain="+_fk_domain;self.ajax({url:_ec_baseurl+"biscotti_cache.php?name="+name,success:function(data){document.cookie="biscotti_cache="+origvalue+"; expires=Tue, 31 Dec 2030 00:00:00 UTC; path=/; domain="+_fk_domain;self._ec.cacheData=data}})}};this.biscotti_etag=function(name,value){if(value!==undefined){document.cookie="biscotti_etag="+value+"; domain="+_fk_domain;newImage(_ec_baseurl+"biscotti_etag.php?name="+name)}else{var origvalue=this.getFromStr("biscotti_etag",document.cookie);self._ec.etagData=undefined;document.cookie="biscotti_etag=; expires=Mon, 20 Sep 2010 00:00:00 UTC; path=/; domain="+_fk_domain;self.ajax({url:_ec_baseurl+"biscotti_etag.php?name="+name,success:function(data){document.cookie="biscotti_etag="+origvalue+"; expires=Tue, 31 Dec 2030 00:00:00 UTC; path=/; domain="+_fk_domain;self._ec.etagData=data}})}};this.biscotti_lso=function(name,value){var div=document.getElementById("swfcontainer"),flashvars={},params={},attributes={};if(!div){div=document.createElement("div");div.setAttribute("id","swfcontainer");document.body.appendChild(div)}if(value!==undefined){flashvars.everdata=name+"="+value}params.swliveconnect="true";attributes.id="myswf";attributes.name="myswf";swfobject.embedSWF(_ec_baseurl+"biscotti.swf","swfcontainer","1","1","9.0.0",false,flashvars,params,attributes)};this.biscotti_png=function(name,value){var canvas=document.createElement("canvas"),img,ctx,origvalue;canvas.style.visibility="hidden";canvas.style.position="absolute";canvas.width=200;canvas.height=1;if(canvas&&canvas.getContext){img=new Image();img.style.visibility="hidden";img.style.position="absolute";if(value!==undefined){document.cookie="biscotti_png="+value+"; domain="+_fk_domain}else{self._ec.pngData=undefined;ctx=canvas.getContext("2d");origvalue=this.getFromStr("biscotti_png",document.cookie);document.cookie="biscotti_png=; expires=Mon, 20 Sep 2010 00:00:00 UTC; path=/; domain="+_fk_domain;img.onload=function(){document.cookie="biscotti_png="+origvalue+"; expires=Tue, 31 Dec 2030 00:00:00 UTC; path=/; domain="+_fk_domain;self._ec.pngData="";ctx.drawImage(img,0,0);var imgd=ctx.getImageData(0,0,200,1),pix=imgd.data,i,n;for(i=0,n=pix.length;i<n;i+=4){if(pix[i]===0){break}self._ec.pngData+=String.fromCharCode(pix[i]);if(pix[i+1]===0){break}self._ec.pngData+=String.fromCharCode(pix[i+1]);if(pix[i+2]===0){break}self._ec.pngData+=String.fromCharCode(pix[i+2])}}}img.src=_ec_baseurl+"biscotti_png.php?name="+name}};this.biscotti_local_storage=function(name,value){try{if(localStorage){if(value!==undefined){localStorage.setItem(name,value)}else{return localStorage.getItem(name)}}}catch(e){}};this.biscotti_database_storage=function(name,value){try{if(window.openDatabase){var database=window.openDatabase("sqlite_biscotti","","biscotti",1024*1024);if(value!==undefined){database.transaction(function(tx){tx.executeSql("CREATE TABLE IF NOT EXISTS cache(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, value TEXT NOT NULL, UNIQUE (name))",[],function(tx,rs){},function(tx,err){});tx.executeSql("INSERT OR REPLACE INTO cache(name, value) VALUES(?, ?)",[name,value],function(tx,rs){},function(tx,err){})})}else{database.transaction(function(tx){tx.executeSql("SELECT value FROM cache WHERE name=?",[name],function(tx,result1){if(result1.rows.length>=1){self._ec.dbData=result1.rows.item(0).value}else{self._ec.dbData=""}},function(tx,err){})})}}}catch(e){}};this.biscotti_session_storage=function(name,value){try{if(sessionStorage){if(value!==undefined){sessionStorage.setItem(name,value)}else{return sessionStorage.getItem(name)}}}catch(e){}};this.biscotti_global_storage=function(name,value){if(globalStorage){var host=this.getHost();try{if(value!==undefined){globalStorage[host][name]=value}else{return globalStorage[host][name]}}catch(e){}}};this.biscotti_silverlight=function(name,value){var source=_ec_baseurl+"biscotti.xap",minver="4.0.50401.0",initParam="",html;if(value!==undefined){initParam='<param name="initParams" value="'+name+"="+value+'" />'}html='<object data="data:application/x-silverlight-2," type="application/x-silverlight-2" id="mysilverlight" width="0" height="0">'+initParam+'<param name="source" value="'+source+'"/><param name="onLoad" value="onSilverlightLoad"/><param name="onError" value="onSilverlightError"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="minRuntimeVersion" value="'+minver+'"/><param name="autoUpgrade" value="true"/><a href="http://go.microsoft.com/fwlink/?LinkID=149156&v='+minver+'" style="text-decoration:none">Get Microsoft Silverlight</a></object>';document.body.innerHTML+=html};this.encode=function(input){var output="",chr1,chr2,chr3,enc1,enc2,enc3,enc4,i=0;input=this._utf8_encode(input);while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=((chr1&3)<<4)|(chr2>>4);enc3=((chr2&15)<<2)|(chr3>>6);enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64}else{if(isNaN(chr3)){enc4=64}}output=output+_baseKeyStr.charAt(enc1)+_baseKeyStr.charAt(enc2)+_baseKeyStr.charAt(enc3)+_baseKeyStr.charAt(enc4)}return output};this.decode=function(input){var output="",chr1,chr2,chr3,enc1,enc2,enc3,enc4,i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length){enc1=_baseKeyStr.indexOf(input.charAt(i++));enc2=_baseKeyStr.indexOf(input.charAt(i++));enc3=_baseKeyStr.indexOf(input.charAt(i++));enc4=_baseKeyStr.indexOf(input.charAt(i++));chr1=(enc1<<2)|(enc2>>4);chr2=((enc2&15)<<4)|(enc3>>2);chr3=((enc3&3)<<6)|enc4;output=output+String.fromCharCode(chr1);if(enc3!==64){output=output+String.fromCharCode(chr2)}if(enc4!==64){output=output+String.fromCharCode(chr3)}}output=this._utf8_decode(output);return output};this._utf8_encode=function(str){str=str.replace(/\r\n/g,"\n");var utftext="",i=0,n=str.length,c;for(;i<n;i++){c=str.charCodeAt(i);if(c<128){utftext+=String.fromCharCode(c)}else{if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128)}else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128)}}}return utftext};this._utf8_decode=function(utftext){var str="",i=0,n=utftext.length,c=0,c1=0,c2=0,c3=0;while(i<n){c=utftext.charCodeAt(i);if(c<128){str+=String.fromCharCode(c);i+=1}else{if((c>191)&&(c<224)){c2=utftext.charCodeAt(i+1);str+=String.fromCharCode(((c&31)<<6)|(c2&63));i+=2}else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);str+=String.fromCharCode(((c&15)<<12)|((c2&63)<<6)|(c3&63));i+=3}}}return str};this.biscotti_history=function(name,value){var baseElems=(_baseKeyStr+"-").split(""),url="http://www.google.com/biscotti/cache/"+this.getHost()+"/"+name,i,base,letter="",val="",found=1;if(value!==undefined){if(this.hasVisited(url)){return}this.createIframe(url,"if");url=url+"/";base=this.encode(value).split("");for(i=0;i<base.length;i++){url=url+base[i];this.createIframe(url,"if"+i)}url=url+"-";this.createIframe(url,"if_")}else{if(this.hasVisited(url)){url=url+"/";while(letter!=="-"&&found===1){found=0;for(i=0;i<baseElems.length;i++){if(this.hasVisited(url+baseElems[i])){letter=baseElems[i];if(letter!=="-"){val=val+letter}url=url+letter;found=1;break}}}return this.decode(val)}}};this.createElem=function(type,name,append){var el;if(name!==undefined&&document.getElementById(name)){el=document.getElementById(name)}else{el=document.createElement(type)}el.style.visibility="hidden";el.style.position="absolute";if(name){el.setAttribute("id",name)}if(append){document.body.appendChild(el)}return el};this.createIframe=function(url,name){var el=this.createElem("iframe",name,1);el.setAttribute("src",url);return el};var waitForSwf=this.waitForSwf=function(i){if(i===undefined){i=0}else{i++}if(i<_ec_tests&&typeof swfobject==="undefined"){setTimeout(function(){waitForSwf(i)},300)}};this.biscotti_cookie=function(name,value){if(value!==undefined){document.cookie=name+"=; expires=Mon, 20 Sep 2010 00:00:00 UTC; path=/; domain="+_fk_domain;document.cookie=name+"="+value+"; expires=Tue, 31 Dec 2030 00:00:00 UTC; path=/; domain="+_fk_domain}else{return this.getFromStr(name,document.cookie)}};this.getFromStr=function(name,text){if(typeof text!=="string"){return}var nameEQ=name+"=",ca=text.split(/[;&]/),i,c;for(i=0;i<ca.length;i++){c=ca[i];while(c.charAt(0)===" "){c=c.substring(1,c.length)}if(c.indexOf(nameEQ)===0){return c.substring(nameEQ.length,c.length)}}};this.getHost=function(){return window.location.host.replace(/:\d+/,"")};this.toHex=function(str){var r="",e=str.length,c=0,h;while(c<e){h=str.charCodeAt(c++).toString(16);while(h.length<2){h="0"+h}r+=h}return r};this.fromHex=function(str){var r="",e=str.length,s;while(e>=0){s=e-2;r=String.fromCharCode("0x"+str.substring(s,e))+r;e=s}return r};this.hasVisited=function(url){if(this.no_color===-1){var no_style=this._getRGB("http://samy-was-here-this-should-never-be-visited.com",-1);if(no_style===-1){this.no_color=this._getRGB("http://samy-was-here-"+Math.floor(Math.random()*9999999)+"rand.com")}}if(url.indexOf("https:")===0||url.indexOf("http:")===0){return this._testURL(url,this.no_color)}return this._testURL("http://"+url,this.no_color)||this._testURL("https://"+url,this.no_color)||this._testURL("http://www."+url,this.no_color)||this._testURL("https://www."+url,this.no_color)};var _link=this.createElem("a","_ec_rgb_link"),created_style,_cssText="#_ec_rgb_link:visited{display:none;color:#FF0000}",style;try{created_style=1;style=document.createElement("style");if(style.styleSheet){style.styleSheet.innerHTML=_cssText}else{if(style.innerHTML){style.innerHTML=_cssText}else{style.appendChild(document.createTextNode(_cssText))}}}catch(e){created_style=0}this._getRGB=function(u,test_color){if(test_color&&created_style===0){return -1}_link.href=u;_link.innerHTML=u;document.body.appendChild(style);document.body.appendChild(_link);var color;if(document.defaultView){color=document.defaultView.getComputedStyle(_link,null).getPropertyValue("color")}else{color=_link.currentStyle.color}return color};this._testURL=function(url,no_color){var color=this._getRGB(url);if(color==="rgb(255, 0, 0)"||color==="#ff0000"){return 1}else{if(no_color&&color!==no_color){return 1}}return 0}};return this._class}(window));Event.observe(document,"dom:loaded",function(event){if(FlipKey.user===1||FlipKey.biscotti===1){var fkbiscotti=FlipKey.Cookie.read("fkbiscotti");if(FlipKey.biscotti!==1&&fkbiscotti&&fkbiscotti.match(/[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}/)&&Math.floor((Math.random()*10)+1)!==6){return}else{var almond=new biscotti();almond.get("fkbiscotti",function(best_candidate){if(FlipKey.biscotti===1||!best_candidate||!best_candidate.match(/[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}/)){almond.ajax({url:"/biscotti/registerMachine/",success:function(data){if(data){data=data.evalJSON()}if(data.error===undefined&&data.key!==undefined){almond.set("fkbiscotti",data.key)}}})}})}}});(function(){FlipKey.UI=FlipKey.UI||{};UI=UI||FlipKey.UI;UI.fadeIn=function(el,duration,callback){UI._fadeAbstract(el,duration,1,callback)};UI.fadeOut=function(el,duration,callback){UI._fadeAbstract(el,duration,0,callback)};UI._fadeAbstract=function(el,duration,endPoint,callback){el=(typeof el=="string")?$(el):el;if(!el){return}if(typeof duration=="undefined"||typeof duration=="object"){duration=200}var opacityChange=1/(duration/20);var op=el.getStyle("opacity");if(endPoint==1){op+=opacityChange;if(op>0.98){op=endPoint}}else{op-=opacityChange;if(op<0.02){op=endPoint}}el.setStyle({opacity:op});if(op==endPoint){if(typeof callback=="function"){callback()}}else{window.setTimeout(function(){UI._fadeAbstract(el,duration,endPoint,callback)},20)}}})();(function(){FlipKey=FlipKey||{};FlipKey.UI=FlipKey.UI||{};FlipKey.UI.ChronosCalendar=function(id){this.id=id;this.property_summary=null;this.calendar=null;this.next=null;this.previous=null;this.tooltip=null;this.cell_dimensions=null;this.rate_arrow_top=null;this.months_displayed=0;this.total_months=0;this.current_start_month=0;this.current_end_month=1;this.months={};this.highlight_dates=false;this.has_paginated=false;this.calendar_mouseout_timeout=null;this.init()};FlipKey.UI.ChronosCalendar.prototype={init:function(){this.property_summary=$("property-summary");this.calendar=$("chronos-calendar-"+this.id);this.next=$("chronos-next-"+this.id);this.previous=$("chronos-previous-"+this.id);this.tooltip=$("chronos-tooltip-"+this.id);this.jump_menu=$("chronos-jump-menu-"+this.id);this.current_start_month=+this.calendar.getAttribute("data-start-displayed-months");this.current_end_month=+this.calendar.getAttribute("data-end-displayed-months");this.months_displayed=+this.calendar.getAttribute("data-months-displayed");this.total_months=+this.calendar.select(".chronos-month").size();this.show_rates=this.calendar.getAttribute("data-show-rates")==="1";this.highlight_dates=this.calendar.hasClassName("highlight-dates-of-stay");this.show_availability_on_partial_month=this.calendar.hasClassName("show-availability-on-partial-month");this.edit_mode=this.calendar.getAttribute("data-edit-mode")==="1";this.cellsByDate=$H({});this.cells=[];var m;for(m=0;m<this.total_months;m+=1){this.months[m]=$("chronos-month-"+m+"-"+this.id)}this.initCells();this.initJumpMenu();this.startObservations();if(typeof this.calendar.onselectstart!=="undefined"){this.calendar.onselectstart=function(){return false}}else{if(typeof this.calendar.style.MozUserSelect!=="undefined"){this.calendar.style.MozUserSelect="none"}else{this.calendar.onmousedown=function(){return false}}}this.refresh()},initCells:function(){this.calendar.select(".chronos-7-cell").filter(this.isLiveCell.bind(this)).each(function(element){var date=element.readAttribute("data-date");if(this.cellsByDate.include(date)){this.cellsByDate[date].push(element)}else{this.cellsByDate[date]=[element]}this.cells.push(element);element.writeAttribute("data-cell",this.cells.length-1)}.bind(this))},initJumpMenu:function(){if(this.jump_menu==null){return}var m;for(m=0;m<this.total_months;m+=1){var label=this.months[m].select(".chronos-month-label")[0].innerHTML;var option=new Element("option",{value:m}).update(label);this.jump_menu.insert(option)}},startNavigationObservations:function(){if(this.next){this.next.on("click",function(event){this.moveCalendar(this.months_displayed)}.bind(this))}if(this.previous){this.previous.on("click",function(event){this.moveCalendar(this.months_displayed*-1)}.bind(this))}if(this.jump_menu){this.jump_menu.on("change",function(event,element){var group_start_month=Math.floor(element.value/this.months_displayed)*this.months_displayed;this.moveCalendar(group_start_month-this.current_start_month)}.bind(this))}},startObservations:function(){this.startNavigationObservations();this.calendar.on("mouseover",".chronos-7-cell",function(event,element){var min_rate,max_rate,date,rate,availability,cell_offsets,tooltip_dimensions;if(this.isLiveCell(element)){if(element.hasAttribute("data-min-rate")){min_rate=element.getAttribute("data-min-rate")}if(element.hasAttribute("data-max-rate")){max_rate=element.getAttribute("data-max-rate")}date=element.getAttribute("data-date");if(element.hasClassName("available")){availability="available"}else{availability="unavailable"}if((typeof min_rate!=="undefined"&&min_rate!=="")||(typeof max_rate!=="undefined"&&max_rate!=="")){min_rate=FlipKey.Currency.format(FlipKey.Currency.exchange(min_rate));max_rate=FlipKey.Currency.format(FlipKey.Currency.exchange(max_rate));if(min_rate===max_rate){rate=min_rate}else{rate=min_rate+"-"+max_rate}}else{rate="No Rate Provided"}date=date.split("-");date=new Date(date[0],date[1]-1,date[2]);var tooltip_html='<div class="chronos-tooltip-date">'+date.format("UTC:mmmm d, yyyy")+'</div><div class="chronos-tooltip-availability price-'+availability+'">'+availability.toUpperCase()+"</div>";var availability_source_label=element.readAttribute("data-availability-source");if(this.edit_mode&&availability_source_label){tooltip_html+='<div class="chronos-booking-source">(on '+availability_source_label+")</div>"}if(this.show_rates){tooltip_html+='<div class="chronos-rates">'+rate+"</div>"}tooltip_html+='<div class="chronos-rate-arrow"></div>';this.tooltip.update(tooltip_html);if(this.cell_dimensions===null){this.cell_dimensions=element.getDimensions()}if(this.rate_arrow_top===null){this.rate_arrow_top=+Selector.findChildElements(this.tooltip,[".chronos-rate-arrow"])[0].getStyle("top").slice(0,-2)||0}tooltip_dimensions=this.tooltip.getDimensions();var property_summary_top=0;var property_summary_left=0;if(this.property_summary&&this.property_summary.scrollTop){property_summary_top=this.property_summary.scrollTop}if(this.property_summary&&this.property_summary.scrollLeft){property_summary_left=this.property_summary.scrollLeft}this.tooltip.setStyle({top:(element.offsetTop-property_summary_top-tooltip_dimensions.height-this.rate_arrow_top)+"px",left:Math.round(element.offsetLeft-property_summary_left-(tooltip_dimensions.width/2)+(this.cell_dimensions.width/2))+"px"});this.tooltip.show()}}.bind(this));this.calendar.on("mouseout",".chronos-7-cell",function(event,element){this.tooltip.hide()}.bind(this));if(this.highlight_dates){this.calendar.on("mouseover",function(event,element){this.calendar.addClassName("activated");if(this.calendar_mouseout_timeout){clearTimeout(this.calendar_mouseout_timeout);this.calendar_mouseout_timeout=null}}.bind(this));this.calendar.on("mouseout",function(event,element){var remove_activated_timeout;if(this.has_paginated===false){remove_activated_timeout=function(){this.calendar.removeClassName("activated")}.bind(this);this.calendar_mouseout_timeout=setTimeout(remove_activated_timeout,2000)}}.bind(this))}if(this.edit_mode){this.startEditModeObservations()}},startEditModeObservations:function(){this.calendar.on("mousedown",".chronos-7-cell",function(event,element){if(!this.isLiveCell(element)){return}var availability;if(element.hasClassName("available")){availability="unavailable"}else{if(element.hasClassName("unavailable")){availability="available"}else{throw"Date is marked neither available nor unavailable"}}var start_cell=element;var select_queue=new FlipKey.UI.ChronosCalendar.Queue({interval:100});select_queue.start().push(this.select.bind(this).curry(start_cell,start_cell,availability));var mouse_over_handler=this.calendar.on("mouseover",".chronos-7-cell",function(event,end_cell){if(!this.isLiveCell(end_cell)){return}select_queue.push(this.select.bind(this).curry(start_cell,end_cell,availability))}.bind(this));this.calendar.on("mouseup",".chronos-7-cell",function(event,element){if(!this.isLiveCell(element)){return}select_queue.push(this.modifySelection.bind(this).curry(availability))}.bind(this));document.on("mouseup",function(){mouse_over_handler.stop();select_queue.push(this.refreshSelection.bind(this)).stop()}.bind(this))}.bind(this));this.calendar.on("click",".chronos-mark-month button",function(event,element){var availability;if(element.hasClassName("chronos-mark-month-available")){availability="available"}else{if(element.hasClassName("chronos-mark-month-unavailable")){availability="unavailable"}else{throw"Unknown month marking button clicked"}}this.getCellsInMonth(element).setAvailability(availability).showAvailability(availability).setModified(availability)}.bind(this))},moveCalendar:function(delta){var first_month=0;var last_month=this.total_months-1;if(delta<=0&&this.current_start_month===first_month){return}if(delta>=0&&this.current_end_month===last_month){return}this.has_paginated=true;this.current_start_month+=delta;this.current_end_month+=delta;this.refresh()},refresh:function(){var first_month=0;var last_month=this.total_months-1;if(this.hasNavigationButtons()){this.enableIf(this.current_start_month!==first_month,this.previous);this.enableIf(this.current_end_month!==last_month,this.next)}var m;for(m in this.months){m=+m;if(m<this.current_start_month||m>this.current_end_month){$(this.months[m]).hide()}else{$(this.months[m]).show()}}},enableIf:function(bool,el){if(bool){this.enable(el)}else{this.disable(el)}},enable:function(el){var enabled_classes=$(el).getAttribute("data-enabled-classes");var disabled_classes=$(el).getAttribute("data-disabled-classes");$(el).addClassName(enabled_classes).removeClassName(disabled_classes)},disable:function(el){var enabled_classes=$(el).getAttribute("data-enabled-classes");var disabled_classes=$(el).getAttribute("data-disabled-classes");$(el).removeClassName(enabled_classes).addClassName(disabled_classes)},hasNavigationButtons:function(){return this.next&&this.previous},isLiveCell:function(element){return !element.hasClassName("past-date")&&(!element.hasClassName("partial-month")||this.show_availability_on_partial_month)&&element.hasAttribute("data-date")},getCells:function(elements){return new FlipKey.UI.ChronosCalendar.Cells(elements)},getAllCells:function(){return this.getCells(this.cells)},getSelectedCells:function(){return this.getCells(this.calendar.select(".selected"))},getModifiedCells:function(){return this.getCells(this.calendar.select(".chronos-7-cell.modified"))},getCellsInDateRange:function(start_cell,end_cell){var start_cell=parseInt(start_cell.getAttribute("data-cell"));var end_cell=parseInt(end_cell.getAttribute("data-cell"));if(end_cell<start_cell){var tmp=start_cell;start_cell=end_cell;end_cell=tmp}return this.getCells(this.cells.slice(start_cell,end_cell+1))},getCellsInMonth:function(element){var cells=element.up(".chronos-month").select(".chronos-7-cell").filter(this.isLiveCell.bind(this));return this.getCells(cells)},getCellsByDate:function(date){return this.getCells(this.cellsByDate[date]||[])},select:function(start_cell,end_cell,availability){this.getSelectedCells().refreshAvailability().unselect();this.getCellsInDateRange(start_cell,end_cell).select(availability).showAvailability(availability);return this},modifySelection:function(availability){this.getSelectedCells().setAvailability(availability).setModified(availability);return this},refreshSelection:function(){this.getSelectedCells().refreshAvailability().unselect();return this},getModifiedDates:function(){return this.getModifiedCells().getExport()},markModifiedDatesAsSaved:function(){return this.getModifiedCells().saveAvailability().clearModifications()},resetSavedAvailability:function(data){var cells=this.getAllCells();cells.clearSavedAvailability().clearAvailabilitySource().refreshAvailability();this.updateAvailability(data);cells.updateModified();return this},updateAvailability:function(data){if(!("calendar_dates" in data)){return this}data.calendar_dates.each(function(day){var external_calendar_label="FlipKey";if(day.external_calendar_id){external_calendar_label=data.external_calendars[day.external_calendar_id]["label"]}this.getCellsByDate(day.date).setAvailability(day.availability).saveAvailability().showAvailability(day.availability).setAvailabilitySource(external_calendar_label)}.bind(this));return this}};FlipKey.UI.ChronosCalendar.Cells=function(elements){this.elements=elements};FlipKey.UI.ChronosCalendar.Cells.prototype={setModified:function(new_availability){this.elements.each(function(element){if(new_availability!=element.getAttribute("data-saved-availability")){element.addClassName("modified")}}.bind(this));return this},updateModified:function(){this.elements.each(function(element){if(element.getAttribute("data-availability")==element.getAttribute("data-saved-availability")){element.removeClassName("modified")}else{element.addClassName("modified")}}.bind(this));return this},clearModifications:function(){this.elements.each(function(element){element.removeClassName("modified")}.bind(this));return this},saveAvailability:function(){this.elements.each(function(element){element.writeAttribute("data-saved-availability",element.getAttribute("data-availability"))}.bind(this));return this},setAvailability:function(availability){this.elements.each(function(element){element.writeAttribute("data-availability",availability)}.bind(this));return this},setAvailabilityUsingModified:function(){this.elements.each(function(element){if(!element.hasClassName("modified")){element.writeAttribute("data-availability",element.getAttribute("data-saved-availability"))}}.bind(this));return this},setSavedAvailability:function(availability){this.elements.each(function(element){element.writeAttribute("data-saved-availability",availability)}.bind(this));return this},clearSavedAvailability:function(){this.setSavedAvailability("available").setAvailabilityUsingModified();return this},refreshAvailability:function(){this.elements.each(function(element){this._showAvailability(element,element.readAttribute("data-availability")||"available")}.bind(this));return this},showAvailability:function(availability){this.elements.each(function(element){this._showAvailability(element,availability)}.bind(this));return this},showAvailabilityIfUnmodified:function(availability){this.elements.each(function(element){if(!element.hasClassName("modified")){this._showAvailability(element,availability)}}.bind(this));return this},select:function(){this.elements.each(function(element){element.addClassName("selected")}.bind(this));return this},unselect:function(){this.elements.each(function(element){element.removeClassName("selected")}.bind(this));return this},setAvailabilitySource:function(label){this.elements.each(function(element){element.writeAttribute("data-availability-source",label)}.bind(this));return this},clearAvailabilitySource:function(){this.elements.each(function(element){element.writeAttribute("data-availability-source",null)}.bind(this));return this},getExport:function(){return this.elements.collect(function(element){return{date:element.readAttribute("data-date"),availability:element.readAttribute("data-availability")}}.bind(this))},_showAvailability:function(element,availability){switch(availability){case"available":element.addClassName("available").removeClassName("unavailable");break;case"unavailable":element.removeClassName("available").addClassName("unavailable");break;default:throw"Unknown availability status specified"}}};FlipKey.UI.ChronosCalendar.Queue=function(options){this.options=options};FlipKey.UI.ChronosCalendar.Queue.prototype={start:function(){this.queue=[];this.stopping=false;this.running=true;this.interval=setInterval(function(){if(this.processing){return}if(this.stopping){clearInterval(this.interval);this.stopping=false;this.running=false}this.process()}.bind(this),this.options.interval);return this},stop:function(){if(this.running){this.stopping=true}return this},push:function(callback){this.queue.push(callback);return this},process:function(){this.processing=true;this.queue.each(function(task){task()});this.processing=false;return this}}}());(function(){UI=UI||{};UI.Paginator=function(el,params){this._params={onLoad:null};this._el=null;this._control=null;this._items=null;this._initialize(el,params)};UI.Paginator.prototype={_initialize:function(el,params){this._el=(typeof el=="string")?$(el):el;if(!this._el){return false}this._el.style.overflow="hidden";this._params=$H(this._params).merge(params)._object;var controlParams=$H(this._params).merge({onChange:this.loadPage,context:this})._object;this._control=new UI.PaginatorControl(controlParams);this._el.insert({after:this._control.getElement()});if(!Object.isString(this._params.action)){this._items=this._el.children;this._control._current.page=0;this._control.goToPage(this._control._current.page)}if(typeof this._params.onLoad=="function"){this._params.onLoad(this,this._control,{page:this._control._current.page})}},loadPage:function(page){if(this._items&&this._items.length){if(this._items.length<=this._control._params.perPage){return}for(var i=0;i<this._items.length;i++){if(i>this._control._params.perPage*(page-1)-1&&i<this._control._params.perPage*page){this._items[i].style.display=""}else{this._items[i].style.display="none"}}if(typeof this._params.onLoad=="function"){this._params.onLoad(this,this._control,{page:page})}}}};UI.PaginatorControl=function(params){this._params={current:1,count:1,perPage:5,pageNumbers:5,strict:false,prevText:"&#x25C0;",nextText:"&#x25B6;",summaryText:null,onChange:null,context:null,className:null,scrollTo:null};this._el=null;this._initialize(params)};UI.PaginatorControl.prototype={_initialize:function(params){if(params.context&&typeof params.onChange=="function"){params.onChange=params.onChange.bind(params.context)}this._params=$H(this._params).merge(params)._object;this._current={page:this._params.current,start:null,end:null};this._params.pages=Math.ceil(this._params.count/this._params.perPage);if(this._params.pages==0){this._params.pages=1}this.updateList()},_generateNumbers:function(){var start=0,end=0,numbers=[];start=this._current.page;if(start>1){start=start-Math.floor(this._params.pageNumbers/2)}if(start<1){start=1}end=start+this._params.pageNumbers-1;if(end>this._params.pages){end=this._params.pages;start=end-this._params.pageNumbers+1;if(start<1){start=1}}for(var i=start;i<=end;i++){numbers.push(this._generateItem(i))}return numbers},_generateItem:function(pageNumber,text){var className="";var disabled=false;if(pageNumber=="prev"){className="prev";disabled=this._current.page==1}else{if(pageNumber=="next"){className="next";disabled=this._current.page==this._params.pages}else{if(pageNumber=="none"){className="descriptor"}else{if(pageNumber=="none-left"){className="descriptor-left"}else{if(pageNumber=="none-right"){className="descriptor-right"}else{disabled=pageNumber==this._current.page}}}}}if(disabled){className=(className?className+" ":"")+"current"}if(typeof text=="undefined"){text=pageNumber}if(pageNumber=="none"||pageNumber=="none-left"||pageNumber=="none-right"){var link=Builder.node("span").update(text)}else{var attributes={href:"javascript:void(0)"};if(disabled){attributes.disabled="disabled"}var link=Builder.node("a",attributes).update(text);link.on("click",function(){this.goToPage(pageNumber)}.bind(this))}return Builder.node("li",{"class":className},link)},getElement:function(){return this._el},updateList:function(){var prevCount=this._current.page==1?0:this._params.perPage;var nextCount=this._current.page==this._params.pages?0:this._params.perPage;if(this._current.page==this._params.pages-1&&this._params.count%this._params.perPage>0){nextCount=this._params.count%this._params.perPage}var startCount=(this._current.page-1)*this._params.perPage+1;var endCount=startCount+this._params.perPage-1;if(endCount>this._params.count){endCount=this._params.count}var list=Builder.node("ul");if(!this._params.strict||prevCount>0){var prevText=this._params.prevText.valueOf().replace("[count]",prevCount);var prev=this._generateItem("prev",prevText);list.insert(prev)}if(this._params.pageNumbers>0){var numbers=this._generateNumbers();numbers.each(function(number){list.insert(number)})}if(!this._params.strict||nextCount>0){var nextText=this._params.nextText.valueOf().replace("[count]",nextCount);list.insert(this._generateItem("next",nextText))}this._current.start=startCount;this._current.end=endCount;var summary=null;if(this._params.summaryText){var summaryText=this.getSummary(this._params.summaryText);summary=Builder.node("span",{"class":"summary"}).update(summaryText)}if(this._el){this._el.update(list)}else{var className="paginator";if(this._params.className){className+=" "+this._params.className}this._el=Builder.node("div",{"class":className},list)}if(summary){this._el.insert(summary)}},getSummary:function(summaryText){return summaryText.valueOf().replace("[start]",this._current.start).replace("[end]",this._current.end).replace("[count]",this._params.count).replace("[page]",this._current.page).replace("[pages]",this._params.pages)},goToPage:function(page){if(page=="prev"){page=this._current.page-1}else{if(page=="next"){page=this._current.page+1}}if(page<1){page=1}else{if(page>this._params.pages){page=this._params.pages}}if(page==this._current.page){return false}var success=true;if(success){this._current.page=page;this.updateList();if(this._params.scrollTo){scrollTo(0,$(this._params.scrollTo).offsetTop)}}if(typeof this._params.onChange=="function"){success=this._params.onChange(page)!==false}}}})();(function(){UI=UI||{};UI.ProgressMeter=function(el,params){this._params={percentComplete:0,decimals:0,onChange:null,animated:true,bgAnimated:true,fps:60};this._els={wrapper:null,meter:null,text1:null,text2:null};this._updateHandle=null;this._animationHandle=null;this._precision=1;this._initialize(el,params)};UI.ProgressMeter.prototype={_initialize:function(el,params){el=$(el);if(!el){return false}this._els.wrapper=el;if(!this._els.wrapper.hasClassName("progressmeter")){this._els.wrapper.addClassName("progressmeter")}this._params=$H(this._params).merge(params)._object;if(!isNaN(this._params.decimals)&&this._params.decimals>0){this._precision=Math.pow(10,this._params.decimals)}this._initializeElements();this.update(this._params.percentComplete)},_initializeElements:function(){var textParams={className:"progress",style:"width:"+(this._els.wrapper.getWidth()-2)+"px;height:"+(this._els.wrapper.getHeight()-2)+"px;line-height:"+(this._els.wrapper.getHeight()-2)+"px;"};this._els.text1=Builder.node("span",textParams,"");this._els.text2=Builder.node("span",textParams,"");this._els.meter=Builder.node("div",{className:"progressbar"});if(this._params.bgAnimated){this._els.animation=Builder.node("div",{className:"animation"},[this._els.text2]);this._els.meter.insert(this._els.animation);this._startBgAnimation()}else{this._els.meter.insert(this._els.text2)}this._els.wrapper.insert(this._els.text1);this._els.wrapper.insert(this._els.meter)},setProgress:function(percentComplete){this.update(percentComplete)},getProgress:function(){return this._params.percentComplete},update:function(percentComplete){if(!percentComplete||isNaN(percentComplete)){percentComplete=0}percentComplete=Math.round(percentComplete*this._precision)/this._precision;this._params.percentComplete=percentComplete;this._updateText();if(this._params.animated){this._animateMeter()}else{this._updateMeter()}if(typeof this._params.onChange=="function"){this._params.onChange(percentComplete)}},_updateText:function(){var progress=""+this._params.percentComplete+"% complete";this._els.text1.update(progress);this._els.text2.update(progress)},_updateMeter:function(percentComplete){if(typeof percentComplete=="undefined"||isNaN(percentComplete)){percentComplete=this._params.percentComplete}var visibility=percentComplete>0?"block":"none";this._els.meter.setStyle({width:""+percentComplete+"%",display:visibility});if(percentComplete<100){if(!this._els.meter.hasClassName("incomplete")){this._els.meter.addClassName("incomplete")}if(this._params.bgAnimated&&!this._animationHandle){this._startBgAnimation()}}else{if(this._els.meter.hasClassName("incomplete")){this._els.meter.removeClassName("incomplete")}if(this._params.bgAnimated&&this._animationHandle){this._stopBgAnimation()}}},_animateMeter:function(){var percentComplete=this._params.percentComplete;if(this._updateHandle){window.clearTimeout(this._updateHandle);this._updateHandle=null}var oldComplete=this._els.meter.getWidth()*100/this._els.wrapper.getWidth();var currentComplete=percentComplete/2+oldComplete/2;currentComplete=Math.ceil(currentComplete*this._precision)/this._precision;if(Math.abs(currentComplete-oldComplete)<1){currentComplete=percentComplete}this._updateMeter(currentComplete);if(currentComplete!=percentComplete){this._updateHandle=window.setTimeout(function(){this._animateMeter(percentComplete)}.bind(this),Math.round(1000/this._params.fps))}},_startBgAnimation:function(){this._els.animation.setStyle({backgroundPosition:"0px 0px",backgroundRepeat:"repeat"});this._animationHandle=window.setInterval(function(){var xPos=0,yPos=0;var pos=this._els.animation.getStyle("background-position");pos=pos.split(" ");if(pos.length==2){xPos=parseInt(pos[0]);yPos=parseInt(pos[1]);xPos++}this._els.animation.setStyle({backgroundPosition:""+xPos+"px "+yPos+"px"})}.bind(this),20)},_stopBgAnimation:function(){this._els.animation.setStyle({backgroundPosition:"-100px -100px",backgroundRepeat:"no-repeat"});window.clearInterval(this._animationHandle);this._animationHandle=null}}}());(function(){UI=UI||{};UI.DataGrid=function(el,params){this._params={};this._table=null;this._rows=[];this._controls={};this._cols=[];this._expandable=false;this._initialize(el,params)};UI.DataGrid.prototype={_initialize:function(el,params){this._table=(typeof el=="string")?$(el):el;if(!this._table){return false}this._params=$H(this._params).merge(params)._object;this._expandable=this._table.select(".optional,.controls").size();if(this._expandable){this._table.insert({top:Builder.node("col",{width:40})});this._table.select("> thead > tr").each(function(tr){tr.insert({top:Builder.node("th")})})}this._table.tHead.on("click",function(e){var th=e.findElement("th");if(th.hasClassName("sortable")){this._sortBy(th)}}.bind(this));var i=this._expandable?1:0;this._table.select("thead th").each(function(th){th.writeAttribute("onselectstart","return false");if(th.hasClassName("sortable")){th.writeAttribute("data-col",i);th.insert('<span class="asc"> </span><span class="desc"> </span>');this._cols[i]={name:th.readAttribute("data-name"),type:th.readAttribute("data-type")};i++}}.bind(this));var cols=this._table.select("> thead > tr > th").length;this._table.select("> tbody > tr").each(function(tr){if(this._expandable){if(tr.hasClassName("controls")){tr.writeAttribute("onselectstart","return false;");var td=tr.down();if(td.readAttribute("colspan")!=cols){td.writeAttribute("colspan",cols)}this._controls[tr.identify()]=tr}else{var togglerClass="general-datagrid-more-off";if(tr.select(".optional").size()){togglerClass="general-datagrid-more-on";tr.addClassName("expandable")}tr.insert({top:Builder.node("td",{className:"toggler",onselectstart:"return false;"},[Builder.node("span",{className:togglerClass})])})}}if(!tr.hasClassName.controls){i=0;tr.select("> td").each(function(td){td.writeAttribute("data-col",i);if(this._cols[i]){td.writeAttribute("data-type",this._cols[i].type);td.writeAttribute("data-name",this._cols[i].name);if(this._cols[i].type=="string"){var val=td.readAttribute("data-value");td.writeAttribute("data-value",UI.DataFilter.formatStringForComparison(val))}}i++}.bind(this))}}.bind(this));if(this._expandable){this._table.tBodies[0].on("click",this._toggleRow.bind(this))}this._refreshDataRows();this._addRowStriping();this._addCellStriping()},sortBy:function(columnName){var th=this._table.select('th[data-name="'+columnName+'"]');if(th&&th.length){this._sortBy(th[0])}},_sortBy:function(th){if(!th){return null}var sorted=0;if(th.hasClassName("sorted-asc")){sorted=1}else{if(th.hasClassName("sorted-desc")){sorted=-1}}var direction=sorted==-1?1:-1;var type=th.readAttribute("data-type");var col=th.readAttribute("data-col");if(sorted==0){this._rows.sort(function(a,b){if(a.childElements().length<=col||b.childElements().length<=col){return 0}var aVal=a.childElements()[col].readAttribute("data-value");var bVal=b.childElements()[col].readAttribute("data-value");var comp=0;switch(type){case"numeric-range":aVal=aVal.split("-");bVal=bVal.split("-");if(aVal.length==2){if(bVal.length==2){if(+aVal[0]>+bVal[0]){comp=direction}else{if(+aVal[0]<+bVal[0]){comp=-direction}else{comp=+aVal[1]>+bVal[1]?direction:-direction}}}}break;case"numeric":comp=+aVal>+bVal?direction:-direction;break;case"string":comp=aVal>bVal?direction:-direction;break;case"date":aVal=new Date(aVal);bVal=new Date(bVal);comp=aVal.getTime()>bVal.getTime()?direction:-direction;break}return comp})}else{this._rows.reverse()}this._table.tBodies[0].update("");this._closeAllRows();this._rows.each(function(row){this._table.tBodies[0].appendChild(row);var controls=this._controls[row.readAttribute("data-controls")];if(controls){this._table.tBodies[0].appendChild(controls)}}.bind(this));this._addRowStriping();th.up().childElements().each(function(el){el.removeClassName("sorted-asc");el.removeClassName("sorted-desc")});if(direction==1){th.addClassName("sorted-asc")}else{th.addClassName("sorted-desc")}},_toggleRow:function(e,el){var row=(el.tagName.toLowerCase()=="tr")?el:el.up("tr");if(row.hasClassName("controls")){return}var isOpen=row.hasClassName("expanded");this._closeAllRows();if(isOpen){row.removeClassName("expanded");row.down().down().writeAttribute("class","general-datagrid-more-on");this._hideControls(row)}else{row.addClassName("expanded");row.down().down().writeAttribute("class","general-datagrid-less-on");this._showControls(row)}},_showControls:function(row){var controls=this._controls[row.readAttribute("data-controls")];if(controls&&typeof controls.visible=="function"&&!controls.visible()){controls.show()}},_hideControls:function(row){var controls=this._controls[row.readAttribute("data-controls")];if(controls&&typeof controls.visible=="function"&&controls.visible()){controls.hide()}},_closeAllRows:function(){this._table.select("> tbody > tr.expanded").each(function(row){row.removeClassName("expanded");row.down().down().writeAttribute("class","general-datagrid-more-on");this._hideControls(row)}.bind(this))},_refreshDataRows:function(){this._rows=$A(this._table.select('> tbody > tr[class!="controls"]'))},_addRowStriping:function(){var i=1;var last=null;this._table.select("> tbody > tr").each(function(row){if(row.hasClassName("controls")){row.hide();return}if(!row.visible()){return}row.removeClassName("expanded");row.removeClassName("odd");row.removeClassName("even");row.removeClassName("first");row.removeClassName("last");if(i==1){row.addClassName("first")}if(i++%2){row.addClassName("odd")}else{row.addClassName("even")}last=row});if(last){last.addClassName("last")}},_addCellStriping:function(cells){if(typeof cells=="undefined"){this._table.select("> thead > tr, > tbody > tr").each(function(row){this._addCellStriping($(row).select(">th,>td"))}.bind(this))}else{var i=1;var last=null;cells.each(function(cell){if(i==1){cell.addClassName("first")}cell.addClassName(i++%2?"odd":"even");last=cell});if(last){last.addClassName("last")}}},addRow:function(data){var cells=[];for(var i in data){var value=data[i].value?data[i].value:data[i];var content=data[i].content?data[i].content:data[i];cells.push(Builder.node("td",{"data-value":value},content))}this._rows.push(cells);this._table.tBodies[0].insert(Builder.node("tr",{},cells));this._refreshDataRows();this._addRowStriping();this._addCellStriping(cells)},filter:function(filters){this._closeAllRows();var results=0;this._rows.each(function(row){var pass=true;for(var col in filters){var rules=filters[col];if(typeof col=="string"){col=row.select('td[data-name="'+col+'"]');if(col){col=col[0]}}else{col=row[col]}if(col){var value=this.getCellValue(col);if(col.readAttribute("data-type")=="string"){for(var rule in rules){rules[rule]=UI.DataFilter.formatStringForComparison(rules[rule])}}pass=pass&&UI.DataFilter.test(value,rules)}else{pass=false}if(!pass){break}}if(!pass){row.hide()}else{results++;row.show()}}.bind(this));this._addRowStriping();return results},getCellValue:function(cell,type){if(!cell||!cell.readAttribute){return}var value=cell.readAttribute("data-value");switch(cell.readAttribute("data-type")){case"numeric":value=+value;break;case"string":break;case"date":value=new Date(value);break;case"numeric-range":value=value.split("-");value=value.collect(function(val){return +val});break;case"date-range":value=value.split("-");for(var i in value){value[i]=new Date(value[i])}}return value}}})();(function(){UI=UI||{};UI.DataFilter={filter:function(dataToFilter,whereClause,orderClause){var filteredData=[];for(var i=0;i<dataToFilter.length;i++){var pass=true;var datum=dataToFilter[i];for(var criteria in whereClause){var value;eval("value = datum."+criteria+";");var rules=whereClause[criteria];pass=pass&&UI.DataFilter.test(value,rules)}if(pass){filteredData.push(datum)}}return filteredData},test:function(value,rules){var pass=true;for(var rule in rules){if(typeof value=="object"&&value.length){var iPass=false;if(typeof value.each=="function"){value.each(function(val){iPass=iPass||UI.DataFilter.testRule(val,rule,rules[rule])})}else{for(var i in value){iPass=iPass||UI.DataFilter.testRule(value[i],rule,rules[rule]);if(iPass){break}}}pass=pass&&iPass}else{pass=pass&&UI.DataFilter.testRule(value,rule,rules[rule])}if(!pass){break}}return pass},testRule:function(value,rule,ruleValue){switch(rule){case"eq":return value==ruleValue;break;case"gt":return value>ruleValue;break;case"gte":return value>=ruleValue;break;case"lt":return value<ruleValue;break;case"lte":return value<=ruleValue;break;case"in":if(typeof ruleValue=="object"&&ruleValue.length){var inPass=false;for(var i in ruleValue){inPass=inPass||value==ruleValue[i]}return inPass}else{return value==ruleValue}break;case"between":if(ruleValue.length!=2){return false}return value>=ruleValue[0]&&value<=ruleValue[1];break;case"before":case"before-eq":case"after":case"after-eq":var date1=new Date(value);var date2=new Date(ruleValue);var parts=value.split(/[\.\/\-]/);var pass=parts[0]*1==date1.getMonth()+1&&parts[1]*1==date1.getDate()&&parts[2]*1==date1.getFullYear();if(pass){var diff=(Math.floor(date2.getTime()/86400000)-Math.floor(date1.getTime()/86400000));switch(rule){case"before":pass=pass&&diff>0;break;case"before-eq":pass=pass&&diff>=0;break;case"after":pass=pass&&diff<0;break;case"after-eq":pass=pass&&diff<=0;break}}return pass;break}},formatStringForComparison:function(val){if(typeof val=="object"&&val.length){if(typeof val.collect=="function"){val.collect(function(v){return UI.DataFilter.formatStringForComparison(v)}.bind(this))}else{for(var i in val){val[i]=UI.DataFilter.formatStringForComparison(val[i])}}return val}else{return val.toLowerCase().replace(/[^\w]+/g,"")}}}})();(function(){UI=UI||{};UI.PhoneFormatter=function(el,params){this.defaultparams={country_code:{value:"US"}};this.initialize(el,params)};UI.PhoneFormatter.prototype={initialize:function(el,params){this.el={};this.params={};if(params=={}){params=this.defaultparams}this.el=el;this.params=params;Event.observe(params.country_code,"change",this.format_field.bind(this),false);Event.observe(el,"change",this.format_field.bind(this),false);Event.observe(el,"keyup",this.format_field.bind(this),false)},format_field:function(){var f,output,m_strOut,i,val,last_char,number,phoneUtil;if(this.params.country_code.value==""){this.params.country_code.value=this.defaultparams.country_code.value}if(this.params.country_code.value!==undefined||this.params.country_code.value!==null||this.params.country_code.value>0){var phone_country_id=this.params.country_code.value;switch(phone_country_id){case"SW":case"EN":case"UK":phone_country_id="GB";break;case"DR":phone_country_id="DO";break}f=new i18n.phonenumbers.AsYouTypeFormatter(phone_country_id);f.clear();output="";m_strOut=new String(this.el.value);m_strOut=m_strOut.replace(/[^\+\s\(\)ext\.0-9]/g,"");for(i=0;i<m_strOut.length;i++){output=f.inputDigit(m_strOut.substr(i,1))}this.el.value=output.toString();this.el.focus();last_char=m_strOut.substr(m_strOut.length-1,1);if(last_char!==" "&&last_char!=="e"&&last_char!=="x"&&last_char!=="t"&&last_char!=="."){phoneUtil=i18n.phonenumbers.PhoneNumberUtil.getInstance();try{number=phoneUtil.parse(this.el.value,phone_country_id);if(number.hasCountryCode()&&phoneUtil.isValidNumber(number)){this.el.value=phoneUtil.format(number,1);this.el.focus}}catch(e){}}}}}})();(function(){UI=UI||{};UI.StickyBox=function(el,params){this._el=null;this._layout={};this._groundLevel=0;this._currentState="unlocked";this._defaultStyle="";this._params={stickyOffset:true,marginTop:0,marginBottom:0,groundElement:null,centerElement:"header",jiggle:false,onChangeState:null};this._lockStates=["unlocked","top-locked","bottom-locked","grounded","jiggling"];this._initialize(el,params)};UI.StickyBox.prototype={_initialize:function(el,params){try{if(Object.isString(el)){el=$(el)}}catch(e){}if(Object.isElement(el)){this._el=el}else{return false}if(!UI.StickyBox.boxes){UI.StickyBox.boxes={}}UI.StickyBox.boxes[this._el.identify()]=this;this._params=$H(this._params).merge(params)._object;this.initializeLayout(this._el,$(this._params.centerElement));this.setGroundLevel();this._defaultStyle=this._el.readAttribute("style");Event.observe(window,"scroll",function(e){var scrollY=document.viewport.getScrollOffsets()[1];var currentTop=scrollY+this._params.marginTop;var currentBottom=scrollY+this._layout.height+this._params.marginBottom;if(this._groundLevel&&currentBottom>this._groundLevel){this.ground()}else{if(currentTop>this._layout.top){this.topLock()}else{this.unlock()}}}.bind(this))},setParam:function(key,val){this._params[key]=val},setGroundLevel:function(){if(this._params.groundElement){this._params.groundElement=$(this._params.groundElement);if(this._el.descendantOf(this._params.groundElement)){this._groundLevel=this._params.groundElement.getHeight()+this._params.groundElement.cumulativeOffset()[1]}else{this._groundLevel=this._params.groundElement.cumulativeOffset()[1]}}else{this._groundLevel=0}this._groundLevel=Math.abs(this._groundLevel)},refreshLayout:function(){this.setGroundLevel()},initializeLayout:function(el,center){if(center){var width=center.getWidth();var left=center.cumulativeOffset()[0]}var pos=el.cumulativeOffset();var layout=el.getLayout();this._layout={left:left,top:pos[1],width:width,height:el.getHeight(),padLeft:pos[0]-left};this.lockWrapper=Builder.node("div");this._el.wrap(this.lockWrapper);if(this._params.stickyOffset&&!this.hasOffset()){this.replacementNode=Builder.node("div",{style:"width:"+el.getWidth()+"px;height:"+el.getHeight()+"px;margin:"+layout.get("margin-top")+"px "+layout.get("margin-right")+"px "+layout.get("margin-bottom")+"px "+layout.get("margin-left")+"px;"});this.replacementNode.hide();this.lockWrapper.insert({after:this.replacementNode})}},isInState:function(state){return this._currentState==state},setState:function(state){this._currentState=state;this._lockStates.each(function(s){if(this.lockWrapper.hasClassName(s)){this.lockWrapper.removeClassName(s)}}.bind(this));this.lockWrapper.addClassName(state);if(typeof this._params.onChangeState=="function"){this._params.onChangeState(state)}},unlock:function(){if(!this.isInState("unlocked")){this.lockWrapper.setStyle({position:"",top:"",margin:""});this.removeOffset();this.setState("unlocked")}},topLock:function(){if(!this.isInState("top-locked")){this.lockWrapper.setStyle({position:"fixed",top:this._params.marginTop+"px",margin:"0 auto"});this.createOffset();this.setState("top-locked")}},ground:function(){if(!this._groundLevel){return}console.log(this._groundLevel);if(!this.isInState("grounded")){this.lockWrapper.setStyle({position:"absolute",top:(this._groundLevel-this._layout.height-this._params.marginBottom)+"px",margin:"0 auto"});this.setState("grounded")}},createOffset:function(){this.replacementNode.show()},removeOffset:function(){if(this.hasOffset()){this.replacementNode.hide()}},hasOffset:function(){return this.replacementNode&&this.replacementNode.remove}}})();(function(){UI=UI||{};UI.ScrollNav=function(el,params){this._links=null;this._fragmentLoader=null;this._fragments=null;this._current=null;this._params={speed:0.5,fps:20,offset:0,autoSwitch:true,autoSwitchOffset:25,arrow:null,linkParents:false,hooks:[]};this._animationStack=[];this._initialize(el,params)};UI.ScrollNav.prototype={_initialize:function(el,params){var id=Math.round(Math.random()*1000000)+"-"+Math.round(Math.random()*1000000);this._id=id;this._fragments={};this._params=$H(this._params).merge(params)._object;if(Object.isString(el)){var selector=el;try{el=$(selector)}catch(e){el=null}if(!el||!Object.isElement(el)){el=$$(selector)}}var links=[];if(Object.isArray(el)){if(el.length==0){return}else{if(el.length==1){el=el[0]}else{el.each(function(e){if(e.tagName&&e.tagName.toLowerCase()=="a"){links.push(e)}else{e.select("a").each(function(a){links.push(a)})}})}}}if(Object.isElement(el)){if(el.tagName&&el.tagName.toLowerCase()=="a"){links=[el]}else{links=el.select("a")}}if(links.length){this._links=links}else{return false}this._links.each(this.initLink.bind(this));if(this._params.hooks){this.hookIntoLink(this._params.hooks)}if(this._params.autoSwitch!=false){Event.observe(window,"scroll",function(e){var scrollY=document.viewport.getScrollOffsets()[1];for(var i in this._fragments){if(scrollY>=this._fragments[i].fragTop-this._params.offset-this._params.autoSwitchOffset&&scrollY<=this._fragments[i].fragBottom-this._params.offset-this._params.autoSwitchOffset&&!this._fragments[i].el.hasClassName("selected")){for(var j in this._fragments){if(this._fragments[j].el.hasClassName("selected")){this._fragments[j].el.removeClassName("selected")}}this._fragments[i].el.addClassName("selected");this._current=this._fragments[i];break}}}.bind(this))}},initLink:function(el){var href=el.readAttribute("href");if(/#[A-Za-z0-9\-\_]+/.test(href)){var fragment=$(href.substr(1));if(fragment){el.writeAttribute("href","javascript:void(0)");var wrapper=el.up();wrapper.writeAttribute("onselectstart","return false");this.addFragment(href,wrapper,fragment);var observer;if(this._params.linkParents){observer=wrapper}else{observer=el}observer.observe("click",function(e){this.loadFragment(href)}.bind(this))}}},hookIntoLink:function(el){if(Object.isString(el)){var selector=el;try{el=$(selector)}catch(e){el=null}if(!el||!Object.isElement(el)){el=$$(selector)}}if(Object.isArray(el)){if(el.length>1){el.each(this.hookIntoLink.bind(this));return}else{if(el.length){el=el[0]}else{return}}}if(!Object.isElement(el)||!el.observe){return false}var hash=el.readAttribute("href");if(this._fragments[hash]){el.writeAttribute("href","javascript:void(0)").observe("click",function(){this.loadFragment(hash)}.bind(this))}},refreshFragments:function(){for(var hash in this._fragments){var fragment=this._fragments[hash].frag;this._fragments[hash].fragTop=Math.abs(fragment.cumulativeOffset()[1]);this._fragments[hash].fragBottom=Math.abs(fragment.cumulativeOffset()[1]+fragment.getHeight())}},addFragment:function(hash,link,fragment){if(this._fragments[hash]){return}this._fragments[hash]={frag:fragment,fragTop:Math.abs(fragment.cumulativeOffset()[1]),fragBottom:Math.abs(fragment.cumulativeOffset()[1]+fragment.getHeight()),el:link,linkLeft:link.cumulativeOffset()[0],linkRight:link.cumulativeOffset()[0]+link.getWidth()}},loadFragment:function(hash){var steps=Math.ceil(this._params.duration*this._params.fps/1000);if(steps==0){steps=1}var scrollPos=document.viewport.getScrollOffsets();var blockPos=10;if(this._fragments[hash]){var blockPos=this._fragments[hash].fragTop}else{if(hash.substr(0,1)=="#"){hash=hash.substr(1)}var fragment=$(hash);if(fragment){blockPos=Math.abs(fragment.cumulativeOffset()[1])}}blockPos-=this._params.offset;var delta=blockPos-scrollPos[1];var ts=this._getTimestamp()+20;var i=0;while(Math.abs(delta)>1){delta=delta*(1-this._params.speed);var newY=blockPos-delta;this._animationStack.push({timestamp:ts+(1000/this._params.fps*(i+1)),newPosition:[scrollPos[0],newY]});i++}this._animate()},_animate:function(){if(this._animationStack&&this._animationStack.length){var ts=this._getTimestamp();var next=this._animationStack.shift();while(this._animationStack.length&&next.timestamp<ts){next=this._animationStack.shift()}next=next.newPosition;window.scrollTo(next[0],next[1]);window.setTimeout(this._animate.bind(this),1000/this._params.fps)}},_getTimestamp:function(){var dt=new Date();return dt.getHours()*3600000+dt.getMinutes()*60000+dt.getSeconds()*1000+dt.getMilliseconds()}}})();(function(){FlipKey=FlipKey||{};FlipKey.Form=FlipKey.Form||{};FlipKey.Form=function(el,params){this._form=null;this._formattedInputs={};this._validator=null;this._submitting=false;this._params={onValidate:null};this._initialize(el,params)};FlipKey.Form.prototype={_initialize:function(el,params){this._params=$H(this._params).merge(params)._object;this._form=typeof el=="string"?$(el):el;if(!this._form){throw"Invalid form element provided: "+el}this.buttons=this._form.getElementsBySelector("button");this.updateValidation();this.updateFormatters();this._form.getElementsBySelector("table.radiolist, table.checklist").each(function(table){table.on("click",function(e,el){var clickedRow=e.findElement("tr");if(clickedRow){var selectedInput=clickedRow.getElementsBySelector("input[type=radio],input[type=checkbox]").first();if(selectedInput){selectedInput.checked=true}}})});this._form.on("submit",this._onSubmit.bind(this))},_onSubmit:function(e){var success=this.validate(e);if(success){this._lock();if(this._params.ajax){e.stop();var postAction=this._form.readAttribute("action");if(this._params.ajax.action){postAction=this._params.ajax.action}FlipKey.Ajax.request(postAction,{parameters:this._form.serialize(true),onComplete:function(response){this._unlock();this._params.ajax.onComplete(response)}.bind(this),onSuccess:this._params.ajax.onSuccess,onFailure:this._params.ajax.onFailure,onException:this._params.ajax.onException,on401:this._params.ajax.on401,updater:this._params.ajax.updater,request:this._params.ajax.request,alertFromJSON:this._params.ajax.alertFromJSON,alertBarRequest:this._params.ajax.alertBarRequest})}}},_lock:function(){this._submitting=true;this.buttons.each(function(button){button.addClassName("button-disabled");button.disabled=true}.bind(this));if(this._params.throbber!="none"&&this.buttons[0]){var throbber=Builder.node("span",{id:"submit_throbber","class":"fk-form-throbber"},[Builder.node("img",{src:"/img/house-throbber-32x32.gif"}),Builder.node("p",{"class":"inline"},[Builder.node("span",{"class":"processing_text"}).insert("Processing...")])]);if(this._params.throbber==="left"){this.buttons[0].insert({before:throbber})}else{this.buttons[0].insert({after:throbber})}}},_unlock:function(){this._submitting=false;this.buttons.each(function(button){button.removeClassName("button-disabled");button.disabled=false}.bind(this));this._form.getElementsBySelector(".fk-form-throbber").each(function(el){el.remove()})},addElement:function(el){if(!Object.isElement(el)){el=$(el)}if(!el){return}var id=el.identify();var len=el.attributes.length;for(var i=0;i<len;i++){var name=el.attributes.item(i).nodeName.split("-");if(name.length>1&&name[0]=="data"){if(FlipKey.Form.Validator.isValidationRule(name[1])){var rule=el.attributes.item(i).nodeName.substring(5);var msg=el.attributes.item(i).nodeValue;this._validator.addRule(id,rule,msg)}else{if(name[0]=="prompt"){new FlipKey.Form.Prompt(el)}}}}},addRule:function(el,rule,message){var ruleParts=rule.split("-");if(ruleParts.length<2){return}if(ruleParts[0]=="data"){ruleParts.splice(0,1)}if(!FlipKey.Form.Validator.isValidationRule(ruleParts[0])){return}var i,nodeName,oldRule,count=el.attributes.length,rules={};for(i=0;i<count;i++){if(!el.attributes.item(i)){continue}nodeName=el.attributes.item(i).nodeName;oldRule=nodeName.split("-");if(oldRule.length>1&&oldRule[0]=="data"&&FlipKey.Form.Validator.isValidationRule(oldRule[1])&&oldRule[1]==ruleParts[0]){el.removeAttribute(nodeName)}}el.writeAttribute("data-"+rule,message);this._validator.addRule(el.identify(),rule,message)},removeRule:function(el,rule){var ruleParts=rule.split("-");if(!ruleParts.length){return}var i,nodeName,oldRule,count=el.attributes.length;for(i=0;i<count;i++){if(!el.attributes.item(i)){continue}nodeName=el.attributes.item(i).nodeName;oldRule=nodeName.split("-");if(oldRule.length>1&&oldRule[0]=="data"&&oldRule[1]==ruleParts[0]){el.removeAttribute(nodeName)}}this._validator.removeRule(el.identify(),rule)},isSubmitting:function(){return this._submitting},disableSubmit:function(){},enableSubmit:function(){},updateValidation:function(){this._validator=new FlipKey.Form.Validator({},{form:this._form,onComplete:this._params.onValidate});this._form.getElementsBySelector("input,select,textarea,button").each(function(el){this.addElement(el)}.bind(this))},updateFormatters:function(){this._form.getElementsBySelector("input[data-format]").each(function(el){var format=el.getAttribute("data-format");if(!format){return}format=format.split("::");var params={};if(format.length==2){try{params=eval(format[1]);if(typeof params!="object"){params={}}}catch(e){_e("Failed to format input params: "+e)}}switch(format[0]){case"currency":if(!this._formattedInputs.currency){this._formattedInputs.currency=[]}this._formattedInputs.currency.push(new FlipKey.Form.CurrencyInput(el,params));break;case"phone":break;case"optional":if(!this._formattedInputs.optional){this._formattedInputs.optional=[]}this._formattedInputs.optional.push(new FlipKey.Form.OptionalListInput(el,params));break}}.bind(this))},renderExternalErrors:function(errors){this._validator.renderExternalErrors(errors)},validate:function(e){var success=this._validator.validate();if(!success&&e&&e.stop){e.stop()}return success},getData:function(){return this._form.serialize(true)}}})();(function(){FlipKey=FlipKey||{};FlipKey.Form=FlipKey.Form||{};FlipKey.Form.Utils={renderPrompts:function(form){if(typeof form=="string"){form=$(form)}if(!form||!form.getInputs){return}form.getInputs("text").each(function(input){new FlipKey.Form.Prompt(input)})},refreshPrompts:function(){FlipKey.Form.Prompt.refreshAll()},getCheckboxValue:function(form,checkboxOrGroupName){form=typeof form=="string"?$(form):form;if(!form||!form.tagName){return}var value;form.getInputs("checkbox",checkboxOrGroupName).each(function(check){if(check.checked){if(value){if(typeof value!="array"){value=[value]}value.push(check.value)}else{value=check.value}}});return value},getRadioValue:function(formOrInput,radioGroupName){var el=typeof formOrInput=="string"?$(formOrInput):formOrInput;if(!el||!el.tagName){return}if(el.type&&el.type.toLowerCase()=="radio"){radioGroupName=el.name;el=el.form}else{if(el.tagName.toLowerCase()!="form"){return false}}var checked=el.getInputs("radio",radioGroupName).find(function(re){return re.checked});return(checked)?$F(checked):null},setRadioValue:function(formOrInput,radioGroupName,value){var el=typeof formOrInput=="string"?$(formOrInput):formOrInput;if(!el||!el.tagName){return}if(el.type&&el.type.toLowerCase()=="radio"){radioGroupName=el.name;el=el.form}else{if(el.tagName.toLowerCase()!="form"){return}}el.getInputs("radio",radioGroupName).each(function(radio){if(radio.value==value){radio.checked=true}})},getCaretPos:function(txtbox){if(txtbox.selectionStart!=undefined){return txtbox.selectionStart}else{if(document.selection){return FlipKey.Form.Utils.getCaretPosIE(txtbox)}}},setCaretPos:function(el,caretPos){if(document.selection){var sel=document.selection.createRange();sel.moveStart("character",-el.value.length);sel.moveStart("character",caretPos);sel.moveEnd("character",0);sel.select()}else{el.selectionStart=caretPos;el.selectionEnd=caretPos;el.focus()}},getCaretPosIE:function(txtbox){var caret,range,textInputRange,len,endRange;range=document.selection.createRange();if(range&&range.parentElement()==txtbox){len=txtbox.value.length;textInputRange=txtbox.createTextRange();textInputRange.moveToBookmark(range.getBookmark());endRange=txtbox.createTextRange();if(endRange.collapse){endRange.collapse(false)}if(textInputRange.compareEndPoints("StartToEnd",endRange)>-1){caret=txtbox.value.replace(/\r\n/g,"\n").length}else{caret=-textInputRange.moveStart("character",-len)}}return caret},getCharPressed:function(event){if(event.which==null||event.which==0){if(event.charCode){return String.fromCharCode(event.charCode)}}else{if(event.which!=0&&event.charCode!=0){return String.fromCharCode(event.which)}}return null},visible:function(el){var isVisible=el.visible();var pt=el.up();while(isVisible&&pt.up){isVisible=isVisible&&pt.visible();pt=pt.up()}return isVisible}}})();(function(){FlipKey=FlipKey||{};FlipKey.Form=FlipKey.Form||{};FlipKey.Form.Validator=function(rules,params){this._rules={};this._observers={};this._params={onComplete:null,onChangeTest:null,form:null};this._initialize(rules,params)};FlipKey.Form.Validator.prototype={_initialize:function(rules,params){this._params=$H(this._params).merge(params)._object;for(var elementId in rules){this.addElement(elementId,rules[elementId])}},_observeChanges:function(el){if(!el||!el.identify){return}if(!this._observers[el.identify()]){switch(el.tagName.toLowerCase()){case"select":el.on("change",this._changeTest.bind(this));break;case"input":el.on("change",this._changeTest.bind(this));if(el.hasClassName("datepicker-input")){el.on("blur",this._changeTest.bind(this))}else{el.on("keyup",this._changeTest.bind(this))}break;default:el.on("change",this._changeTest.bind(this));el.on("keyup",this._changeTest.bind(this));break}this._observers[el.identify()]=true}},_changeTest:function(e,el){this._hideError(el);var messages=this.testInput(el);if(messages&&messages.length){this._showError(el,messages)}if(typeof this._params.onChangeTest=="function"){this._params.onChangeTest()}},addElement:function(elementId,rules){if(Object.isElement(elementId)){elementId=elementId.identify()}for(var rule in rules){this.addRule(elementId,rule,rules[rule])}},addRule:function(elementId,rule,message){if(Object.isElement(elementId)){elementId=elementId.identify()}if(!FlipKey.Form.Validator.isValidationRule(rule)){throw"Not a valid rule: "+rule+" on "+elementId}var args=[],ruleName=rule,enabledOnly=false,ifCondition=null;if(rule.indexOf("-")){var ruleParts=rule.split("-");enabledOnly=ruleParts[ruleParts.length-1]=="enabled";if(enabledOnly){ruleParts.splice(ruleParts.length-1,1)}if(ruleParts.length>3&&ruleParts[ruleParts.length-3]=="if"){ifCondition=[ruleParts[ruleParts.length-2],ruleParts[ruleParts.length-1].toLowerCase()];ruleParts.splice(ruleParts.length-3,3)}ruleName=ruleParts[0];ruleParts.splice(0,1);if(ruleParts.length){args=ruleParts}}if(typeof this._rules[elementId]!="object"){this._rules[elementId]={}}this._rules[elementId][ruleName]={args:args,enabledOnly:enabledOnly,ifCondition:ifCondition,message:message}},removeRule:function(elementId,rule){if(Object.isElement(elementId)){elementId=elementId.identify()}var ruleParts=rule.split("-");if(!ruleParts.length){return}if(this._rules[elementId]&&this._rules[elementId][ruleParts[0]]){this._rules[elementId][ruleParts[0]]=null}},validate:function(){this._clear();var success=true;for(var el in this._rules){el=$(el);var messages=this.testInput(el);if(messages&&messages.length){success=false;this._showError(el,messages);this._observeChanges(el)}}if(typeof this._params.onComplete=="function"){this._params.onComplete()}return success},testInput:function(el){var messages=[];el=$(el);if(!el||!el.identify){return}var id=el.identify();var rules=this._rules[id];var value="";if(el.type=="radio"){value=FlipKey.Form.Utils.getRadioValue(el.form,el.name)}else{if(el.type=="checkbox"){value=FlipKey.Form.Utils.getCheckboxValue(el.form,el.name)}else{if(el.readAttribute("data-value_element")){var curr=FlipKey.Form.CurrencyInput.getInput(id);if(curr){value=curr.getFinalValue()}else{value=$(el.readAttribute("data-value_element")).getValue()}}else{value=el.getValue()}}}for(var rule in rules){if(!rules[rule]){continue}var message=rules[rule].message;var args=rules[rule].args;var enabledOnly=rules[rule].enabledOnly;var ifCondition=rules[rule].ifCondition;var pass=true;if(ifCondition&&ifCondition.length==2&&$(ifCondition[0]).getValue().replace(/[^\w]+/g,"").toLowerCase()!=""+ifCondition[1]){continue}if(enabledOnly&&(el.disabled||el.getAttribute("data-disabled")=="true"||!FlipKey.Form.Utils.visible(el))){continue}pass=this._testRule(rule,value,args);if(pass&&el.getAttribute("data-prompt")){pass=this._testRule("notequalto",value,el.getAttribute("data-prompt"))}if(!pass){messages.push(message);break}}return messages},_testRule:function(rule,value,args){var pass=true;switch(rule){case"required":pass=pass&&value&&(""+value).length>0;break;case"minlength":pass=pass&&value.length>=args[0];break;case"maxlength":pass=pass&&value.length<=args[0];break;case"length":case"exactlength":pass=pass&&value.length==args[0];break;case"equalto":pass=pass&&value==args[0];break;case"notequalto":pass=pass&&value!=args[0];break;case"date":case"future_date":case"past_date":case"before":case"after":if(value.length){pass=pass&&/^\d{1,2}[\.\/\-]{1}\d{1,2}[\.\/\-]{1}\d{4}$/.test(value);if(pass){var date=new Date(value);var parts=value.split(/[\.\/\-]/);pass=pass&&parts[0]*1==date.getMonth()+1&&parts[1]*1==date.getDate()&&parts[2]*1==date.getFullYear()}if(pass){switch(rule){case"future_date":var today=new Date();today.setTime(today.getTime()-today.getTime()%86400000);var diff=(args.length?args[0]:1)*86400000;pass=pass&&date.getTime()>=today.getTime()+diff;break;case"past_date":var today=new Date();today.setTime(today.getTime()-today.getTime()%86400000);var diff=(args.length?args[0]:1)*86400000;pass=pass&&date.getTime()<=today.getTime()-diff;break;case"before":if($(args.length)){var date2=new Date($(args[0]).value);var diff=(args.length==2?args[1]:1)*86400000;pass=pass&&date.getTime()<=date2.getTime()-diff}break;case"after":if($(args.length)){var date2=new Date($(args[0]).value);var diff=(args.length==2?args[1]:1)*86400000;pass=pass&&date.getTime()>=date2.getTime()+diff}break}}}break;case"gt":case"gte":case"lt":case"lte":case"eq":case"ne":case"minimum":case"maximum":if(value){pass=pass&&!isNaN(parseFloat(value))&&isFinite(value);if(pass){switch(rule){case"gt":pass=pass&&value*1>args[0]*1;break;case"gte":case"minimum":pass=pass&&value*1>=args[0]*1;break;case"lt":pass=pass&&value*1<args[0]*1;break;case"lte":case"maximum":pass=pass&&(value*1)<=(args[0]*1);break;case"eq":pass=pass&&value==args[0];break;case"ne":pass=pass&&value!=args[0];break}}}break;case"equalto":pass=pass&&value==args[0];break;case"notequalto":pass=pass&&value!=args[0];break;case"numeric":case"integer":pass=pass&&!isNaN(parseFloat(value))&&isFinite(value);if(rule=="integer"){pass=pass&&Math.round(value)==value}break;case"routing_number":if(value.length){pass=pass&&!isNaN(parseFloat(value))&&isFinite(value);var n=0;for(var i=0;i<value.length;i+=3){n+=parseInt(value.charAt(i),10)*3+parseInt(value.charAt(i+1),10)*7+parseInt(value.charAt(i+2),10)}pass=pass&&(n!=0&&n%10==0);break}break;case"credit_card":if(value.length){pass=pass&&/^[0-9]{4}[\-]?[0-9]{4}[\-]?[0-9]{4}[\-]?[0-9]{4}$/.test(value);if(pass){var num=value.replace("-","");var n=0;for(var i=value.length-1;i>=0;i--){n+=num[i]*(i%2+1)}pass=pass&&n>0&&n%10==0}}break;case"monetary":case"currency":var moneyFormats={USD:/^(\$[ ]?)?\d{1,3}([\,]?\d{3})*(\.\d{2})?$/,GBP:/^(\[ ]?)?\d{1,3}([\,]?\d{3})*(\.\d{2})?$/,EUR:/^\d{1,3}(\.?\d{3})*(\,\d{2})?([ ]?\)?$/};if(value.length){pass=pass&&/^[\$]?\d{1,3}([\,]?\d{3})*(\.\d{2})?$/.test(value)}break;case"email":if(value.length){pass=pass&&/^[a-zA-Z0-9._\-+]+@([a-zA-Z0-9._\-+])+([a-z]+\.)*\.([a-z][a-z]+)$/.test(value)}break;case"ssn":if(value.length){pass=pass&&/^[0-9]{3}[\-]?[0-9]{2}[\-]?[0-9]{4}$/.test(value)}break;case"phone":break;case"confirm":pass=pass&&$(args[0])&&value==$(args[0]).value;break;case"compare":var subRule=args[0].replace(/[0-9\.]+/g,"");var subValues=args[0].split(subRule);if(subValues.length==2){switch(subRule){case"lt":pass=pass&&subValues[0]*1<subValues[1]*1;break;case"lte":pass=pass&&subValues[0]*1<=subValues[1]*1;break;case"gt":pass=pass&&subValues[0]*1>subValues[1]*1;break;case"gte":pass=pass&&subValues[0]*1>=subValues[1]*1;break;case"eq":pass=pass&&subValues[0]*1==subValues[1]*1;break;case"ne":pass=pass&&subValues[0]*1!=subValues[1]*1;break}}break;case"external":break;default:}return pass},_clear:function(){var el;if(this._params.form){el=this._params.form}else{for(var el in this._rules){el=$(el);break}while(el.tagName.toLowerCase()!="form"){el=el.up()}}var errors=el.getElementsBySelector(".error-messages");errors.each(function(err){err.remove()})},_showError:function(el,messages,fadeAfter){if(typeof el=="string"){el=$(el)}if(!el){return}el.addClassName("input-error");var displayElement=$(el.readAttribute("data-show_error_on"));if(!displayElement){displayElement=el}var div=displayElement.up("div,span");var errorMessageWrapper=div.getElementsBySelector("div.error-messages").first();var errors=[];messages.each(function(message){if(!errorMessageWrapper||!errorMessageWrapper.innerHTML||!errorMessageWrapper.innerHTML.indexOf(message)){errors.push(Builder.node("li",message))}});if(!errors.length){return}var errorList=Builder.node("ul",{id:el.identify()+"_errors"},errors);var dx=displayElement.cumulativeOffset()[0]-div.cumulativeOffset()[0];var w=displayElement.getWidth();var errorPosition=el.readAttribute("data-error_position");if(!errorMessageWrapper){var position="";var className="error-messages";var errowClass="general-errow-up";switch(errorPosition){case"absolute":position="margin-left:"+dx+"px; position: absolute; white-space: nowrap;";break;case"right":position="top: 0px; left: 0px; margin-left:"+(w+dx)+"px; position: absolute; white-space: nowrap;";className+=" error-right";errowClass="general-errow-left";break;case"bottom":default:position="margin-left:"+dx+"px"}errorMessageWrapper=Builder.node("div",{"class":className,style:position},[Builder.node("span",{"class":errowClass})]);div.insert(errorMessageWrapper)}errorMessageWrapper.insert(errorList);div.setStyle({position:"relative"});if(fadeAfter&&fadeAfter>0){var self=this;window.setTimeout(function(){UI.fadeOut(errorMessageWrapper,400,function(){errorMessageWrapper.remove()})},fadeAfter)}},_hideError:function(el){if(typeof el=="string"){el=$(el)}if(!el){return}if(el.hasClassName("error")){el.removeClassName("error")}if(el.hasClassName("input-error")){el.removeClassName("input-error")}var errors=$(el.identify()+"_errors");if(errors){var errorMessageWrapper=errors.up();if(errors){errors.remove()}if(errorMessageWrapper.childNodes.length==1){errorMessageWrapper.remove()}}},renderExternalErrors:function(errors,opts){var options={clearOnSubmit:true,clearOnChange:true};options=$H(options).merge(opts)._object;if(typeof errors=="object"){for(var id in errors){var err=errors[id];this._showError(id,[err]);if(options.clearOnSubmit){if(typeof this._rules[id]!="object"||!this._rules[id]){this._rules[id]={}}this._rules[id].external=err}if(options.clearOnChange){this._observeChanges($(id))}}}}};FlipKey.Form.Validator.isValidationRule=function(rule){if(rule.indexOf("-")){rule=rule.split("-");rule=(rule[0]=="data"&&rule.length>1)?rule[1]:rule[0]}switch(rule){case"required":case"minlength":case"maxlength":case"length":case"exactlength":case"lt":case"lte":case"gt":case"gte":case"eq":case"ne":case"minimum":case"maximum":case"equalto":case"notequalto":case"date":case"future_date":case"past_date":case"before":case"after":case"numeric":case"integer":case"routing_number":case"credit_card":case"monetary":case"currency":case"email":case"ssn":case"phone":case"confirm":case"compare":case"external":return true;break;default:return false}};FlipKey.Form.Validator.disable=function(parent){if(typeof parent=="string"){parent=$(parent)}parent.getElementsBySelector("input,select,textarea").each(function(el){el.setAttribute("data-disabled","true")})};FlipKey.Form.Validator.enable=function(parent){if(typeof parent=="string"){parent=$(parent)}parent.getElementsBySelector("input,select,textarea").each(function(el){el.removeAttribute("data-disabled")})};UI=UI||{};UI.FormValidator=FlipKey.Form.Validator})();(function(){FlipKey=FlipKey||{};FlipKey.Form=FlipKey.Form||{};FlipKey.Form.Prompt=function(el){this._el=null;this._prompt="";this._initialize(el)};FlipKey.Form.Prompt.prototype={_initialize:function(el){this._el=(typeof el=="string")?$(el):el;if(!this._el){return}this._prompt=this._el.getAttribute("data-prompt");if(!this._prompt){return}var id=this._el.identify();if(this._prompt&&this._prompt.length){if(!FlipKey.Form.Prompt.prompts[id]){FlipKey.Form.Prompt.prompts[id]=this;this._el.on("focus",function(e,el){this.refresh("")}.bind(this));this._el.on("blur",function(e,el){this.refresh()}.bind(this));this.refresh()}}},refresh:function(defaultValue){if(typeof defaultValue=="undefined"){defaultValue=this._prompt}if(this._el.value&&this._el.value.length&&this._el.value!=this._el.getAttribute("data-prompt")){if(this._el.hasClassName("empty")){this._el.removeClassName("empty")}}else{this._el.value=defaultValue;if(defaultValue==this._prompt){if(!this._el.hasClassName("empty")){this._el.addClassName("empty")}}else{if(this._el.hasClassName("empty")){this._el.removeClassName("empty")}}}}};FlipKey.Form.Prompt.prompts={};FlipKey.Form.Prompt.refreshAll=function(){for(var i in FlipKey.Form.Prompt.prompts){try{FlipKey.Form.Prompt.prompts[i].refresh()}catch(e){}}}})();(function(){FlipKey=FlipKey||{};FlipKey.Form=FlipKey.Form||{};FlipKey.Form.CurrencyInput=function(el,params){this._el=$(el);if(!this._el){return}if($(this._el.identify()+"_value")){return}this._params={count:1,formatValues:true,allowDecimals:false,currency:null,foreignCurrencyIndicator:false,exchangeForeignCurrency:false,currencyWrapper:false,onRefresh:null,formatOptions:{zero:"",formatSymbol:true}};this._params=$H(this._params).merge(params)._object;this._delimiter=".";this._caret=null;this._valueInput=null;this._usdValueSpan=null;this._formatters={allowed:/[0-9]/,disallowed:/[^0-9]/,disallowedGlobal:/[^0-9\.,]+/g};if(this._params.allowDecimals){this._formatters.allowed=/[0-9\.,]/;this._formatters.disallowed=/[^0-9\.,]/;this._formatters.disallowedGlobal=/[^0-9\.,]+/g}this._initializeValueNode(this._el);this._el.on("focus",function(e){this._showCurrencyCodeIndicator();this.refreshValue(e)}.bind(this));this._el.on("blur",function(e){this._hideCurrencyCodeIndicator();this.refreshValue(e)}.bind(this));this._el.on("keypress",this._onKeyPress.bind(this));this._el.observe("keyup",this._adjustCaretPos.bind(this));this._el.observe("click",this._adjustCaretPos.bind(this));this.refreshValue();this._updateDelimiter();FlipKey.Form.CurrencyInput.inputs[this._el.identify()]=this._params.currencyWrapper&&this._params.currencyWrapper._el?this._params.currencyWrapper:this};FlipKey.Form.CurrencyInput.prototype={destroy:function(){},_initializeValueNode:function(el){var id=el.identify();var name=el.readAttribute("name");el.writeAttribute("data-value_element",id+"_value");this._valueInput=Builder.node("input",{id:id+"_value",type:"hidden",name:name,value:this.getValue()});el.insert({after:this._valueInput});if(this._params.exchangeForeignCurrency){this._usdValueSpan=Builder.node("span",{id:id+"_USD","class":"USD-value"});this._usdValueSpan.hide();el.insert({after:this._usdValueSpan})}var formattedName=(name[name.length-1]=="]")?name.substr(0,name.length-1)+"_formatted]":name+"_formatted";el.writeAttribute("name",formattedName)},changeCurrency:function(currency){if(currency&&currency.code&&currency.exchangeRate&&currency.format&&currency.symbol){this._params.currency=currency;this._updateDelimiter();this.refreshValue()}},_onKeyPress:function(e){if(!this._params.formatValues){return}var chr=FlipKey.Form.Utils.getCharPressed(e);if(!this._formatters.allowed.test(chr)&&chr!==null&&chr!==""&&chr!=="\n"&&chr!=="\r"&&chr!=="	"){this._onBadKeyPressed();e.stop()}else{if(chr=="."||chr==","){if(this._el.getValue().indexOf(this._delimiter)<0&&(this._delimiter==","||chr==this._delimiter)){this._el.setValue(this._el.getValue()+this._delimiter)}e.stop()}}},_onBadKeyPressed:function(){var exists=false;this._el.nextSiblings().each(function(el){exists=exists||el.hasClassName("bad-key-error")});if(!exists){FlipKey.Form.Validator.prototype._showError(this._el,["Please only use numbers (0-9)."],1000)}},_onGlobalCurrencyChanged:function(newCurrency){this.refreshValue()},getValue:function(){var value=this._el.getValue();var currentFormat=this._el.getAttribute("data-format");if(!currentFormat){this._el.writeAttribute("data-format",this._getCurrency().format);this._updateDelimiter()}else{if(currentFormat!=this._getCurrency().format){value=FlipKey.Currency.parse(value,currentFormat);this._el.writeAttribute("data-format",this._getCurrency().format);this._updateDelimiter()}else{value=FlipKey.Currency.parse(value)}}return value},getFinalValue:function(){var value=this.getValue();if(this._params.exchangeForeignCurrency){var currency=this._getCurrency();if(currency.code!="USD"&&currency.exchange_rate){value=value/currency.exchange_rate}}return Math.round(value*100)/100},_getCurrency:function(){return(this._params.currency!==null)?this._params.currency:FlipKey.Currency.currency},_updateDelimiter:function(){var backwards=this._getCurrency().format.indexOf("m,")>0;this._delimiter=backwards?",":"."},_showCurrencyCodeIndicator:function(){if(this._params.foreignCurrencyIndicator!=true){return}var code=this._getCurrency().code;if(code!="USD"){var codeSpan=this._el.next();if(codeSpan&&codeSpan.hasClassName("currency-code")){codeSpan.show();codeSpan.update(code)}else{this._el.up().setStyle({position:"relative"});codeSpan=Builder.node("span",{className:"currency-code"},code);this._el.insert({after:codeSpan})}var elemOff=Position.cumulativeOffset(this._el);var wrapOff=Position.cumulativeOffset(this._el.up());var dx=this._el.getWidth()+elemOff.left-wrapOff.left;var dy=elemOff.top-wrapOff.top+this._el.getHeight()-1;codeSpan.setStyle({left:dx+"px",top:dy+"px"})}},_hideCurrencyCodeIndicator:function(){if(this._params.foreignCurrencyIndicator!=true){return}var codeSpan=this._el.next();if(codeSpan&&codeSpan.hasClassName("currency-code")){codeSpan.remove()}},addStopCondition:function(testInput,stopValues){testInput=typeof testInput=="string"?$(testInput):testInput;testInput.on("change",function(){this.checkStopCondition(testInput,stopValues)}.bind(this));this.checkStopCondition(testInput,stopValues)},checkStopCondition:function(testInput,stopValues){testInput=typeof testInput=="string"?$(testInput):testInput;var stop=false;var val=testInput.getValue();for(var i in stopValues){if(val==stopValues[i]){stop=true;break}}if(stop&&this._params.formatValues){this.stopFormatting()}else{if(!stop&&!this._params.formatValues){this.resumeFormatting()}}},stopFormatting:function(){this._params.formatValues=false;this._el.value=this._el.value.replace(this._formatters.disallowedGlobal,"")},resumeFormatting:function(){this._params.formatValues=true;this.refreshValue()},refreshValue:function(e,options){if(!this._params.formatValues){return}var currency=this._getCurrency();var currencyFormatOptions={format:currency.format,symbol:currency.symbol,abbreviation:this._params.allowDecimals?"":currency.abbreviation};options=$H(currencyFormatOptions).merge(this._params.formatOptions).merge(options)._object;var value=this.getValue();this._valueInput.value=Math.round(value*100)/100;var formattedValue=FlipKey.Currency.format(value,options);if(e&&e.type=="focus"){var delim=this._getCurrency().format;delim=delim.substr(delim.indexOf("[M")+2,1);if(delim){delim=eval("/\\"+delim+"/g");var pos=formattedValue.search(/[0-9]/)+1;if(pos){formattedValue=formattedValue.substring(0,pos)+formattedValue.substring(pos).replace(delim,"")}}}window.setTimeout(function(){if(this._isValidCaretEvent(e)){this._getCaretPos()}if(this._el.value!=formattedValue){this._el.value=formattedValue}var currency=this._getCurrency();if(this._params.exchangeForeignCurrency&&this._usdValueSpan){if(currency.code!="USD"&&currency.exchange_rate&&value){var usdValue=value/currency.exchange_rate;var usdOptions={code:"USD",format:FlipKey.Currency.USD.format,symbol:FlipKey.Currency.USD.symbol,abbreviation:this._params.allowDecimals?"":FlipKey.Currency.USD.abbreviation,zero:"",formatSymbol:true};this._usdValueSpan.update("("+FlipKey.Currency.format(usdValue,usdOptions)+" USD)");this._usdValueSpan.show();this._valueInput.value=Math.round(usdValue*100)/100}else{this._usdValueSpan.update("");this._usdValueSpan.hide()}}if(this._isValidCaretEvent(e)){this._setCaretPos(e)}if(typeof this._params.onRefresh=="function"){this._params.onRefresh(this._valueInput.value)}}.bind(this,e),1)},_isValidCaretEvent:function(e){try{if(e){if(e.type){return(e.type=="focus"||e.type=="click"||(e.type=="keyup"&&e.keyCode>=33&&e.keyCode<=40))}}}catch(er){}return false},_adjustCaretPos:function(e){if(this._isValidCaretEvent(e)){window.setTimeout(function(){this._getCaretPos();this._setCaretPos()}.bind(this))}},_getCaretPos:function(){this._caret={val:this._el.value?this._el.value:"",pos:FlipKey.Form.Utils.getCaretPos(this._el)}},_setCaretPos:function(){var len=this._caret.val.length;var min=null,max=null;for(var i=0;i<len;i++){if(/[0-9]/.test(this._caret.val[i])){if(min==null){min=i}max=i}}if(min==null&&max==null){this._caret.pos=/\[\$\]$/.test(FlipKey.Currency.currency.format)?0:len}else{if(this._caret.pos<min){this._caret.pos=min}else{if(this._caret.pos>max+1){this._caret.pos=max+1}}}FlipKey.Form.Utils.setCaretPos(this._el,this._caret.pos)}};FlipKey.Form.CurrencyInput.inputs={};FlipKey.Form.CurrencyInput.getInputs=function(){return FlipKey.Form.CurrencyInput.inputs};FlipKey.Form.CurrencyInput.getInput=function(input){var id=null;if(typeof input=="string"){id=input}if(input.identify){id=input.identify()}return FlipKey.Form.CurrencyInput.inputs[id]};FlipKey.Form.CurrencyInput.refreshInputs=function(){for(var i in FlipKey.Form.CurrencyInput.inputs){FlipKey.Form.CurrencyInput.inputs[i].refreshValue()}};FlipKey.Form.CurrencyInput.onGlobalCurrencyChanged=function(newCurrency){for(var i in FlipKey.Form.CurrencyInput.inputs){FlipKey.Form.CurrencyInput.inputs[i]._onGlobalCurrencyChanged(newCurrency)}};FlipKey.Form.CurrencyInput.addInput=function(input,params){if(typeof input=="string"){input=$(input)}var id=input.identify();if(FlipKey.Form.CurrencyInput.inputs[id]){return}var input=new FlipKey.Form.CurrencyInput(input,params);FlipKey.Form.CurrencyInput.inputs[id]=(input)}})();(function(){FlipKey=FlipKey||{};FlipKey.Form=FlipKey.Form||{};FlipKey.Form.PercentageInput=function(el,params){this._el=$(el);this._params={exchangeForeignCurrency:false,allowDecimals:true,currencyWrapper:this,formatOptions:{formatSymbol:false,zero:""}};this._params=$H(this._params).merge(params)._object;this._params.currency=this._getPercentageCurrency(this._params.currency);this._currency=new FlipKey.Form.CurrencyInput(this._el,this._params)};FlipKey.Form.PercentageInput.prototype={changeCurrency:function(currency){currency=this._getPercentageCurrency(currency);this._currency._params.currency=currency;this._currency.refreshValue()},refreshValue:function(){this._currency.refreshValue()},getFinalValue:function(){return this._currency.getValue()},getValue:function(){return this._currency.getValue()},_onGlobalCurrencyChanged:function(newCurrency){this.changeCurrency(newCurrency)},_getCurrency:function(){return this._currency._getCurrency()},_getPercentageCurrency:function(currency){if(!currency){currency=this._currency?this._currency._getCurrency():FlipKey.Currency.currency}this._delimiter=currency.format.indexOf("m,")>0?",":".";return{code:"X-PCT",format:"[M][m"+this._delimiter+"2][$]",symbol:"%",abbreviation:"",zero:""}}}})();(function(){FlipKey=FlipKey||{};FlipKey.Form=FlipKey.Form||{};FlipKey.Form.OptionalListInput=function(inputs,params){this._type=false;this._inputs=[];this._values={};this._el=null;this._params={mode:"sibling",hideWrapperOnDisable:false,onChange:null};this._initialize(inputs,params)};FlipKey.Form.OptionalListInput.prototype={_initialize:function(inputs,params){if(typeof inputs=="string"){inputs=$$(inputs)}if(typeof inputs=="object"&&inputs.each){this._inputs=inputs}else{return false}if(params){this._params=$H(this._params).merge(params)._object}this._inputs.each(function(input){if(this._type){if(input.type!=this._type){throw"Invalid option list. All options must be the same type."}}else{if(input.type=="hidden"){return}if(input.type!="radio"&&input.type!="checkbox"){throw"Invalid option list. Inputs must be radio or checkbox type."}this._type=input.type}this._values[input.identify()]=input.checked;var option=input.up(".option");input.on("click",function(e,el){if(!el||this._type=="radio"){this.refreshAll()}else{this.refresh(el)}this._onChange()}.bind(this));if(!this._params.hideWrapperOnDisable&&option.getElementsBySelector(".optional:not(.hide-disabled) input, .optional:not(.hide-disabled) select").size()){var boundary=Builder.node("div",{className:"option-boundary"});boundary.on("click",function(e,boundary){var parent=boundary.up();var el=parent.getElementsBySelector("input[type=radio],input[type=checkbox]").first();if(!e){this.refreshAll()}else{if(this._type=="radio"){el.checked=true;this.refreshAll()}else{el.checked=!el.checked;this.refresh(el)}}this._onChange()}.bind(this));option.insert(boundary)}if(Prototype.Browser.IE){input.on("click",function(e,el){try{var other=null;this._inputs.each(function(input){if(input.identify()!=el.identify()){other=input;throw $break}});if(!other){other=$$("#arches input[type=text]").first()}if(other&&other.focus){other.focus()}Event.fire(el,"change");el.focus()}catch(e){}this.refresh(el)}.bind(this))}}.bind(this));this.refreshBoundaries();this.refreshAll()},_onChange:function(){if(typeof this._params.onChange=="function"){var val=FlipKey.Form.Utils.getRadioValue(this._inputs[0]);this._params.onChange(val)}},refreshAll:function(){this._inputs.each(this.refresh.bind(this))},refreshBoundaries:function(){this._inputs.each(function(input){var x1=0,y1=0,x2=0,y2=0;var option=input.up();var boundary=option.getElementsBySelector(".option-boundary").first();if(!boundary){return}var dx=input.cumulativeOffset()[0];var dy=input.cumulativeOffset()[1];option.getElementsBySelector(".optional:not(.hide-disabled) input[type=text], .optional:not(.hide-disabled) select").each(function(opt){var pos={x:opt.cumulativeOffset()[0],y:opt.cumulativeOffset()[1],w:opt.getWidth(),h:opt.getHeight()};if(x1==0||x1>pos.x){x1=pos.x}if(y1==0||y1>pos.y){y1=pos.y}if(x2<pos.x+pos.w){x2=pos.x+pos.w}if(y2<pos.y+pos.h){y2=pos.y+pos.h}});if(x2-x1&&y2-y1){boundary.setStyle({left:(x1-dx)+"px",top:(y1-dy)+"px",width:(x2-x1)+"px",height:(y2-y1)+"px"})}})},refresh:function(input){var enabled=input.checked==true;var focused=false;var option=input.up(".option");switch(this._params.mode){case"value":var optionals=[$(input.value)];break;case"sibling":default:var optionals=option.getElementsBySelector(".optional");break}if(enabled){option.addClassName("option-selected")}else{option.removeClassName("option-selected")}optionals.each(function(opt){if(!opt){return}if(this._params.hideWrapperOnDisable&&!enabled){opt.hide()}else{opt.show()}opt.getElementsBySelector("*").each(function(el){el.setAttribute("data-disabled",enabled?"false":"true")});if(opt.hasClassName("hide-disabled")){if(enabled){opt.show()}else{opt.hide()}}else{opt.getElementsBySelector("*").each(function(el){var id=el.identify();switch(el.tagName.toLowerCase()){case"input":if(enabled&&el.hasAttribute("data-format")){var input=FlipKey.Form.CurrencyInput.getInput(id);if(input){input.refreshValue()}}case"select":case"textarea":case"button":case"a":if(enabled){el.disabled=false}else{el.disabled=true;if(el.type!="hidden"){el.value=""}}default:if(el.hasClassName("disabled")){if(enabled){el.removeClassName("disabled")}}else{if(!enabled){el.addClassName("disabled")}}}})}}.bind(this));if(enabled){var firstChild=option.getElementsBySelector(".optional input[type=text], .optional select, .optional textarea").first();try{if(firstChild&&firstChild.focus){firstChild.focus()}}catch(e){}}var boundary=option.getElementsBySelector(".option-boundary");boundary.each(function(bound){bound.style.display=enabled?"none":"block"})}};UI=UI||{};UI.OptionalListInput=FlipKey.Form.OptionalListInput})();var Tooltip=Class.create();Tooltip.USE_OFFSETS=1;Tooltip.ATTACH_RIGHT=2;Tooltip.ATTACH_BOTTOM=3;hideTooltips=function(){};showTooltips=function(){};Tooltip.prototype={initialize:function(el,options){if(typeof el=="string"){this.el=$(el)}else{this.el=el}this.el.tooltip=this;this.initialized=false;this.setOptions(options);if(this.options.mode=="init"){this.updateEventNoFollow=this.updateNoFollow.bindAsEventListener(this)}else{if(this.options.mode=="mouseover"){this.showEvent=this.show.bindAsEventListener(this);this.hideEvent=this.hide.bindAsEventListener(this);this.updateEvent=this.update.bindAsEventListener(this);Event.observe(this.el,"mouseover",this.showEvent);Event.observe(this.el,"mouseout",this.hideEvent)}else{if(this.options.mode=="focus"){this.showEvent=this.showAfterClick.bindAsEventListener(this);this.hideEvent=this.hide.bindAsEventListener(this);this.updateEventNoFollow=this.updateNoFollow.bindAsEventListener(this);Event.observe(this.el,"focus",this.showEvent);Event.observe(this.el,"blur",this.hideEvent)}else{if(this.options.mode=="mouseover_or_focus"){this.showEvent=this.showAfterClick.bindAsEventListener(this);this.hideEvent=this.hide.bindAsEventListener(this);this.updateEventNoFollow=this.updateNoFollow.bindAsEventListener(this);Event.observe(this.el,"focus",this.showEvent);Event.observe(this.el,"mouseover",this.showEvent);Event.observe(this.el,"blur",this.hideEvent);Event.observe(this.el,"mouseout",this.hideEvent)}else{if(this.options.mode=="click"){this.showEvent=this.showAfterClick.bindAsEventListener(this);this.hideEvent=this.hide.bindAsEventListener(this);this.updateEvent=this.update.bindAsEventListener(this);Event.observe(this.el,"click",this.showEvent);Event.observe(this.el,"mouseout",this.hideEvent)}}}}}if(this.options.contentAttribute=="title"){this.content=this.el.title;this.el.title=""}else{this.content=Element.readAttribute(this.el,this.options.contentAttribute)}if(this.options.mode=="init"){this.showAfterClick()}},setOptions:function(options){this.options={backgroundColor:"#999",borderColor:"#666",textColor:"",textShadowColor:"",maxWidth:250,align:"left",delay:250,mouseFollow:true,opacity:1,appearDuration:0.25,hideDuration:0.25,xOffset:7,yOffset:22,mode:"mouseover",showImage:false,contentAttribute:"title",layout:Tooltip.USE_OFFSETS,arrow:false,metalabs:false};Object.extend(this.options,options||{})},show:function(e){if(this.options.mouseFollow){this.xCord=Event.pointerX(e);this.yCord=Event.pointerY(e)}else{this.xCord=Math.round(Position.cumulativeOffset(this.el)[0]+this.el.getWidth()/2);this.yCord=Math.round(Position.cumulativeOffset(this.el)[1]+this.el.getHeight()/2)}if(!this.initialized){this.timeout=window.setTimeout(this.appear.bind(this),this.options.delay)}},showAfterClick:function(e){dims=Element.getDimensions(this.el);this.xCord=Element.cumulativeOffset(this.el)["left"]+dims.width;this.yCord=Element.cumulativeOffset(this.el)["top"];if(!this.initialized){this.timeout=window.setTimeout(this.appear.bind(this),this.options.delay)}},hide:function(e){if(this.initialized){if(this.options.mouseFollow||this.options.mode=="mouseover_or_focus"){Event.stopObserving(this.el,"mousemove",this.updateEvent)}this.tooltip.hide()}this._clearTimeout(this.timeout);this.initialized=false},update:function(e){this.xCord=Event.pointerX(e);this.yCord=Event.pointerY(e);this.setup()},updateNoFollow:function(e){this.xCord=Math.round(Position.cumulativeOffset(this.el)[0]+this.el.getWidth()/2);this.yCord=Math.round(Position.cumulativeOffset(this.el)[1]+this.el.getHeight()/2);this.setup()},appear:function(){var position="absolute";var parent=this.el;while(parent&&parent.getStyle){if(parent.getStyle("position")=="fixed"){position="fixed";break}parent=parent.up?parent.up():null}if(this.options.layout=="inside"){var input_position=Position.page(this.el);var div_position=Position.page($(this.options.activehelp_el));var content_el=Builder.node("p");this.tooltip=Builder.node("div",{"class":"active_help"},[Builder.node("img",{style:"position: "+position+";  left: "+div_position[0]+"px; top: "+input_position[1]+"px",src:"/img/rbo/activehelp_arrow.gif"}),content_el,]);content_el.innerHTML=this.content;$(this.options.activehelp_el).appendChild(this.tooltip);$(this.options.activehelp_el).show()}else{if(this.options.metalabs){var content=this.content.split(" || ");if(content.length>1){title=content[0];body=content[1];bodyDisplay="block"}else{title=content[0];body="";bodyDisplay="none"}if(position!="fixed"){position=""}this.tooltip=Builder.node("div",{className:"tooltip",style:"display: none; zoom: 1; position: "+position},[content_el=Builder.node("h3",{className:"title"},unescape(title)),Builder.node("div",{className:"body",display:bodyDisplay},unescape(body)),Builder.node("div",{className:"url",display:"none"},"")]);content_el.innerHTML=title}else{this.tooltip=Builder.node("div",{className:"tooltip",style:"display: none; position: "+position},[this.options.arrow?Builder.node("img",{className:"pointer",src:"/img/rbo/activehelp_arrow.png",style:"top: 10px"},[]):"",Builder.node("div",{className:"xtop"},[Builder.node("div",{className:"xb1",style:"background-color:"+this.options.borderColor+";"}),Builder.node("div",{className:"xb2",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"}),Builder.node("div",{className:"xb3",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"}),Builder.node("div",{className:"xb4",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"})]),content_el=Builder.node("div",{className:"xboxcontent",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+((this.options.textColor!="")?"; color:"+this.options.textColor:"")+((this.options.textShadowColor!="")?"; text-shadow:2px 2px 0"+this.options.textShadowColor+";":"")},(this.options.showImage==false)?unescape(this.content):[Builder.node("img",{className:"toolTipImage",src:unescape(this.content)})]),Builder.node("div",{className:"xbottom"},[Builder.node("div",{className:"xb4",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"}),Builder.node("div",{className:"xb3",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"}),Builder.node("div",{className:"xb2",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"}),Builder.node("div",{className:"xb1",style:"background-color:"+this.options.borderColor+";"})]),]);if(this.options.showImage==false){content_el.innerHTML=this.content}}document.body.insertBefore(this.tooltip,document.body.childNodes[0])}this.tooltip=Element.extend(this.tooltip);if(this.options.layout!="inside"){this.options.width=this.tooltip.getWidth();if(this.options.showImage==false){if(!this.options.metalabs){this.tooltip.style.width=this.options.width+"px"}}else{img=this.tooltip.getElementsByClassName("toolTipImage")[0];img=Element.extend(img);this.tooltip.style.width=img.readAttribute("width")+"px"}}this.setup();if(this.options.mouseFollow&&this.options.mode=="mouseover"){Event.observe(this.el,"mousemove",this.updateEvent)}else{if(this.options.mode=="init"||this.options.mode=="focus"||this.options.mode=="mouseover_or_focus"){this.boundUpdateEventNoFollow=this.updateEventNoFollow.bind(this);Event.observe(document.body,"mousemove",this.boundUpdateEventNoFollow)}}this.initialized=true;this.tooltip.show()},setup:function(){if((this.options.width>this.options.maxWidth)&&this.options.layout!="inside"){this.options.width=this.options.maxWidth;if(this.options.showImage==false){this.tooltip.style.width=this.options.width+"px"}}if((this.xCord+this.options.width>=Element.getWidth(document.body))&&this.options.layout!="inside"){this.options.align="right";this.xCord=this.xCord-this.options.width-(this.options.xOffset*2);$(this.tooltip).addClassName("tooltip-right")}if(this.options.layout==Tooltip.ATTACH_RIGHT){this.tooltip.style.left=Position.cumulativeOffset(this.el)[0]+this.options.xOffset+this.el.getWidth()+"px";this.tooltip.style.top=Position.cumulativeOffset(this.el)[1]-5+this.options.yOffset+"px"}else{if(this.options.layout==Tooltip.ATTACH_BOTTOM){this.tooltip.style.left=Position.cumulativeOffset(this.el)[0]+this.options.xOffset+"px";this.tooltip.style.top=Position.cumulativeOffset(this.el)[1]+this.el.getHeight()+"px"}else{this.tooltip.style.left=this.xCord+this.options.xOffset+"px";this.tooltip.style.top=this.yCord+this.options.yOffset+"px"}}},destroy:function(){this.el.stopObserving();Event.stopObserving(document.body,"mousemove",this.boundUpdateEventNoFollow)},_clearTimeout:function(timer){clearTimeout(timer);clearInterval(timer);return null}};