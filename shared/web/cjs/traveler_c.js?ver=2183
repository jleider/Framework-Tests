var Autocomplete=function(el,options){this.el=$(el);this.id=this.el.identify();this.el.setAttribute("autocomplete","off");this.counts=[];this.suggestions=[];this.data=[];this.badQueries=[];this.selectedIndex=-1;this.currentValue=this.el.value;this.intervalId=0;this.cachedResponse=[];this.instanceId=null;this.onChangeInterval=null;this.ignoreValueChange=false;this.serviceUrl=options.serviceUrl;this.options={autoSubmit:false,minChars:1,maxHeight:400,deferRequestBy:0,width:0,container:null};if(options){Object.extend(this.options,options)}if(Autocomplete.isDomLoaded){this.initialize()}else{Event.observe(document,"dom:loaded",this.initialize.bind(this),false)}};Autocomplete.instances=[];Autocomplete.isDomLoaded=false;Autocomplete.getInstance=function(id){var instances=Autocomplete.instances;var i=instances.length;while(i--){if(instances[i].id===id){return instances[i]}}};Autocomplete.highlight=function(value,re){return value.replace(re,function(match){return"<strong>"+match+"</strong>"})};Autocomplete.prototype={killerFn:null,initialize:function(){var me=this;this.killerFn=function(e){if(!$(Event.element(e)).up(".autocomplete")){me.killSuggestions();me.disableKillerFn()}}.bindAsEventListener(this);if(!this.options.width){this.options.width=this.el.getWidth()}var div=new Element("div",{style:"position:absolute;"});div.update('<div class="autocomplete" id="Autocomplete_'+this.id+'" style="display:none; width:'+this.options.width+'px;"></div>');this.options.container=$(this.options.container);if(this.options.container){this.options.container.appendChild(div);this.fixPosition=function(){}}else{document.body.appendChild(div)}this.mainContainerId=div.identify();this.container=$("Autocomplete_"+this.id);this.fixPosition();Event.observe(this.el,window.opera?"keypress":"keydown",this.onKeyPress.bind(this));Event.observe(this.el,"keyup",this.onKeyUp.bind(this));Event.observe(this.el,"blur",this.enableKillerFn.bind(this));Event.observe(this.el,"focus",this.fixPosition.bind(this));this.container.setStyle({maxHeight:this.options.maxHeight+"px"});this.instanceId=Autocomplete.instances.push(this)-1},fixPosition:function(){var offset=this.el.cumulativeOffset();$(this.mainContainerId).setStyle({top:(offset.top+this.el.getHeight())+"px",left:offset.left+"px"})},enableKillerFn:function(){Event.observe(document.body,"click",this.killerFn)},disableKillerFn:function(){Event.stopObserving(document.body,"click",this.killerFn)},killSuggestions:function(){this.stopKillSuggestions();this.intervalId=window.setInterval(function(){this.hide();this.stopKillSuggestions()}.bind(this),300)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},onKeyPress:function(e){if(!this.enabled){return}switch(e.keyCode){case Event.KEY_ESC:this.el.value=this.currentValue;this.hide();break;case Event.KEY_TAB:case Event.KEY_RETURN:if(this.selectedIndex===-1){this.hide();return}this.select(this.selectedIndex);if(e.keyCode===Event.KEY_TAB){return}break;case Event.KEY_UP:this.moveUp();break;case Event.KEY_DOWN:this.moveDown();break;default:return}Event.stop(e)},onKeyUp:function(e){switch(e.keyCode){case Event.KEY_UP:case Event.KEY_DOWN:return}clearInterval(this.onChangeInterval);if(this.currentValue!==this.el.value){if(this.options.deferRequestBy>0){this.onChangeInterval=setInterval((function(){this.onValueChange()}).bind(this),this.options.deferRequestBy)}else{this.onValueChange()}}},onValueChange:function(){clearInterval(this.onChangeInterval);this.currentValue=this.el.value;this.selectedIndex=-1;if(this.ignoreValueChange){this.ignoreValueChange=false;return}if(this.currentValue===""||this.currentValue.length<this.options.minChars){this.hide()}else{this.getSuggestions()}},getSuggestions:function(){var cr=this.cachedResponse[this.currentValue];if(cr&&Object.isArray(cr.suggestions)){this.suggestions=cr.suggestions;this.data=cr.data;this.suggest()}else{if(!this.isBadQuery(this.currentValue)){new Ajax.Request(this.serviceUrl,{parameters:{query:this.currentValue},onComplete:this.processResponse.bind(this),method:"get"})}}},isBadQuery:function(q){var i=this.badQueries.length;while(i--){if(q.indexOf(this.badQueries[i])===0){return true}}return false},hide:function(){this.enabled=false;this.selectedIndex=-1;this.container.hide()},suggest:function(){if(this.suggestions.length===0){this.hide();return}var content=[];var re=new RegExp("\\b"+this.currentValue.match(/\w+/g).join("|\\b"),"gi");this.suggestions.each(function(value,i){content.push((this.selectedIndex===i?'<div class="loc_row selected"':'<div class="loc_row"'),' title="',value,'" onclick="Autocomplete.instances[',this.instanceId,"].select(",i,');" onmouseover="Autocomplete.instances[',this.instanceId,"].activate(",i,');"><div class="loc_name">',Autocomplete.highlight(value,re),'</div><div class="loc_count">',this.counts[i],' Rentals</div><div class="cleaner"></div></div>')}.bind(this));this.enabled=true;this.container.update(content.join("")).show()},processResponse:function(xhr){var response;try{response=xhr.responseText.evalJSON();if(!Object.isArray(response.data)){response.data=[]}}catch(err){return}this.cachedResponse[response.query]=response;if(response.suggestions.length===0){this.badQueries.push(response.query)}if(response.query===this.currentValue){this.suggestions=response.suggestions;this.data=response.data;this.counts=response.counts;this.suggest()}},activate:function(index){var divs=this.container.childNodes;var activeItem;if(this.selectedIndex!==-1&&divs.length>this.selectedIndex){divs[this.selectedIndex].className="loc_row"}this.selectedIndex=index;if(this.selectedIndex!==-1&&divs.length>this.selectedIndex){activeItem=divs[this.selectedIndex];activeItem.className="loc_row selected"}return activeItem},deactivate:function(div,index){div.className="loc_row";if(this.selectedIndex===index){this.selectedIndex=-1}},select:function(i){var selectedValue=this.suggestions[i];if(selectedValue){this.el.value=selectedValue;if(this.options.autoSubmit&&this.el.form){this.el.form.submit()}this.ignoreValueChange=true;this.hide();this.onSelect(i)}},moveUp:function(){if(this.selectedIndex===-1){return}if(this.selectedIndex===0){this.container.childNodes[0].className="loc_row";this.selectedIndex=-1;this.el.value=this.currentValue;return}this.adjustScroll(this.selectedIndex-1)},moveDown:function(){if(this.selectedIndex===(this.suggestions.length-1)){return}this.adjustScroll(this.selectedIndex+1)},adjustScroll:function(i){var container=this.container;var activeItem=this.activate(i);var offsetTop=activeItem.offsetTop;var upperBound=container.scrollTop;var lowerBound=upperBound+this.options.maxHeight-25;if(offsetTop<upperBound){container.scrollTop=offsetTop}else{if(offsetTop>lowerBound){container.scrollTop=offsetTop-this.options.maxHeight+25}}this.el.value=this.suggestions[i]},onSelect:function(i){(this.options.onSelect||Prototype.emptyFunction)(this.suggestions[i],this.data[i])}};Event.observe(document,"dom:loaded",function(){Autocomplete.isDomLoaded=true},false);FlipKey.Specials=Class.create({edited:false,initialize:function(special_data){this.special_data=special_data},observeUnsavedChanges:function(){$$("#special_form input").each((function(e){e.observe("change",(function(evt){this.edited=true}).bind(this))}).bind(this));$$("#special_form select").each((function(e){e.observe("change",(function(evt){this.edited=true}).bind(this))}).bind(this));$$("#special_form textarea").each((function(e){e.observe("change",(function(evt){this.edited=true}).bind(this))}).bind(this));var check_unsaved=["#profile a","#nav a","a.return_to_dash","#logo a","#footer a"];for(var i=0;i<check_unsaved.length;i++){$$(check_unsaved[i]).each((function(el){el.observe("click",(function(evt){this.checkUnsavedChanges(evt.element().href);Event.stop(evt);return false}).bind(this))}).bind(this))}},checkUnsavedChanges:function(href){if(this.edited){new AlertBar().show("You have unsaved information",{alertType:"warning",options:[{text:"Save",callback:function(){$("special_form").submit()}},{text:"Discard",callback:function(){window.location=href}}],addOpaque:true})}else{window.location=href}},showDetailedLightbox:function(id){FlipKey.showLightboxFromDiv("specials-lightbox-"+id,true,false,null,{arches:true})},selectAllProperties:function(){$$(".propcheck").each(function(e){e.checked=true})},clearAllProperties:function(){$$(".propcheck").each(function(e){e.checked=false})},reCalcRates:function(){sel=null;$$(".radio_in").each(function(e){if($F(e)!=null){sel=$F(e)}});var checked="";$$(".propcheck").each(function(ele){if($(ele).checked){checked=checked+$(ele).id+","}});FlipKey.Ajax.request("/dashboards/recalc_special_rate",{method:"post",parameters:{"data[selected]":checked},onSuccess:function(transport){rate_min=transport.responseJSON.min;rate_max=transport.responseJSON.max;if(sel==2){val=$F($("amt_per_night"));if(isNaN(parseFloat(val))){$("discount_rate").hide();return false}min=rate_min-val;max=rate_max-val;if(min<0){min=0}if(max<0){max=0}$("rate_span").update(Math.round(min)+"-"+Math.round(max))}else{if(sel==3){val=$F($("pct_per_night"));if(isNaN(parseInt(val))){$("discount_rate").hide();return false}min=rate_min-rate_min*(val/100);max=rate_max-rate_max*(val/100);$("rate_span").update(Math.round(min)+"-"+Math.round(max))}else{$("discount_rate").hide();return false}}$("discount_rate").show();return true}})},deleteSpecial:function(id){ab=new AlertBar();ab.show("Are you sure you want to delete this special? This action cannot be undone.",{alertType:"warning",addOpaque:true,options:[{text:"Delete",callback:(function(){FlipKey.Ajax.request("/dashboards/delete_special/"+id,{onLoading:(function(){ab.show("Loading...",{alertType:"info"})}).bind(this),onComplete:(function(response){json=eval("("+response.responseText+")");if(json[0]){UI.Tabs.reload();tab=$$("div#specials_tabs li.UI_tab_buttons_active span.text")[0];tab_arr=tab.innerHTML.split(" ");if(json[2]["count"]){tab.update(tab_arr[0]+" ("+json[2]["count"]+")")}else{tab.update(tab_arr[0])}ab.show("Your special offer was deleted successfully",{alertType:"success",autoHideAfter:2})}else{ab.show(json[1],{closeable:true})}}).bind(this)})}).bind(this)},{text:"Cancel",callback:function(){ab.hide()}}]})}});FlipKey.MapMetaV3={poi_preferences:{}};FlipKey.MapsV3=function(){return true};FlipKey.MapsV3.prototype={options:{},meta_div:null,working:false,poiMarkers:new Array(),poiOverlay:null,poisLoaded:false,propMarker:null,map:null,infoBox:null,pinLayer:null,infoBoxLayer:null,_infoBoxContent:"",removeInfoBox:function(){this._infoBoxContent="";this.infoBox.setOptions({visible:false})},newMap:function(options){var defaultOptions=$H({zoom:9,width:520,height:245,exact:0});options=defaultOptions.merge(options).toObject();this.options=options;this._renderMap();if(options.precision!="location"){setTimeout((function(){this.repopulatePois.bind(this).curry(arguments.callee.bind(this))()}).bind(this),1000)}},editPOI:function(el){this.repopulatePois()},onMove:function(map){if(this._infoBoxContent==""){this.repopulatePois()}else{this.infoBox.setOptions({visible:true});this.infoBox.setHtmlContent(this._infoBoxContent);this._infoBoxContent="";if(document.querySelector(".Infobox")){document.querySelector(".Infobox").parentNode.style.pointerEvents="";document.querySelector(".poi_overlay").parentNode.style.pointerEvents="auto"}}},update_pins:function(){},repopulatePois:function(){if(!this.working){if(this.map.getZoom()<12&&!this.editedMetaData){return}var meta_params=$("map_meta_form").serialize(true);var to_remove=$A();if(!$("MapMetaAttractions").checked){to_remove.push("attraction")}if(!$("MapMetaEateries").checked){to_remove.push("eatery")}if(!$("MapMetaNearby").checked){to_remove.push("property")}this.clearPOIMarkers(to_remove);this.working=true;var center=new Microsoft.Maps.Location(options.latitude,options.longitude);var bounds=this.map.getBounds();var bottom_right=bounds.getNorthwest();var top_left=bounds.getSoutheast();var bound_params={"data[center_lat]":center.latitude,"data[center_lng]":center.longitude,"data[bounds_tl_lat]":top_left.latitude,"data[bounds_br_lat]":bottom_right.latitude,"data[bounds_tl_lng]":bottom_right.longitude,"data[bounds_br_lng]":top_left.longitude,"data[first_load]":this.poisLoaded?"0":"1"};var search_params={"data[MapMeta][attractions]":$("MapMetaAttractions").checked?"1":"0","data[MapMeta][eateries]":$("MapMetaEateries").checked?"1":"0","data[MapMeta][nearby]":$("MapMetaNearby").checked?"1":"0"};var map_params=$H(bound_params).merge(search_params).toObject();FlipKey.Ajax.request("/properties/getMapDetails/"+this.options.pid,{parameters:map_params,method:"post",onComplete:(function(resp){this.poisLoaded=true;var json=eval("("+resp.responseText+")");if(json.e_results&&json.e_count>0){for(i=0;i<json.e_results.length;i++){if(!json.e_results[i][0]["latitude"]){json.e_count=json.e_count-1}else{this.addPoi(json.e_results[i],"eatery")}}if(json.e_count==20){json.e_count="20+"}$("restaurant_count").update("("+json.e_count+")")}else{$("restaurant_count").update("")}if(json.a_results&&json.a_count>0){for(i=0;i<json.a_results.length;i++){this.addPoi(json.a_results[i],"attraction")}if(json.a_count==20){json.a_count="20+"}$("attraction_count").update("("+json.a_count+")")}else{$("attraction_count").update("")}if(json.p_results&&json.p_count>0){for(i=0;i<json.p_results.length;i++){this.addPoi(json.p_results[i],"property")}if(json.p_count==20){json.p_count="20+"}$("nearby_count").update("("+json.p_count+")")}else{$("nearby_count").update("")}this.working=false}).bind(this)})}},clearPOIMarkers:function(types){if(this.poiMarkers){for(i=0;i<this.poiMarkers.length;i++){if(types.indexOf(this.poiMarkers[i].type)!=-1){this.pinLayer.remove(this.poiMarkers[i]);this.poiMarkers[i]=null}}if(this.poiMarkers.length){this.poiMarkers=this.poiMarkers.without(null).toArray()}}},formatPropertyMarker:function(poi){star_count=poi.p["rating_sum"]/poi.p["rating_count"];our_width=Math.round(75/5*star_count,0);if(poi.p["rating_count"]!==1){has_s="s"}else{has_s=""}bed_bath_line="";if(poi.p["bedroom_count"]>-1){if(poi.p["bedroom_count"]==0){bed_bath_line="Bedrooms <b>Studio</b>"}else{bed_bath_line="Bedrooms <b>"+poi.p["bedroom_count"]+"</b>"}}if(poi.p["bedroom_count"]>-1&&poi.p["guest_count"]>0){bed_bath_line=bed_bath_line+"  "}if(poi.p["guest_count"]>0){bed_bath_line=bed_bath_line+"Sleeps <b>"+poi.p["guest_count"]+"</b>"}rate_information="";if(poi.p["display_rate"]&&poi.p["display_rate"]["rate"]){rate_information='<span class="rate_big">'+poi.p["display_rate"]["rate"]+"</span> /"+poi.p["display_rate"]["scope"]}middle=Builder.node("div",{"class":"middle"},[Builder.node("p",{"class":"main"},[Builder.node("a",{href:poi.p["url"]}).update(poi.p["name"])]),Builder.node("div",{"class":"photo_div"},[Builder.node("img",{src:poi.p["photo_url"],alt:"",width:"48",height:"36"})]),Builder.node("p",[Builder.node("span").update(bed_bath_line)]),Builder.node("p",[Builder.node("span").update(rate_information)])]);if(poi.p["rating_count"]>0){middle.appendChild(Builder.node("p",[Builder.node("span",{"class":"rating-b"},[Builder.node("span",{style:"width:"+our_width+"px;"},Math.round(star_count,2)),"of 5"]),Builder.node("span").update(poi.p["rating_count"]+" review"+has_s)]))}return middle},addPoi:function(poi,type){if(type=="attraction"){pintype="attraction";index="0";title=poi[0]["primaryname"]}else{if(type=="eatery"){pintype="restaurant";index="0";title=poi[0]["primaryname"]}else{pintype="nearby-rental";index="p";title=poi.p["name"]}}poimap=this.map;var pushpinOptions={icon:"/img/maps/"+pintype+"-pin.png",width:24,height:31,typeName:"poi_pushpin"};var loc=new Microsoft.Maps.Location(poi[index]["latitude"],poi[index]["longitude"]);var marker=new Microsoft.Maps.Pushpin(loc,pushpinOptions);marker.type=type;var i=0;for(i=0;i<this.pinLayer.getLength();i++){var test=this.pinLayer.get(i);var test_loc=test.getLocation();if(Microsoft.Maps.Location.areEqual(test_loc,loc)){return}}Microsoft.Maps.Events.addHandler(marker,"click",(function(e){var offset=new Microsoft.Maps.Point(-117,145);var pinInfobox=this.infoBox;pinInfobox.setLocation(e.target.getLocation());var buffer=55;var infoboxOffset=pinInfobox.getOffset();var infoboxAnchor=pinInfobox.getAnchor();var infoboxLocation=this.map.tryLocationToPixel(e.target.getLocation(),Microsoft.Maps.PixelReference.control);var dx=infoboxLocation.x+infoboxOffset.x-infoboxAnchor.x;var dy=infoboxLocation.y-65-infoboxAnchor.y;if(dy<buffer){dy*=-1;dy+=buffer}else{dy=0}if(dx<buffer){dx*=-1;dx+=buffer}else{dx=this.map.getWidth()-infoboxLocation.x+infoboxAnchor.x-pinInfobox.getWidth();if(dx>buffer){dx=0}else{dx-=buffer}}if(type=="property"){middle=this.formatPropertyMarker(poi);offset=new Microsoft.Maps.Point(-117,165)}else{switch(type){case"eatery":type="0";type_id="eatery_id";break;case"attraction":type="0";type_id="attraction_id";break}if(type=="a"){if(poi[0]["attraction_type_names"]){meta_node=Builder.node("p",[Builder.node("span",{"class":"heading"}).update("Attraction Type: "),Builder.node("span").update(poi[0]["attraction_type_names"])])}else{meta_node=Builder.node("p")}}else{if(type=="e"){meta_node=Builder.node("p");if(poi["0"]["minprice"]>0){var minPrice=FlipKey.Currency.exchange(poi["0"]["minprice"]);minPrice=FlipKey.Currency.format(minPrice);meta_node.appendChild(Builder.node("span",{"class":"heading"}).update("Price: "));meta_node.appendChild(Builder.node("span").update(minPrice+"+ | "))}if(poi["0"]["cuisine_names"]){meta_node.appendChild(Builder.node("span",{"class":"heading"}).update("Cuisines: "));meta_node.appendChild(Builder.node("span").update(poi["0"]["cuisine_names"]))}}else{meta_node=Builder.node("p")}}our_width=Math.round(51/5*poi[0]["review_score"],0);console.log(poi);if(poi[0]["total_reviews"]>0){if(poi[0]["total_reviews"]!=1){has_s="s"}else{has_s=""}rating_info=[Builder.node("span",{"class":"tarating"},[Builder.node("span",{style:"width:"+our_width+"px;"},Math.round(poi[0]["review_score"],2)),"of 5"]),Builder.node("a",{href:"http://www.tripadvisor.com/g"+poi[0]["location_id"]+"-d"+poi[0]["id"],target:"_blank",rel:"nofollow","class":"rating_count"},[Builder.node("span").update(poi[0]["total_reviews"]+" tripadvisor review"+has_s)])]}else{rating_info=[Builder.node("a",{href:"http://www.tripadvisor.com/g"+poi[0]["parent_location_id"]+"-d"+poi[type][type_id],target:"_blank",rel:"nofollow","class":"rating_count"},[Builder.node("span").update("View on TripAdvisor")])]}middle=Builder.node("div",{"class":"middle"},[Builder.node("p",{"class":"main"}).update(poi[0]["primaryname"]),Builder.node("p",rating_info),meta_node])}div=new Element("div",{id:"poi_overlay_box","class":"poi_overlay"});upper=new Element("div",{"class":"upper"});closediv=Builder.node("div",{"class":"closebox-outer"},[Builder.node("a",{href:"javascript:void(0)",onclick:"FlipKey.mapzz.removeInfoBox()"},[Builder.node("div",{"class":"closebox"})])]);bottom=new Element("div",{"class":"bottom"});div.insert(closediv);div.insert(upper);div.insert(middle);div.insert(bottom);this._div=div;height=100;this._offsetVertical=this._offsetVertical-height;this._height=height;div.setStyle({visibility:"visible"});if(dx!=0||dy!=0){pinInfobox.setOptions({showPointer:false,showCloseButton:false,title:e.target.Title,description:e.target.Description,visible:false,offset:offset});this._infoBoxContent='<div class="poi_overlay" style="z-index: 1000;">'+div.innerHTML+"</div>";this.map.setView({centerOffset:new Microsoft.Maps.Point(dx,dy),center:this.map.getCenter()})}else{this.infoBox.setHtmlContent('<div class="poi_overlay">'+div.innerHTML+"</div>");pinInfobox.setOptions({showPointer:false,showCloseButton:false,title:e.target.Title,description:e.target.Description,visible:true,offset:offset});if(document.querySelector(".Infobox")){document.querySelector(".Infobox").parentNode.style.pointerEvents="";document.querySelector(".poi_overlay").parentNode.style.pointerEvents="auto"}}}).bind(this));this.poiMarkers.push(marker);this.pinLayer.push(marker)},closeCurrentOverlay:function(){if(this.poiOverlay){if(this.poiOverlay._div){this.poiOverlay.close.call(this.poiOverlay)}else{this.poiOverlay=null}}},_renderMap:function(){options=this.options;switch(options.exact==1?options.precision:""){case"coord":maxZoom=21;break;case"street":maxZoom=19;break;case"city":default:maxZoom=15;break}var center=new Microsoft.Maps.Location(options.latitude,options.longitude);var mapOptions={width:options.width,height:options.height,credentials:options.key,showMapTypeSelector:false,enableClickableLogo:false,enableSearchLogo:false,zoom:options.zoom,mapTypeId:Microsoft.Maps.MapTypeId.road,center:center};real_map=new Microsoft.Maps.Map($(options.source),mapOptions);this.pinLayer=new Microsoft.Maps.EntityCollection();real_map.entities.push(this.pinLayer);var infoboxLayer=new Microsoft.Maps.EntityCollection();real_map.entities.push(infoboxLayer);this.infoBox=new Microsoft.Maps.Infobox(new Microsoft.Maps.Location(0,0),{visible:false,zIndex:2});infoboxLayer.push(this.infoBox);this.map=real_map;type="property";if(options.exact==1&&(options.precision=="coord"||options.precision=="street")){var pushpinOptions={icon:"/img/maps/current-rental-pin.png",width:30,height:43,typeName:"poi_pushpin_property"};marker=new Microsoft.Maps.Pushpin(center,pushpinOptions);this.pinLayer.push(marker);this.propMarker=marker;var poi=options.poi;Microsoft.Maps.Events.addHandler(marker,"click",(function(e){var offset=new Microsoft.Maps.Point(-117,145);var pinInfobox=this.infoBox;pinInfobox.setLocation(e.target.getLocation());var buffer=55;var infoboxOffset=pinInfobox.getOffset();var infoboxAnchor=pinInfobox.getAnchor();var infoboxLocation=this.map.tryLocationToPixel(e.target.getLocation(),Microsoft.Maps.PixelReference.control);var dx=infoboxLocation.x+infoboxOffset.x-infoboxAnchor.x;var dy=infoboxLocation.y-65-infoboxAnchor.y;if(dy<buffer){dy*=-1;dy+=buffer}else{dy=0}if(dx<buffer){dx*=-1;dx+=buffer}else{dx=this.map.getWidth()-infoboxLocation.x+infoboxAnchor.x-pinInfobox.getWidth();if(dx>buffer){dx=0}else{dx-=buffer}}middle=this.formatPropertyMarker(poi);offset=new Microsoft.Maps.Point(-117,175);div=new Element("div",{id:"poi_overlay_box","class":"poi_overlay"});upper=new Element("div",{"class":"upper"});closediv=Builder.node("div",{"class":"closebox-outer"},[Builder.node("a",{href:"javascript:void(0)",onclick:"FlipKey.mapzz.removeInfoBox()"},[Builder.node("div",{"class":"closebox"})])]);bottom=new Element("div",{"class":"bottom"});div.insert(closediv);div.insert(upper);div.insert(middle);div.insert(bottom);this._div=div;height=100;this._offsetVertical=this._offsetVertical-height;this._height=height;div.setStyle({visibility:"visible"});if(dx!=0||dy!=0){pinInfobox.setOptions({showPointer:false,showCloseButton:false,title:e.target.Title,description:e.target.Description,visible:false,offset:offset});this._infoBoxContent='<div class="poi_overlay" style="z-index: 1000;">'+div.innerHTML+"</div>";this.map.setView({centerOffset:new Microsoft.Maps.Point(dx,dy),center:this.map.getCenter()})}else{this.infoBox.setHtmlContent('<div class="poi_overlay">'+div.innerHTML+"</div>");pinInfobox.setOptions({showPointer:false,showCloseButton:false,title:e.target.Title,description:e.target.Description,visible:true,offset:offset});if(document.querySelector(".Infobox")){document.querySelector(".Infobox").parentNode.style.pointerEvents="";document.querySelector(".poi_overlay").parentNode.style.pointerEvents="auto"}}}).bind(this))}else{if(options.precision=="location"){this.propMarker=null;op=new Element("div",{id:"opaque_map_div"}).setStyle({position:"absolute",height:"100%",width:"100%",zIndex:2,top:0});$("google_map").setStyle({position:"relative"}).appendChild(op);$("map_bad_location_popup").setStyle({visibility:"hidden",display:"block"});var h,ph;var d=$("map_bad_location_popup").getDimensions();$("map_bad_location_popup").setStyle({visibility:"visible",display:"none"});h=d.height;w=d.width;display_div=$("map_bad_location_popup").remove();pd=op.getDimensions();ph=pd.height;pw=pd.width;display_div.setStyle({position:"relative"});op.appendChild(display_div.setStyle({top:(ph/2)-(h/2)+"px",left:(pw/2)-(w/2)+"px"}).show())}else{var pushpinOptions={icon:"/img/maps/approximate-area.png",width:120,height:120,typeName:"POI_pushpin"};marker=new Microsoft.Maps.Pushpin(center,pushpinOptions);this.propMarker=marker;this.pinLayer.push(marker)}}Microsoft.Maps.Events.addHandler(this.map,"viewchangeend",(function(){this.onMove(real_map)}).bind(this));Microsoft.Maps.Events.addHandler(this.map,"mousewheel",function(e){e.handled=true;return})}};FlipKey.EstimatedRates={symbol:null,exchange_rate:null,submitDates:function(pid,fid,loading_div,rando){if(!rando){rando=""}if(!loading_div){loading_div="rate-callout-box"}if("estimated-rate-error"+rando){$("estimated-rate-error"+rando).hide()}$$("#estimated-rates-form"+rando+" input.hasDefault").each(function(el){el.value="";el.removeClassName("hasDefault")});FlipKey.Pdp.isLoading(loading_div,{noAnimation:true});FlipKey.Ajax.request("/properties/updateEstimatedRates/"+pid+"/"+fid+"/",{parameters:$("estimated-rates-form"+rando).serialize(true),onComplete:function(response){json=eval("("+response.responseText+")");if(json.status){$$("input.arrival_date").each(function(el){el.value=json.from;el.removeClassName("hasDefault")});$$("input.departure_date").each(function(el){el.value=json.to;el.removeClassName("hasDefault")});$("estimated-rate-callout").innerHTML="";ratetext=json.stats["display"];ratepriceunit="/night";if(!json.stats["min_display_rate"]>0&&!json.stats["max_display_rate"]>0){ratepriceunit=""}erate=Builder.node("p",{"class":"rate-callout"},[Builder.node("span",{"class":"rate-highlight"},[Builder.node("span",{"class":"price"}).update(ratetext),]),Builder.node("span",{"class":"price-unit"},ratepriceunit)]);erate_d_text=Builder.node("p",{"class":"selected-date-text"},["For trip dates ",Builder.node("strong").update(json.from)," to ",Builder.node("strong").update(json.to),"  ",Builder.node("a",{onclick:"FlipKey.EstimatedRates.clearDates()",href:"javascript:void(0);","class":"italic ltb"},"clear dates")]);$("estimated-rate-callout").appendChild(erate);$("estimated-rate-callout").appendChild(erate_d_text);$("estimated-rate-dates").hide();$("estimated-rate-error").hide();$("overall-rate-range-display").hide();$("estimated-rate-display-div").show();if($("estimated-rates-summary-div")){serate=Builder.node("p",{"class":"rate-callout"},[Builder.node("span",{"class":"rate-highlight"},[Builder.node("span",{"class":"price"}).update(ratetext),]),Builder.node("span",{"class":"price-unit"},ratepriceunit)]);serate_d_text=Builder.node("p",{"class":"selected-date-text"},["For trip dates ",Builder.node("strong").update(json.from)," to ",Builder.node("strong").update(json.to),"  ",Builder.node("a",{onclick:"FlipKey.EstimatedRates.clearDates()",href:"javascript:void(0);","class":"italic ltb"},"clear dates")]);$("summary-estimated-rate-callout").update();$("summary-estimated-rate-callout").appendChild(serate);$("summary-estimated-rate-callout").appendChild(serate_d_text);$("summary-rates-summary-div").hide();$("estimated-rates-summary-div").show()}if($("estimated-rates-summary-div-variation1")){serate=Builder.node("p",{"class":"rate-callout"},[Builder.node("span",{"class":"rate-highlight"},[Builder.node("span",{"class":"price"}).update(ratetext),]),Builder.node("span",{"class":"price-unit"},ratepriceunit)]);serate_d_text=Builder.node("p",{"class":"selected-date-text"},["For trip dates ",Builder.node("strong",{className:"trip_dates_from"}).update(json.from)," to ",Builder.node("strong",{className:"trip_dates_to"}).update(json.to),"  ",Builder.node("a",{onclick:"FlipKey.EstimatedRates.clearDates()",href:"javascript:void(0);","class":"italic ltb"},"clear dates")]);$("summary-estimated-rate-callout-variation1").update();$("summary-estimated-rate-callout-variation1").appendChild(serate);$("summary-estimated-rate-callout-variation1").appendChild(serate_d_text);$("summary-rates-summary-div-variation1").hide();$("estimated-rates-summary-div-variation1").show()}if($$("#summary_rate_sidebar_variation1 > form")[0]){side_bar_rando=$$("#summary_rate_sidebar_variation1 > form")[0].id.replace("inquiry-form","");FlipKey.EstimatedRates.showTripDates(side_bar_rando,json.from,json.to)}if($$("#footer-inquiry-form > form")[0]){side_bar_rando=$$("#footer-inquiry-form > form")[0].id.replace("inquiry-form","");FlipKey.EstimatedRates.showTripDates(side_bar_rando,json.from,json.to)}if($$("#lightbox-inquiry-form > form")[0]){side_bar_rando=$$("#lightbox-inquiry-form > form")[0].id.replace("inquiry-form","");FlipKey.EstimatedRates.showTripDates(side_bar_rando,json.from,json.to)}$$("estimated-rate-divs").invoke("show");$$("estimated-rate-summary-divs").invoke("hide")}else{$("estimated-rate-error"+rando).show().update(json.errors["error"])}$("tabs-loading-div").hide()}})},clearDates:function(){$$(".estimated-rate-divs").invoke("hide");$$(".estimated-rate-summary-divs").invoke("show");$$(".estimated-rate-summary-divs input.arrival_date").each(function(el){el.value=""});$$(".estimated-rate-summary-divs input.departure_date").each(function(el){el.value=""})},toggleDetails:function(el,div_id){el=Element.extend(el);if($(div_id).style.display=="none"){el.removeClassName("arrow-right").addClassName("arrow-down")}else{el.removeClassName("arrow-down").addClassName("arrow-right")}$(div_id).toggle()},showTripDates:function(rando,start,end){$("inquiry-trip-dates-"+rando).show();$("trip_dates-"+rando).update(start+" - "+end);$("inquiry-to-"+rando).value=end;$("inquiry-from-"+rando).value=start;$("inquiry-form-to-"+rando).hide()}};FlipKey.PdpAvailabilityDisplay=Class.create(DatePicker,{initialize:function(params){var i,date_obj;this.params=params;this.cal=new Array();for(i=0;i<6;i++){this.cal.push(Calendar.setup({parentElement:this.params.id+"_month_"+(i+1),disabledHandler:this.disableDates,datePicker:this,type:"static"}));if(i==0){date_obj=new Date()}else{new Date().set("+"+i+"m")}this.cal[i].update(date_obj,true)}this.prevEvent=this.prev.bindAsEventListener(this);this.nextEvent=this.next.bindAsEventListener(this);$("prev_dates").observe("click",this.prevEvent);$("next_dates").observe("click",this.nextEvent)},prev:function(){this.cal.each((function(c){var cdate;cdate=c.date;cdate.setDate(1);cdate.setMonth(cdate.getMonth()-this.cal.size());c.update(cdate,true)}).bind(this))},next:function(){this.cal.each((function(c){var cdate;cdate=c.date;cdate.setDate(1);cdate.setMonth(cdate.getMonth()+this.cal.size());c.update(cdate,true)}).bind(this))}});FlipKey.Pdp={inquiry_vacant_dates:null,specials:null,datepickers:new Array(),Reviews:{showPhotoViewer:function(reviewPhotoViewer,id){reviewPhotoViewer.createViewer();FlipKey.showLightboxFromDiv("photo-viewer",true,false,null,{arches:true,close_callback:reviewPhotoViewer.destroy.bind(reviewPhotoViewer)});reviewPhotoViewer.init(id.toString())}},rates:{toggleRateDisplays:function(el,content_el){el=Element.extend(el);content_el=$(content_el);if(content_el.style.display=="none"){el.select("span").invoke("update","&#9662;");content_el.show()}else{el.select("span").invoke("update","&#9656;");content_el.hide()}}},onload:function(params){FlipKey.booked_dates=params.availability;FlipKey.rates_calendar=new FlipKey.PdpAvailabilityDisplay({id:"rates",staticmap:true});FlipKey.EstimatedRates.symbol=params.symbol;FlipKey.EstimatedRates.exchange_rate=params.currency_rate;Event.observe(document,"FlipKey:pageloaded",function(){var specials,open_special_box;specials=new FlipKey.Specials(params.special);FlipKey.Pdp.specials=specials;open_special_box=params.open_special_box;if(open_special_box&&$$("div.specials-lightbox")){FlipKey.Pdp.specials.showDetailedLightbox(params.special.Special["id"])}$$(".tooltiplink").each(function(ele){ele.setStyle({cursor:"pointer"});new Tooltip(ele,{metalabs:true,maxWidth:359,yOffset:40,mouseFollow:false,xOffset:10})});FlipKey.setupDefaultText();if($("review_confirmation_lightbox")){FlipKey.showLightboxFromDiv("review_confirmation_lightbox",true,false,null,{archesnew:true})}})},checkAvailDates:function(rando,prefix){function avail_dates(avail_huh){FlipKey.Pdp.inquiry_vacant_dates=avail_huh;return avail_huh}if(!rando){rando=""}if(!prefix){prefix="inquiry-"}if(!$F(prefix+"to"+rando)||!$F(prefix+"from"+rando)){return avail_dates(true)}if(!$F(prefix+"to"+rando).match(/\d{2}\/\d{2}\/\d{4}/)||!$F(prefix+"from"+rando).match(/\d{2}\/\d{2}\/\d{4}/)){return avail_dates(true)}to=new Date($F(prefix+"to"+rando));from=new Date($F(prefix+"from"+rando));diff=(Date.parse($F(prefix+"to"+rando))-Date.parse($F(prefix+"from"+rando)))/(3600000*24);if(diff>60){return avail_dates(true)}tostring=Date.parse(to);function checkSingleDate(now){if(Date.parse(now)>=tostring){return avail_dates(true)}year=now.getFullYear();month=now.getMonth();day=now.getDate();if(!FlipKey.booked_dates){return avail_dates(true)}if(FlipKey.booked_dates[year]){if(FlipKey.booked_dates[year]=="all"){return avail_dates(false)}if(FlipKey.booked_dates[year][month]){if(FlipKey.booked_dates[year][month]=="all"){return avail_dates(false)}var range,i;for(i=0;i<FlipKey.booked_dates[year][month].length;i++){range=FlipKey.booked_dates[year][month][i];if(range&&day>=range[0]&&day<=range[1]){return avail_dates(false)}}}}now.setDate(now.getDate()+1);return avail_dates(arguments.callee(now))}return checkSingleDate(from)},isLoading:function(ele,loadingOptions){var type=typeof ele;if(type=="string"){ele=$(ele)}ele.setStyle({position:"relative"});if($("tabs-loading-div")){$("tabs-loading-div").remove()}loading=new Element("div",{id:"tabs-loading-div"});loading.setStyle({position:"absolute",top:"0px",left:"0px",display:"none",zIndex:100,width:"100%",height:"100%",backgroundColor:"white",textAlign:"center"});loading_span=new Element("span");loading_img=new Element("img",{src:"/img/house-throbber-32x32.gif",height:32,width:32});loading_text=new Element("span",{className:"loadingText"}).update("Loading");loading_span.appendChild(loading_img);loading_span.appendChild(loading_text);loading.appendChild(loading_span);ele.appendChild(loading);$("tabs-loading-div").setStyle({visibility:"hidden",display:"block"});element=$("tabs-loading-div").select("span")[0];var h,ph;var d=element.getDimensions();h=d.height;pd=loading.getDimensions();ph=pd.height;element.setStyle({position:"relative"});element.setStyle({top:(ph/2)-(h/2)+"px"});$("tabs-loading-div").setStyle({visibility:"visible",display:"none"});$("tabs-loading-div").setOpacity(0.7);$("tabs-loading-div").show();return true}};FlipKey.Photo={property_id:"",holding_frontdesk_id:"",Sprite:{totalPhotos:0,photo_viewer:null,preload:function(photo_viewer){FlipKey.Photo.Sprite.totalPhotos=photo_viewer.photoOverview.num_photos;FlipKey.Photo.property_id=photo_viewer.photoOverview.property_id;FlipKey.Photo.holding_frontdesk_id=photo_viewer.photoOverview.holding_frontdesk_id;this.photo_viewer=photo_viewer},init:function(){var primaryPhotoDisplayed=0;$("photo-thumbs-inner").observe("mouseover",function(event){var element=Event.findElement(event,"div");var newPhotoId=element.id.replace(/^photo-sprite-(\d+)$/,"$1");if(newPhotoId=="photo-sprite-video"){newPhotoId="video"}if(((newPhotoId.match(/^\d+$/)&&newPhotoId<FlipKey.Photo.Sprite.totalPhotos)||newPhotoId=="video")&&newPhotoId!=primaryPhotoDisplayed){$("primary-photo-"+primaryPhotoDisplayed).hide();$("primary-photo-"+newPhotoId).show();if($("primary-photo-"+newPhotoId).hasClassName("show_zoom")&&$("zoom-icon")){$("zoom-icon").show()}else{if($("zoom-icon")){$("zoom-icon").hide()}}primaryPhotoDisplayed=newPhotoId}});$("photo-thumbs-inner").observe("click",function(event){var element=Event.findElement(event,"div");var videoId=element.firstDescendant();if(videoId!=null){videoId=videoId.id.replace(/^video-thumb-(\d+)$/,"$1")}FlipKey.Photo.Sprite.photo_viewer.preload();FlipKey.showLightboxFromDiv("photo-viewer",true,false,null,{arches:true,close_callback:FlipKey.Photo.Sprite.photo_viewer.destroy.bind(FlipKey.Photo.Sprite.photo_viewer)});if(videoId!=null&&videoId.match(/^\d+$/)){videoId=FlipKey.Photo.Sprite.totalPhotos-1+parseInt(videoId);FlipKey.Photo.Sprite.photo_viewer.init(videoId.toString())}else{var newPhotoId=element.id.replace(/^photo-sprite-(\d+)$/,"$1");FlipKey.Photo.Sprite.photo_viewer.init(newPhotoId)}if(typeof _gaq!=="undefined"&&typeof _gaq.push==="function"){if(FlipKey.Photo.property_id){_gaq.push(["_trackEvent","FlipKey.Photo.Sprite.photo_viewer","sprite_thumb_click",FlipKey.Photo.property_id])}else{_gaq.push(["_trackEvent","FlipKey.Photo.Sprite.photo_viewer","frontdesk_thumb_click",FlipKey.Photo.holding_frontdesk_id])}}});$("photo-primary").observe("click",function(event){var element=Event.findElement(event);var videoId=$(element).readAttribute("videoid");FlipKey.Photo.Sprite.photo_viewer.preload();FlipKey.showLightboxFromDiv("photo-viewer",true,false,null,{arches:true,close_callback:FlipKey.Photo.Sprite.photo_viewer.destroy.bind(FlipKey.Photo.Sprite.photo_viewer)});if(videoId!=null&&videoId.match(/^\d+$/)){var photoId=FlipKey.Photo.Sprite.totalPhotos-1+parseInt(videoId);FlipKey.Photo.Sprite.photo_viewer.init(photoId.toString())}else{var newPhotoId=element.id.replace(/^primary-photo-(\d+)$/,"$1");FlipKey.Photo.Sprite.photo_viewer.init(newPhotoId)}if(typeof _gaq!=="undefined"&&typeof _gaq.push==="function"){if(FlipKey.Photo.property_id){_gaq.push(["_trackEvent","photo_viewer","primary_photo_click",FlipKey.Photo.property_id])}else{_gaq.push(["_trackEvent","photo_viewer","primary_forntdesk_photo_click",FlipKey.Photo.holding_frontdesk_id])}}})},change:function(dir,el){if(!Element.extend(el).hasClassName("photo-thumbs-arrow-active")){return false}var active_thumb=$$("#photo-thumbs .photo-sprite-row-wrapper-active");if(active_thumb&&active_thumb[0]){}if((dir==1&&!active_thumb[0].next()&&active_thumb[0].next().hasClassName("photo-sprite-row-wrapper"))||(dir==-1&&!active_thumb[0].previous()&&active_thumb[0].previous().hasClassName("photo-sprite-row-wrapper"))){return false}active_thumb[0].removeClassName("photo-sprite-row-wrapper-active").hide();if(dir==1){var new_active=active_thumb[0].next().addClassName("photo-sprite-row-wrapper-active").show()}else{var new_active=active_thumb[0].previous().addClassName("photo-sprite-row-wrapper-active").show()}if(new_active.next()&&new_active.next().hasClassName("photo-sprite-row-wrapper")){$("photo-thumbs-arrow-right").removeClassName("photo-thumbs-arrow-inactive").addClassName("photo-thumbs-arrow-active")}else{$("photo-thumbs-arrow-right").removeClassName("photo-thumbs-arrow-active").addClassName("photo-thumbs-arrow-inactive")}if(new_active.previous()&&new_active.previous().hasClassName("photo-sprite-row-wrapper")){$("photo-thumbs-arrow-left").removeClassName("photo-thumbs-arrow-inactive").addClassName("photo-thumbs-arrow-active")}else{$("photo-thumbs-arrow-left").removeClassName("photo-thumbs-arrow-active").addClassName("photo-thumbs-arrow-inactive")}return true}}};FlipKey.Photo.Viewer=function(viewerType,photoOverview,photoData,objectName){this.setDefaults();this.viewerType=viewerType;this.photoOverview=photoOverview;this.photoData=photoData;this.totalPhotos=this.photoOverview.num_photos;this.objectName=objectName;this.preloadedPhotoIndex={};return true};FlipKey.Photo.Viewer.prototype={currentViewerType:null,photosPerSection:8,prefetchDistance:3,objectName:null,setDefaults:function(){this.currentSectionOffset=-1;this.loadedSectionOffset={};this.insertedPhotoIndex={};this.hoverPhoto=-1;this.primaryPhotoDisplayed=-1;this.keyHandlerBinding=null},preload:function(){this.createViewer()},fetch:function(startIndex,endIndex,insert){if(typeof insert=="undefined"){insert=true}if(startIndex<0){var diff=Math.abs(startIndex);startIndex=0;endIndex=endIndex+diff}var i=startIndex;for(i;i<=endIndex;i++){if(typeof this.preloadedPhotoIndex[i]=="undefined"){this.preloadedPhotoIndex[i]={};if(i<this.totalPhotos){if(this.photoData[i]["videosrc"]!=undefined&&this.photoData[i]["videosrcid"]!=undefined){this.preloadedPhotoIndex[i]["video"]=this.photoData[i]}else{var photo=new Image();photo.src=this.photoData[i]["path"];photo.alt=this.photoData[i]["alt"];photo.id="photo-viewer-"+this.photoData[i]["id"];photo.style.cssText=this.photoData[i]["style"];this.preloadedPhotoIndex[i]["photo"]=photo}var thumb='<img width="100" height="75" src="'+this.photoData[i]["path"]+'" alt="'+this.photoData[i]["alt"].replace(/\<[^\>]+\>/g,"").replace(/"/g,"")+'" id="photo-viewer-thumb-'+this.photoData[i]["id"]+'" />';this.preloadedPhotoIndex[i]["thumb"]=thumb}else{this.preloadedPhotoIndex[i]["thumb-placeholder"]='<div class="thumb-placeholder"></div>'}}}if(insert){this.insertPhotos(startIndex,endIndex)}},createViewer:function(){if(this.viewerType==FlipKey.Photo.Viewer.currentViewerType){return true}else{if(FlipKey.Photo.Viewer.currentViewerType!=null){FlipKey.YouTube.destroy();this.destroy();$("photo-viewer").remove()}FlipKey.Photo.Viewer.currentViewerType=this.viewerType;this.setDefaults()}var display_name="";if(this.photoOverview.property_name){display_name=this.photoOverview.property_name}else{display_name=this.photoOverview.frontdesk_name}var html;html='<div id="photo-viewer" style="display: none;"><h3>Photos of '+display_name+'</h3><div id="photo-nav-container" style="width: '+(this.photoOverview.max_photo_width+120)+'px;"><div id="left-nav" style="height: '+this.photoOverview.max_photo_height+'px;"><span id="left-nav-button" style="position: relative; top: '+(this.photoOverview.max_photo_height/2-20)+'px;  width: 25px; height:34px; display: block;" class="general-photo-previous"></span></div><div id="photo-frame" style="height: '+this.photoOverview.max_photo_height+"px; width: "+this.photoOverview.max_photo_width+'px;"><div id="photo-viewer-photos" style="height: '+this.photoOverview.max_photo_height+"px; width: "+this.photoOverview.max_photo_width+'px;"></div></div><div id="right-nav" style="height: '+this.photoOverview.max_photo_height+'px;"><span id="right-nav-button" style="position: relative; top: '+(this.photoOverview.max_photo_height/2-20)+'px; width: 25px; height:34px; display: block;" class="general-photo-next"></span></div><br class="cleaner" /></div><p id="photo-caption-wrapper"><span id="photo-caption"></span></p><div id="photo-viewer-thumbs"></div><div id="photo-viewer-footer"><div id="photo-pagination"><span class="light-text">Showing photos: </span>';var start,end,offset;for(var i=0;i<this.totalPhotos;i=i+this.photosPerSection){start=i+1;offset=i/this.photosPerSection;if((i+this.photosPerSection)>=this.totalPhotos){end=this.totalPhotos;html+='<a href="javascript:void(0);" id="thumb-nav-'+offset+'" onclick="FlipKey.'+this.objectName+".switchPhoto("+i+');">'+start+" - "+end+"</a>"}else{end=i+this.photosPerSection;html+='<a href="javascript:void(0);" id="thumb-nav-'+offset+'" onclick="FlipKey.'+this.objectName+".switchPhoto("+i+');">'+start+" - "+end+"</a> | "}}html+="</div>";if(FlipKey.Photo.property_id){html+='<div id="photo-links"><span class="light-text">Looking good? </span><a href="#pdp-title" onclick="FlipKey.closeLightbox();">View details</a> | <a href="#pdp-rates" onclick="FlipKey.closeLightbox();">Check rates</a> | <a href="javascript:void(0);" onclick="FlipKey.closeLightbox(); FlipKey.inquiry.popup_inq = true; FlipKey.showLightboxFromDiv(\'inquiry_form_lightbox\', true, false, null, {arches : true});">Ask a question</a></div>'}html+='</div><div class="cleaner"></div></div></div>';$("arches").insert(html);this.fetch(0,7);var target=$("photo-viewer");if(typeof target.onselectstart!="undefined"){target.onselectstart=function(){return false}}else{if(typeof target.style.MozUserSelect!="undefined"){target.style.MozUserSelect="none"}else{target.onmousedown=function(){return false}}}},insertPhotos:function(startIndex,endIndex){var i=startIndex;for(i;i<=endIndex;i++){var section=Math.floor(i/this.photosPerSection);if(this.loadedSectionOffset[section]!=true){$("photo-viewer-thumbs").insert('<div id="thumb-section-'+section+'" style="display:none;"></div>');this.loadedSectionOffset[section]=true}if(typeof this.preloadedPhotoIndex[i]!="undefined"){if(this.insertedPhotoIndex[i]!=true){if(typeof this.preloadedPhotoIndex[i]["photo"]!="undefined"&&typeof this.preloadedPhotoIndex[i]["thumb"]!="undefined"){$("photo-viewer-photos").insert(this.preloadedPhotoIndex[i]["photo"]);$("thumb-section-"+section).insert(this.preloadedPhotoIndex[i]["thumb"])}else{if(typeof this.preloadedPhotoIndex[i]["video"]!="undefined"&&typeof this.preloadedPhotoIndex[i]["thumb"]!="undefined"){$("photo-viewer-photos").insert(this.embededVideoSrc(this.preloadedPhotoIndex[i]["video"]));$("thumb-section-"+section).insert(this.preloadedPhotoIndex[i]["thumb"]);FlipKey.YouTube.create()}else{if(typeof this.preloadedPhotoIndex[i]["thumb-placeholder"]!="undefined"){$("thumb-section-"+section).insert(this.preloadedPhotoIndex[i]["thumb-placeholder"])}}}this.insertedPhotoIndex[i]=true}}}},init:function(defaultPhoto){if(typeof defaultPhoto!="undefined"&&defaultPhoto.match(/^\d+$/)){var startIndex;if(defaultPhoto!=0){startIndex=Math.floor(defaultPhoto/this.photosPerSection)*this.photosPerSection;this.fetch(startIndex,startIndex+this.photosPerSection-1)}this.switchPhoto(defaultPhoto)}else{this.switchPhoto(0)}$("photo-viewer-thumbs").observe("mouseover",function(event){var element=Event.findElement(event,"img");if(!element||element.hasClassName("thumb-placeholder")){return false}if(typeof element!="undefined"){var newPhotoId=element.id.replace(/^.+-(\d+)$/,"$1");if(newPhotoId.match(/^\d+$/)&&newPhotoId!=this.hoverPhoto){this.removeHover();this.addHover(newPhotoId);this.hoverPhoto=newPhotoId}}}.bind(this));$("photo-viewer-thumbs").observe("mouseout",function(event){this.removeHover()}.bind(this));$("photo-viewer-thumbs").observe("click",function(event){var element=Event.findElement(event,"img");if(!element||element.hasClassName("thumb-placeholder")){return false}var newPhotoId=element.id.replace(/.+-(\d+)$/,"$1");if(newPhotoId.match(/^\d+$/)&&newPhotoId!=this.primaryPhotoDisplayed){this.switchPhoto(newPhotoId)}}.bind(this));$("left-nav").observe("click",function(event){this.moveLeft()}.bind(this));$("right-nav").observe("click",function(event){this.moveRight()}.bind(this));$("photo-frame").observe("click",function(event){this.moveRight()}.bind(this));this.keyHandlerBinding=this.keyEventHandler.bind(this);$(document).observe("keydown",this.keyHandlerBinding);return true},keyEventHandler:function(event){var key=event.which||event.keyCode;switch(key){case Event.KEY_LEFT:this.removeHover();this.moveLeft();break;case Event.KEY_RIGHT:case Event.KEY_RETURN:this.removeHover();this.moveRight();break}},moveRight:function(){if(this.primaryPhotoDisplayed<(this.totalPhotos-1)){var newPhotoId=this.primaryPhotoDisplayed+1;this.switchPhoto(newPhotoId)}else{this.switchPhoto(0)}},moveLeft:function(){if(this.primaryPhotoDisplayed>0){var newPhotoId=this.primaryPhotoDisplayed-1;this.switchPhoto(newPhotoId)}else{this.switchPhoto(this.totalPhotos-1)}},switchPhoto:function(newPhotoId){newPhotoId=Number(newPhotoId);if(newPhotoId!=this.primaryPhotoDisplayed&&newPhotoId>=0&&newPhotoId<this.totalPhotos){var offset=Math.floor(newPhotoId/this.photosPerSection);if(offset!=this.currentSectionOffset){if(this.currentSectionOffset>=0){$("thumb-section-"+this.currentSectionOffset).hide();$("thumb-nav-"+this.currentSectionOffset).removeClassName("current-photos")}if(offset>0){this.fetch(offset*this.photosPerSection,offset*this.photosPerSection+this.photosPerSection-1)}$("thumb-section-"+offset).show();$("thumb-nav-"+offset).addClassName("current-photos");this.currentSectionOffset=offset}if(newPhotoId>this.primaryPhotoDisplayed){this.fetch(newPhotoId,newPhotoId+this.prefetchDistance,false)}else{this.fetch(newPhotoId-this.prefetchDistance,newPhotoId,false)}if(this.primaryPhotoDisplayed>=0){$("photo-viewer-"+this.primaryPhotoDisplayed).hide();$("photo-viewer-thumb-"+this.primaryPhotoDisplayed).removeClassName("active")}$("photo-viewer-"+newPhotoId).show();$("photo-viewer-thumb-"+newPhotoId).addClassName("active");if($("photo-viewer-"+newPhotoId).hasAttribute("video")){$("photo-caption").update();$("photo-frame").stopObserving()}else{var currentPhoto=$("photo-viewer-"+this.primaryPhotoDisplayed);if(currentPhoto&&currentPhoto.hasAttribute("video")){$("photo-frame").observe("click",function(event){this.moveRight()}.bind(this));eval("FlipKey."+currentPhoto.readAttribute("video")+".stopVideo()")}if(this.photoData[newPhotoId]["caption"]){$("photo-caption").update(this.photoData[newPhotoId]["caption"])}else{$("photo-caption").update()}}this.primaryPhotoDisplayed=newPhotoId}},removeHover:function(){if(this.hoverPhoto!=-1){$("photo-viewer-thumb-"+this.hoverPhoto).removeClassName("hover");this.hoverPhoto=-1}},addHover:function(newPhotoId){$("photo-viewer-thumb-"+newPhotoId).addClassName("hover")},destroy:function(){$("photo-viewer-thumbs").stopObserving();$("left-nav").stopObserving();$("right-nav").stopObserving();$("photo-frame").stopObserving();$(document).stopObserving("keydown",this.keyHandlerBinding)},embededVideoSrc:function(video){var videohtml="";if(video.videosrc=="youtube"){videohtml=FlipKey.YouTube.init(this,video);videoattr="YouTube"}return'<div id="photo-viewer-'+video.id+'" video="'+videoattr+'" style="'+video.style+'">'+videohtml+"</div>"}};FlipKey.YouTube={jsLoaded:false,ready:false,setDefaults:function(){FlipKey.YouTube.player=null;FlipKey.YouTube.video=null;FlipKey.YouTube.photoViewer=null},init:function(photoViewer,video){this.setDefaults();this.photoViewer=photoViewer;if(!FlipKey.YouTube.jsLoaded){var tag=document.createElement("script");tag.src="http://www.youtube.com/player_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);FlipKey.YouTube.jsLoaded=true}FlipKey.YouTube.video=video;return'<div id="youtube-player"></div>'},create:function(){if(!FlipKey.YouTube.ready){return false}FlipKey.YouTube.player=new YT.Player("youtube-player",{height:this.photoViewer.photoOverview.max_photo_height,width:this.photoViewer.photoOverview.max_photo_width,videoId:FlipKey.YouTube.video.videosrcid,playerVars:{origin:location.host,disablekb:1,rel:0,showinfo:0,showsearch:0,iv_load_policy:3}})},stopVideo:function(){if(FlipKey.YouTube.player&&(typeof FlipKey.YouTube.player.stopVideo=="function")){FlipKey.YouTube.player.stopVideo()}},destroy:function(){if(FlipKey.YouTube.player&&(typeof FlipKey.YouTube.player.stopVideo=="function")){FlipKey.YouTube.player.destroy()}this.setDefaults()}};function onYouTubePlayerAPIReady(){FlipKey.YouTube.ready=true;FlipKey.YouTube.create()}FlipKey.Business={cats:[],businesses:{},init:function(cats){FlipKey.Business.cats=cats;for(var i=0;i<cats.length;i++){FlipKey.Business.businesses[cats[i]]=[];$$("#business-list ."+cats[i]).each(function(biz){FlipKey.Business.businesses[cats[i]].push(biz.clone(true))})}FlipKey.Business.observeDirectoryLinks()},observeDirectoryLinks:function(){$("business-list").on("click",".view-more a",function(event,element){var html="";var cat=element.id.replace(/^view-more-(\w+)$/,"$1");$("business-list").update();FlipKey.Business.removeActiveCategory();for(var i=0;i<FlipKey.Business.businesses[cat].length;i++){FlipKey.Business.updateBusinessList(FlipKey.Business.businesses[cat][i]);FlipKey.Business.setActiveCategory(cat)}$("things-to-do").scrollTo()});$("directory-categories").on("click","li a",function(event,element){var html="";var cat=element.id.replace(/^cat-list-(\w+)$/,"$1");$("business-list").update();FlipKey.Business.removeActiveCategory();if(cat=="featured"){for(cat in FlipKey.Business.businesses){for(var i=0;i<FlipKey.Business.businesses[cat].length;i++){$("business-list").insert(FlipKey.Business.businesses[cat][i].clone(true))}}FlipKey.Business.setActiveCategory("featured")}else{for(var i=0;i<FlipKey.Business.businesses[cat].length;i++){FlipKey.Business.updateBusinessList(FlipKey.Business.businesses[cat][i])}var header_arr=$("business-list").getElementsByClassName("biz-category-header "+cat);header_arr[0].addClassName("first-cat");FlipKey.Business.setActiveCategory(cat)}$("things-to-do").scrollTo()})},removeActiveCategory:function(){var active_cats=$$("#directory-categories .active-cat");var view_more_cats=$$(".view-more a");for(var i=0;i<active_cats.length;i++){$(active_cats[i]).removeClassName("active-cat")}for(var i=0;i<view_more_cats.length;i++){view_more_cats[i].show()}},setActiveCategory:function(cat){$("cat-list-"+cat).addClassName("active-cat");if(cat!="featured"){$("view-more-"+cat).hide()}},updateBusinessList:function(biz){if($(biz).hasClassName("first-biz")){biz=$(biz).clone(true);biz.addClassName("biz-highlight").show();biz.getElementsByClassName("spotlight-text")[0].show();$("business-list").insert(biz)}else{$("business-list").insert($(biz).clone(true).show())}},toggleDescription:function(bizid){$("desc-trunc-"+bizid).toggle();$("desc-full-"+bizid).toggle()}};FlipKey.Homepage={num_image_callouts:0,current_callout_image:0,rotate_timeout:null,imageCalloutPrevious:function(){if(FlipKey.Homepage.current_callout_image-1<0){FlipKey.Homepage.swapCallouts(FlipKey.Homepage.num_image_callouts-1)}else{FlipKey.Homepage.swapCallouts(FlipKey.Homepage.current_callout_image-1)}},imageCalloutNext:function(){if(FlipKey.Homepage.current_callout_image+1>FlipKey.Homepage.num_image_callouts-1){FlipKey.Homepage.swapCallouts(0)}else{FlipKey.Homepage.swapCallouts(FlipKey.Homepage.current_callout_image+1)}},swapCallouts:function(next){FlipKey.Homepage.initImageRotate();$("image-callout-"+FlipKey.Homepage.current_callout_image).hide();$("image-callout-"+next).show();FlipKey.Homepage.current_callout_image=next},validateDate:function(val){pass=/^\d{1,2}[\.\/\-]{1}\d{1,2}[\.\/\-]{1}\d{4}$/.test(val);if(pass){var date=new Date(val);var parts=val.split(/[\.\/\-]/);pass=pass&&parts[0]*1==date.getMonth()+1&&parts[1]*1==date.getDate()&&parts[2]*1==date.getFullYear();var today=new Date();today.setTime(today.getTime()-today.getTime()%86400000);pass=pass&&date.getTime()>=today.getTime()}return pass},beforeSubmitValidation:function(){var count=0;var error={error:{},status:"error"};var location=$("vr-location").getValue();var checkin=$("vr-check-in").getValue();var checkout=$("vr-check-out").getValue();if(location==""||location=="Enter a destination..."){error.error["vr-location"]="Please enter a city or region";count++}if(checkin!="mm/dd/yyyy"&&!this.validateDate(checkin)){error.error["vr-check-in"]="Please enter a valid check-in date.";count++}if(checkout!="mm/dd/yyyy"&&!this.validateDate(checkout)){error.error["vr-check-out"]="Please enter a valid check-out date.";count++}if(count>0){error.msg="<ul>";for(var e in error.error){error.msg+='<li class="general-error">'+error.error[e]+"</li>";$(e).setStyle({border:"1px solid #f00"})}error.msg+="</ul>";$("vr-form-error").update(error.msg).show();return false}return true},initImageRotate:function(){clearTimeout(FlipKey.Homepage.rotate_timeout);FlipKey.Homepage.rotate_timeout=setTimeout(function(){FlipKey.Homepage.imageCalloutNext();FlipKey.Homepage.initImageRotate()},25000)}};var isIE=navigator.userAgent.toLowerCase().indexOf("msie")>-1;var isMoz=document.implementation&&document.implementation.createDocument;var isSafari=((navigator.userAgent.toLowerCase().indexOf("safari")!=-1)&&(navigator.userAgent.toLowerCase().indexOf("mac")!=-1))?true:false;function curvyCorners(){if(typeof(arguments[0])!="object"){throw newCurvyError("First parameter of curvyCorners() must be an object.")}if(typeof(arguments[1])!="object"&&typeof(arguments[1])!="string"){throw newCurvyError("Second parameter of curvyCorners() must be an object or a class name.")}if(typeof(arguments[1])=="string"){var G=0;var A=getElementsByClass(arguments[1])}else{var G=1;var A=arguments}var D=new Array();if(arguments[0].validTags){var F=arguments[0].validTags}else{var F=["div"]}for(var C=G,B=A.length;C<B;C++){var E=A[C].tagName.toLowerCase();if(inArray(F,E)!==false){D[D.length]=new curvyObject(arguments[0],A[C])}}this.objects=D;this.applyCornersToAll=function(){for(var H=0,I=this.objects.length;H<I;H++){this.objects[H].applyCorners()}}}function curvyObject(){this.box=arguments[1];this.settings=arguments[0];this.topContainer=null;this.bottomContainer=null;this.masterCorners=new Array();this.contentDIV=null;var G=get_style(this.box,"height","height");var D=get_style(this.box,"width","width");var A=get_style(this.box,"borderTopWidth","border-top-width");var H=get_style(this.box,"borderTopColor","border-top-color");var C=get_style(this.box,"backgroundColor","background-color");var E=get_style(this.box,"backgroundImage","background-image");var B=get_style(this.box,"position","position");var F=get_style(this.box,"paddingTop","padding-top");this.boxHeight=parseInt(((G!=""&&G!="auto"&&G.indexOf("%")==-1)?G.substring(0,G.indexOf("px")):this.box.scrollHeight));this.boxWidth=parseInt(((D!=""&&D!="auto"&&D.indexOf("%")==-1)?D.substring(0,D.indexOf("px")):this.box.scrollWidth));this.borderWidth=parseInt(((A!=""&&A.indexOf("px")!==-1)?A.slice(0,A.indexOf("px")):0));this.boxColour=format_colour(C);this.boxPadding=parseInt(((F!=""&&F.indexOf("px")!==-1)?F.slice(0,F.indexOf("px")):0));this.borderColour=format_colour(H);this.borderString=this.borderWidth+"px solid "+this.borderColour;this.backgroundImage=((E!="none")?E:"");this.boxContent=this.box.innerHTML;if(B!="absolute"){this.box.style.position="relative"}this.box.style.padding="0px";if(isIE&&D=="auto"&&G=="auto"){this.box.style.width="100%"}if(this.settings.autoPad==true&&this.boxPadding>0){this.box.innerHTML=""}this.applyCorners=function(){for(var Z=0;Z<2;Z++){switch(Z){case 0:if(this.settings.tl||this.settings.tr){var W=document.createElement("DIV");W.style.width="100%";W.style.fontSize="1px";W.style.overflow="hidden";W.style.position="absolute";W.style.paddingLeft=this.borderWidth+"px";W.style.paddingRight=this.borderWidth+"px";var R=Math.max(this.settings.tl?this.settings.tl.radius:0,this.settings.tr?this.settings.tr.radius:0);W.style.height=R+"px";W.style.top=0-R+"px";W.style.left=0-this.borderWidth+"px";this.topContainer=this.box.appendChild(W)}break;case 1:if(this.settings.bl||this.settings.br){var W=document.createElement("DIV");W.style.width="100%";W.style.fontSize="1px";W.style.overflow="hidden";W.style.position="absolute";W.style.paddingLeft=this.borderWidth+"px";W.style.paddingRight=this.borderWidth+"px";var X=Math.max(this.settings.bl?this.settings.bl.radius:0,this.settings.br?this.settings.br.radius:0);W.style.height=X+"px";W.style.bottom=0-X+"px";W.style.left=0-this.borderWidth+"px";this.bottomContainer=this.box.appendChild(W)}break}}if(this.topContainer){this.box.style.borderTopWidth="0px"}if(this.bottomContainer){this.box.style.borderBottomWidth="0px"}var d=["tr","tl","br","bl"];for(var h in d){if(h>-1<4){var c=d[h];if(!this.settings[c]){if(((c=="tr"||c=="tl")&&this.topContainer!=null)||((c=="br"||c=="bl")&&this.bottomContainer!=null)){var V=document.createElement("DIV");V.style.position="relative";V.style.fontSize="1px";V.style.overflow="hidden";if(this.backgroundImage==""){V.style.backgroundColor=this.boxColour}else{V.style.backgroundImage=this.backgroundImage}switch(c){case"tl":V.style.height=R-this.borderWidth+"px";V.style.marginRight=this.settings.tr.radius-(this.borderWidth*2)+"px";V.style.borderLeft=this.borderString;V.style.borderTop=this.borderString;V.style.left=-this.borderWidth+"px";break;case"tr":V.style.height=R-this.borderWidth+"px";V.style.marginLeft=this.settings.tl.radius-(this.borderWidth*2)+"px";V.style.borderRight=this.borderString;V.style.borderTop=this.borderString;V.style.backgroundPosition="-"+(R+this.borderWidth)+"px 0px";V.style.left=this.borderWidth+"px";break;case"bl":V.style.height=X-this.borderWidth+"px";V.style.marginRight=this.settings.br.radius-(this.borderWidth*2)+"px";V.style.borderLeft=this.borderString;V.style.borderBottom=this.borderString;V.style.left=-this.borderWidth+"px";V.style.backgroundPosition="-"+(this.borderWidth)+"px -"+(this.boxHeight+(X+this.borderWidth))+"px";break;case"br":V.style.height=X-this.borderWidth+"px";V.style.marginLeft=this.settings.bl.radius-(this.borderWidth*2)+"px";V.style.borderRight=this.borderString;V.style.borderBottom=this.borderString;V.style.left=this.borderWidth+"px";V.style.backgroundPosition="-"+(X+this.borderWidth)+"px -"+(this.boxHeight+(X+this.borderWidth))+"px";break}}}else{if(this.masterCorners[this.settings[c].radius]){var V=this.masterCorners[this.settings[c].radius].cloneNode(true)}else{var V=document.createElement("DIV");V.style.height=this.settings[c].radius+"px";V.style.width=this.settings[c].radius+"px";V.style.position="absolute";V.style.fontSize="1px";V.style.overflow="hidden";var M=parseInt(this.settings[c].radius-this.borderWidth);for(var T=0,g=this.settings[c].radius;T<g;T++){if((T+1)>=M){var O=-1}else{var O=(Math.floor(Math.sqrt(Math.pow(M,2)-Math.pow((T+1),2)))-1)}if(M!=g){if((T)>=M){var L=-1}else{var L=Math.ceil(Math.sqrt(Math.pow(M,2)-Math.pow(T,2)))}if((T+1)>=g){var J=-1}else{var J=(Math.floor(Math.sqrt(Math.pow(g,2)-Math.pow((T+1),2)))-1)}}if((T)>=g){var I=-1}else{var I=Math.ceil(Math.sqrt(Math.pow(g,2)-Math.pow(T,2)))}if(O>-1){this.drawPixel(T,0,this.boxColour,100,(O+1),V,-1,this.settings[c].radius)}if(M!=g){for(var S=(O+1);S<L;S++){if(this.settings.antiAlias){if(this.backgroundImage!=""){var K=(pixelFraction(T,S,M)*100);if(K<30){this.drawPixel(T,S,this.borderColour,100,1,V,0,this.settings[c].radius)}else{this.drawPixel(T,S,this.borderColour,100,1,V,-1,this.settings[c].radius)}}else{var b=BlendColour(this.boxColour,this.borderColour,pixelFraction(T,S,M));this.drawPixel(T,S,b,100,1,V,0,this.settings[c].radius,c)}}}if(this.settings.antiAlias){if(J>=L){if(L==-1){L=0}this.drawPixel(T,L,this.borderColour,100,(J-L+1),V,0,0)}}else{if(J>=O){this.drawPixel(T,(O+1),this.borderColour,100,(J-O),V,0,0)}}var Q=this.borderColour}else{var Q=this.boxColour;var J=O}if(this.settings.antiAlias){for(var S=(J+1);S<I;S++){this.drawPixel(T,S,Q,(pixelFraction(T,S,g)*100),1,V,((this.borderWidth>0)?0:-1),this.settings[c].radius)}}}this.masterCorners[this.settings[c].radius]=V.cloneNode(true)}if(c!="br"){for(var Z=0,f=V.childNodes.length;Z<f;Z++){var U=V.childNodes[Z];var e=parseInt(U.style.top.substring(0,U.style.top.indexOf("px")));var m=parseInt(U.style.left.substring(0,U.style.left.indexOf("px")));var o=parseInt(U.style.height.substring(0,U.style.height.indexOf("px")));if(c=="tl"||c=="bl"){U.style.left=this.settings[c].radius-m-1+"px"}if(c=="tr"||c=="tl"){U.style.top=this.settings[c].radius-o-e+"px"}switch(c){case"tr":U.style.backgroundPosition="-"+Math.abs((this.boxWidth-this.settings[c].radius+this.borderWidth)+m)+"px -"+Math.abs(this.settings[c].radius-o-e-this.borderWidth)+"px";break;case"tl":U.style.backgroundPosition="-"+Math.abs((this.settings[c].radius-m-1)-this.borderWidth)+"px -"+Math.abs(this.settings[c].radius-o-e-this.borderWidth)+"px";break;case"bl":U.style.backgroundPosition="-"+Math.abs((this.settings[c].radius-m-1)-this.borderWidth)+"px -"+Math.abs((this.boxHeight+this.settings[c].radius+e)-this.borderWidth)+"px";break}}}}if(V){switch(c){case"tl":if(V.style.position=="absolute"){V.style.top="0px"}if(V.style.position=="absolute"){V.style.left="0px"}if(this.topContainer){this.topContainer.appendChild(V)}break;case"tr":if(V.style.position=="absolute"){V.style.top="0px"}if(V.style.position=="absolute"){V.style.right="0px"}if(this.topContainer){this.topContainer.appendChild(V)}break;case"bl":if(V.style.position=="absolute"){V.style.bottom="0px"}if(V.style.position=="absolute"){V.style.left="0px"}if(this.bottomContainer){this.bottomContainer.appendChild(V)}break;case"br":if(V.style.position=="absolute"){V.style.bottom="0px"}if(V.style.position=="absolute"){V.style.right="0px"}if(this.bottomContainer){this.bottomContainer.appendChild(V)}break}}}}var Y=new Array();Y.t=Math.abs(this.settings.tl.radius-this.settings.tr.radius);Y.b=Math.abs(this.settings.bl.radius-this.settings.br.radius);for(z in Y){if(z=="t"||z=="b"){if(Y[z]){var l=((this.settings[z+"l"].radius<this.settings[z+"r"].radius)?z+"l":z+"r");var N=document.createElement("DIV");N.style.height=Y[z]+"px";N.style.width=this.settings[l].radius+"px";N.style.position="absolute";N.style.fontSize="1px";N.style.overflow="hidden";N.style.backgroundColor=this.boxColour;switch(l){case"tl":N.style.bottom="0px";N.style.left="0px";N.style.borderLeft=this.borderString;this.topContainer.appendChild(N);break;case"tr":N.style.bottom="0px";N.style.right="0px";N.style.borderRight=this.borderString;this.topContainer.appendChild(N);break;case"bl":N.style.top="0px";N.style.left="0px";N.style.borderLeft=this.borderString;this.bottomContainer.appendChild(N);break;case"br":N.style.top="0px";N.style.right="0px";N.style.borderRight=this.borderString;this.bottomContainer.appendChild(N);break}}var P=document.createElement("DIV");P.style.position="relative";P.style.fontSize="1px";P.style.overflow="hidden";P.style.backgroundColor=this.boxColour;P.style.backgroundImage=this.backgroundImage;switch(z){case"t":if(this.topContainer){if(this.settings.tl.radius&&this.settings.tr.radius){P.style.height=R-this.borderWidth+"px";P.style.marginLeft=this.settings.tl.radius-this.borderWidth+"px";P.style.marginRight=this.settings.tr.radius-this.borderWidth+"px";P.style.borderTop=this.borderString;if(this.backgroundImage!=""){P.style.backgroundPosition="-"+(R-this.borderWidth)+"px 0px"}this.topContainer.appendChild(P)}this.box.style.backgroundPosition="0px -"+(R-this.borderWidth)+"px"}break;case"b":if(this.bottomContainer){if(this.settings.bl.radius&&this.settings.br.radius){P.style.height=X-this.borderWidth+"px";P.style.marginLeft=this.settings.bl.radius-this.borderWidth+"px";P.style.marginRight=this.settings.br.radius-this.borderWidth+"px";P.style.borderBottom=this.borderString;if(this.backgroundImage!=""){P.style.backgroundPosition="-"+(X-this.borderWidth)+"px -"+(this.boxHeight+(R-this.borderWidth))+"px"}this.bottomContainer.appendChild(P)}}break}}}if(this.settings.autoPad==true&&this.boxPadding>0){var a=document.createElement("DIV");a.style.position="relative";a.innerHTML=this.boxContent;a.className="autoPadDiv";var n=Math.abs(R-this.boxPadding);var p=Math.abs(X-this.boxPadding);if(R<this.boxPadding){a.style.paddingTop=n+"px"}if(X<this.boxPadding){a.style.paddingBottom=X+"px"}a.style.paddingLeft=this.boxPadding+"px";a.style.paddingRight=this.boxPadding+"px";this.contentDIV=this.box.appendChild(a)}};this.drawPixel=function(R,O,I,N,P,Q,K,M){var J=document.createElement("DIV");J.style.height=P+"px";J.style.width="1px";J.style.position="absolute";J.style.fontSize="1px";J.style.overflow="hidden";var L=Math.max(this.settings.tr.radius,this.settings.tl.radius);if(K==-1&&this.backgroundImage!=""){J.style.backgroundImage=this.backgroundImage;J.style.backgroundPosition="-"+(this.boxWidth-(M-R)+this.borderWidth)+"px -"+((this.boxHeight+L+O)-this.borderWidth)+"px"}else{J.style.backgroundColor=I}if(N!=100){setOpacity(J,N)}J.style.top=O+"px";J.style.left=R+"px";Q.appendChild(J)}}function insertAfter(B,C,A){B.insertBefore(C,A.nextSibling)}function BlendColour(L,J,G){var D=parseInt(L.substr(1,2),16);var K=parseInt(L.substr(3,2),16);var F=parseInt(L.substr(5,2),16);var C=parseInt(J.substr(1,2),16);var I=parseInt(J.substr(3,2),16);var E=parseInt(J.substr(5,2),16);if(G>1||G<0){G=1}var H=Math.round((D*G)+(C*(1-G)));if(H>255){H=255}if(H<0){H=0}var B=Math.round((K*G)+(I*(1-G)));if(B>255){B=255}if(B<0){B=0}var A=Math.round((F*G)+(E*(1-G)));if(A>255){A=255}if(A<0){A=0}return"#"+IntToHex(H)+IntToHex(B)+IntToHex(A)}function IntToHex(A){base=A/16;rem=A%16;base=base-(rem/16);baseS=MakeHex(base);remS=MakeHex(rem);return baseS+""+remS}function MakeHex(A){if((A>=0)&&(A<=9)){return A}else{switch(A){case 10:return"A";case 11:return"B";case 12:return"C";case 13:return"D";case 14:return"E";case 15:return"F"}}}function pixelFraction(H,G,A){var C=0;var B=new Array(1);var F=new Array(1);var I=0;var D="";var E=Math.sqrt((Math.pow(A,2)-Math.pow(H,2)));if((E>=G)&&(E<(G+1))){D="Left";B[I]=0;F[I]=E-G;I=I+1}var E=Math.sqrt((Math.pow(A,2)-Math.pow(G+1,2)));if((E>=H)&&(E<(H+1))){D=D+"Top";B[I]=E-H;F[I]=1;I=I+1}var E=Math.sqrt((Math.pow(A,2)-Math.pow(H+1,2)));if((E>=G)&&(E<(G+1))){D=D+"Right";B[I]=1;F[I]=E-G;I=I+1}var E=Math.sqrt((Math.pow(A,2)-Math.pow(G,2)));if((E>=H)&&(E<(H+1))){D=D+"Bottom";B[I]=E-H;F[I]=0}switch(D){case"LeftRight":C=Math.min(F[0],F[1])+((Math.max(F[0],F[1])-Math.min(F[0],F[1]))/2);break;case"TopRight":C=1-(((1-B[0])*(1-F[1]))/2);break;case"TopBottom":C=Math.min(B[0],B[1])+((Math.max(B[0],B[1])-Math.min(B[0],B[1]))/2);break;case"LeftBottom":C=(F[0]*B[1])/2;break;default:C=1}return C}function rgb2Hex(B){try{var C=rgb2Array(B);var G=parseInt(C[0]);var E=parseInt(C[1]);var A=parseInt(C[2]);var D="#"+IntToHex(G)+IntToHex(E)+IntToHex(A)}catch(F){alert("There was an error converting the RGB value to Hexadecimal in function rgb2Hex")}return D}function rgb2Array(A){var C=A.substring(4,A.indexOf(")"));var B=C.split(", ");return B}function setOpacity(F,C){C=(C==100)?99.999:C;if(isSafari&&F.tagName!="IFRAME"){var B=rgb2Array(F.style.backgroundColor);var E=parseInt(B[0]);var D=parseInt(B[1]);var A=parseInt(B[2]);F.style.backgroundColor="rgba("+E+", "+D+", "+A+", "+C/100+")"}else{if(typeof(F.style.opacity)!="undefined"){F.style.opacity=C/100}else{if(typeof(F.style.MozOpacity)!="undefined"){F.style.MozOpacity=C/100}else{if(typeof(F.style.filter)!="undefined"){F.style.filter="alpha(opacity:"+C+")"}else{if(typeof(F.style.KHTMLOpacity)!="undefined"){F.style.KHTMLOpacity=C/100}}}}}}function inArray(C,B){for(var A=0;A<C.length;A++){if(C[A]===B){return A}}return false}function inArrayKey(B,A){for(key in B){if(key===A){return true}}return false}function addEvent(E,D,B,A){if(E.addEventListener){E.addEventListener(D,B,A);return true}else{if(E.attachEvent){var C=E.attachEvent("on"+D,B);return C}else{E["on"+D]=B}}}function removeEvent(E,D,B,A){if(E.removeEventListener){E.removeEventListener(D,B,A);return true}else{if(E.detachEvent){var C=E.detachEvent("on"+D,B);return C}else{alert("Handler could not be removed")}}}function format_colour(B){var A="#ffffff";if(B!=""&&B!="transparent"){if(B.substr(0,3)=="rgb"){A=rgb2Hex(B)}else{if(B.length==4){A="#"+B.substring(1,2)+B.substring(1,2)+B.substring(2,3)+B.substring(2,3)+B.substring(3,4)+B.substring(3,4)}else{A=B}}}return A}function get_style(obj,property,propertyNS){try{if(obj.currentStyle){var returnVal=eval("obj.currentStyle."+property)}else{if(isSafari&&obj.style.display=="none"){obj.style.display="";var wasHidden=true}var returnVal=document.defaultView.getComputedStyle(obj,"").getPropertyValue(propertyNS);if(isSafari&&wasHidden){obj.style.display="none"}}}catch(e){}return returnVal}function getElementsByClass(G,E,A){var D=new Array();if(E==null){E=document}if(A==null){A="*"}var C=E.getElementsByTagName(A);var B=C.length;var F=new RegExp("(^|s)"+G+"(s|$)");for(i=0,j=0;i<B;i++){if(F.test(C[i].className)){D[j]=C[i];j++}}return D}function newCurvyError(A){return new Error("curvyCorners Error:\n"+A)};